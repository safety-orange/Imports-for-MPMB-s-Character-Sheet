var iFileName = "all_WotC_published.js";
var iFileName = "pub_20140715_LMoP.js";
RequiredSheetVersion(13);
// This file adds the magic items from the Lost Mines of Phandelver adventure from the D&D 5e starter set to MPMB's Character Record Sheet

// Define the source
SourceList["LMoP"] = {
	name : "Lost Mines of Phandelver [items]",
	abbreviation : "LMoP",
	group : "Adventure Books",
	url : "https:/http://dnd.wizards.com/products/tabletop-games/rpg-products/rpg_starterset",
	date : "2014/07/15"
};

// Magic Items
MagicItemsList["dragonguard"] = {
	name : "Dragonguard",
	source : ["LMoP", 48],
	type : "armor (breastplate)",
	rarity : "rare",
	magicItemTable : "G",
	description : "This +1 breastplate has a gold dragon motif worked into its design. It grants its wearer advantage on saving throws against the breath weapons of creatures that have the dragon type.",
	descriptionFull : "This +1 breastplate has a gold dragon motif worked into its design. Created for a human hero of Neverwinter named Tergon, it grants its wearer advantage on saving throws against the breath weapons of creatures that have the dragon type.",
	weight : 20,
	addArmor: "Dragonguard",
	armorOptions: {
		regExpSearch: /dragonguard/i,
		name : "Dragonguard",
		source : ["LMoP", 48],
		type : "medium",
		ac : 14,
		weight : 20
	},
	savetxt : { adv_vs : ["breath weapons of dragons"] }
}
MagicItemsList["hew"] = {
	name : "Hew",
	source : ["LMoP", 33],
	type : "weapon (battleaxe)",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "This rusty old battleaxe has runes in Dwarvish on its head which read \"Hew\". It deals maximum damage against plant creatures or an object made of wood. While carrying the axe and travelling through a forest, I feel uneasy. Its creator was a dwarf smith who feuded with the dryads of a forest where he cut firewood.",
	descriptionFull : "This rusty old battleaxe has runes in Dwarvish on the axe head which read \"Hew\". It deals maximum damage when the wielder hits a plant creature or an object made of wood. The axe's creator was a dwarf smith who feuded with the dryads of a forest where he cut firewood. Whoever carries the axe feels uneasy whenever he or she travels through a forest.",
	weight : 4,
	weaponsAdd : ["Hew"],
	weaponOptions : {
		baseWeapon : "battleaxe",
		regExpSearch : /hew/i,
		name : "Hew",
		source : ["LMoP", 33],
		description : "Versatile (1d10); Max damage against plant creatures and wooden objects"
	}
}
MagicItemsList["lightbringer"] = {
	name : "Lightbringer",
	source : ["LMoP", 48],
	type : "weapon (mace)",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "This mace adds a +1 bonus to attack and damage rolls made with it. It is made for a cleric of the god of dawn, with its head of shaped like a sunburst and made of solid brass. I can command it to glow as bright as a torch. While glowing, the mace deals an extra 1d6 radiant damage to undead creatures.",
	descriptionFull : "This +1 mace was made for a cleric of Lathander, the god of dawn. The head of the mace is shaped like a sunburst and made of solid brass. Named Lightbringer, this weapon glows as bright as a torch when its wielder commands. While glowing, the mace deals an extra 1d6 radiant damage to undead creatures.",
	weight : 4,
	weaponsAdd : ["Lightbringer"],
	weaponOptions : {
		baseWeapon : "mace",
		regExpSearch : /lightbringer/i,
		name : "Lightbringer",
		source : ["LMoP", 48],
		description : "Command to glow as torch and deal +1d6 radiant damage to undead",
		modifiers : [1, 1]
	}
}
MagicItemsList["spider staff"] = {
	name : "Spider Staff",
	source : ["LMoP", 53],
	type : "staff",
	rarity : "rare",
	magicItemTable : "G",
	description : "Attacks with this black adamantine quarterstaff toped with a spider deal +1d6 poison damage on a hit. It has 10 charges and regains 1d6+4 expended charges at dawn. If I use its last charge, roll a d20. On a 1, it is destroyed. I can use its charges to cast Spider Climb (1 charge) or Web (2 charges, spell save DC 15).",
	descriptionFull : "The top of this black, adamantine staff is shaped like a spider. The staff weighs 6 pounds. You must be attuned to the staff to gain its benefits and cast its spells. The staff can be wielded as a quarterstaff. It deals 1d6 extra poison damage on a hit when used to make a weapon attack.\n   The staff has 10 charges, which are used to fuel the spells within it. With the staff in hand, you can use your action to cast one of the following spells from the staff if the spell is on your class's spell list: Spider Climb (1 charge) or Web (2 charges, spell save DC 15). No components are required.\n   The staff regains 1d6+4 expended charges each day at dusk. If you expend the staff's last charge, roll a d20. On a 1, the staff crumbles to dust and is destroyed.",
	attunement : true,
	weight : 6,
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	weaponsAdd : ["Spider Staff"],
	weaponOptions : {
		baseWeapon : "quarterstaff",
		regExpSearch : /^(?=.*spider)(?=.*staff).*$/i,
		name : "Spider Staff",
		source : ["LMoP", 53],
		description : "Versatile (1d8); +1d6 poison damage"
	},
	fixedDC : 15,
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["spider climb"],
		selection : ["spider climb"],
		firstCol : 1
	}, {
		name : "2 charges",
		spells : ["web"],
		selection : ["web"],
		firstCol : 2
	}]
}
MagicItemsList["staff of defense"] = {
	name : "Staff of Defense",
	source : ["LMoP", 53],
	type : "staff",
	rarity : "rare",
	magicItemTable : "G",
	description : "This slender, hollow staff is made of glass yet is as strong as oak. While holding it, I gain a +1 bonus to AC. It has 10 charges and regains 1d6+4 expended charges at dawn. If I use its last charge, roll a d20. On a 1, it is destroyed. I can use its charges to cast Mage Armor (1 charge) or Shield (2 charges) as an action.",
	descriptionFull : "This slender, hollow staff is made of glass yet is as strong as oak. It weighs 3 pounds. You must be attuned to the staff to gain its benefits and cast its spells.\n   While holding the staff, you have a +1 bonus to your Armor Class.\n   The staff has 10 charges, which are used to fuel the spells within it. With the staff in hand, you can use your action to cast one of the following spells from the staff if the spell is on your class's spell list: Mage Armor (1 charge) or Shield (2 charges). No components are required.\n   The staff regains 1d6+4 expended charges each day at dawn. If you expend the staff's last charge, roll a d20. On a 1, the staff shatters and is destroyed.",
	attunement : true,
	weight : 3,
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	spellcastingAbility : "class",
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["mage armor"],
		selection : ["mage armor"],
		firstCol : 1
	}, {
		name : "2 charges",
		spells : ["shield"],
		selection : ["shield"],
		firstCol : 2
	}],
	spellChanges : {
		"shield" : {
			time : "1 a",
			changes : "Cast as an action."
		}
	},
	extraAC : [{name : "Staff of Defense", mod : 1, magic : true, text : "I gain a +1 bonus to AC while holding the Staff of Defense."}],
}
var iFileName = "pub_20140818_PHB.js";
RequiredSheetVersion(13);
// This file adds all material from the Player's Handbook to MPMB's Character Record Sheet

// Define the source
SourceList.P={
	name : "Player's Handbook",
	abbreviation : "PHB",
	group : "Primary Sources",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/rpg_playershandbook",
	date : "2014/08/19"
};

// (sub)Races that are not in the SRD
RaceList["mountain dwarf"] = {
	regExpSearch : /^((?=.*(hylar|daewar))|((?=.*\b(dwarfs?|dwarves|dwarfish|dwarvish|dwarven)\b)(?=.*\b(mountain|shield)\b))).*$/i,
	name : "Mountain dwarf",
	sortname : "Dwarf, Mountain",
	source : ["P", 20],
	plural : "Mountain dwarves",
	size : 3,
	speed : {
		walk : { spd : 25, enc : 25 }
	},
	languageProfs : ["Common", "Dwarvish"],
	vision : [["Darkvision", 60]],
	savetxt : { adv_vs : ["poison"] },
	dmgres : ["Poison"],
	weaponProfs : [false, false, ["battleaxe", "handaxe", "warhammer", "light hammer"]],
	armorProfs : [true, true, false, false],
	toolProfs : [["Smith, brewer, or mason tools", 1]],
	age : " are considered young until they are 50 and live about 350 years",
	height : " stand between 4 and 5 feet tall (4' + 2d4\")",
	weight : " weigh around 150 lb (130 + 2d4 \xD7 2d6 lb)",
	heightMetric : " stand between 1,2 and 1,5 metres tall (120 + 5d4 cm)",
	weightMetric : " weigh around 75 kg (60 + 5d4 \xD7 4d6 / 10 kg)",
	scores : [2, 0, 2, 0, 0, 0],
	trait : "Mountain Dwarf (+2 Strength, +2 Constitution)\n\nStonecunning:\n   Whenever I make an Intelligence (History) check related to the origin of stonework, I am considered proficient in the History skill and add double my proficiency bonus to the check, instead of my normal proficiency bonus."
};
RaceList["dark elf"] = {
	regExpSearch : /^(?!.*half)((?=.*drow)|((?=.*\b(elfs?|elves|elvish|elven)\b)(?=.*\b(dark|underdarks?|deep|depths?)\b))).*$/i,
	name : "Drow",
	sortname : "Elf, Dark (Drow)",
	source : ["P", 24],
	plural : "Drow",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Elvish"],
	vision : [["Darkvision", 120], ["Sunlight Sensitivity", 0]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	weaponProfs : [false, false, ["rapier", "shortsword", "hand crossbow"]],
	skills : ["Perception"],
	age : " typically claim adulthood around age 100 and can live to be 750 years old",
	height : " range from under 5 to 5 1/2 feet tall (4'5\" + 2d6\")",
	weight : " weigh around 100 lb (75 + 2d6 \xD7 1d6 lb)",
	heightMetric : " range from under 1,5 to 1,7 metres tall (135 + 5d6 cm)",
	weightMetric : " weigh around 45 kg (35 + 5d6 \xD7 2d6 / 10 kg)",
	scores : [0, 2, 0, 0, 0, 1],
	trait : "Drow (+2 Dexterity, +1 Charisma)\nTrance: Elves don't need to sleep, but meditate semiconsciously, for 4 hours a day. This gives the same benefit as a human gets from 8 hours of sleep (long rest takes only 4 hours).\nSunlight Sensitivity: Disadvantage on attack rolls and Wisdom (Perception) checks that rely on sight when I or what I am trying to attack/perceive is in direct sunlight.\nDrow Magic: 1st level: Dancing Lights cantrip; 3rd level: Faerie Fire; 5th level: Darkness. Both spells can be used once per long rest. Charisma is my spellcasting ability for these.", // errata to specify once per day is long rest
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Drow Magic (level 1)",
		spells : ["dancing lights"],
		selection : ["dancing lights"],
		firstCol : "atwill"
	},
	features : {
		"faerie fire" : {
			name : "Drow Magic (level 3)",
			limfeaname : "Faerie Fire",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Drow Magic (level 3)",
				spells : ["faerie fire"],
				selection : ["faerie fire"],
				firstCol : "oncelr"
			}
		},
		"darkness" : {
			name : "Drow Magic (level 5)",
			limfeaname : "Darkness",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Drow Magic (level 5)",
				spells : ["darkness"],
				selection : ["darkness"],
				firstCol : "oncelr"
			}
		}
	}
};
RaceList["wood elf"] = {
	regExpSearch : /^(?!.*half)((?=.*(grugach|kagonesti|silhana))|((?=.*\b(elfs?|elves|elvish|elven)\b)(?=.*\b(woodlands?|woods?|forests?|wilds?|green)\b))).*$/i,
	name : "Wood elf",
	sortname : "Elf, Wood",
	source : ["P", 24],
	plural : "Wood elves",
	size : 3,
	speed : {
		walk : { spd : 35, enc : 25 }
	},
	languageProfs : ["Common", "Elvish"],
	vision : [["Darkvision", 60]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	weaponProfs : [false, false, ["longsword", "shortsword", "longbow", "shortbow"]],
	skills : ["Perception"],
	age : " typically claim adulthood around age 100 and can live to be 750 years old",
	height : " range from under 5 to over 6 feet tall (4'6\" + 2d10\")",
	weight : " weigh around 115 lb (90 + 2d10 \xD7 1d4 lb)",
	heightMetric : " range from under 1,5 to over 1,8 metres tall (140 + 5d10 cm)",
	weightMetric : " weigh around 55 kg (40 + 5d10 \xD7 2d4 / 10 kg)",
	scores : [0, 2, 0, 0, 1, 0],
	trait : "Wood Elf (+2 Dexterity, +1 Wisdom)\nTrance: Elves don't need to sleep, but meditate semiconsciously, for 4 hours a day. While meditating, I can dream after a fashion; such dreams are actually mental exercises that have become reflexive through years of practice. After resting in this way, I gain the same benefit that a human does from 8 hours of sleep, thus needing only 4 hours for a long rest.\nMask of the Wild: I can attempt to hide even when I am only lightly obscured by foliage, heavy rain, falling snow, mist, and other natural phenomena."
};
RaceList["forest gnome"] = {
	regExpSearch : /^((?=.*\bgnomes?\b)(?=.*\b(woods?|forests?|wilds?|green)\b)).*$/i,
	name : "Forest gnome",
	sortname : "Gnome, Forest",
	source : ["P", 37],
	plural : "Forest gnomes",
	size : 4,
	speed : {
		walk : { spd : 25, enc : 15 }
	},
	languageProfs : ["Common", "Gnomish"],
	vision : [["Darkvision", 60]],
	savetxt : { text : ["Adv. on Int/Wis/Cha saves vs. magic"] },
	age : " start adult life around age 40 and can live 350 to almost 500 years",
	height : " are 3 to 4 feet tall (2'11\" + 2d4\")",
	weight : " weigh around 40 lb (35 + 2d4 lb)",
	heightMetric : " are 90 to 120 cm tall (2'11\" + 5d4)",
	weightMetric : " weigh around 18 kg (16 + 5d4 / 10 kg)",
	scores : [0, 1, 0, 2, 0, 0],
	trait : "Forest Gnome (+1 Dexterity, +2 Intelligence)" + (typePF ? "\n" : " ") + "\nNatural Illusionist:\n   I know the Minor Illusion cantrip. Intelligence is my spellcasting ability for it.\n\nSpeak with Small Beasts:\n   Through sounds and gestures, I can communicate simple ideas with Small or smaller beasts.",
	spellcastingAbility : 4,
	spellcastingBonus : {
		name : "Natural Illusionist",
		spells : ["minor illusion"],
		selection : ["minor illusion"],
		firstCol : "atwill"
	}
};
RaceList["stout halfling"] = {
	regExpSearch : /^(?=.*\b(halflings?|hobbits?)\b)(?=.*stout).*$/i,
	name : "Stout halfling",
	sortname : "Halfling, Stout",
	source : ["P", 28],
	plural : "Stout halflings",
	size : 4,
	speed : {
		walk : { spd : 25, enc : 15 }
	},
	languageProfs : ["Common", "Halfling"],
	savetxt : { adv_vs : ["frightened", "poison"] },
	dmgres : ["Poison"],
	age : " reach adulthood at age 20 and live around 150 years",
	height : " average about 3 feet tall (2'7\" + 2d4\")",
	weight : " weigh around 40 lb (35 + 2d4 lb)",
	heightMetric : " average about 90 cm tall (80 + 5d4)",
	weightMetric : " weigh around 18 kg (16 + 5d4 / 10 kg)",
	scores : [0, 2, 1, 0, 0, 0],
	trait : "Stout Halfling (+2 Dexterity, +1 Constitution)\n\nLucky: When I roll a 1 on an attack roll, ability check, or saving throw, I can reroll the die and must use the new roll.\n\nHalfling Nimbleness: I can move through the space of any creature that is of a size larger than me."
};

// Add racial variants that are not part of the SRD
AddRacialVariant("human", "variant", {
	regExpSearch : /variant/i,
	source : ["P", 31],
	skillstxt : "Choose any one skill",
	scorestxt : "+1 to two different ability scores of my choice",
	scores : [0, 0, 0, 0, 0, 0],
	trait : "Human (+1 to two different ability scores of my choice)\n\nSkills: I gain proficiency in one skill of my choice.\n\nFeat: I gain one feat of my choice.",
	eval : function() { AddString('Feat Note 1', 'Human bonus feat', '; '); },
	removeeval : function() { RemoveString('Feat Note 1', 'Human bonus feat'); }
});

// Add the subclasses that are not in the SRD
AddSubClass("barbarian", "totem warrior", {
	regExpSearch : /^(?=.*totem)(?=.*(warrior|fighter|marauder|barbarian|viking|(norse|tribes?|clans?)(wo)?m(a|e)n)).*$/i,
	subname : "Path of the Totem Warrior",
	fullname : "Totem Warrior",
	source : ["P", 50],
	features : {
		"subclassfeature3" : {
			name : "Spirit Seeker",
			source : ["P", 50],
			minlevel : 3,
			description : "\n   " + "I can cast Beast Sense and Speak with Animals as rituals (PHB 217 \u0026 277)",
			spellcastingBonus : {
				name : "Spirit Seeker",
				spells : ["beast sense", "speak with animals"],
				selection : ["beast sense", "speak with animals"],
				firstCol : "(R)",
				times : 2
			},
			spellChanges : {
				"beast sense" : {
					time : "10 min",
					changes : "I can cast this spell only as a ritual, thus its casting time is 10 minutes longer."
				},
				"speak with animals" : {
					time : "10 min",
					changes : "I can cast this spell only as a ritual, thus its casting time is 10 minutes longer."
				}
			}
		},
		"subclassfeature3.1" : {
			name : "Totem Spirit",
			source : ["P", 50],
			minlevel : 3,
			description : "\n   " + "Choose Bear, Eagle, Elk, Wolf, or Tiger Spirit using the \"Choose Feature\" button above",
			choices : ["Bear", "Eagle", "Wolf"],
			"bear" : {
				name : "Bear Spirit",
				description : "\n   " + "While raging, I have resistance to all damage types except psychic",
				dmgres : [["All -Psychic", "All -Psychic (rage)"]],
				eval : function() {
					processResistance(false, 'Barbarian: Rage', ClassList.barbarian.features.rage.dmgres);
				},
				removeeval : function() {
					processResistance(true, 'Barbarian: Rage', ClassList.barbarian.features.rage.dmgres);
				}
			},
			"eagle" : {
				name : "Eagle Spirit",
				description : "\n   " + "While raging without heavy armor, others have disadv. on opportunity attacks vs. me" + "\n   " + "I can use the Dash action as a bonus action",
				action : ["bonus action", " (Dash)"]
			},
			"wolf" : {
				name : "Wolf Spirit",
				description : "\n   " + "While raging, friends have advantage on melee attacks vs. hostiles within 5 ft of me"
			}
		},
		"subclassfeature6" : {
			name : "Aspect of the Beast",
			source : ["P", 50],
			minlevel : 6,
			description : "\n   " + "Choose Bear, Eagle, Elk, Wolf, or Tiger Aspect using the \"Choose Feature\" button above",
			choices : ["Bear", "Eagle", "Wolf"],
			"bear" : {
				name : "Aspect of the Bear",
				description : "\n   " + "Advantage on Strength checks to push/pull/lift/break; Carrying capacity is doubled",
				carryingCapacity : 2
			},
			"eagle" : {
				name : "Aspect of the Eagle",
				description : "\n   " + "I can see up to 1 mile away perfectly; No disadvantage on Perception from dim light"
			},
			"wolf" : {
				name : "Aspect of the Wolf",
				description : "\n   " + "I can track while traveling at a fast pace; I can move stealthily at a normal pace"
			}
		},
		"subclassfeature10" : {
			name : "Spirit Walker",
			source : ["P", 50],
			minlevel : 10,
			description : "\n   " + "I can cast Commune with Nature as a ritual",
			spellcastingBonus : {
				name : "Spirit Walker",
				spells : ["commune with nature"],
				selection : ["commune with nature"],
				firstCol : "(R)"
			},
			spellChanges : {
				"commune with nature" : {
					time : "11 min",
					changes : "I can cast this spell only as a ritual, thus its casting time is 10 minutes longer."
				}
			}
		},
		"subclassfeature14" : {
			name : "Totemic Attunement",
			source : ["P", 50],
			minlevel : 14,
			description : "\n   " + "Choose Bear, Eagle, Elk, Wolf, or Tiger Attunement using the \"Choose Feature\" button",
			choices : ["Bear", "Eagle", "Wolf"],
			"bear" : {
				name : "Bear Attunement",
				description : "\n   " + "While raging, any creature that sees me within 5 ft has disadv. on attacks vs. others" + "\n   " + "Enemies that can't perceive me or be frightened are immune"
			},
			"eagle" : {
				name : "Eagle Attunement",
				description : "\n   " + "While raging, I can fly at my current speed, but I can only stay aloft during my turn"
			},
			"wolf" : {
				name : "Wolf Attunement",
				description : "\n   " + "If my melee attack hits while raging, I can knock prone as a bonus action (up to Large)",
				action : ["bonus action", " (raging: knock prone)"]
			}
		}
	}
});
AddSubClass("bard", "college of valor", {
	regExpSearch : /^(?=.*(college|bard|minstrel|troubadour|jongleur))(?=.*valor).*$/i,
	subname : "College of Valor",
	source : ["P", 55],
	attacks : [1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
	features : {
		"subclassfeature3" : {
			name : "Bonus Proficiencies",
			source : ["P", 55],
			minlevel : 3,
			description : "\n   " + "I gain proficiency with medium armor, shields, and martial weapons",
			armorProfs : [false, true, false, true],
			weaponProfs : [false, true]
		},
		"subclassfeature3.1" : {
			name : "Combat Inspiration",
			source : ["P", 55],
			minlevel : 3,
			description : "\n   " + "My Bardic Inspiration can also be used to add the die to a weapon damage roll" + "\n   " + "Alternatively, it can be used as a reaction to add the die to AC against one attack"
		},
		"subclassfeature14" : {
			name : "Battle Magic",
			source : ["P", 55],
			minlevel : 14,
			description : "\n   " + "As a bonus action when I use my action to cast a bard spell, I can make a weapon attack",
			action : ["bonus action", " (with Bard spell)"]
		}
	}
});
AddSubClass("cleric", "knowledge domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*(knowledge|wisdom|learning)).*$/i,
	subname : "Knowledge Domain",
	source : ["P", 59],
	spellcastingExtra : ["command", "identify", "augury", "suggestion", "nondetection", "speak with dead", "arcane eye", "confusion", "legend lore", "scrying"],
	features : {
		"subclassfeature1" : {
			name : "Blessings of Knowledge",
			source : ["P", 59],
			minlevel : 1,
			description : "\n   " + "I learn two languages and gain proficiency and expertise with two skills" + "\n   " + "I can choose from the following: Arcana, History, Nature, or Religion",
			skillstxt : "Choose two from Arcana, History, Nature, and Religion. You also gain expertise with these skills",
			languageProfs : [2]
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Knowledge of Ages",
			source : ["P", 59],
			minlevel : 2,
			description : "\n   " + "As an action, I gain proficiency with a chosen skill or tool for 10 minutes",
			action : ["action", ""]
		},
		"subclassfeature6" : {
			name : "Channel Divinity: Read Thoughts",
			source : ["P", 59],
			minlevel : 6,
			description : "\n   " + "As an action, one creature within 60 ft I can see must make a Wisdom save" + "\n   " + "If it fails, I can read its surface thoughts for 1 min, as long as it's within 60 ft of me" + "\n   " + "As an action, I can end this and cast Suggestion on it (it fails its save automatically)" + "\n   " + "If it succeeded on its save, I can't use this feature again on it until I finish a long rest",
			action : ["action", ""]
		},
		"subclassfeature8" : {
			name : "Potent Spellcasting",
			source : ["P", 60],
			minlevel : 8,
			description : "\n   " + "I can add my Wisdom modifier to the damage I deal with my cleric cantrips",
			calcChanges : {
				atkCalc : [
					function (fields, v, output) {
						if (classes.known.cleric && classes.known.cleric.level > 7 && v.thisWeapon[3] && v.thisWeapon[4].indexOf('cleric') !== -1 && SpellsList[v.thisWeapon[3]].level === 0) {
							output.extraDmg += What('Wis Mod');
						};
					},
					"My cleric cantrips get my Wisdom modifier added to their damage."
				],
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (spName != "cleric" || !What("Wis Mod") || Number(What("Wis Mod")) <= 0 || spellObj.psionic || spellObj.level !== 0) return;
						if (spellKey == "shillelagh") {
							spellObj.description = spellObj.description.replace("1d8", "1d8+" + What("Wis Mod"));
							return true;
						}
						return genericSpellDmgEdit(spellKey, spellObj, "\\w+\\.?", "Wis", true);
					},
					"My cleric cantrips get my Wisdom modifier added to their damage."
				]
			}
		},
		"subclassfeature17" : {
			name : "Visions of the Past",
			source : ["P", 60],
			minlevel : 17,
			description : "\n   " + "I can see recent events of an object or area by concentrating and praying for 1 min" + "\n   " + "I can meditate this way for up to a number of minutes equal to my Wisdom score" + "\n   - " + "Object Reading (after meditating for 1 minute per owner):" + "\n      " + "If an owner owned it in the last Wis score in days, I learn how that owner got/lost it" + "\n      " + "I also learn the most recent significant event involving the object and the owner" + "\n   - " + "Area Reading (my immediate surroundings, up to a 50-foot cube):" + "\n      " + "Going back my Wisdom score in days, per minute I meditate, I learn about one event" + "\n      " + "This starts with the most recent event; It can be significant or just important to me",
			usages : 1,
			recovery : "short rest"
		}
	}
});
AddSubClass("cleric", "light domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*\b(light|sun|shining)\b).*$/i,
	subname : "Light Domain",
	source : ["P", 61],
	spellcastingExtra : ["burning hands", "faerie fire", "flaming sphere", "scorching ray", "daylight", "fireball", "guardian of faith", "wall of fire", "flame strike", "scrying"],
	features : {
		"subclassfeature1" : {
			name : "Bonus Cantrip",
			source : ["P", 61],
			minlevel : 1,
			description : "\n   " + "I learn the Light cantrip if I didn't already know it",
			spellcastingBonus : {
				name : "Bonus Cantrip (Light)",
				spells : ["light"],
				selection : ["light"]
			}
		},
		"subclassfeature1.1" : {
			name : "Warding Flare",
			source : ["P", 61],
			minlevel : 1,
			description : desc([
				"When a creature within 30 ft attacks me and I can see it, I can interpose divine light",
				"As a reaction, I impose disadv. on the attacker's attack roll (unless it can't be blinded)"
			]),
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest",
			action : ["reaction", ""]
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Radiance of the Dawn",
			source : ["P", 61],
			minlevel : 2,
			description : "\n   " + "As an action, in 30 ft, magical darkness is dispelled and hostiles must make a Con save" + "\n   " + "Each takes radiant damage, saves for half, and negates with total cover",
			additional : ["", "2d10 + 2 damage", "2d10 + 3 damage", "2d10 + 4 damage", "2d10 + 5 damage", "2d10 + 6 damage", "2d10 + 7 damage", "2d10 + 8 damage", "2d10 + 9 damage", "2d10 + 10 dmg", "2d10 + 11 dmg", "2d10 + 12 dmg", "2d10 + 13 dmg", "2d10 + 14 dmg", "2d10 + 15 dmg", "2d10 + 16 dmg", "2d10 + 17 dmg", "2d10 + 18 dmg", "2d10 + 19 dmg", "2d10 + 20 dmg"],
			action : ["action", ""]
		},
		"subclassfeature6" : {
			name : "Improved Flame",
			source : ["P", 61],
			minlevel : 6,
			description : "\n   " + "I can also use my Warding Flare if another is attacked by a creature within 30 ft of me"
		},
		"subclassfeature8" : {
			name : "Potent Spellcasting",
			source : ["P", 61],
			minlevel : 8,
			description : "\n   " + "I can add my Wisdom modifier to the damage I deal with my cleric cantrips",
			calcChanges : {
				atkCalc : [
					function (fields, v, output) {
						if (classes.known.cleric && classes.known.cleric.level > 7 && v.thisWeapon[3] && v.thisWeapon[4].indexOf('cleric') !== -1 && SpellsList[v.thisWeapon[3]].level === 0) {
							output.extraDmg += What('Wis Mod');
						};
					},
					"My cleric cantrips get my Wisdom modifier added to their damage."
				],
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (spName != "cleric" || !What("Wis Mod") || Number(What("Wis Mod")) <= 0 || spellObj.psionic || spellObj.level !== 0) return;
						if (spellKey == "shillelagh") {
							spellObj.description = spellObj.description.replace("1d8", "1d8+" + What("Wis Mod"));
							return true;
						}
						return genericSpellDmgEdit(spellKey, spellObj, "\\w+\\.?", "Wis", true);
					},
					"My cleric cantrips get my Wisdom modifier added to their damage."
				]
			}
		},
		"subclassfeature17" : {
			name : "Corona of Light",
			source : ["P", 61],
			minlevel : 17,
			description : "\n   " + "As an action, I have an aura of 60 ft sunlight and 30 ft dim light for 1 min" + "\n   " + "Enemies in the sunlight have disadv. on saves vs. spells that deal fire or radiant damage",
			action : ["action", " (start/stop)"]
		}
	}
});
AddSubClass("cleric", "nature domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*\b(nature|natural|animal|element(s|al)?)\b).*$/i,
	subname : "Nature Domain",
	source : ["P", 62],
	spellcastingExtra : ["animal friendship", "speak with animals", "barkskin", "spike growth", "plant growth", "wind wall", "dominate beast", "grasping vine", "insect plague", "tree stride"],
	features : {
		"subclassfeature1" : {
			name : "Bonus Proficiency",
			source : ["P", 62],
			minlevel : 1,
			description : "\n   " + "I gain proficiency with heavy armor",
			armorProfs : [false, false, true, false]
		},
		"subclassfeature1.1" : {
			name : "Acolyte of Nature",
			source : ["P", 62],
			minlevel : 1,
			description : "\n   " + "I learn a druid cantrip and proficiency with a skill: Animal Handling, Nature, Survival",
			skillstxt : "Choose one from Animal Handling, Nature, or Survival",
			spellcastingBonus : {
				name : "Acolyte of Nature",
				"class" : "druid",
				level : [0, 0]
			}
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Charm Animals and Plants",
			source : ["P", 62],
			minlevel : 2,
			description : "\n   " + "As an action, all beasts and plants within 30 ft that I can see must make a Wis save" + "\n   " + "If failed, each is charmed and friendly to allies and me for 1 min or until damaged",
			action : ["action", ""]
		},
		"subclassfeature6" : {
			name : "Dampen Elements",
			source : ["P", 62],
			minlevel : 6,
			description : "\n   " + "As a reaction, if an ally in 30 ft or I takes acid/cold/fire/lightning/thunder damage," + "\n   " + "I can grant resistance against that instance of damage",
			action : ["reaction", ""]
		},
		"subclassfeature8" : {
			name : "Divine Strike",
			source : ["P", 62],
			minlevel : 8,
			description : "\n   " + "Once per turn, when I hit a creature with a weapon attack, I can do extra damage",
			additional : levels.map(function (n) {
				return n < 8 ? "" : "+" + (n < 14 ? 1 : 2) + "d8 cold/fire/lightning damage (choice)";
			}),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (classes.known.cleric && classes.known.cleric.level > 7 && !v.isSpell) {
							fields.Description += (fields.Description ? '; ' : '') + 'Once per turn +' + (classes.known.cleric.level < 14 ? 1 : 2) + 'd8 cold/fire/lightning damage';
						}
					},
					"Once per turn, I can have one of my weapon attacks that hit do extra cold, fire, or lightning damage (my choice)."
				]
			}
		},
		"subclassfeature17" : {
			name : "Master of Nature",
			source : ["P", 62],
			minlevel : 17,
			description : "\n   " + "As a bonus action, I can command creatures that are charmed by my Channel Divinity",
			action : ["bonus action", ""]
		}
	}
});
AddSubClass("cleric", "tempest domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*\b(tempest|destruction|storm)\b).*$/i,
	subname : "Tempest Domain",
	source : ["P", 62],
	spellcastingExtra : ["fog cloud", "thunderwave", "gust of wind", "shatter", "call lightning", "sleet storm", "control water", "ice storm", "destructive wave", "insect plague"],
	features : {
		"subclassfeature1" : {
			name : "Bonus Proficiency",
			source : ["P", 62],
			minlevel : 1,
			description : "\n   " + "I gain proficiency with martial weapons and heavy armor",
			armorProfs : [false, false, true, false],
			weaponProfs : [false, true]
		},
		"subclassfeature1.1" : {
			name : "Wrath of the Storm",
			source : ["P", 62],
			minlevel : 1,
			description : "\n   " + "As a reaction, when a creature I can see within 5 ft hits me, I can thunderously rebuke" + "\n   " + "It takes 2d8 lightning or thunder damage (my choice) that a Dex save can halve",
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest",
			action : ["reaction", ""]
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Destructive Wrath",
			source : ["P", 62],
			minlevel : 2,
			description : "\n   " + "Instead of rolling, I can do maximum damage when I do lightning or thunder damage"
		},
		"subclassfeature6" : {
			name : "Thunderbolt Strike",
			source : ["P", 62],
			minlevel : 6,
			description : "\n   " + "When I deal lightning damage to a Large or smaller foe, I can push it up to 10 ft away"
		},
		"subclassfeature8" : {
			name : "Divine Strike",
			source : ["P", 62],
			minlevel : 8,
			description : "\n   " + "Once per turn, when I hit a creature with a weapon attack, I can do extra damage",
			additional : levels.map(function (n) {
				if (n < 8) return "";
				return "+" + (n < 14 ? 1 : 2) + "d8 thunder damage";
			}),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (classes.known.cleric && classes.known.cleric.level > 7 && !v.isSpell) {
							fields.Description += (fields.Description ? '; ' : '') + 'Once per turn +' + (classes.known.cleric.level < 14 ? 1 : 2) + 'd8 thunder damage';
						}
					},
					"Once per turn, I can have one of my weapon attacks that hit do extra thunder damage."
				]
			}
		},
		"subclassfeature17" : {
			name : "Stormborn",
			source : ["P", 62],
			minlevel : 17,
			description : "\n   " + "Whenever I'm not underground or indoors, I have a fly speed equal to my current speed",
			speed : { fly : { spd : "walk", enc : "walk" } }
		}
	}
});
AddSubClass("cleric", "trickery domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*(trickery|trickster|illusion)).*$/i,
	subname : "Trickery Domain",
	source : ["P", 63],
	spellcastingExtra : ["charm person", "disguise self", "mirror image", "pass without trace", "blink", "dispel magic", "dimension door", "polymorph", "dominate person", "modify memory"],
	features : {
		"subclassfeature1" : {
			name : "Blessing of the Trickster",
			source : ["P", 63],
			minlevel : 1,
			description : "\n   " + "As an action, a willing creature I touch (not me) has adv. on Dex (Stealth) checks" + "\n   " + "This lasts for 1 hour or until I use it again",
			action : ["action", ""]
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Invoke Duplicity",
			source : ["P", 63],
			minlevel : 2,
			description : desc([
				"As an action, I create illusory duplicates of myself within 30 ft of me for 1 min (conc)",
				"As a bonus action, I can move them 30 ft to space(s) I can see within 120 ft of me",
				"I can cast spells as though I was in an duplicate's space, using my own senses",
				"I have advantage on attacks if the target is within 5 ft of a duplicate and me"
			]),
			additional : levels.map(function (n) { return n < 2 ? "" : (n < 17 ? 1 : 2) + " illusory duplicate" + (n < 17 ? "" : "s"); }),
			action : [["action", ""], ["bonus action", "Move Duplicate(s)"]]
		},
		"subclassfeature6" : {
			name : "Channel Divinity: Cloak of Shadows",
			source : ["P", 63],
			minlevel : 6,
			description : "\n   " + "As an action, I become invisible until the end of my next turn or I attack/cast a spell",
			action : ["action", ""]
		},
		"subclassfeature8" : {
			name : "Divine Strike",
			source : ["P", 63],
			minlevel : 8,
			description : "\n   " + "Once per turn, when I hit a creature with a weapon attack, I can do extra damage",
			additional : levels.map(function (n) { return n < 8 ? "" : "+" + (n < 14 ? 1 : 2) + "d8 poison damage"; }),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (classes.known.cleric && classes.known.cleric.level > 7 && !v.isSpell) {
							fields.Description += (fields.Description ? '; ' : '') + 'Once per turn +' + (classes.known.cleric.level < 14 ? 1 : 2) + 'd8 poison damage';
						}
					},
					"Once per turn, I can have one of my weapon attacks that hit do extra poison damage."
				]
			}
		},
		"subclassfeature17" : {
			name : "Improved Duplicity",
			source : ["P", 63],
			minlevel : 17,
			description : desc([
				"When I use Invoke Duplicity, I make four illusory duplicates instead of one",
				"I can move any number of the illusory duplicates as part of the same bonus action"
			])
		}
	}
});
AddSubClass("cleric", "war domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*\b(war|fighting|conflict)\b).*$/i,
	subname : "War Domain",
	source : ["P", 63],
	spellcastingExtra : ["divine favor", "shield of faith", "magic weapon", "spiritual weapon", "crusader's mantle", "spirit guardians", "freedom of movement", "stoneskin", "flame strike", "hold monster"],
	features : {
		"subclassfeature1" : {
			name : "Bonus Proficiency",
			source : ["P", 63],
			minlevel : 1,
			description : "\n   " + "I gain proficiency with martial weapons and heavy armor",
			armorProfs : [false, false, true, false],
			weaponProfs : [false, true]
		},
		"subclassfeature1.1" : {
			name : "War Priest",
			source : ["P", 63],
			minlevel : 1,
			description : "\n   " + "When I use the Attack action, I can make a weapon attack as a bonus action",
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest",
			action : ["bonus action", " (with Attack action)"]
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Guided Strike",
			source : ["P", 63],
			minlevel : 2,
			description : "\n   " + "When I make an attack roll, I can add a +10 bonus to the roll after seeing the d20 roll"
		},
		"subclassfeature6" : {
			name : "Channel Divinity: War God's Blessing",
			source : ["P", 63],
			minlevel : 6,
			description : desc([
				"As a reaction, when a creature within 30 ft makes an attack roll, I can grant a ",
				"The creature then adds a +10 bonus to the roll; I can do this after seeing the d20 roll"
			]),
			action : ["reaction", ""]
		},
		"subclassfeature8" : {
			name : "Divine Strike",
			source : ["P", 63],
			minlevel : 8,
			description : "\n   " + "Once per turn, when I hit a creature with a weapon attack, I can do extra damage",
			additional : levels.map(function (n) {
				if (n < 8) return "";
				return "+" + (n < 14 ? 1 : 2) + "d8 damage of the weapon's type";
			}),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (classes.known.cleric && classes.known.cleric.level > 7 && !v.isSpell) {
							fields.Description += (fields.Description ? '; ' : '') + 'Once per turn +' + (classes.known.cleric.level < 14 ? 1 : 2) + 'd8 damage';
						}
					},
					"Once per turn, I can have one of my weapon attacks that hit do extra damage."
				]
			}
		},
		"subclassfeature17" : {
			name : "Avatar of Battle",
			source : ["P", 63],
			minlevel : 17,
			description : "\n   " + "I have resistance to bludgeoning/piercing/slashing damage from nonmagical weapons",
			dmgres : [["Bludgeoning", "Bludg. (nonmagical)"], ["Piercing", "Pierc. (nonmagical)"], ["Slashing", "Slash. (nonmagical)"]]
		}
	}
});
AddSubClass("druid", "circle of the moon", {
	regExpSearch : /^(?=.*(druid|shaman))((?=.*\bmoon\b)|((?=.*\bmany\b)(?=.*\bforms?\b))).*$/i,
	subname : "Circle of the Moon",
	source : ["P", 69],
	features : {
		"subclassfeature2" : {
			name : "Circle Forms",
			source : ["P", 69],
			minlevel : 2,
			description : "\n   " + "I am able to transform into more dangerous animal forms when using Wild Shape"
		},
		"subclassfeature2.wild shape" : {
			name : "Wild Shape",
			source : ["P", 66],
			minlevel : 2,
			description : "\n   " + "As a bonus action, I assume the shape of a beast I have seen before with these rules:" + "\n    - " + "I gain all its game statistics except Intelligence, Wisdom, or Charisma" + "\n    - " + "I get its skill/saving throw prof. while keeping my own, using whichever is higher" + "\n    - " + "I assume the beast's HP and HD; I get mine back when I revert back" + "\n    - " + "I can't cast spells in beast form, but transforming doesn't break concentration" + "\n    - " + "I retain features from class, race, etc., but I don't retain special senses" + "\n    - " + "I can choose whether equipment falls to the ground, merges, or stays worn" + "\n    - " + "I revert if out of time or unconscious; if KOd by damage, excess damage carries over",
			usages : [0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, "\u221E\u00D7 per "],
			recovery : "short rest",
			additional : levels.map(function (n) {
				if (n < 2) return "";
				var cr = Math.max(1, Math.floor(n/3));
				var hr = Math.floor(n/2);
				var restr = n < 4 ? ", no fly/swim" : n < 8 ? ", no fly" : "";
				return "CR " + cr + restr + "; " + hr + (restr.length ? " h" : " hours");
			}),
			action : ["bonus action", " (start/stop)"],
			eval : function() {
				processActions(false, "Druid: Wild Shape", ClassList.druid.features["subclassfeature2.wild shape"].action, "Wild Shape");
			}
		},
		"subclassfeature2.1" : {
			name : "Combat Wild Shape",
			source : ["P", 69],
			minlevel : 2,
			description : "\n   " + "As a bonus action while in Wild Shape, I can expend spell slots to heal myself" + "\n   " + "I regain 1d8 HP per expended spell slot level; I can use Wild Shape as a bonus action",
			action : ["bonus action", " (heal)"],
			removeeval : function() {
				processActions(true, "Druid: Wild Shape", ClassList.druid.features["subclassfeature2.wild shape"].action, "Wild Shape");
			}
		},
		"subclassfeature6" : {
			name : "Primal Strike",
			source : ["P", 69],
			minlevel : 6,
			description : "\n   " + "My attacks count as magical while in Wild Shape"
		},
		"subclassfeature10" : {
			name : "Elemental Wild Shape",
			source : ["P", 69],
			minlevel : 10,
			description : "\n   " + "I can transform into an air/earth/fire/water elemental by expending 2 Wild Shape uses"
		},
		"subclassfeature14" : {
			name : "Thousand Forms",
			source : ["P", 69],
			minlevel : 14,
			description : "\n   " + "I can cast Alter Self at will without using a spell slot",
			spellcastingBonus : {
				name : "Thousand Forms",
				spells : ["alter self"],
				selection : ["alter self"],
				firstCol : "atwill"
			}
		}
	}
});
AddSubClass("fighter", "battle master", {
	regExpSearch : /^(?=.*(war|fighter|battle|martial))(?=.*master).*$/i,
	subname : "Battle Master",
	fullname : "Battle Master",
	source : ["P", 73],
	abilitySave : 1,
	abilitySaveAlt : 2,
	features : {
		"subclassfeature3" : {
			name : "Combat Superiority",
			source : ["P", 73],
			minlevel : 3,
			description : "\n   " + "I gain a number of superiority dice that I can use to fuel special Maneuvers" + "\n   " + "I regain all superiority dice after a short rest",
			additional : ["", "", "d8", "d8", "d8", "d8", "d8", "d8", "d8", "d10", "d10", "d10", "d10", "d10", "d10", "d10", "d10", "d12", "d12", "d12"],
			usages : [0, 0, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6],
			recovery : "short rest"
		},
		"subclassfeature3.1" : {
			name : "Maneuvers",
			source : ["P", 73],
			minlevel : 3,
			description : "\n   " + 'Use the "Choose Feature" button above to add a Maneuver to the third page' + "\n   " + "I can use a Maneuver by expending a superiority die (only one Maneuver per attack)",
			additional : levels.map(function (n) {
				return n < 3 ? "" : (n < 7 ? 3 : n < 10 ? 5 : n < 15 ? 7 : 9) + " known";
			}),
			extraname : "Maneuver",
			extrachoices : ["Commander's Strike", "Disarming Attack", "Distracting Strike", "Evasive Footwork", "Feinting Attack", "Goading Attack", "Lunging Attack", "Maneuvering Attack", "Menacing Attack", "Parry", "Precision Attack", "Pushing Attack", "Rally", "Riposte", "Sweeping Attack", "Trip Attack"],
			extraTimes : levels.map(function (n) {
				return n < 3 ? 0 : n < 7 ? 3 : n < 10 ? 5 : n < 15 ? 7 : 9;
			}),
			eval : function () {
				// If the martial adept feat was selected before adding the Combat Superiority class feature, increase it with one use per day
				// This has to happen after the Combat Superiority feature has been added fully, hence this eval is not part of that feature
				if (CurrentFeats.known.indexOf("martial adept") != -1) {
					AddFeature('Combat Superiority ', 1, '(d6)', 'short rest', 'Martial Adept feat or ', 'bonus');
				}
				// The same goes for the optional fighting style Superior Technique
				if (GetFeatureChoice("classes", "fighter", "fighting style", false) == "superior technique") {
					AddFeature('Combat Superiority ', 1, '(d6)', 'short rest', 'Fighter: Superior Technique Fighting Style', 'bonus');
				}
			},
			"commander's strike" : {
				name : "Commander's Strike",
				source : ["P", 74],
				description : "\n   " + "I forgo one attack of my Attack action to use a bonus action to direct an ally I see/hear" + "\n   " + "The ally can use a reaction to make an attack, adding the superiority die to damage",
				action : ["bonus action", " (with Attack action)"]
			},
			"disarming attack" : {
				name : "Disarming Attack",
				source : ["P", 74],
				description : "\n   " + "Use after hitting a creature; I add the superiority die to my attack's damage" + "\n   " + "Target makes a Strength save or drops a held object of my choice to its feet"
			},
			"distracting strike" : {
				name : "Distracting Strike",
				source : ["P", 74],
				description : "\n   " + "Use after hitting a creature; I add the superiority die to my attack's damage" + "\n   " + "The next attack of an ally before my next turn has adv. against the creature"
			},
			"evasive footwork" : {
				name : "Evasive Footwork",
				source : ["P", 74],
				description : "\n   " + "Use when moving; I add the superiority die to my AC until I stop moving"
			},
			"feinting attack" : {
				name : "Feinting Attack",
				source : ["P", 74],
				description : "\n   " + "As a bonus action, I can feint to gain adv. on my next attack this turn vs. a target in 5 ft" + "\n   " + "If the attack hits, I add the superiority die to my attack's damage",
				action : ["bonus action", ""]
			},
			"goading attack" : {
				name : "Goading Attack",
				source : ["P", 74],
				description : "\n   " + "Use after hitting a creature; I add the superiority die to my attack's damage" + "\n   " + "Target makes a Wis save or has disadv. vs. other targets until the end of my next turn"
			},
			"lunging attack" : {
				name : "Lunging Attack",
				source : ["P", 74],
				description : "\n   " + "I can spend a superiority die to increase the reach of a melee weapon attack by 5 ft" + "\n   " + "If the attack hits, I add the superiority die to my attack's damage"
			},
			"maneuvering attack" : {
				name : "Maneuvering Attack",
				source : ["P", 74],
				description : "\n   " + "Use after hitting a creature; I add the superiority die to my attack's damage" + "\n   " + "Ally can use reaction to move half speed without opportunity attack from the target"

			},
			"menacing attack" : {
				name : "Menacing Attack",
				source : ["P", 74],
				description : "\n   " + "Use after hitting a creature; I add the superiority die to my attack's damage" + "\n   " + "Target makes a Wisdom save or is frightened of me until the end of my next turn"
			},
			"parry" : {
				name : "Parry",
				source : ["P", 74],
				description : "\n   " + "When damaged in melee, I can use a reaction to reduce it by superiority die + Dex mod",
				action : ["reaction", " (when damaged in melee)"]
			},
			"precision attack" : {
				name : "Precision Attack",
				source : ["P", 74],
				description : "\n   " + "I add the superiority die to my attack roll, either before or after rolling"
			},
			"pushing attack" : {
				name : "Pushing Attack",
				source : ["P", 74],
				description : "\n   " + "Use after hitting a creature; I add the superiority die to the attack's damage" + "\n   " + "If target is Large or smaller, it must make a Strength save or be pushed up to 15 ft away"
			},
			"rally" : {
				name : "Rally",
				source : ["P", 74],
				description : "\n   " + "Ally that can see/hear me gets temporary HP equal to superiority die + Charisma mod",
				action : ["bonus action", ""]
			},
			"riposte" : {
				name : "Riposte",
				source : ["P", 74],
				description : "\n   " + "When missed in melee, I can use my reaction to make one melee attack vs. the attacker" + "\n   " + "If the attack hits, I add the superiority die to my attack's damage",
				action : ["reaction", " (after missed in melee)"]
			},
			"sweeping attack" : {
				name : "Sweeping Attack",
				source : ["P", 74],
				description : "\n   " + "Use after hitting a creature and a second creature is within 5 ft of the first" + "\n   " + "If the original attack roll hits this second creature, it takes the superiority die in damage"
			},
			"trip attack" : {
				name : "Trip Attack",
				source : ["P", 74],
				description : "\n   " + "Use after hitting a creature; I add the superiority die to the attack's damage" + "\n   " + "If target is Large or smaller, it must make a Strength save or be knocked prone"
			}
		},
		"subclassfeature3.2" : {
			name : "Student of War",
			source : ["P", 73],
			minlevel : 3,
			description : "\n   " + "I have proficiency with one artisan's tool set of my choice",
			toolProfs : [["Artisan's tools", 1]]
		},
		"subclassfeature7" : {
			name : "Know Your Enemy",
			source : ["P", 73],
			minlevel : 7,
			description : "\n   " + "If I spend 1 min studying someone, the DM will tell me info about him/her"
		},
		"subclassfeature10" : {
			name : "Improved Combat Superiority",
			source : ["P", 74],
			minlevel : 10,
			description : "\n   " + "My superiority dice turn into d10s at 10th level and into d12s at 18th level"
		},
		"subclassfeature15" : {
			name : "Relentless",
			source : ["P", 74],
			minlevel : 15,
			description : "\n   " + "I regain one superiority die if I have no more remaining when I roll initiative"
		}
	}
});
AddSubClass("fighter", "eldritch knight", {
	regExpSearch : /^(?!.*(exalted|sacred|holy|divine|nature|natural|purple.*dragon|green))(?=.*(knight|fighter|warrior|militant|warlord|phalanx|gladiator|trooper))(?=.*\b(eldritch|arcane|magic|mage|witch)\b).*$/i,
	subname : "Eldritch Knight",
	fullname : "Eldritch Knight",
	source : ["P", 75],
	abilitySave : 4,
	spellcastingFactor : 3,
	spellcastingList : {
		"class" : "wizard",
		school : ["Evoc", "Abjur"],
		level : [0, 4]
	},
	spellcastingKnown : {
		cantrips : [0, 0, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
		spells : [0, 0, 2, 3, 3, 3, 4, 4, 4, 5, 6, 6, 7, 7, 7, 8, 8, 8, 9, 9]
	},
	features : {
		"action surge" : {
			name : "Action Surge",
			source : ["P", 72],
			minlevel : 2,
			description : "\n   " + "I can take one additional action on my turn on top of my normally allowed actions",
			usages : [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2],
			recovery : "short rest",
			additional : ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "30 ft teleport", "30 ft teleport", "30 ft teleport", "30 ft teleport", "30 ft teleport", "30 ft teleport"]
		},
		"subclassfeature3" : {
			name : "Spellcasting",
			source : ["P", 75],
			minlevel : 3,
			description : "\n   " + "I can cast known wizard cantrips/spells, using Intelligence as my spellcasting ability",
			additional : ["", "", "2 cantrips \u0026 3 spells known", "2 cantrips \u0026 4 spells known", "2 cantrips \u0026 4 spells known", "2 cantrips \u0026 4 spells known", "2 cantrips \u0026 5 spells known", "2 cantrips \u0026 6 spells known", "2 cantrips \u0026 6 spells known", "3 cantrips \u0026 7 spells known", "3 cantrips \u0026 8 spells known", "3 cantrips \u0026 8 spells known", "3 cantrips \u0026 9 spells known", "3 cantrips \u0026 10 spells known", "3 cantrips \u0026 10 spells known", "3 cantrips \u0026 11 spells known", "3 cantrips \u0026 11 spells known", "3 cantrips \u0026 11 spells known", "3 cantrips \u0026 12 spells known", "3 cantrips \u0026 13 spells known"],
			spellcastingBonus : { // the spells gained at level 3, 8, 14, 20
				name : "From any school",
				"class" : "wizard",
				times : [0, 0, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 4],
				level : [1, 4]
			}
		},
		"subclassfeature3.1" : {
			name : "Weapon Bond",
			source : ["P", 75],
			minlevel : 3,
			description : "\n   " + "I can bond with up to two weapons by spending a short rest with each" + "\n   " + "I can't be disarmed of a bonded weapon and I can summon one as a bonus action",
			action : ["bonus action", ""]
		},
		"subclassfeature7" : {
			name : "War Magic",
			source : ["P", 75],
			minlevel : 7,
			description : "\n   " + "When I use my action to cast a cantrip, I can make a weapon attack as a bonus action",
			action : ["bonus action", ""]
		},
		"subclassfeature10" : {
			name : "Eldritch Strike",
			source : ["P", 75],
			minlevel : 10,
			description : "\n   " + "A creature hit by my weapon attack has disadv. on the save vs. the next spell I cast" + "\n   " + "This lasts until the end of my next turn"
		},
		"subclassfeature15" : {
			name : "Arcane Charge",
			source : ["P", 75],
			minlevel : 15,
			description : "\n   " + "When I use Action Surge, I can also teleport up to 30 ft to an empty space I can see" + "\n   " + "I can do so before or after the extra action"
		},
		"subclassfeature18" : {
			name : "Improved War Magic",
			source : ["P", 75],
			minlevel : 18,
			description : "\n   " + "When I use my action to cast a spell, I can make a weapon attack as a bonus action",
			action : ["bonus action", ""]
		}
	}
});
AddSubClass("monk", "way of the four elements", {
	regExpSearch : /^(?=.*\b(four|4)\b)((?=.*elements?)|((?=.*earth)|(?=.*(wind|air))|(?=.*fire)|(?=.*water)))((?=.*(monk|monastic))|(((?=.*martial)(?=.*(artist|arts)))|((?=.*spiritual)(?=.*warrior)))).*$/i,
	subname : "Way of the Four Elements",
	source : ["P", 80],
	features : {
		"subclassfeature3" : {
			name : "Disciple of the Elements",
			source : ["P", 80],
			minlevel : 3,
			description : "\n   " + "I know Elemental Attunement and additional Elemental Disciplines, depending on level" + "\n   " + "Use the \"Choose Feature\" button above to add Elemental Disciplines to the third page" + "\n   " + "From 5th level onward, I can use additional ki points to increase their spell slot level" + "\n   " + "I can trade known Elemental Disciplines for others when I gain new ones",
			additional : levels.map(function (n) {
				return n < 3 ? "" : ((n < 6 ? 2 : n < 11 ? 3 : n < 17 ? 4 : 5) + " known; ") + (n < 5 ? 2 : n < 9 ? 3 : n < 13 ? 4 : n < 17 ? 5 : 6) + " max ki";
			}),
			extraname : "Elemental Discipline",
			extrachoices : ["Breath of Winter (prereq: level 17 monk)", "Clench of the North Wind (prereq: level 6 monk)", "Elemental Attunement", "Eternal Mountain Defense (prereq: level 17 monk)", "Fangs of the Fire Snake", "Fist of Four Thunders", "Fist of Unbroken Air", "Flames of the Phoenix (prereq: level 11 monk)", "Gong of the Summit (prereq: level 6 monk)", "Mist Stance (prereq: level 11 monk)", "Ride the Wind (prereq: level 11 monk)", "Rive of Hungry Flame (prereq: level 17 monk)", "Rush of the Gale Spirits", "Shape the Flowing River", "Sweeping Cinder Strike", "Water Whip", "Wave of Rolling Earth (prereq: level 17 monk)"],
			extraTimes : levels.map(function (n) {
				return n < 3 ? 0 : n < 6 ? 2 : n < 11 ? 3 : n < 17 ? 4 : 5;
			}),
			autoSelectExtrachoices : [{ extrachoice : "elemental attunement" }],
			"elemental attunement" : {
				name : "Elemental Attunement",
				source : ["P", 81],
				description : "\n   " + "As an action, I can briefly control elemental forces within 30 ft of me" + "\n   " + "I can make a harmless sensory effect, light/snuff light, chill/warm 1 lb for 1 hour," + "\n   " + "or I cause earth/fire/water/mist in a 1 ft cube to shape itself into a form for 1 minute",
				action : ["action", ""]
			},
			"breath of winter (prereq: level 17 monk)" : {
				name : "Breath of Winter",
				source : ["P", 81],
				description : " [6 ki points]" + "\n   " + "As an action, I can cast Cone of Cold without material components",
				spellcastingBonus : {
					name : "Breath of Winter",
					spells : ["cone of cold"],
					selection : ["cone of cold"],
					firstCol : 6
				},
				spellFirstColTitle : "Ki",
				prereqeval : function(v) { return classes.known.monk.level >= 17; },
				spellChanges : {
					"cone of cold" : {
						components : "V,S",
						compMaterial : "",
						description : "8d8 Cold dmg; save halves; crea killed become frozen statues until thawed",
						changes : "With the Breath of Winter discipline, I can cast Cone of Cold without a material component."
					}
				}
			},
			"clench of the north wind (prereq: level 6 monk)" : {
				name : "Clench of the North Wind",
				source : ["P", 81],
				description : " [3 ki points]" + "\n   " + "As an action, I can cast Hold Person without material components",
				spellcastingBonus : {
					name : "Clench of the North Wind",
					spells : ["hold person"],
					selection : ["hold person"],
					firstCol : 3
				},
				spellFirstColTitle : "Ki",
				prereqeval : function(v) { return classes.known.monk.level >= 6; },
				spellChanges : {
					"hold person" : {
						components : "V,S",
						compMaterial : "",
						description : "1 humanoid save or paralyzed; extra save at end of each turn",
						changes : "With the Clench of the North Wind discipline, I can cast Hold Person without a material component."
					}
				}
			},
			"eternal mountain defense (prereq: level 17 monk)" : { // errata from level 11 to level 17
				name : "Eternal Mountain Defense",
				source : ["P", 81],
				description : " [5 ki points]" + "\n   " + "As an action, I can cast Stoneskin on myself without material components",
				spellcastingBonus : {
					name : "Eternal Mountain Defense",
					spells : ["stoneskin"],
					selection : ["stoneskin"],
					firstCol : 5
				},
				spellFirstColTitle : "Ki",
				prereqeval : function(v) { return classes.known.monk.level >= 17; },
				spellChanges : {
					"stoneskin" : {
						range : "Self",
						components : "V,S",
						compMaterial : "",
						description : "I gain resistance to nonmagical Bludgeoning, Piercing, and Slashing damage",
						changes : "With the Eternal Mountain Defense discipline, I can cast Stoneskin without a material component but only on myself."
					}
				}
			},
			"fangs of the fire snake" : {
				name : "Fangs of the Fire Snake",
				source : ["P", 81],
				description : " [1 ki point]" + "\n   " + "With Attack action, my unarmed strikes +10 ft reach and deal fire damage this turn" + "\n   " + "Also, I can spent an additional 1 ki point to cause an attack to deal +1d10 fire damage",
				calcChanges : {
					atkAdd : [
						function (fields, v) {
							if (v.baseWeaponName == "unarmed strike" && (/^(?=.*fire)(?=.*snake).*$/i).test(v.WeaponText)) {
								fields.Description += (fields.Description ? '; ' : '') + 'After hit, spend 1 ki point for +1d10 fire damage';
								fields.Range = 'Melee (15 ft reach)';
								fields.Damage_Type = 'fire';
							};
						},
						"If I include the words 'Fire Snake' in the name of an unarmed strike, it gets +10 ft reach, does fire damage, and gains the option to deal +1d10 fire damage by spending 1 additional ki point."
					]
				}
			},
			"fist of four thunders" : {
				name : "Fist of Four Thunders",
				source : ["P", 81],
				description : " [2 ki points]" + "\n   " + "As an action, I can cast Thunderwave",
				spellcastingBonus : {
					name : "Fist of Four Thunders",
					spells : ["thunderwave"],
					selection : ["thunderwave"],
					firstCol : 2
				},
				spellFirstColTitle : "Ki",
				spellChanges : {
					"thunderwave" : {
						description : "All crea/obj in area 2d8 Thunder dmg, pushed 10 ft away; save halves and not pushed",
						changes : "With the Fist of Four Thunders discipline, I can cast Thunderwave."
					}
				}
			},
			"fist of unbroken air" : {
				name : "Fist of Unbroken Air",
				source : ["P", 81],
				description : " [2 ki points; +1d10/extra ki point]" + "\n   " + "As an action, target within 30 ft takes 3d10 bludgeoning damage (spend ki for more)" + "\n   " + "It is also pushed up to 20 ft away from me and knocked prone" + "\n   " + "It can make a Strength save to halve damage and avoid being pushed and knocked prone",
				action : ["action", ""]
			},
			"flames of the phoenix (prereq: level 11 monk)" : {
				name : "Flames of the Phoenix",
				source : ["P", 81],
				description : " [4 ki points]" + "\n   " + "As an action, I can cast Fireball without material components",
				spellcastingBonus : {
					name : "Flames of the Phoenix",
					spells : ["fireball"],
					selection : ["fireball"],
					firstCol : 4
				},
				spellFirstColTitle : "Ki",
				prereqeval : function(v) { return classes.known.monk.level >= 11; },
				spellChanges : {
					"fireball" : {
						components : "V,S",
						compMaterial : "",
						description : "20-ft rad all crea 8d6 Fire dmg; save halves; unattended flammable objects ignite",
						changes : "With the Flames of the Phoenix discipline, I can cast Fireball without a material component."
					}
				}
			},
			"gong of the summit (prereq: level 6 monk)" : {
				name : "Gong of the Summit",
				source : ["P", 81],
				description : " [3 ki points]" + "\n   " + "As an action, I can cast Shatter without material components",
				spellcastingBonus : {
					name : "Gong of the Summit",
					spells : ["shatter"],
					selection : ["shatter"],
					firstCol : 3
				},
				spellFirstColTitle : "Ki",
				prereqeval : function(v) { return classes.known.monk.level >= 6; },
				spellChanges : {
					"shatter" : {
						components : "V,S",
						compMaterial : "",
						description : "10-ft rad all 3d8 Thunder dmg; save halves; nonmagical unattended objects also take dmg",
						changes : "With the Gong of the Summit discipline, I can cast Shatter without a material component."
					}
				}
			},
			"mist stance (prereq: level 11 monk)" : {
				name : "Mist Stance",
				source : ["P", 81],
				description : " [4 ki points]" + "\n   " + "As an action, I can cast Gaseous Form on myself without material components",
				spellcastingBonus : {
					name : "Mist Stance",
					spells : ["gaseous form"],
					selection : ["gaseous form"],
					firstCol : 4
				},
				spellFirstColTitle : "Ki",
				prereqeval : function(v) { return classes.known.monk.level >= 11; },
				spellChanges : {
					"gaseous form" : {
						range : "Self",
						components : "V,S",
						compMaterial : "",
						description : "I turn into a misty cloud with fly 10 ft, resist. to nonmagical dmg, adv. on Str/Dex/saves",
						changes : "With the Mist Stance discipline, I can cast Gaseous Form without a material component, but only on myself."
					}
				}
			},
			"ride the wind (prereq: level 11 monk)" : {
				name : "Ride the Wind",
				source : ["P", 81],
				description : " [4 ki points]" + "\n   " + "As an action, I can cast Fly on myself without material components",
				spellcastingBonus : {
					name : "Ride the Wind",
					spells : ["fly"],
					selection : ["fly"],
					firstCol : 4
				},
				spellFirstColTitle : "Ki",
				prereqeval : function(v) { return classes.known.monk.level >= 11; },
				spellChanges : {
					"fly" : {
						range : "Self",
						components : "V,S",
						compMaterial : "",
						description : "I gain 60 ft flying speed",
						changes : "With the Ride the Wind discipline, I can cast Fly without a material component but only on myself."
					}
				}
			},
			"rive of hungry flame (prereq: level 17 monk)" : {
				name : "Rive of Hungry Flame",
				source : ["P", 81],
				description : " [5 ki points]" + "\n   " + "As an action, I can cast Wall of Fire without material components",
				spellcastingBonus : {
					name : "Rive of Hungry Flame",
					spells : ["wall of fire"],
					selection : ["wall of fire"],
					firstCol : 5
				},
				spellFirstColTitle : "Ki",
				prereqeval : function(v) { return classes.known.monk.level >= 17; },
				spellChanges : {
					"wall of fire" : {
						components : "V,S",
						compMaterial : "",
						description : "60\u00D71\u00D720ft (l\u00D7w\u00D7h) or 10-ft rad all in and 10 ft on 1 side 5d8 Fire dmg; save halves; see b",
						descriptionMetric : "18\u00D70,3\u00D76m (l\u00D7w\u00D7h) or 3-m rad all in and 3 m on 1 side 5d8 Fire dmg; save halves; see B",
						changes : "With the Rive of Hungry Flame discipline, I can cast Wall of Fire without a material component."
					}
				}
			},
			"rush of the gale spirits" : {
				name : "Rush of the Gale Spirits",
				source : ["P", 81],
				description : " [2 ki points]" + "\n   " + "As an action, I can cast Gust of Wind without material components",
				spellcastingBonus : {
					name : "Rush of the Gale Spirits",
					spells : ["gust of wind"],
					selection : ["gust of wind"],
					firstCol : 2
				},
				spellFirstColTitle : "Ki",
				spellChanges : {
					"gust of wind" : {
						components : "V,S",
						compMaterial : "",
						changes : "With the Rush of the Gale Spirits discipline, I can cast Gust of Wind without a material component."
					}
				}
			},
			"shape the flowing river" : {
				name : "Shape the Flowing River",
				source : ["P", 81],
				description : " [1 ki point]" + "\n   " + "As an action, I can affect ice/water up to a 30-foot cube within 120 ft" + "\n   " + "I can switch it between water/ice states and reshape ice up to half its largest dimension",
				action : ["action", ""]
			},
			"sweeping cinder strike" : {
				name : "Sweeping Cinder Strike",
				source : ["P", 81],
				description : " [2 ki points]" + "\n   " + "As an action, I can cast Burning Hands",
				spellcastingBonus : {
					name : "Sweeping Cinder Strike",
					spells : ["burning hands"],
					selection : ["burning hands"],
					firstCol : 2
				},
				spellFirstColTitle : "Ki",
				spellChanges : {
					"burning hands" : {
						components : "V,S",
						compMaterial : "",
						description : "3d6 Fire dmg; save halves; unattended flammable objects ignite",
						changes : "With the Sweeping Cinder Strike discipline, I can cast Burning Hands."
					}
				}
			},
			"water whip" : {
				name : "Water Whip",
				source : ["P", 81],
				description : " [2 ki points; +1d10/extra ki point]" + "\n   " + "As an action, a creature within 30 ft takes 3d10 bludgeoning damage (spend ki for more)" + "\n   " + "It is also knocked prone or pulled up to 25 ft closer to me (my choice)" + "\n   " + "It can make a Dexterity save to halve damage and avoid being pulled or knocked prone",
				action : ["action", ""]
			},
			"wave of rolling earth (prereq: level 17 monk)" : {
				name : "Wave of Rolling Earth",
				source : ["P", 81],
				description : " [6 ki points]" + "\n   " + "As an action, I can cast Wall of Stone without material components",
				spellcastingBonus : {
					name : "Wave of Rolling Earth",
					spells : ["wall of stone"],
					selection : ["wall of stone"],
					firstCol : 6
				},
				spellFirstColTitle : "Ki",
				prereqeval : function(v) { return classes.known.monk.level >= 17; },
				spellChanges : {
					"wall of stone" : {
						components : "V,S",
						compMaterial : "",
						changes : "With the Wave of Rolling Earth discipline, I can cast Wall of Stone without a material component."
					}
				}
			}
		}
	}
});
AddSubClass("monk", "way of shadow", {
	regExpSearch : /^(?=.*shadow)((?=.*(monk|monastic))|(((?=.*martial)(?=.*(artist|arts)))|((?=.*spiritual)(?=.*warrior)))).*$/i,
	subname : "Way of Shadow",
	source : ["P", 80],
	features : {
		"subclassfeature3" : {
			name : "Shadow Arts",
			source : ["P", 80],
			minlevel : 3,
			description : "\n   " + "I know the Minor Illusion cantrip and can cast certain spells by using ki (see page 3)",
			spellcastingBonus : {
				name : "Shadow Arts",
				spells : ["minor illusion"],
				selection : ["minor illusion"],
				firstCol : "atwill"
			},
			spellFirstColTitle : "Ki",
			extraname : "Shadow Arts",
			"shadow spells" : {
				name : "Shadow Spells",
				source : ["P", 80],
				description : " [2 ki points]" + "\n   " + "As an action, I can cast Darkness, Darkvision, Pass Without Trace, or Silence" + "\n   " + "I don't require spell slots or material components to cast these spells like this, just ki points",
				action : ["action", ""],
				spellcastingBonus : {
					name : "Shadow Arts",
					spells : ["darkness", "darkvision", "pass without trace", "silence"],
					selection : ["darkness", "darkvision", "pass without trace", "silence"],
					firstCol : 2,
					times : 4
				}
			},
			autoSelectExtrachoices : [{ extrachoice : "shadow spells" }],
			spellChanges : {
				"darkness" : {
					components : "V",
					compMaterial : "",
					changes : "Spell cast with my Shadow Arts don't require material components."
				},
				"darkvision" : {
					components : "V,S",
					compMaterial : "",
					changes : "Spell cast with my Shadow Arts don't require material components."
				},
				"pass without trace" : {
					components : "V,S",
					compMaterial : "",
					changes : "Spell cast with my Shadow Arts don't require material components."
				}
			}
		},
		"subclassfeature6" : {
			name : "Shadow Step",
			source : ["P", 80],
			minlevel : 6,
			description : "\n   " + "As a bonus action, I can teleport from and into dim light or darkness within 60 ft" + "\n   " + "After I do this, I have adv. on the next melee attack I make before the end of my turn",
			action : ["bonus action", ""]
		},
		"subclassfeature11" : {
			name : "Cloak of Shadows",
			source : ["P", 80],
			minlevel : 11,
			description : "\n   " + "As an action, I can become invisible in dim light or darkness until I attack/cast",
			action : ["action", ""]
		},
		"subclassfeature17" : {
			name : "Opportunist",
			source : ["P", 80],
			minlevel : 17,
			description : "\n   " + "As a reaction, if a creature in 5 ft is hit by another, I can make a melee attack vs. it",
			action : ["reaction", ""]
		}
	}
});
AddSubClass("paladin", "oath of the ancients", {
	regExpSearch : /^(((?=.*(ancient|nature|natural|green|fey|horned))((?=.*paladin)|((?=.*(exalted|sacred|holy|divine))(?=.*(knight|fighter|warrior|warlord|trooper)))))|((?=.*(green|fey|horned))(?=.*(knight|fighter|warrior|warlord|trooper)))).*$/i,
	subname : "Oath of the Ancients",
	source : ["P", 87],
	features : {
		"subclassfeature3" : {
			name : "Channel Divinity: Nature's Wrath",
			source : ["P", 87],
			minlevel : 3,
			description : "\n   " + "As an action, a creature I can see within 10 ft must make a Str/Dex save (its choice)" + "\n   " + "If it fails this save, it is restrained until it succeeds on a save at the end of its turn",
			action : ["action", ""],
			spellcastingExtra : ["ensnaring strike", "speak with animals", "moonbeam", "misty step", "plant growth", "protection from energy", "ice storm", "stoneskin", "commune with nature", "tree stride"]
		},
		"subclassfeature3.1" : {
			name : "Channel Divinity: Turn the Faithless",
			source : ["P", 87],
			minlevel : 3,
			description : "\n   " + "As an action, all fey/fiends within 30 ft that can hear me must make a Wisdom save" + "\n   " + "If one fails, it is turned for 1 minute or until it takes damage and must show true form" + "\n   " + "Turned: move away, never within 30 ft of me, no reactions or actions other than Dash" + "\n   " + "Turned: may Dodge instead of Dash when nowhere to move and unable to escape bonds",
			action : ["action", ""]
		},
		"subclassfeature7" : {
			name : "Aura of Warding",
			source : ["P", 87],
			minlevel : 7,
			description : "\n   " + "Allies within range and I have resistance to damage from spells",
			additional : ["", "", "", "", "", "", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "30-foot aura", "30-foot aura", "30-foot aura"],
			dmgres : ["Spells"]
		},
		"subclassfeature15" : {
			name : "Undying Sentinel",
			source : ["P", 87],
			minlevel : 15,
			description : "\n   " + "If dropped to 0 hit points and not killed outright, I can choose to stay at 1 hit point" + "\n   " + "Additionally, I suffer no drawbacks of old age and can't be aged magically",
			recovery : "long rest",
			usages : 1
		},
		"subclassfeature20" : {
			name : "Elder Champion",
			source : ["P", 87],
			minlevel : 20,
			description : "\n   " + "As an action, I assume the form of a force of nature for 1 minute and gain benefits:" + "\n    - " + "At the start of each of my turns, I regain 10 hit points" + "\n    - " + "I can cast paladin spells with a casting time of 1 action as a bonus action instead" + "\n    - " + "Enemies within 10 ft have disadv. on saves vs. my paladin spells and channel divinity",
			recovery : "long rest",
			usages : 1,
			action : ["action", ""]
		}
	}
});
AddSubClass("paladin", "oath of vengeance", {
	regExpSearch : /^(((?=.*(vengeance|wrath|justice))((?=.*paladin)|((?=.*(exalted|sacred|holy|divine))(?=.*(knight|fighter|warrior|warlord|trooper)))))|((?=.*dark)(?=.*knight))|(?=.*avenger)).*$/i,
	subname : "Oath of Vengeance",
	source : ["P", 88],
	features : {
		"subclassfeature3" : {
			name : "Channel Divinity: Abjure Enemy",
			source : ["P", 88],
			minlevel : 3,
			description : "\n   " + "As an action, one creature within 60 ft that I can see me must make a Wisdom save" + "\n   " + "If failed, it is frightened and its speed is 0 despite bonuses; if success, its speed is halved" + "\n   " + "This lasts for 1 minute or until it takes damage; Undead/fiends have disadv. on save",
			action : ["action", ""],
			spellcastingExtra : ["bane", "hunter's mark", "hold person", "misty step", "haste", "protection from energy", "banishment", "dimension door", "hold monster", "scrying"]
		},
		"subclassfeature3.1" : {
			name : "Channel Divinity: Vow of Enmity",
			source : ["P", 88],
			minlevel : 3,
			description : "\n   " + "As a bonus action, I utter a vow against a creature I can see within 10 ft" + "\n   " + "I get adv. on attacks against it for 1 minute or until it drops to 0 HP or falls unconscious",
			action : ["bonus action", ""]
		},
		"subclassfeature7" : {
			name : "Relentless Avenger",
			source : ["P", 88],
			minlevel : 7,
			description : "\n   " + "After I hit with an opportunity attack, I can move 1/2 my speed in the same reaction" + "\n   " + "This movement doesn't provoke opportunity attacks"
		},
		"subclassfeature15" : {
			name : "Soul of Vengeance",
			source : ["P", 88],
			minlevel : 15,
			description : "\n   " + "When an enemy I have an active Vow of Enmity against makes an attack, I can react" + "\n   " + "As a reaction, I can make a melee weapon attack against it if it is within range",
			action : ["reaction", " (with Vow of Enmity)"]
		},
		"subclassfeature20" : {
			name : "Avenging Angel",
			source : ["P", 88],
			minlevel : 20,
			description : "\n   " + "As an action, I gain a flying speed of 60 ft and a 30 ft aura of menace for 1 hour" + "\n   " + "When a creature first enters or starts its turn in the aura, it must make a Wis save" + "\n   " + "If failed, for 1 min or until it takes damage, it is frightened and attacks vs. it have adv.",
			recovery : "long rest",
			usages : 1,
			action : ["action", ""]
		}
	}
});
AddSubClass("ranger", "beast master", {
	regExpSearch : /^(?=.*(animal|beast))((?=.*(master|ranger|strider))|((?=.*(nature|natural|green))(?=.*(knight|fighter|warrior|warlord|trooper)))).*$/i,
	subname : "Beast Master",
	fullname : "Beast Master",
	source : ["P", 93],
	features : {
		"subclassfeature3" : {
			name : "Ranger's Companion",
			source : ["P", 93],
			minlevel : 3,
			description : desc([
				"It adds my proficiency bonus to AC, attacks, damage, and save/skill proficiencies",
				"Its hit point maximum equals four times my ranger level if higher than its normal HP",
				"It takes a turn on my initiative; It takes the Dodge action unless I command it otherwise",
				"As an action, I can have it take the Attack, Dash, Disengage, or Help action on its turn",
				"I can still use Extra Attack while commanding it to Attack; No action to order to move"
			]),
			additional : "1/4 CR up to medium sized beast",
			action : ["action", "Command Companion"]
		},
		"subclassfeature7" : {
			name : "Exceptional Training",
			source : ["P", 93],
			minlevel : 7,
			description : desc([
				"My beast's attacks count as magical for overcoming resistances and immunities",
				"As a bonus action, I can command it to take the Dash/Disengage/Help action on its turn"
			]),
			action : ["bonus action", ""]
		},
		"subclassfeature11" : {
			name : "Bestial Fury",
			source : ["P", 93],
			minlevel : 11,
			description : "\n   " + "When I command my beast to use the Attack action, it can attack twice on its turn"
		},
		"subclassfeature15" : {
			name : "Share Spells",
			source : ["P", 93],
			minlevel : 15,
			description : "\n   " + "When I cast a spell on myself, I can have it also affect my beast if it is within 30 ft"
		}
	}
});
AddSubClass("rogue", "arcane trickster", {
	regExpSearch : /^(?=.*(trickster|rogue|miscreant))(?=.*\b(eldritch|arcane|magic|mage|witch)\b).*$/i,
	subname : "Arcane Trickster",
	fullname : "Arcane Trickster",
	source : ["P", 98],
	abilitySave : 4,
	spellcastingFactor : 3,
	spellcastingList : {
		"class" : "wizard",
		school : ["Ench", "Illus"],
		level : [0, 4]
	},
	spellcastingKnown : {
		cantrips : [0, 0, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3],
		spells : [0, 0, 2, 3, 3, 3, 4, 4, 4, 5, 6, 6, 7, 7, 7, 8, 8, 8, 9, 9]
	},
	features : {
		"subclassfeature3" : {
			name : "Spellcasting",
			source : ["P", 98],
			minlevel : 3,
			description : "\n   " + "I can cast known wizard cantrips/spells, using Intelligence as my spellcasting ability",
			additional : ["", "", "3 cantrips \u0026 3 spells known", "3 cantrips \u0026 4 spells known", "3 cantrips \u0026 4 spells known", "3 cantrips \u0026 4 spells known", "3 cantrips \u0026 5 spells known", "3 cantrips \u0026 6 spells known", "3 cantrips \u0026 6 spells known", "4 cantrips \u0026 7 spells known", "4 cantrips \u0026 8 spells known", "4 cantrips \u0026 8 spells known", "4 cantrips \u0026 9 spells known", "4 cantrips \u0026 10 spells known", "4 cantrips \u0026 10 spells known", "4 cantrips \u0026 11 spells known", "4 cantrips \u0026 11 spells known", "4 cantrips \u0026 11 spells known", "4 cantrips \u0026 12 spells known", "4 cantrips \u0026 13 spells known"],
			spellcastingBonus : [{
				name : "Mage Hand cantrip", // the Mage Hand cantrip gained at level 1
				spells : ["mage hand"],
				selection : ["mage hand"]
			}, {
				name : "From any school", // the spells gained at level 3, 8, 14, 20
				"class" : "wizard",
				times : [0, 0, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 4],
				level : [1, 4]
			}]
		},
		"subclassfeature3.1" : {
			name : "Mage Hand Legerdemain",
			source : ["P", 98],
			minlevel : 3,
			description : "\n   " + "As a bonus action, I can direct my Mage Hand" + "\n   " + "With a Dex (Sleight of Hand) vs. Wis (Perception) checks, I can do so discreetly" + "\n   " + "I can make it invisible and perform the following tasks:" + "\n    - " + "Stow/retrieve an object the hand is holding in a container worn/carried by another" + "\n    - " + "Use thieves' tools to pick locks and disarm traps at range",
			action : ["bonus action", ""],
			spellChanges : {
				"mage hand" : {
					description : "Invisible hand, carries 10 lb; 1 bns to control, use thieves' tools, or stow/retrieve obj; only 1 instance",
					changes : "My Mage Hand Legerdemain class feature expands my use of the Mage Hand cantrip and makes the spectral hand invisible."
				}
			}
		},
		"subclassfeature9" : {
			name : "Magical Ambush",
			source : ["P", 98],
			minlevel : 9,
			description : "\n   " + "When I cast a spell while hidden, the target(s) have disadvantage against that spell"
		},
		"subclassfeature13" : {
			name : "Versatile Trickster",
			source : ["P", 98],
			minlevel : 13,
			description : "\n   " + "As a bonus action, gain adv. on attacks this turn on creature within 5 ft of Mage Hand",
			action : ["bonus action", ""]
		},
		"subclassfeature17" : {
			name : "Spell Thief",
			source : ["P", 98],
			minlevel : 17,
			description : "\n   " + "As a reaction, after a spell is cast at me, I can try to negate and steal it" + "\n   " + "The caster makes a save against my spell DC with his/her spellcasting ability" + "\n   " + "On failure, the caster forgets how to cast that spell for eight hours" + "\n   " + "If I have a spell slot of a high enough level for it, I learn how to cast it during this time",
			action : ["reaction", ""],
			recovery : "long rest",
			usages : 1
		}
	}
});
AddSubClass("rogue", "assassin", {
	regExpSearch : /^(?!.*(barbarian|bard|cleric|druid|fighter|monk|paladin|ranger|sorcerer|warlock|wizard))(?=.*assassin).*$/i,
	subname : "Assassin",
	fullname : "Assassin",
	source : ["P", 97],
	abilitySave : 2,
	features : {
		"subclassfeature3" : {
			name : "Bonus Proficiencies",
			source : ["P", 97],
			minlevel : 3,
			description : "\n   " + "I am proficient with disguise kits and poisoner's kits",
			toolProfs : ["Disguise kit", "Poisoner's kit"]
		},
		"subclassfeature3.1" : {
			name : "Assassinate",
			source : ["P", 97],
			minlevel : 3,
			description : "\n   " + "I have adv. on attack rolls against creatures that have not taken a turn in combat yet" + "\n   " + "Any hit I score against a creature that is surprised is a critical hit"
		},
		"subclassfeature9" : {
			name : "Infiltration Expertise",
			source : ["P", 97],
			minlevel : 9,
			description : "\n   " + "I can create false identities in 7 days for 25 gp"
		},
		"subclassfeature13" : {
			name : "Imposter",
			source : ["P", 97],
			minlevel : 13,
			description : "\n   " + "After 3 hours of studying a person, I can mimic speech, writing, and behavior" + "\n   " + "I have advantage on Charisma (Deception) checks to maintain this ruse"
		},
		"subclassfeature17" : {
			name : "Death Strike",
			source : ["P", 97],
			minlevel : 17,
			description : "\n   " + "When I hit a surprised creature, it must make a Con save or take double damage",
			additional : "Save DC: 8 + Dex mod + Proficiency bonus"
		}
	}
});
AddSubClass("sorcerer", "wild magic", {
	regExpSearch : /^(?=.*(mage|magus|sorcerer|witch))(?=.*(wild|chaos|chaotic|limbo)).*$/i,
	subname : "Wild Magic",
	fullname : "Wild Mage",
	source : ["P", 103],
	features : {
		"subclassfeature1" : {
			name : "Wild Magic Surge",
			source : ["P", 103],
			minlevel : 1,
			description : desc([
				"Wild Magic Surges happen 5% of the time that I cast a sorcerer spell",
				"This doesn't happen with cantrips and I only take this chance if the DM tells me to",
				"See the \"Notes\" page for the table"
			]),
			toNotesPage : [{
				name : "Wild Magic Surge Table",
				source : ["P", 104],
				popupName : "Wild Mage's Wild Magic Surge Table, part 1",
				additional : "results 01-50",
				note : [
					"d100  Effect",
					"01-02 Roll on this table at the start of each of your turns for the next minute, ignoring this result on subsequent rolls.",
					"03-04 For the next minute, you can see any invisible creature if you have line of sight to it.",
					"05-06 A modron chosen and controlled by the DM appears in an unoccupied space within 5 ft of you, then disappears 1 minute later.",
					"07-08 You cast fireball as a 3rd-level spell centered on yourself.",
					"09-10 You cast magic missile as a 5th-level spell.",
					"11-12 Roll a d10. Your height changes by a number of inches equal to the roll. If the roll is odd, you shrink. If the roll is even, you grow.",
					"13-14 You cast confusion centered on yourself.",
					"15-16 For the next minute, you regain 5 hit points at the start of each of your turns.",
					"17-18 You grow a long beard made of feathers that remains until you sneeze, at which point the feathers explode out from your face.",
					"19-20 You cast grease centered on yourself.",
					"21-22 Creatures have disadvantage on saving throws against the next spell you cast in the next minute that involves a saving throw.",
					"23-24 Your skin turns a vibrant shade of blue. A remove curse spell can end this effect.",
					"25-26 An eye appears on your forehead for the next minute.",
					"27-28 For the next minute, all your spells with a casting time feet of 1 action have a casting time of 1 bonus action.",
					"29-30 You teleport up to 60 ft to an unoccupied space of your choice that you can see.",
					"31-32 You are transported to the Astral Plane until the end of your next turn, after which time you return to the space you previously occupied or the nearest unoccupied space if that space is occupied.",
					"33-34 Maximize the damage of the next damaging spell you cast within the next minute.",
					"35-36 Roll a d10. Your age changes by a number of years equal to the roll. If the roll is odd, you get younger (minimum 1 year old). If the roll is even, you get older.",
					"37-38 1d6 flumphs controlled by the DM appear in unoccupied spaces within 60 ft of you and are frightened of you. They vanish after 1 minute.",
					"39-40 You regain 2d10 hit points.",
					"41-42 You turn into a potted plant until the start of your next turn. While a plant, you are incapacitated and have vulnerability to all damage. If you drop to 0 hit points, your pot breaks, and your form reverts.",
					"43-44 For the next minute, you can teleport up to 20 ft as a bonus action on each of your turns.",
					"45-46 You cast levitate on yourself.",
					"47-48 A unicorn controlled by the DM appears in a space within 5 ft of you, then disappears 1 minute later.",
					"49-50 You can't speak for the next minute. Whenever you try, pink bubbles float out of your mouth."
				]
			}, {
				name : "Wild Magic Surge Table",
				source : ["P", 104],
				popupName : "Wild Mage's Wild Magic Surge Table, part 2",
				additional : "results 51-100",
				note : [
					"d100  Effect",
					"51-52 A spectral shield hovers near you for the next minute, granting you a +2 bonus to AC and immunity to magic missile.",
					"53-54 You are immune to being intoxicated by alcohol for the next 5d6 days.",
					"55-56 Your hair falls out but grows back within 24 hours.",
					"57-58 For the next minute, any flammable object you touch that isn't being worn or carried by another creature bursts into flame.",
					"59-60 You regain your lowest-level expended spell slot.",
					"61-62 For the next minute, you must shout when you speak.",
					"63-64 You cast fog cloud centered on yourself.",
					"65-66 Up to three creatures you choose within 30 ft of you take 4d10 lightning damage.",
					"67-68 You are frightened by the nearest creature until the end of your next turn.",
					"69-70 Each creature within 30 ft of you becomes invisible for the next minute. The invisibility ends on a creature when it attacks or casts a spell.",
					"71-72 You gain resistance to all damage for the next minute.",
					"73-74 A random creature within 60 ft of you becomes poisoned for 1d4 hours.",
					"75-76 You glow with bright light in a 30-ft radius for the next minute. Any creature that ends its turn within 5 ft of you is blinded until the end of its next turn.",
					"79-80 Illusory butterflies and flower petals flutter in the air within 10 ft of you for the next minute.",
					"77-78 You cast polymorph on yourself. If you fail the saving throw, you turn into a sheep for the spell's duration.",
					"81-82 You can take one additional action immediately.",
					"83-84 Each creature within 30 ft of you takes 1d10 necrotic damage. You regain hit points equal to the sum of the necrotic damage dealt.",
					"85-86 You cast mirror image.",
					"87-88 You cast fly on a random creature within 60 ft of you.",
					"89-90 You become invisible for the next minute. During that time, other creatures can't hear you. The invisibility ends if you attack or cast a spell.",
					"91-92 If you die within the next minute, you immediately come back to life as if by the reincarnate spell.",
					"93-94 Your size increases by one size category for the next minute.",
					"95-96 You and all creatures within 30 ft of you gain vulnerability to piercing damage for the next minute.",
					"97-98 You are surrounded by faint, ethereal music for the next minute.",
					"99-100 You regain all expended sorcery points."
				]
			}]
		},
		"subclassfeature1.1" : {
			name : "Tides of Chaos",
			source : ["P", 103],
			minlevel : 1,
			description : "\n   " + "I can gain advantage on either one attack roll, ability check, or saving throw" + "\n   " + "After I cast a 1st-level or higher sorcerer spell, the DM can impose a Wild Magic Surge" + "\n   " + "After I roll on the Wild Magic Surge table, I regain my use of Tides of Chaos",
			recovery : "long rest",
			usages : 1
		},
		"subclassfeature6" : {
			name : "Bend Luck",
			source : ["P", 103],
			minlevel : 6,
			description : "\n   " + "As a reaction, I can add/subtract 1d4 from another's attack roll, ability check, or save",
			action : ["reaction", " (2 sorcery points)"],
			additional : "2 sorcery points"
		},
		"subclassfeature14" : {
			name : "Controlled Chaos",
			source : ["P", 103],
			minlevel : 14,
			description : "\n   " + "Whenever I roll on the Wild Magic Surge table, I can roll twice and use either result"
		},
		"subclassfeature18" : {
			name : "Spell Bombardment",
			source : ["P", 103],
			minlevel : 18,
			description : "\n   " + "Once per turn, when I roll spell damage, I can take one damage die that rolled max" + "\n   " + "I can then roll this die again and add it to the spell's damage"
		}
	}
});
AddSubClass("warlock", "the archfey", {
	regExpSearch : /^(?=.*fey)(?=.*warlock).*$/i,
	subname : "the Archfey",
	source : ["P", 109],
	spellcastingExtra : ["faerie fire", "sleep", "calm emotions", "phantasmal force", "blink", "plant growth", "dominate beast", "greater invisibility", "dominate person", "seeming"],
	features : {
		"subclassfeature1" : {
			name : "Fey Presence",
			source : ["P", 109],
			minlevel : 1,
			description : "\n   " + "As an action, all creatures in a 10-ft cube around me must make a Wisdom save" + "\n   " + "If failed, they're all charmed or frightened (my choice) until the end of my next turn",
			recovery : "short rest",
			usages : 1,
			action : ["action", ""]
		},
		"subclassfeature6" : {
			name : "Misty Escape",
			source : ["P", 109],
			minlevel : 6,
			description : "\n   " + "As a reaction, when I take damage, I can turn invisible and teleport up to 60 ft" + "\n   " + "I stay invisible until the start of my next turn or until I attack or cast a spell",
			action : ["reaction", " (taking damage)"],
			recovery : "short rest",
			usages : 1
		},
		"subclassfeature10" : {
			name : "Beguiling Defenses",
			source : ["P", 109],
			minlevel : 10,
			description : "\n   " + "As a reaction, when a creature tries to charm me, I can turn the charm back on it" + "\n   " + "It must make a Wis save or be charmed by me for 1 minute or until taking damage" + "\n   " + "I am immune to being charmed",
			action : ["reaction", " (when charmed)"],
			savetxt : { immune : ["charmed"] }
		},
		"subclassfeature14" : {
			name : "Dark Delirium",
			source : ["P", 109],
			minlevel : 14,
			description : "\n   " + "As an action, a creature within 60 ft must make a Wis save or be charmed/frightened" + "\n   " + "This lasts for 1 minute or until my concentration is broken or it takes damage" + "\n   " + "During this time, it can't see or hear anything but the illusion, me, and itself",
			recovery : "short rest",
			usages : 1,
			action : ["action", ""]
		}
	}
});
AddSubClass("warlock", "the great old one", {
	regExpSearch : /^(((?=.*(tharizdun|cthulhu))(?=.*warlock))|((?=.*(great|dread))(?=.*(ancient|old))(?=.*\b(one|entity)\b))).*$/i,
	subname : "the Great Old One",
	source : ["P", 110],
	spellcastingExtra : ["dissonant whispers", "tasha's hideous laughter", "detect thoughts", "phantasmal force", "clairvoyance", "sending", "dominate beast", "evard's black tentacles", "dominate person", "telekinesis"],
	features : {
		"subclassfeature1" : {
			name : "Awakened Mind",
			source : ["P", 110],
			minlevel : 1,
			description : "\n   " + "I can telepathically speak to creatures I can see within 30 ft if they know a language" // 'to' not 'with', so one-way
		},
		"subclassfeature6" : {
			name : "Entropic Ward",
			source : ["P", 110],
			minlevel : 6,
			description : "\n   " + "As a reaction, when I'm attacked, I can impose disadvantage to that attack roll" + "\n   " + "If it misses me, I have adv. on my next attack vs. the attacker during my next turn",
			action : ["reaction", " (when attacked)"],
			recovery : "short rest",
			usages : 1
		},
		"subclassfeature10" : {
			name : "Thought Shield",
			source : ["P", 110],
			minlevel : 10,
			description : "\n   " + "No one can read my mind unless I allow it; I have resistance to psychic damage" + "\n   " + "When I take psychic damage, the dealer of the psychic damage takes the same amount",
			dmgres : ["Psychic"]
		},
		"subclassfeature14" : {
			name : "Create Thrall",
			source : ["P", 110],
			minlevel : 14,
			description : "\n   " + "As an action, I can charm an incapacitated humanoid by touch" + "\n   " + "While it is charmed, I can communicate with it telepathically if it is on the same plane" + "\n   " + "This lasts until the charm is removed (can be by Remove Curse) or I use this again",
			action : ["action", ""]
		}
	}
});
AddSubClass("wizard", "abjuration", {
	regExpSearch : /(abjuration|abjurer)/i,
	subname : "School of Abjuration",
	fullname : "Abjurer",
	source : ["P", 115],
	features : {
		"subclassfeature2" : {
			name : "Abjuration Savant",
			source : ["P", 115],
			minlevel : 2,
			description : "\n   " + "I halve the gp and time needed to copy abjuration spells into my spellbook"
		},
		"subclassfeature2.1" : {
			name : "Arcane Ward",
			source : ["P", 115],
			minlevel : 2,
			description : "\n   " + "Whenever I cast an 1st-level or higher abjuration spell, I make/heal a ward" + "\n   " + "I make it at max HP; When I cast again, it heals two HP per spell level" + "\n   " + "It stays active at 0 HP and doesn't go away until my next long rest" + "\n   " + "If I take damage, the ward takes the damage instead, but excess damage carries over",
			additional : levels.map( function(n) {
				return n < 2 ? "" : "Ward max HP: " + (n * 2) + "+Int mod";
			}),
			usages : 1,
			recovery : "long rest"
		},
		"subclassfeature6" : {
			name : "Projected Ward",
			source : ["P", 115],
			minlevel : 6,
			description : "\n   " + "As a reaction, my Arcane Ward can absorb damage done to a creature within 30 ft",
			action : ["reaction", ""]
		},
		"subclassfeature10" : {
			name : "Improved Abjuration",
			source : ["P", 115],
			minlevel : 10,
			description : "\n   " + "When I cast an abjuration spell requiring an ability check, I add my proficiency bonus",
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (spellKey == "dispel magic" || spellKey == "counterspell") {
							var theDC = Number(spellObj.description.replace(/.*DC (\d+).*/i, "$1"));
							spellObj.description = spellObj.description.replace("DC " + theDC, "DC " + (theDC - Number(How("Proficiency Bonus"))));
							return true;
						};
					},
					"I add my proficiency bonus to ability checks required by abjuration spells, thus lowering the DC."
				]
			}
		},
		"subclassfeature14" : {
			name : "Spell Resistance",
			source : ["P", 116],
			minlevel : 14,
			description : "\n   " + "I have adv. on spell saves and resistance to damaging spells",
			dmgres : ["Spells"],
			savetxt : { adv_vs : ["spells"] }
		}
	}
});
AddSubClass("wizard", "conjuration", {
	regExpSearch : /(conjuration|conjurer)/i,
	subname : "School of Conjuration",
	fullname : "Conjurer",
	source : ["P", 116],
	features : {
		"subclassfeature2" : {
			name : "Conjuration Savant",
			source : ["P", 116],
			minlevel : 2,
			description : "\n   " + "I halve the gp and time needed to copy conjuration spells into my spellbook"
		},
		"subclassfeature2.1" : {
			name : "Minor Conjuration",
			source : ["P", 116],
			minlevel : 2,
			description : "\n   " + "As an action, I can conjure an object up to 3 ft on each side and no more than 10 lbs" + "\n   " + "It must be of a form of a nonmagical object I have seen and is created within 10 ft" + "\n   " + "The object disappears after 1 hour, if it takes or deals damage, or when I use this again",
			action : ["action", ""]
		},
		"subclassfeature6" : {
			name : "Benign Transposition",
			source : ["P", 116],
			minlevel : 6,
			description : "\n   " + "As an action, I can teleport to a place within 30 ft that I can see" + "\n   " + "Instead, I can swap places with a willing Small/Medium creature in 30 ft that I can see" + "\n   " + "I can do this again after a long rest or casting a 1st-level or higher conjuration spell",
			usages : 1,
			recovery : "long rest",
			action : ["action", ""]
		},
		"subclassfeature10" : {
			name : "Focused Conjuration",
			source : ["P", 116],
			minlevel : 10,
			description : "\n   " + "While I am concentrating on a conjuration spell, it can't be broken by taking damage"
		},
		"subclassfeature14" : {
			name : "Durable Summons",
			source : ["P", 116],
			minlevel : 14,
			description : "\n   " + "Any creature I summon or create with a conjuration spell has 30 temporary hit points",
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (spellKey.indexOf("conjure") !== -1 && !(/barrage|volley|knowbot/i).test(spellKey)) {
							spellObj.description = spellObj.description.replace(/verbal commands/i, "command").replace(/^summon /i, '') + "; +30 temp hp";
							return true;
						} else if ((/find (greater )?(steed|familiar)/i).test(spellKey)) {
							spellObj.description = spellObj.description.replace(/Gain the services of a ([^;]+)/i, "A $1 (+30 temp hp)");
							return true;
						}
					},
					"Any creature I summon or create with a conjuration spell gains 30 temporary hit points."
				]
			}
		}
	}
});
AddSubClass("wizard", "divination", {
	regExpSearch : /(divination|diviner|divinator)/i,
	subname : "School of Divination",
	fullname : "Diviner",
	source : ["P", 116],
	features : {
		"subclassfeature2" : {
			name : "Divination Savant",
			source : ["P", 116],
			minlevel : 2,
			description : "\n   " + "I halve the gp and time needed to copy divination spells into my spellbook"
		},
		"subclassfeature2.1" : {
			name : "Portent",
			source : ["P", 116],
			minlevel : 2,
			description : "\n   " + "After a long rest, I roll dice and keep the results to be used before my next rest" + "\n   " + "A result can replace an attack/save/ability check made by me or a creature I can see" + "\n   " + "I choose to switch them before the dice to be replaced are rolled; Max once per turn",
			additional : levels.map( function(n) {
				return n < 2 ? "" : (n < 14 ? 2 : 3) + "d20 after a long rest";
			})
		},
		"subclassfeature6" : {
			name : "Expert Divination",
			source : ["P", 116],
			minlevel : 6,
			description : "\n   " + "When I cast a divination spell, I recover a spell slot of a lower level than the one I cast",
			additional : "Spell slot < 6th-level"
		},
		"subclassfeature10" : {
			name : "The Third Eye",
			source : ["P", 116],
			minlevel : 10,
			description : "\n   " + "As an action, I gain one of the following until my next short or long rest:" + "\n   " + "Darkvision 60ft, see the Ethereal Plane 60ft, read any language, or see invisibility 10ft",
			recovery : "short rest",
			usages : 1,
			action : ["action", ""]
		},
		"subclassfeature14" : {
			name : "Greater Portent",
			source : ["P", 117],
			minlevel : 14,
			description : "\n   " + "I can roll 3d20 instead of 2d20 when using my Portent feature"
		}
	}
});
AddSubClass("wizard", "enchantment", {
	regExpSearch : /(enchantment|enchanter)/i,
	subname : "School of Enchantment",
	fullname : "Enchanter",
	source : ["P", 117],
	features : {
		"subclassfeature2" : {
			name : "Enchantment Savant",
			source : ["P", 117],
			minlevel : 2,
			description : "\n   " + "I halve the gp and time needed to copy enchantment spells into my spellbook"
		},
		"subclassfeature2.1" : {
			name : "Hypnotic Gaze",
			source : ["P", 117],
			minlevel : 2,
			description : "\n   " + "As an action, a seen enemy within 5 ft must make a Wis save or be charmed" + "\n   " + "This doesn't work if it can't see/hear me; It's also incapacitated and reduced to 0 speed" + "\n   " + "This lasts until the end of my next turn, but I can use an action to extend the duration" + "\n   " + "It also ends if it takes damage, can't see or hear me, or is more than 5 ft from me" + "\n   " + "On success or once it ends, I can't use this on it again until after a long rest",
			action : ["action", ""],
			usages : 1,
			recovery : "long rest"
		},
		"subclassfeature6" : {
			name : "Instinctive Charm",
			source : ["P", 117],
			minlevel : 6,
			description : "\n   " + "As a reaction, when someone I can see in 30 ft attacks me, it must make a Wis save" + "\n   " + "If failed, it must instead attack the closest creature within range (not me or self)" + "\n   " + "On a success, the target is immune to this until after my long rest; This is a charm effect",
			action : ["reaction", " (when attacked)"]
		},
		"subclassfeature10" : {
			name : "Split Enchantment",
			source : ["P", 117],
			minlevel : 10,
			description : "\n   " + "When I cast an enchantment spell with only one target, I can target a second in range" + "\n   " + "This does not apply to cantrips",
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (spellObj.psionic || !spellObj.level || spellObj.school !== "Ench") return;
						var startDescr = spellObj.description;
						switch(spellKey) {
							case "animal messenger" :
								spellObj.description = spellObj.description.replace("Tiny beast delivers", "2 tiny beasts deliver single");
								break;
							case "antipathy/sympathy" :
								spellObj.description = spellObj.description.replace("Creature,", "2 crea, 1");
								break;
							case "heroism" :
							case "command" :
								spellObj.description = spellObj.description.replace(/, halt| as spell lasts/i, "");
							default :
								spellObj.description = spellObj.description.replace("1+1/SL", "2 or 1+1/SL").replace(/1 (crea(ture)?|beast|humanoid)/i, "2 $1s").replace(/creas\b/gi, "crea");
						}
						return startDescr !== spellObj.description;
					},
					"My enchantment, single-target 1st-level or higher spells can affect two targets instead of only one."
				]
			}
		},
		"subclassfeature14" : {
			name : "Alter Memories",
			source : ["P", 117],
			minlevel : 14,
			description : "\n   " + "When I cast an enchantment spell that charms, I can have one target be unaware of it" + "\n   " + "Also, once before that spell ends, I can have that target forget time while affected" + "\n   " + "It must make an Intelligence save or lose up to 1 + Charisma modifier hours of memory"
		}
	}
});
AddSubClass("wizard", "illusion", {
	regExpSearch : /(illusion|illusionist|illusionary)/i,
	subname : "School of Illusion",
	fullname : "Illusionist",
	source : ["P", 118],
	features : {
		"subclassfeature2" : {
			name : "Illusion Savant",
			source : ["P", 118],
			minlevel : 2,
			description : "\n   " + "I halve the gp and time needed to copy illusion spells into my spellbook"
		},
		"subclassfeature2.1" : {
			name : "Improved Minor Illusion",
			source : ["P", 118],
			minlevel : 2,
			description : "\n   " + "I gain the knowledge of the Minor Illusion cantrip (or another if I already knew it)" + "\n   " + "When I cast it, I can create both a sound and an image with a single casting",
			spellcastingBonus : {
				name : "Minor Illusion cantrip",
				spells : ["minor illusion"],
				selection : ["minor illusion"]
			},
			spellChanges : {
				"minor illusion" : {
					description : "5-ft cube illusion includes visible and audible; Int(Investigation) check vs. Spell DC; see book",
					changes : "My Improved Minor Illusion class feature allows me to make both a sound and an image with a single casting."
				}
			}
		},
		"subclassfeature6" : {
			name : "Malleable Illusion",
			source : ["P", 118],
			minlevel : 6,
			description : "\n   " + "After I cast an illusion spell that lasts 1 min or longer, I can use an action to change it",
			action : ["action", ""]
		},
		"subclassfeature10" : {
			name : "Illusory Self",
			source : ["P", 118],
			minlevel : 10,
			description : "\n   " + "As a reaction, when I'm attacked, I can impose an illusion that makes the attack miss",
			action : ["reaction", ""],
			recovery : "short rest",
			usages : 1
		},
		"subclassfeature14" : {
			name : "Illusory Reality",
			source : ["P", 118],
			minlevel : 14,
			description : "\n   " + "As a bonus action, after I cast a 1st-level or higher illusion spell, I can make it real" + "\n   " + "One inanimate, nonmagical object that is part of the illusion becomes real for 1 minute" + "\n   " + "The object can't be something that directly harms someone",
			action : ["bonus action", ""]
		}
	}
});
AddSubClass("wizard", "necromancy", {
	regExpSearch : /necromancy|necromancer|necromantic/i,
	subname : "School of Necromancy",
	fullname : "Necromancer",
	source : ["P", 118],
	features : {
		"subclassfeature2" : {
			name : "Necromancy Savant",
			source : ["P", 118],
			minlevel : 2,
			description : "\n   " + "I halve the gp and time needed to copy necromancy spells into my spellbook"
		},
		"subclassfeature2.1" : {
			name : "Grim Harvest",
			source : ["P", 118],
			minlevel : 2,
			description : "\n   " + "Once per turn, when I kill something with a 1st-level or higher spell, I regain hit points" + "\n   " + "The number of hit points regained is 2\u00D7 the spell's level (or 3\u00D7 with necromancy spells)" + "\n   " + "This doesn't occur for constructs/undead"
		},
		"subclassfeature6" : {
			name : "Undead Thralls",
			source : ["P", 119],
			minlevel : 6,
			description : "\n   " + "I add Animate Dead to my spellbook and can have an additional target when casting it" + "\n   " + "Undead created by my necromancy spells have the following benefits:" + "\n   " + "They add my proficiency bonus to damage and my wizard level to their HP maximums",
			spellcastingBonus : {
				name : "Undead Thralls",
				spells : ["animate dead"],
				selection : ["animate dead"]
			},
			spellChanges : {
				"animate dead" : {
					description : "Turn corpses into 2+2/SL Skeletons or Zombies; control for 24h; bns a command within 60 ft",
					changes : "My Undead Thralls class feature allows me to animate one more corpse than normal with Animate Dead."
				}
			}
		},
		"subclassfeature10" : {
			name : "Inured to Undead",
			source : ["P", 119],
			minlevel : 10,
			description : "\n   " + "I have resistance to necrotic damage and my hit point maximum can't be reduced",
			dmgres : ["Necrotic"]
		},
		"subclassfeature14" : {
			name : "Command Undead",
			source : ["P", 11],
			minlevel : 14,
			description : "\n   " + "As an action, an undead within 60 ft that I can see must make a Charisma save" + "\n   " + "If its Int is > 7, it has adv. on the save; If its Int is > 11, it repeats the save every hour" + "\n   " + "If failed, it becomes friendly to me and obeys my commands until I use this on another" + "\n   " + "On success, it becomes permanently immune to my further attempts",
			action : ["action", ""]
		}
	}
});
AddSubClass("wizard", "transmutation", {
	regExpSearch : /(transmutation|transmuter)/i,
	subname : "School of Transmutation",
	fullname : "Transmuter",
	source : ["P", 119],
	features : {
		"subclassfeature2" : {
			name : "Transmutation Savant",
			source : ["P", 119],
			minlevel : 2,
			description : "\n   " + "I halve the gp and time needed to copy transmutation spells into my spellbook"
		},
		"subclassfeature2.1" : {
			name : "Minor Alchemy",
			source : ["P", 119],
			minlevel : 2,
			description : "\n   " + "I can transform an object of wood/stone/iron/copper/silver into another of those" + "\n   " + "For each 10 min I spend, I can transform up to 1 cubic foot of the material" + "\n   " + "It reverts back when I lose concentration or after 1 hour"
		},
		"subclassfeature6" : {
			name : "Transmuter's Stone",
			source : ["P", 119],
			minlevel : 6,
			description : "\n   " + "In 8 hours, I can create a transmuter's stone that gives its wielder one of the following:" + "\n    - " + "Darkvision 60 ft" + "\n    - " + "10 ft increase to speed while unencumbered" + "\n    - " + "Proficiency in Constitution saving throws" + "\n    - " + "Resistance to either acid, cold, fire, lightning, or thunder damage" + "\n   " + "The benefit is chosen at creation; I can have only one active stone at a time" + "\n   " + "I can change the benefit when I cast a 1st-level or higher transmutation spell with it"
		},
		"subclassfeature10" : {
			name : "Shapechanger",
			source : ["P", 119],
			minlevel : 10,
			description : "\n   " + "I add Polymorph to my spellbook; I can cast it on myself without using a spell slot" + "\n   " + "When I do that, I can only transform into a beast with a challenge rating of 1 or lower",
			recovery : "short rest",
			usages : 1,
			spellcastingBonus : [{
				name : "Add to spellbook",
				spells : ["polymorph"],
				selection : ["polymorph"]
			}, {
				name : "1/SR no spell slot",
				spells : ["polymorph"],
				selection : ["polymorph"],
				firstCol : "oncesr"
			}],
			spellChanges : {
				"polymorph" : {
					name : "Polymorph (special)",
					range : "Self",
					description : "I transformed into a beast of my choice with a CR 1 or lower; see book",
					changes : "Using my Shapechanger class feature, I can cast Polymorph once per short rest without using a spell slot, but when I do so I can only cast it on myself and transform into a beast."
				}
			}
		},
		"subclassfeature14" : {
			name : "Master Transmuter",
			source : ["P", 119],
			minlevel : 14,
			description : "\n   " + "As an action, I can destroy my transmuter's stone and do one of the four following:" + "\n    " + "1) Major Transformation" + "\n      " + "In 10 minutes, I transmute one nonmagical object up to 5 cubic foot into another" + "\n      " + "This new, nonmagical object must be of similar size and mass and equal or less value" + "\n    " + "2) Panacea" + "\n      " + "One touched has all curses, diseases, and poisons removed and is healed to max HP" + "\n    " + "3) Restore Life" + "\n      " + "I cast Raise Dead without using spell slots or needing to have it in my spellbook" + "\n    " + "4) Restore Youth" + "\n      " + "A touched creature's apparent age is reduced by 3d10 years (to a minimum of 13)",
			action : ["action", ""]
		}
	}
});

// Add the backgrounds that are not in the SRD
BackgroundList["charlatan"] = {
	regExpSearch : /charlatan/i,
	name : "Charlatan",
	source : [["P", 128], ["ALbackground", 0]],
	skills : ["Deception", "Sleight of Hand"],
	gold : 15,
	equipleft : [
		["Disguise kit", "", 3],
		["Tools for chosen con", "", ""]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "False Identity",
	trait : [
		"I fall in and out of love easily, and am always pursuing someone.",
		"I have a joke for every occasion, especially occasions where humor is inappropriate.",
		"Flattery is my preferred trick for getting what I want.",
		"I'm a born gambler who can't resist taking a risk for a potential payoff.",
		"I lie about almost everything, even when there's no good reason to.",
		"Sarcasm and insults are my weapons of choice.",
		"I keep multiple holy symbols on me and invoke whatever deity might come in useful at any given moment.",
		"I pocket anything I see that might have some value."
	],
	ideal : [
		["Independence",
			"Independence: I am a free spirit \u2015 no one tells me what to do. (Chaotic)"
		],
		["Fairness",
			"Fairness: I never target people who can't afford to lose a few coins. (Lawful)"
		],
		["Charity",
			"Charity: I distribute the money I acquire to the people who really need it. (Good)"
		],
		["Creativity",
			"Creativity: I never run the same con twice. (Chaotic)"
		],
		["Friendship",
			"Friendship: Material goods come and go. Bonds of friendship last forever. (Good)"
		],
		["Aspiration",
			"Aspiration: I'm determined to make something of myself. (Any)"
		]
	],
	bond : [
		"I fleeced the wrong person and must work to ensure that this individual never crosses paths with me or those I care about.",
		"I owe everything to my mentor \u2015 a horrible person who's probably rotting in jail somewhere.",
		"Somewhere out there, I have a child who doesn't know me. I'm making the world better for him or her.",
		"I come from a noble family, and one day I'll reclaim my lands and title from those who stole them from me.",
		"A powerful person killed someone I love. Someday soon, I'll have my revenge.",
		"I swindled and ruined a person who didn't deserve it. I seek to atone for my misdeeds but might never be able to forgive myself."
	],
	flaw : [
		"I can't resist a pretty face.",
		"I'm always in debt. I spend my ill-gotten gains on decadent luxuries faster than I bring them in.",
		"I'm convinced that no one could ever fool me the way I fool others.",
		"I'm too greedy for my own good. I can't resist taking a risk if there's money involved.",
		"I can't resist swindling people who are more powerful than me.",
		"I hate to admit it and will hate myself for it, but I'll run and preserve my own hide if the going gets tough."
	],
	extra : [
		"Select a Favorite Scheme",
		"Cheat at games of chance",
		"Shave coins, forge documents",
		"User/manipulator",
		"Change identity",
		"Sleight-of-hand cons",
		"Sell junk as expensive necessities"
	],
	toolProfs : ["Disguise kit", "Forgery kit"],
	lifestyle : "comfortable"
};
BackgroundList["criminal"] = {
	regExpSearch : /criminal/i,
	name : "Criminal",
	source : [["P", 129], ["ALbackground", 0]],
	skills : ["Deception", "Stealth"],
	gold : 15,
	equipright : [
		["Dark, common clothes with hood", "", 3],
		["Crowbar", "", 5],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Criminal Contact",
	trait : [
		"I always have a plan for what to do when things go wrong.",
		"I am always calm, no matter the situation. I never raise my voice or let my emotions control me.",
		"The first thing I do in a new place is note the locations of everything valuable \u2015 or where such things could be hidden.",
		"I would rather make a new friend than a new enemy.",
		"I am incredibly slow to trust. Those who seem the fairest often have the most to hide.",
		"I don't pay attention to the risks in a situation. Never tell me the odds.",
		"The best way to get me to do something is to tell me I can't do it.",
		"I blow up at the slightest insult."
	],
	ideal : [
		["Honor",
			"Honor: I don't steal from others in the trade. (Lawful)"
		],
		["Freedom",
			"Freedom: Chains are meant to be broken, as are those who would forge them. (Chaotic)"
		],
		["Charity",
			"Charity: I steal from the wealthy so that I can help people in need. (Good)"
		],
		["Greed",
			"Greed: I will do whatever it takes to become wealthy. (Evil)"
		],
		["People",
			"People: I'm loyal to my friends, not to any ideals, and everyone else can take a trip down the Styx for all I care. (Neutral)"
		],
		["Redemption",
			"Redemption: There's a spark of good in everyone. (Good)"
		]
	],
	bond : [
		"I'm trying to pay off an old debt I owe to a generous benefactor.",
		"My ill-gotten gains go to support my family.",
		"Something important was taken from me, and I aim to steal it back.",
		"I will become the greatest thief that ever lived.",
		"I'm guilty of a terrible crime. I hope I can redeem myself for it.",
		"Someone I loved died because of a mistake I made. That will never happen again."
	],
	flaw : [
		"When I see something valuable, I can't think about anything but how to steal it.",
		"When faced with a choice between money and my friends, I usually choose the money.",
		"If there's a plan, I'll forget it. If I don't forget it, I'll ignore it.",
		"I have a \"tell\" that reveals when I'm lying.",
		"I turn tail and run when things look bad.",
		"An innocent person is in prison for a crime that I committed. I'm okay with that."
	],
	extra : [
		"Select a Criminal Specialty",
		"Blackmailer",
		"Burglar",
		"Enforcer",
		"Fence",
		"Highway robber",
		"Hired killer",
		"Pickpocket",
		"Smuggler",
		"Spy"
	],
	toolProfs : [["Gaming set", 1], ["Thieves' tools", "Dex"]],
	lifestyle : "poor"
};
BackgroundList["entertainer"] = {
	regExpSearch : /(entertainer|actor|dancer|fire.?eater|jester|juggler|instrumentalist|poet|singer|storyteller|tumbler)/i,
	name : "Entertainer",
	source : [["P", 130], ["ALbackground", 0]],
	skills : ["Acrobatics", "Performance"],
	gold : 15,
	equipright : [
		["Costume", "", 4],
		["Favor of an admirer", "", ""],
		["Belt pouch (with coins)", "", 1],
		["Musical instrument of my choice", "", ""]
	],
	feature : "By Popular Demand",
	trait : [
		"I know a story relevant to almost every situation.",
		"Whenever I come to a new place, I collect local rumors and spread gossip.",
		"I'm a hopeless romantic, always searching for that 'special someone'.",
		"Nobody stays angry at me or around me for long, since I can defuse any amount of tension.",
		"I love a good insult, even one directed at me.",
		"I get bitter if I'm not the center of attention.",
		"I'll settle for nothing less than perfection.",
		"I change my mood or my mind as quickly as I change key in a song."
	],
	ideal : [
		["Beauty",
			"Beauty: When I perform, I make the world better than it was. (Good)"
		],
		["Tradition",
			"Tradition: The stories, legends, and songs of the past must never be forgotten, for they teach us who we are. (Lawful)"
		],
		["Creativity",
			"Creativity: The world is in need of new ideas and bold action. (Chaotic)"
		],
		["Greed",
			"Greed: I'm only in it for the money and fame. [Evil]"
		],
		["People",
			"People: I like seeing the smiles on people's faces when I perform. That's all that matters. (Neutral)"
		],
		["Honesty",
			"Honesty: Art should reflect the soul; it should come from within and reveal who we really are. (Any)"
		]
	],
	bond : [
		"My instrument is my most treasured possession, and it reminds me of someone I love.",
		"Someone stole my precious instrument, and someday I'll get it back.",
		"I want to be famous, whatever it takes.",
		"I idolize a hero of the old tales and measure my deeds against that person's.",
		"I will do anything to prove myself superior to my hated rival.",
		"I would do anything for the other members of my old troupe."
	],
	flaw : [
		"I'll do anything to win fame and renown.",
		"I'm a sucker for a pretty face.",
		"A scandal prevents me from ever going home again. That kind of trouble seems to follow me around.",
		"I once satirized a noble who still wants my head. It was a mistake that I will likely repeat.",
		"I have trouble keeping my true feelings hidden. My sharp tongue lands me in trouble.",
		"Despite my best efforts, I am unreliable to my friends."
	],
	extra : [
		"Select an Entertainer Routine",
		"Actor",
		"Dancer",
		"Fire-eater",
		"Jester",
		"Juggler",
		"Instrumentalist",
		"Poet",
		"Singer",
		"Storyteller",
		"Tumbler"
	],
	toolProfs : ["Disguise kit", ["Musical instrument", 1]],
	lifestyle : "modest"
};
BackgroundList["folk hero"] = {
	regExpSearch : /^(?=.*folk)(?=.*hero).*$/i,
	name : "Folk Hero",
	source : [["P", 131], ["ALbackground", 0]],
	skills : ["Animal Handling", "Survival"],
	gold : 10,
	equipleft : [
		["Set of artisan's tools", "", ""],
		["Shovel", "", 5],
		["Iron pot", "", 10]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Rustic Hospitality",
	trait : [
		"I judge people by their actions, not their words.",
		"If someone is in trouble, I'm always ready to lend help.",
		"When I set my mind to something, I follow through no matter what gets in my way.",
		"I have a strong sense of fair play and always try to find the most equitable solution to arguments.",
		"I'm confident in my own abilities and do what I can to instill confidence in others.",
		"Thinking is for other people. I prefer action.",
		"I misuse long words in an attempt to sound smarter.",
		"I get bored easily. When am I going to get on with my destiny?"
	],
	ideal : [
		["Respect",
			"Respect: People deserve to be treated with dignity and respect. (Good)"
		],
		["Fairness",
			"Fairness: No one should get preferential treatment before the law, and no one is above the law. (Lawful)"
		],
		["Freedom",
			"Freedom: Tyrants must not be allowed to oppress the people. (Chaotic)"
		],
		["Might",
			"Might: If I become strong, I can take what I want\u2015 what I deserve. (Evil)"
		],
		["Sincerity",
			"Sincerity: There's no good in pretending to be something I'm not. (Neutral)"
		],
		["Destiny",
			"Destiny: Nothing and no one can steer me away from my higher calling. (Any)"
		]
	],
	bond : [
		"I have a family, but I have no idea where they are. One day, I hope to see them again.",
		"I worked the land, I love the land, and I will protect the land.",
		"A proud noble once gave me a horrible beating, and I will take my revenge on any bully I encounter.",
		"My tools are symbols of my past life, and I carry them so that I will never forget my roots.",
		"I protect those who cannot protect themselves.",
		"I wish my childhood sweetheart had come with me to pursue my destiny."
	],
	flaw : [
		"The tyrant who rules my land will stop at nothing to see me killed.",
		"I'm convinced of the significance of my destiny, and blind to my shortcomings and the risk of failure.",
		"The people who knew me when I was young know my shameful secret, so I can never go home again.",
		"I have a weakness for the vices of the city, especially hard drink.",
		"Secretly, I believe that things would be better if I were a tyrant lording over the land.",
		"I have trouble trusting in my allies."
	],
	extra : [
		"Select a Defining Event",
		"I stood up to a tyrant's agents",
		"I saved people during a natural disaster",
		"I stood alone against a terrible monster",
		"I stole from a corrupt merchant for the poor",
		"I led a militia to fight off an invading army",
		"I stole weapons from a tyrant to arm the people",
		"I trained peasantry to fight a tyrant with farm tools",
		"A decree was rescinded after I led a protest against it",
		"A magical creature gave me a blessing or insight",
		"I rose to leadership in a lord's army"
	],
	toolProfs : [["Artisan's tools", 1], "Vehicles (land)"],
	lifestyle : "modest"
};
BackgroundList["guild artisan"] = {
	regExpSearch : /^(?=.*guild)(?=.*artisan).*$/i,
	name : "Guild Artisan",
	source : [["P", 132], ["ALbackground", 0]],
	skills : ["Insight", "Persuasion"],
	gold : 15,
	equipleft : [
		["Set of artisan's tools", "", ""],
		["Letter of introduction from guild", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Guild Membership",
	trait : [
		"I believe that anything worth doing is worth doing right. I can't help it\u2015 I'm a perfectionist.",
		"I'm a snob who looks down on those who can't appreciate fine art.",
		"I always want to know how things work and what makes people tick.",
		"I'm full of witty aphorisms and have a proverb for every occasion.",
		"I'm rude to people who lack my commitment to hard work and fair play.",
		"I like to talk at length about my profession.",
		"I don't part with my money easily and will haggle tirelessly to get the best deal possible.",
		"I'm well known for my work, and I want to make sure everyone appreciates it. I'm always taken aback when people haven't heard of me."
	],
	ideal : [
		["Community",
			"Community: It is the duty of all civilized people to strengthen the bonds of community and the security of civilization. (Lawful)"
		],
		["Generosity",
			"Generosity: My talents were given to me so that I could use them to benefit the world. (Good)"
		],
		["Freedom",
			"Freedom: Everyone should be free to pursue his or her own livelihood. (Chaotic)"
		],
		["Greed",
			"Greed: I'm only in it for the money. (Evil)"
		],
		["People",
			"People: I'm committed to the people I care about, not to ideals. (Neutral)"
		],
		["Aspiration",
			"Aspiration: I work hard to be the best there is at my craft. (Any)"
		]
	],
	bond : [
		"The workshop where I learned my trade is the most important place in the world to me.",
		"I created a great work for someone, and then found them unworthy to receive it. I'm still looking for someone worthy.",
		"I owe my guild a great debt for forging me into the person I am today.",
		"I pursue wealth to secure someone's love.",
		"One day I will return to my guild and prove that I am the greatest artisan of them all.",
		"I will get revenge on the evil forces that destroyed my place of business and ruined my livelihood."
	],
	flaw : [
		"I'll do anything to get my hands on something rare or priceless.",
		"I'm quick to assume that someone is trying to cheat me.",
		"No one must ever learn that I once stole money from guild coffers.",
		"I'm never satisfied with what I have\u2015 I always want more.",
		"I would kill to acquire a noble title.",
		"I'm horribly jealous of anyone who can outshine my handiwork. Everywhere I go, I'm surrounded by rivals."
	],
	extra : [
		"Select a Guild Business",
		"Alchemists and apothecaries",
		"Armorers, locksmiths, and finesmiths",
		"Brewers, distillers, and vintners",
		"Calligraphers, scribes, and scriveners",
		"Carpenters, roofers, and plasterers",
		"Cartographers, surveyors, and chart-makers",
		"Cobblers and shoemakers",
		"Cooks and bakers",
		"Glassblowers and glaziers",
		"Jewelers and gemcutters",
		"Leatherworkers, skinners, and tanners",
		"Masons and stonecutters",
		"Painters, limners, and sign-makers",
		"Potters and tile-makers",
		"Shipwrights and sailmakers",
		"Smiths and metal-forgers",
		"Tinkers, pewterers, and casters",
		"Wagon-makers and wheelwrights",
		"Weavers and dyers",
		"Woodcarvers, coopers, and bowyers"
	],
	toolProfs : [["Artisan's tools", 1]],
	languageProfs : [1],
	lifestyle : "comfortable"
};
BackgroundList["hermit"] = {
	regExpSearch : /hermit/i,
	name : "Hermit",
	source : [["P", 134], ["ALbackground", 0]],
	skills : ["Medicine", "Religion"],
	gold : 5,
	equipleft : [
		["Winter blanket", "", 3],
		["Herbalism kit", "", 3]
	],
	equipright : [
		["Common clothes", "", 3],
		["Scroll case with notes", "", 1]
	],
	feature : "Discovery",
	trait : [
		"I've been isolated for so long that I rarely speak, preferring gestures and the occasional grunt.",
		"I am utterly serene, even in the face of disaster.",
		"The leader of my community had something wise to say on every topic, and I am eager to share that wisdom.",
		"I feel tremendous empathy for all who suffer.",
		"I'm oblivious to etiquette and social expectations.",
		"I connect everything that happens to me to a grand, cosmic plan.",
		"I often get lost in my own thoughts and contemplation, becoming oblivious to my surroundings.",
		"I am working on a grand philosophical theory and love sharing my ideas."
	],
	ideal : [
		["Greater Good",
			"Greater Good: My gifts are meant to be shared with all, not used for my own benefit. (Good)"
		],
		["Logic",
			"Logic: Emotions must not cloud our sense of what is right and true, or our logical thinking. (Lawful)"
		],
		["Free Thinking",
			"Free Thinking: Inquiry and curiosity are the pillars of progress. (Chaotic)"
		],
		["Power",
			"Power: Solitude and contemplation are paths toward mystical or magical power. (Evil)"
		],
		["Live and Let Live",
			"Live and Let Live: Meddling in the affairs of others only causes trouble. (Neutral)"
		],
		["Self-Knowledge",
			"Self-Knowledge: If you know yourself, there's nothing left to know. (Any)"
		]
	],
	bond : [
		"Nothing is more important than the other members of my hermitage, order, or association.",
		"I entered seclusion to hide from the ones who might still be hunting me. I must someday confront them.",
		"I'm still seeking the enlightenment I pursued in my seclusion, and it still eludes me.",
		"I entered seclusion because I loved someone I could not have.",
		"Should my discovery come to light, it could bring ruin to the world.",
		"My isolation gave me great insight into a great evil that only I can destroy."
	],
	flaw : [
		"Now that I've returned to the world, I enjoy its delights a little too much.",
		"I harbor dark, bloodthirsty thoughts that my isolation and meditation failed to quell.",
		"I am dogmatic in my thoughts and philosophy.",
		"I let my need to win arguments overshadow friendships and harmony.",
		"I'd risk too much to uncover a lost bit of knowledge.",
		"I like keeping secrets and won't share them with anyone."
	],
	extra : [
		"Select a Life of Seclusion",
		"Searching for spiritual enlightenment",
		"Living in accordance with a religious order",
		"Exiled for a crime I didn't commit",
		"Retreated from society after a life-altering event",
		"Worked on my art, literature, music, or manifesto",
		"Commune with nature, far from civilization",
		"Caretaker of an ancient ruin or relic",
		"Pilgrim in search of a thing of spiritual significance"
	],
	toolProfs : ["Herbalism kit"],
	languageProfs : [1],
	lifestyle : "poor"
};
BackgroundList["noble"] = {
	regExpSearch : /^(?!.*(waterdhavian|waterdeep|knight))(?=.*noble).*$/i,
	name : "Noble",
	source : [["P", 135], ["ALbackground", 0]],
	skills : ["History", "Persuasion"],
	gold : 25,
	equipleft : [
		["Scroll of pedigree", "", ""]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Signet ring", "", ""],
		["Purse (with coins)", "", 1]
	],
	feature : "Position of Privilege",
	trait : [
		"My eloquent flattery makes everyone I talk to feel like the most wonderful and important person in the world.",
		"The common folk love me for my kindness and generosity.",
		"No one could doubt by looking at my regal bearing that I am a cut above the unwashed masses.",
		"I take great pains to always look my best and follow the latest fashions.",
		"I don't like to get my hands dirty, and I won't be caught dead in unsuitable accommodations.",
		"Despite my noble birth, I do not place myself above other folk. We all have the same blood.",
		"My favor, once lost, is lost forever.",
		"If you do me an injury, I will crush you, ruin your name, and salt your fields."
	],
	ideal : [
		["Respect",
			"Respect: Respect is due to me because of my position, but all people regardless of station deserve to be treated with dignity. (Good)"
		],
		["Responsibility",
			"Responsibility: It is my duty to respect the authority of those above me, just as those below me must respect mine. (Lawful)"
		],
		["Independence",
			"Independence: I must prove that I can handle myself without the coddling of my family. (Chaotic)"
		],
		["Power",
			"Power: If I can attain more power, no one will tell me what to do. (Evil)"
		],
		["Family",
			"Family: Blood runs thicker than water. (Any)"
		],
		["Noble Obligation",
			"Noble Obligation: It is my duty to protect and care for the people beneath me. (Good)"
		]
	],
	bond : [
		"I will face any challenge to win the approval of my family.",
		"My house's alliance with another noble family must be sustained at all costs.",
		"Nothing is more important than the other members of my family.",
		"I am in love with the heir of a family that my family despises.",
		"My loyalty to my sovereign is unwavering.",
		"The common folk must see me as a hero of the people."
	],
	flaw : [
		"I secretly believe that everyone is beneath me.",
		"I hide a truly scandalous secret that could ruin my family forever.",
		"I too often hear veiled insults and threats in every word addressed to me, and I'm quick to anger.",
		"I have an insatiable desire for carnal pleasures.",
		"In fact, the world does revolve around me.",
		"By my words and actions, I often bring shame to my family."
	],
	toolProfs : [["Gaming set", 1]],
	languageProfs : [1],
	lifestyle : "wealthy"
};
BackgroundList["outlander"] = {
	regExpSearch : /^(?!.*urban)(?=.*(outlander|forester|trapper|homesteader|guide|exile|outcast|bounty.?hunter|tribal nomad|hunter-gatherer|tribal.?marauder)).*$/i,
	name : "Outlander",
	source : [["P", 136], ["ALbackground", 0]],
	skills : ["Athletics", "Survival"],
	gold : 10,
	equipright : [
		["Traveler's clothes", "", 4],
		["Staff", "", 4],
		["Hunting trap", "", 25],
		["Trophy from animal", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Wanderer",
	trait : [
		"I'm driven by a wanderlust that led me away from home.",
		"I watch over my friends as if they were a litter of newborn pups.",
		"I once ran twenty-five miles without stopping to warn to my clan of an approaching orc horde. I'd do it again if I had to.",
		"I have a lesson for every situation, drawn from observing nature.",
		"I place no stock in wealthy or well-mannered folk. Money and manners won't save you from a hungry owlbear.",
		"I'm always picking things up, absently fiddling with them, and sometimes accidentally breaking them.",
		"I feel far more comfortable around animals than people.",
		"I was, in fact, raised by wolves."
	],
	ideal : [
		["Change",
			"Change: Life is like the seasons, in constant change, and we must change with it. (Chaotic)"
		],
		["Greater Good",
			"Greater Good: It is each person's responsibility to make the most happiness for the whole tribe. (Good)"
		],
		["Honor",
			"Honor: If I dishonor myself, I dishonor my whole clan. (Lawful)"
		],
		["Might",
			"Might: The strongest are meant to rule. (Evil)"
		],
		["Nature",
			"Nature: The natural world is more important than all the constructs of civilization. (Neutral)"
		],
		["Glory",
			"Glory: I must earn glory in battle, for myself and my clan. (Any)"
		]
	],
	bond : [
		"My family, clan, or tribe is the most important thing in my life, even when they are far from me.",
		"An injury to the unspoiled wilderness of my home is an injury to me.",
		"I will bring terrible wrath down on the evildoers who destroyed my homeland.",
		"I am the last of my tribe, and it is up to me to ensure their names enter legend.",
		"I suffer awful visions of a coming disaster and will do anything to prevent it.",
		"It is my duty to provide children to sustain my tribe."
	],
	flaw : [
		"I am too enamored of ale, wine, and other intoxicants.",
		"There's no room for caution in a life lived to the fullest.",
		"I remember every insult I've received and nurse a silent resentment toward anyone who's ever wronged me.",
		"I am slow to trust members of other races, tribes, and societies.",
		"Violence is my answer to almost any challenge.",
		"Don't expect me to save those who can't save themselves. It is nature's way that the strong thrive and the weak perish."
	],
	extra : ["Select an Origin",
		"Forester",
		"Trapper",
		"Homesteader",
		"Guide",
		"Exile or outcast",
		"Bounty hunter",
		"Pilgrim",
		"Tribal nomad",
		"Hunter-gatherer",
		"Tribal marauder"
	],
	toolProfs : [["Musical instrument", 1]],
	languageProfs : [1],
	lifestyle : "poor"
};
BackgroundList["sage"] = {
	regExpSearch : /(sage|alchemist|astronomer|academic|librarian|professor|researcher|apprentice|scribe)/i,
	name : "Sage",
	source : [["P", 137], ["ALbackground", 0]],
	skills : ["Arcana", "History"],
	gold : 10,
	equipleft : [
		["Ink, 1 ounce bottle of", 1, ""],
		["Ink pen (quill)", "", ""],
		["Small knife", "", 0.5],
		["Letter from dead colleague", "", ""]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Researcher",
	trait : [
		"I use polysyllabic words that convey the impression of great erudition.",
		"I've read every book in the world's greatest libraries\u2015 or I like to boast that I have.",
		"I'm used to helping out those who aren't as smart as I am, and I patiently explain anything and everything to others.",
		"There's nothing I like more than a good mystery.",
		"I'm willing to listen to every side of an argument before I make my own judgment.",
		"I . . . speak . . . slowly . . . when talking . . . to idiots, . . . which . . . almost. . . everyone . . . is . . . compared . . . to me.",
		"I am horribly, horribly awkward in social situations.",
		"I'm convinced that people are always trying to steal my secrets."
	],
	ideal : [
		["Knowledge",
			"Knowledge: The path to power and self-improvement is through knowledge. (Neutral)"
		],
		["Beauty",
			"Beauty: What is beautiful points us beyond itself toward what is true. (Good)"
		],
		["Logic",
			"Logic: Emotions must not cloud our logical thinking. (Lawful)"
		],
		["No Limits",
			"No Limits: Nothing should fetter the infinite possibility inherent in all existence. (Chaotic)"
		],
		["Power",
			"Power: Knowledge is the path to power and domination. (Evil)"
		],
		["Self-Improvement",
			"Self-Improvement: The goal of a life of study is the betterment of oneself. (Any)"
		]
	],
	bond : [
		"It is my duty to protect my students.",
		"I have an ancient text that holds terrible secrets that must not fall into the wrong hands.",
		"I work to preserve a library, university, scriptorium, or monastery.",
		"My life's work is a series of tomes related to a specific field of lore.",
		"I've been searching my whole life for the answer to a certain question.",
		"I sold my soul for knowledge. I hope to do great deeds and win it back."
	],
	flaw : [
		"I am easily distracted by the promise of information.",
		"Most people scream and run when they see a demon. I stop and take notes on its anatomy.",
		"Unlocking an ancient mystery is worth the price of a civilization.",
		"I overlook obvious solutions in favor of complicated ones.",
		"I speak without really thinking through my words, invariably insulting others.",
		"I can't keep a secret to save my life, or anyone else's."
	],
	extra : ["Select a Specialty",
		"Alchemist",
		"Astronomer",
		"Discredited academic",
		"Librarian",
		"Professor",
		"Researcher",
		"Wizard's apprentice",
		"Scribe"
	],
	languageProfs : [2],
	lifestyle : "modest"
};
BackgroundList["sailor"] = {
	regExpSearch : /sailor/i,
	name : "Sailor",
	source : [["P", 139], ["ALbackground", 0]],
	skills : ["Athletics", "Perception"],
	gold : 10,
	equipleft : [
		["Silk rope, feet of", 50, 0.1]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belaying pin (club)", "", 2],
		["Lucky charm", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Ship's Passage",
	trait : [
		"My friends know they can rely on me, no matter what.",
		"I work hard so that I can play hard when the work is done.",
		"I enjoy sailing into new ports and making new friends over a flagon of ale.",
		"I stretch the truth for the sake of a good story.",
		"To me, a tavern brawl is a nice way to get to know a new city.",
		"I never pass up a friendly wager.",
		"My language is as foul as an otyugh nest.",
		"I like a job well done, especially if I can convince someone else to do it."
	],
	ideal : [
		["Respect",
			"Respect: The thing that keeps a ship together is mutual respect between captain and crew. (Good)"
		],
		["Fairness",
			"Fairness: We all do the work, so we all share in the rewards. (Lawful)"
		],
		["Freedom",
			"Freedom: The sea is freedom\u2015 the freedom to go anywhere and do anything. (Chaotic)"
		],
		["Mastery",
			"Mastery: I'm a predator, and the other ships on the sea are my prey. (Evil)"
		],
		["People",
			"People: I'm committed to my crewmates, not to ideals. (Neutral)"
		],
		["Aspiration",
			"Aspiration: Someday I'll own my own ship and chart my own destiny. (Any)"
		]
	],
	bond : [
		"I'm loyal to my captain first, everything else second.",
		"The ship is most important\u2015 crewmates and captains come and go.",
		"I'll always remember my first ship.",
		"In a harbor town, I have a paramour whose eyes nearly stole me from the sea.",
		"I was cheated out of my fair share of the profits, and I want to get my due.",
		"Ruthless pirates murdered my captain and crewmates, plundered our ship, and left me to die. Vengeance will be mine."
	],
	flaw : [
		"I follow orders, even if I think they're wrong.",
		"I'll say anything to avoid having to do extra work.",
		"Once someone questions my courage, I never back down no matter how dangerous the situation.",
		"Once I start drinking, it's hard for me to stop.",
		"I can't help but pocket loose coins and other trinkets I come across.",
		"My pride will probably lead to my destruction."
	],
	toolProfs : ["Navigator's tools", "Vehicles (water)"],
	lifestyle : "modest",
};
BackgroundList["soldier"] = {
	regExpSearch : /^(?!.*mercenary)(?=.*soldier).*$/i,
	name : "Soldier",
	source : [["P", 140], ["ALbackground", 0]],
	skills : ["Athletics", "Intimidation"],
	gold : 10,
	equipright : [
		["Common clothes", "", 3],
		["Insignia of rank", "", ""],
		["Trophy from fallen enemy", "", ""],
		["Bone dice or playing cards", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Military Rank",
	trait : [
		"I'm always respectful and polite.",
		"I'm haunted by memories of war. I can't get the violent images out of my mind.",
		"I'm slow to make new friends, because I've lost too many old ones.",
		"I'm full of inspiring and cautionary tales from my military experience with some relevance to almost every type of combat situation.",
		"I can stare down a owlbear without flinching.",
		"I enjoy my strength and like to break things.",
		"I have a rough sense of humor.",
		"I approach problems head-on. A simple, direct course is the best path to a solution."
	],
	ideal : [
		["Greater Good",
			"Greater Good: Our fate is to give our lives in the defense of others. (Good)"
		],
		["Responsibility",
			"Responsibility: I do what I have to and follow just authority. (Lawful)"
		],
		["Independence",
			"Independence: When people obey orders blindly, they affirm a kind of tyranny. (Chaotic)"
		],
		["Might",
			"Might: In life as in war, the mightier force prevails. (Evil)"
		],
		["Live and Let Live",
			"Live and Let Live: Ideals aren't worth killing over or going to war for. (Neutral)"
		],
		["Nation",
			"Nation: My city, state, or people are the only things that matter. (Any)"
		]
	],
	bond : [
		"I would still give my life for the people I have served with.",
		"Someone saved my life on the battlefield. Even now, I would never leave a friend behind.",
		"My honor is my life.",
		"I'll never forget the crushing defeat my company endured or the foes who inflicted it.",
		"Those who fight with me are those worth laying down my life for.",
		"I fight for those who cannot fight for themselves."
	],
	flaw : [
		"The atrocious enemy we faced in battle still leaves me trembling with fear.",
		"I have little respect for those who are not a tested warrior.",
		"A disastrous mistake I made in battle cost many lives\u2015 I will do anything to keep that mistake a secret.",
		"My hatred of my foes is blind and unreasoning. ",
		"I uphold the law, even if the law causes suffering.",
		"I'd rather eat my weapon than admit when I'm wrong."
	],
	extra : ["Select a Specialty",
		"Officer",
		"Scout",
		"Infantry",
		"Cavalry",
		"Healer",
		"Quartermaster",
		"Standard-bearer",
		"Support staff"
	],
	toolProfs : [["Gaming set", 1], "Vehicles (land)"],
	lifestyle : "modest"
};
BackgroundList["urchin"] = {
	regExpSearch : /urchin/i,
	name : "Urchin",
	source : [["P", 141], ["ALbackground", 0]],
	skills : ["Sleight of Hand", "Stealth"],
	gold : 10,
	equipleft : [
		["Map of the city", "", ""],
		["Small knife", "", 0.5]
	],
	equipright : [
		["Common clothes", "", 3],
		["Token from my parents", "", ""],
		["Pet mouse", "", 0.1],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "City Secrets",
	trait : [
		"I keep scraps of food and trinkets hidden away in my pockets.",
		"I ask questions all the time.",
		"I like to squeeze into compact places where nobody can harm me.",
		"I sleep with my back to solid surface, with all that I own embraced tightly in my arms.",
		"I have bad manners and eat like a pig.",
		"I expect that anybody who's nice to me is hiding malicious intent.",
		"I eschew bathing.",
		"I say, without reserve, what other people are implying or masking."
	],
	ideal : [
		["Respect",
			"Respect: Everybody, no matter their riches, deserves respect. (Good)"
		],
		["Community",
			"Community: We have to take look out for each other, because nobody else will do it for us. (Lawful)"
		],
		["Change",
			"Change: The low rise up, and the high and mighty come down. Change is natural. (Chaotic)"
		],
		["Retribution",
			"Retribution: The rich need to be shown how it is to live and die in the poor quarters. (Evil)"
		],
		["People",
			"People: I help those who help me\u2015 that is what lets us stay alive. (Neutral)"
		],
		["Aspiration",
			"Aspiration: I'm going to prove that I'm worthy of a better life. (Any)"
		]
	],
	bond : [
		"My town or city is my home, and I'll battle those that threaten it.",
		"I'm the benefactor of an orphanage so others may be kept from enduring what I was forced to endure.",
		"I owe my life to another urchin who taught me the ways of living in the gutters.",
		"I owe a debt I can never repay to the person who showed me sympathy.",
		"I got away from my life of poverty by robbing an influential person, and I'm wanted for it.",
		"No one else should have to suffer the difficulties I've been through."
	],
	flaw : [
		"I will run away from a fight if I'm outnumbered.",
		"A gold piece already has a lot of value to me, and I'll do just about anything for more of it.",
		"I will never completely trust another. I only trust myself.",
		"I would rather use an unfair advantage than fight honorably.",
		"It's not theft if I have more use for it than someone else.",
		"People who are incapable of taking care of themselves get what they deserve."
	],
	toolProfs : ["Disguise kit", ["Thieves' tools", "Dex"]],
	lifestyle : "modest"
};

// Add the background variants
AddBackgroundVariant("entertainer", "gladiator", {
	regExpSearch : /gladiator/i,
	name : "Gladiator",
	source : [["P", 131], ["ALbackground", 0]],
	equipright : [
		["Costume", "", 4],
		["Favor of an admirer", "", ""],
		["Belt pouch (with coins)", "", 1],
		["Inexpensive, unusual weapon", "", ""]
	],
	feature : "Are You Entertained?",
	extra : ""
});
AddBackgroundVariant("guild artisan", "guild merchant", {
	regExpSearch : /^(?=.*guild)(?=.*merchant).*$/i,
	name : "Guild Merchant",
	source : [["P", 133], ["ALbackground", 0]],
	equipleft : [
		["Letter of introduction from guild", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Belt pouch (with coins)", "", 1],
		["Cart", "", ""],
		["Mule", "", ""]
	],
	extra : [
		"Select a Guild Business",
		"Traders",
		"Caravan masters",
		"Shopkeepers"
	],
	toolProfs : ["Navigator's tools (or language)"]
});
AddBackgroundVariant("noble", "knight", {
	regExpSearch : /^(?!.*order)(?=.*knight).*$/i,
	name : "Knight",
	source : [["P", 136], ["ALbackground", 0]],
	equipright : [
		["Fine clothes", "", 6],
		["Signet ring", "", ""],
		["Purse (with coins)", "", 1],
		["Banner or token from devoted love", "", ""]
	],
	feature : "Retainers"
});
AddBackgroundVariant("sailor", "pirate", {
	regExpSearch : /pirate/i,
	name : "Pirate",
	source : [["P", 139], ["ALbackground", 0]],
	feature : "Bad Reputation"
});

// Add the backgrounds features that are not in the SRD
BackgroundFeatureList["are you entertained?"] = {
	description : "I can always find a place to perform (arena/pit fight), where I receive free lodging and food of a modest or comfortable standard, as long as I perform each night. In addition, my performance makes me something of a local figure. When strangers recognize me in a town where I have performed, they typically take a liking to me.",
	source : [["P", 131], ["ALbackground", 0]]
};
BackgroundFeatureList["bad reputation"] = {
	description : "No matter where I go, people are afraid of me due to my reputation. When I am in a civilized settlement, I can get away with minor criminal offenses, such as refusing to pay for food at a tavern or breaking down doors at a local shop, since most people will not report my activity to the authorities.",
	source : [["P", 139], ["ALbackground", 0]]
};
BackgroundFeatureList["by popular demand"] = {
	description : "I can always find a place to perform (inn/tavern/circus/etc.), where I receive free lodging and food of a modest or comfortable standard, as long as I perform each night. In addition, my performance makes me something of a local figure. When strangers recognize me in a town where I have performed, they typically take a liking to me.",
	source : [["P", 130], ["ALbackground", 0]],
};
BackgroundFeatureList["city secrets"] = {
	description : "I know the secret patterns and flow to cities and can find passages through the urban sprawl that others would miss. When I am not in combat, I (and companions I lead) can travel between any two locations in the city twice as fast as my speed would normally allow.",
	source : [["P", 141], ["ALbackground", 0]]
};
BackgroundFeatureList["criminal contact"] = {
	description : "I have a reliable and trustworthy contact who acts as my liaison to a network of other criminals. I know how to get messages to and from my contact, even over great distances; specifically, I know the local messengers, corrupt caravan masters, and seedy sailors who can deliver my messages.",
	source : [["P", 129], ["ALbackground", 0]]
};
BackgroundFeatureList["discovery"] = {
	description : "The quiet seclusion of my extended hermitage gave me access to a unique and powerful discovery. The exact nature of this revelation depends on the nature of my seclusion. It might be a great truth, a hidden site, a long forgotten fact, or unearthed some relic of the past that could rewrite history.",
	source : [["P", 134], ["ALbackground", 0]]
};
BackgroundFeatureList["false identity"] = {
	description : "I have created a second identity that includes documentation, established acquaintances, and disguises that allow me to assume that persona. Additionally, I can forge documents, including official papers and personal letters, as long as I have seen an example of the kind of document or the handwriting I am trying to copy.",
	source : [["P", 128], ["ALbackground", 0]]
};
BackgroundFeatureList["guild membership"] = {
	description : "5 gp membership fees per month: The guild offers lodging if possible. In case of being accused of a crime, the guild will support me if a good case can be made for my innocence or the crime is justifiable. I can also gain access to powerful political figures through the guild, as long as I'm in good standing and the guild is paid enough.",
	source : [["P", 133], ["ALbackground", 0]]
};
BackgroundFeatureList["military rank"] = {
	description : "I have a military rank from my career as a soldier. Soldiers loyal to my former military organization still recognize my authority and influence. I can invoke my rank to influence soldiers and temporarily requisition simple equipment or horses. I can usually gain access to friendly military encampments and fortresses where my rank is recognized.",
	source : [["P", 140], ["ALbackground", 0]],
};
BackgroundFeatureList["position of privilege"] = {
	description : "I am welcome in high society, and people assume I have the right to be wherever I am. The common folk make every effort to accommodate me and avoid my displeasure, and other people of high birth treat me as a member of the same social sphere. I can secure an audience with a local noble if I need to.",
	source : [["P", 135], ["ALbackground", 0]]
};
BackgroundFeatureList["researcher"] = {
	description : "When I attempt to learn or recall a piece of lore, if I do not know that information, I often know where and from whom I can obtain it. Usually, this information comes from a library, scriptorium, university, or a sage or other learned person or creature. Unearthing the deepest secrets of the multiverse can require an adventure or even a whole campaign.",
	source : [["P", 138], ["ALbackground", 0]]
};
BackgroundFeatureList["retainers"] = {
	description : "I have the service of three retainers loyal to me family, one of whom is another noble and my squire. My other retainers are commoners who can perform mundane tasks for me, but they do not fight for me, will not follow me into obviously dangerous areas (such as dungeons), and will leave if they are frequently endangered or abused.",
	source : [["P", 136], ["ALbackground", 0]]
};
BackgroundFeatureList["rustic hospitality"] = {
	description : "Since I come from the ranks of the common folk, I fit in among them with ease. I can find a place to hide, rest, or recuperate among other commoners, unless I have shown myself to be a danger to them. They will shield me from the law or anyone else searching for me, though they will not risk their lives for me.",
	source : [["P", 131], ["ALbackground", 0]]
};
BackgroundFeatureList["ship's passage"] = {
	description : "When I need to, I can secure free passage on a sailing ship for myself and my companions. I might sail on the ship I served on, or another ship I have good relations with. Because I'm calling in a favor, I can't be certain of a schedule or route that will meet my every need. My companions and I are expected to assist the crew during the voyage.",
	source : [["P", 139], ["ALbackground", 0]]
};
BackgroundFeatureList["wanderer"] = {
	description : "I have an excellent memory for maps and geography, and I can always recall the general layout of terrain, settlements, and other features around me. In addition, I can find food and fresh water for myself and up to five other people each day, provided that the land offers berries, small game, water, and so forth.",
	source : [["P", 136], ["ALbackground", 0]]
};

// Add the feats that are not in the SRD
FeatsList["actor"] = {
	name : "Actor",
	source : ["P", 165],
	descriptionFull : "Skilled at mimicry and dramatics, you gain the following benefits:\n \u2022 Increase your Charisma score by 1, to a maximum of 20.\n \u2022 You have advantage on Charisma (Deception) and Charisma (Performance) checks when trying to pass yourself off as a different person.\n \u2022 You can mimic the speech of another person or the sounds made by other creatures. You must have heard the person speaking, or heard the creature make the sound, for at least 1 minute. A successful Wisdom (Insight) check contested by your Charisma (Deception) check allows a listener to determine that the effect is faked.",
	description : "Advantage on Charisma (Deception) and (Performance) if trying to pass as another. I can mimic a person's speech or other creature's sounds if I've heard it for at least 1 minute. Wisdom (Insight) vs. Charisma (Deception) to determine the sound is faked. [+1 Charisma]",
	scores : [0, 0, 0, 0, 0, 1]
};
FeatsList["alert"] = {
	name : "Alert",
	source : ["P", 165],
	descriptionFull : "Always on the lookout for danger, you gain the following benefits:\n \u2022 You gain a +5 bonus to initiative.\n \u2022 You can't be surprised while you are conscious.\n \u2022 Other creatures don't gain advantage on attack rolls against you as a result of being unseen by you.",
	description : "I can't be surprised while I'm conscious. I have a +5 bonus on initiative rolls. Other creatures don't gain advantage on attack rolls against me as a result of being hidden from me.",
	addMod : { type : "skill", field : "Init", mod : 5, text : "I have a +5 bonus on initiative rolls." }
};
FeatsList["athlete"] = {
	name : "Athlete",
	source : ["P", 165],
	descriptionFull : "You have undergone extensive physical training to gain the following benefits:\n \u2022 Increase your Strength or Dexterity score by 1, to a maximum of 20.\n \u2022 When you are prone, standing up uses only 5 feet of your movement.\n \u2022 Climbing doesn't cost you extra movement.\n \u2022 You can make a running long jump or a running high jump after moving only 5 feet on foot, rather than 10 feet.",
	description : "Standing up from prone uses only 5 ft of movement. Climbing doesn't cost me extra movement. I can make a running long jump or a running high jump after moving only 5 feet on foot, rather than 10 feet. [+1 Strength or Dexterity]",
	scorestxt : "+1 Strength or Dexterity"
};
FeatsList["charger"] = {
	name : "Charger",
	source : ["P", 165],
	descriptionFull : "When you use your action to Dash, you can use a bonus action to make one melee weapon attack or to shove a creature.\n   If you move at least 10 feet in a straight line immediately before taking this bonus action, you either gain a +5 bonus to the attack's damage roll (if you chose to make a melee attack and hit) or push the target up to 10 feet away from you (if you chose to shove and you succeed).",
	description : "When taking the Dash action and moving 10 feet or more in a straight line, I can immediately take a bonus action to make either one melee weapon attack with +5 damage or try to shove the target up to 10 feet away.",
	action : ["bonus action", " (after Dash action)"]
};
FeatsList["crossbow expert"] = {
	name : "Crossbow Expert",
	source : ["P", 165],
	descriptionFull : "Thanks to extensive practice with the crossbow, you gain the following benefits:\n \u2022 You ignore the loading quality of crossbows with which you are proficient.\n \u2022 Being within 5 feet of a hostile creature doesn't impose disadvantage on your ranged attack rolls.\n \u2022 When you use the Attack action and attack with a one-handed weapon, you can use a bonus action to attack with a hand crossbow you are holding.",
	description : "I ignore the loading quality of crossbows I'm proficient with. I don't suffer disadv. on ranged attack rolls for being within 5 ft of a hostile. When I attack with a one-handed weapon in my Attack action, I can use a bonus action to attack with a hand crossbow I'm holding.",
	action : ["bonus action", " (with Attack action)"],
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if ((/crossbow/i).test(v.baseWeaponName) && fields.Proficiency) {
					fields.Description = fields.Description.replace(/(,? ?loading|loading,? ?)/i, '');
				};
			},
			"I ignore the loading quality of crossbows I'm proficient with."
		]
	}
};
FeatsList["defensive duelist"] = {
	name : "Defensive Duelist",
	source : ["P", 165],
	descriptionFull : "When you are wielding a finesse weapon with which you are proficient and another creature hits you with a melee attack, you can use your reaction to add your proficiency bonus to your AC for that attack, potentially causing the attack to miss you.",
	description : "When wielding a finesse weapon with which I am proficient and another creature hits me with a melee attack, I can use my reaction to add my proficiency bonus to my AC for that attack, potentially causing the attack to miss me.",
	prerequisite : "Dexterity 13 or higher",
	prereqeval : function(v) { return What('Dex') >= 13; },
	action : ["reaction", " (when hit in melee)"]
};
FeatsList["dual wielder"] = {
	name : "Dual Wielder",
	source : ["P", 165],
	descriptionFull : "You master fighting with two weapons, gaining the following benefits:\n \u2022 You gain a +1 bonus to AC while you are wielding a separate melee weapon in each hand.\n \u2022 You can use two-weapon fighting even when the one-handed melee weapons you are wielding aren't light.\n \u2022 You can draw or stow two one-handed weapons when you would normally be able to draw or stow only one.",
	description : "I can use two-weapon fighting even when the one-handed melee weapons I'm wielding aren't light. I can draw or stow two one-handed weapons when I would normally be able to draw or stow only one. +1 AC while wielding separate melee weapons in each hand.",
	extraAC : {
		mod : 1,
		text : "I gain a +1 bonus to AC when holding a melee weapon in each hand.",
		stopeval : function (v) { return v.usingShield && !(/animated/i).test(What("AC Shield Bonus Description")); }
	}
};
FeatsList["dungeon delver"] = {
	name : "Dungeon Delver",
	source : ["P", 166],
	descriptionFull : "Alert to the hidden traps and secret doors found in many dungeons, you gain the following benefits:\n \u2022 You have advantage on Wisdom (Perception) and Intelligence (Investigation) checks made to detect the presence of secret doors.\n \u2022 You have advantage on saving throws made to avoid or resist traps.\n \u2022 You have resistance to the damage dealt by traps.\n \u2022 Traveling at a fast pace doesn't impose the normal -5 penalty on your passive Wisdom (Perception) score.",
	description : "I have adv. on Wis (Perception) and Int (Investigation) checks made to detect the presence of secret doors. I have resistance to damage dealt by traps and advantage on saves to avoid or resist traps. Travelling at a fast pace doesn't impose -5 on my passive Perception.",
	dmgres : ["Traps"],
	savetxt : { adv_vs : ["traps"] },
	vision : [["Adv. on Perception and Investigation for secret doors", 0], ["No -5 for travelling at fast pace", 0]]
};
FeatsList["durable"] = {
	name : "Durable",
	source : ["P", 166],
	descriptionFull : "Hardy and resilient, you gain the following benefits:\n \u2022 Increase your Constitution score by 1, to a maximum of 20.\n \u2022 When you roll a Hit Die to regain hit points, the minimum number of hit points you regain from the roll equals twice your Constitution modifier (minimum of 2).",
	description : "When I roll a hit die to regain hit points, the minimum number of hit points I regain from the roll equals twice my Constitution modifier (minimum of 2). [+1 Constitution]",
	scores : [0, 0, 1, 0, 0, 0]
};
FeatsList["elemental adept"] = {
	name : "Elemental Adept",
	source : ["P", 166],
	descriptionFull : "When you gain this feat, choose one of the following damage types: acid, cold, fire, lightning, or thunder.\n   Spells you cast ignore resistance to damage of the chosen type. In addition, when you roll damage for a spell you cast that deals damage of that type, you can treat any 1 on a damage die as a 2.\n\nYou can select this feat multiple times. Each time you do so, you must choose a different damage type.",
	description : "Choose one of the damage types: acid, cold, fire, lightning, or thunder. Spells I cast ignore resistance to damage from this damage type. For any spell I cast that deals this damage type, I can treat any 1 on a damage die as a 2.",
	prerequisite : "The ability to cast at least one spell",
	prereqeval : function(v) { return v.isSpellcaster; },
	allowDuplicates : true,
	choices : ["acid", "cold", "fire", "lightning", "thunder"],
	"acid" : {
		description : "Spells I cast ignore resistance to acid damage. For any spell I cast that deals acid damage, I can treat any 1 on a damage die as a 2."
	},
	"cold" : {
		description : "Spells I cast ignore resistance to cold damage. For any spell I cast that deals cold damage, I can treat any 1 on a damage die as a 2."
	},
	"fire" : {
		description : "Spells I cast ignore resistance to fire damage. For any spell I cast that deals fire damage, I can treat any 1 on a damage die as a 2."
	},
	"lightning" : {
		description : "Spells I cast ignore resistance to lightning damage. For any spell I cast that deals lightning damage, I can treat any 1 on a damage die as a 2."
	},
	"thunder" : {
		description : "Spells I cast ignore resistance to thunder damage. For any spell I cast that deals thunder damage, I can treat any 1 on a damage die as a 2."
	}
};
FeatsList["great weapon master"] = {
	name : "Great Weapon Master",
	source : ["P", 167],
	descriptionFull : "You've learned to put the weight of a weapon to your advantage, letting its momentum empower your strikes. You gain the following benefits:\n \u2022 On your turn, when you score a critical hit with a melee weapon or reduce a creature to 0 hit points with one, you can make one melee weapon attack as a bonus action.\n \u2022 Before you make a melee attack with a heavy weapon that you are proficient with, you can choose to take a -5 penalty to the attack roll. If the attack hits, you add +10 to the attack's damage.",
	description : "If I score a critical hit or reduce a creature to 0 hit points with a melee weapon in my turn, I can make one melee weapon attack as a bonus action. With a heavy melee weapon, I can choose to take a -5 penalty on the attack roll for +10 on the attack's damage.",
	action : ["bonus action", " (after crit or take-down)"],
	calcChanges : {
		atkCalc : [
			function (fields, v, output) {
				if (v.isMeleeWeapon && (/heavy/i).test(fields.Description) && (/power.{0,3}attack|great.{0,3}weapon.{0,3}master/i).test(v.WeaponText)) {
					output.extraDmg += 10;
					output.extraHit -= 5;
				};
			},
			"If I include the words 'Power Attack' or 'Great Weapon Master' in a heavy melee weapon's name or description, the calculation will put a -5 penalty on the attack's To Hit and +10 on its Damage."
		]
	}
};
FeatsList["healer"] = {
	name : "Healer",
	source : ["P", 167],
	descriptionFull : "You are an able physician, allowing you to mend wounds quickly and get your allies back in the fight. You gain the following benefits:\n \u2022 When you use a healer's kit to stabilize a dying creature, that creature also regains 1 hit point.\n \u2022 As an action, you can spend one use of a healer's kit to tend to a creature and restore 1d6+4 hit points to it, plus additional hit points equal to the creature's maximum number of Hit Dice. The creature can't regain hit points from this feat again until it finishes a short or long rest.",
	description : "Using a healer's kit to stabilize someone gives them 1 hit point as well. As an action, I can spend one use of a healer's kit to restore 1d6 + 4 + (creature's HD) hit points. After that, the creature can't gain hit points from this feat again until it finishes a short rest.",
	action : ["action", " (1d6+4+HD with healing kit)"]
};
FeatsList["heavily armored"] = {
	name : "Heavily Armored",
	source : ["P", 167],
	descriptionFull : "You have trained to master the use of heavy armor, gaining the following benefits:\n \u2022 Increase your Strength score by 1, to a maximum of 20.\n \u2022 You gain proficiency with heavy armor.",
	description : "I gain proficiency with heavy armor. [+1 Strength]",
	prerequisite : "Proficiency with medium armor",
	prereqeval : function(v) { return v.mediumArmorProf; },
	scores : [1, 0, 0, 0, 0, 0],
	armorProfs : [false, false, true, false]
};
FeatsList["heavy armor master"] = {
	name : "Heavy Armor Master",
	source : ["P", 167],
	descriptionFull : "You can use your armor to deflect strikes that would kill others. You gain the following benefits:\n \u2022 While you are wearing heavy armor, bludgeoning, piercing, and slashing damage that you take from nonmagical weapons is reduced by 3.",
	description : "While wearing heavy armor, bludgeoning, piercing, and slashing damage taken from nonmagical weapons is reduced by 3. [+1 Strength]",
	prerequisite : "Proficiency with heavy armor",
	prereqeval : function(v) { return v.heavyArmorProf; },
	scores : [1, 0, 0, 0, 0, 0]
};
FeatsList["inspiring leader"] = {
	name : "Inspiring Leader",
	source : ["P", 167],
	descriptionFull : "You can spend 10 minutes inspiring your companions, shoring up their resolve to fight. When you do so, choose up to six friendly creatures (which can include yourself) within 30 feet of you who can see or hear you and who can understand you. Each creature can gain temporary hit points equal to your level + your Charisma modifier. A creature can't gain temporary hit points from this feat again until it has finished a short or long rest.",
	calculate : "event.value = 'I can spend 10 minutes inspiring up to 6 friendly creatures within 30 feet who can see or hear and can understand me. Each gains lvl (' + What('Character Level') + ') + Cha mod (' + What('Cha Mod') + \") temporary hit points. One can't gain temporary hit points from this feat again until after a short rest.\";",
	prerequisite : "Charisma 13 or higher",
	prereqeval : function(v) { return What('Cha') >= 13; }
};
FeatsList["keen mind"] = {
	name : "Keen Mind",
	source : ["P", 167],
	descriptionFull : "You have a mind that can track time, direction, and detail with uncanny precision. You gain the following benefits:\n \u2022 Increase your Intelligence score by 1, to a maximum of 20.\n \u2022 You always know which way is north.\n \u2022 You always know the number of hours left before the next sunrise or sunset.\n \u2022 You can accurately recall anything you have seen or heard within the past month.",
	description : "I always know which way is north and the number of hours left before the next sunrise or sunset. I can accurately recall anything I have seen or heard within the past month. [+1 Intelligence]",
	scores : [0, 0, 0, 1, 0, 0]
};
FeatsList["lightly armored"] = {
	name : "Lightly Armored",
	source : ["P", 167],
	descriptionFull : "You have trained to master the use of light armor, gaining the following benefits:\n \u2022 Increase your Strength or Dexterity score by 1, to a maximum of 20.\n \u2022 You gain proficiency with light armor.",
	description : "I gain proficiency with light armor. [+1 Strength or Dexterity]",
	scorestxt : "+1 Strength or Dexterity",
	armorProfs : [true, false, false, false]
};
FeatsList["linguist"] = {
	name : "Linguist",
	source : ["P", 167],
	descriptionFull : "You have studied languages and codes, gaining the following benefits:\n \u2022 Increase your Intelligence score by 1, to a maximum of 20.\n \u2022 You learn three languages of your choice.\n \u2022 You can ably create written ciphers. Others can't decipher a code you create unless you teach them, they succeed on an Intelligence check (DC equal to your Intelligence score + your proficiency bonus), or they use magic to decipher it.",
	calculate : "event.value = \"I can ably create written ciphers that others can't decipher unless I teach them, they succeed on an Intelligence check DC \" + (What('Int') + What('Proficiency Bonus')) + ' (Intelligence score + proficiency bonus), or they use magic to decipher it. I learn three languages of my choice. [+1 Intelligence]';",
	scores : [0, 0, 0, 1, 0, 0],
	languageProfs : [3]
};
FeatsList["lucky"] = {
	name : "Lucky",
	source : ["P", 167],
	descriptionFull : "You have inexplicable luck that seems to kick in at just the right moment.\n   You have 3 luck points. Whenever you make an attack roll, an ability check, or a saving throw, you can spend one luck point to roll an additional d20. You can choose to spend one of your luck points after you roll the die, but before the outcome is determined. You choose which of the d20s is used for the attack roll, ability check, or saving throw.\n   You can also spend one luck point when an attack roll is made against you. Roll a d20, and then choose whether the attack uses the attacker's roll or yours. If more than one creature spends a luck point to influence the outcome of a roll, the points cancel each other out; no additional dice are rolled.\n   You regain your expended luck points when you finish a long rest.",
	description : "Use one of three luck points to roll an extra d20 for attacking, being attacked, an ability check, or a saving throw before the outcome is determined. If more than one creature uses luck, no extra dice are rolled. I regain expended luck points when I finish a long rest.",
	usages : 3,
	recovery : "long rest",
	additional : "attack/check/save"
};
FeatsList["mage slayer"] = {
	name : "Mage Slayer",
	source : ["P", 168],
	descriptionFull : "You have practiced techniques useful in melee combat against spellcasters, gaining the following benefits:\n \u2022 When a creature within 5 feet of you casts a spell, you can use your reaction to make a melee weapon attack against that creature.\n \u2022 When you damage a creature that is concentrating on a spell, that creature has disadvantage on the saving throw it makes to maintain its concentration.\n \u2022 You have advantage on saving throws against spells cast by creatures within 5 feet of you.",
	description : "As a reaction, I can make a melee weapon attack on a creature within 5 ft of me that casts a spell. Concentration checks from damage from me are made with disadvantage. I have advantage on saving throws against spells cast by creatures within 5 feet of me.",
	savetxt : { adv_vs : ["spells cast within 5 ft"] },
	action : ["reaction", "Melee weapon attack (if spell cast in 5 ft)"]
};
FeatsList["magic initiate"] = {
	name : "Magic Initiate",
	source : ["P", 168],
	descriptionFull : "Choose a class: bard, cleric, druid, sorcerer, warlock, or wizard. You learn two cantrips of your choice from that class's spell list.\n   In addition, choose one 1st-level spell from that same list. You learn that spell and can cast it at its lowest level. Once you cast it, you must finish a long rest before you can cast it again using this feat.\n   Your spellcasting ability for these spells depends on the class you chose: Charisma for bard, sorcerer, or warlock; Wisdom for cleric or druid: or Intelligence for wizard.",
	description : "Select a spellcasting class using the square button on this feat line. I learn two cantrips and one 1st-level spell of my choice from that class' spell list. I can cast the 1st-level spell at its lowest level once per long rest without using a spell slot.",
	choices : ["Bard", "Cleric", "Druid", "Sorcerer", "Warlock", "Wizard"],
	"bard" : {
		description : "I learn two cantrips and one 1st-level spell of my choice from the bard's spell list.\nI can cast the 1st-level spell at its lowest level once per long rest without using a spell slot.\nCharisma is my spellcasting ability for these.",
		spellcastingBonus : [{
			name : "Bard cantrip",
			spellcastingAbility : 6,
			'class' : 'bard',
			level : [0, 0],
			firstCol : "atwill",
			times : 2
		}, {
			name : "Bard 1st-level spell",
			'class' : 'bard',
			level : [1, 1],
			firstCol : "oncelr"
		}]
	},
	"cleric" : {
		description : "I learn two cantrips and one 1st-level spell of my choice from the cleric's spell list.\nI can cast the 1st-level spell at its lowest level once per long rest without using a spell slot.\nWisdom is my spellcasting ability for these.",
		spellcastingBonus : [{
			name : "Cleric cantrip",
			spellcastingAbility : 5,
			'class' : 'cleric',
			level : [0, 0],
			firstCol : "atwill",
			times : 2
		}, {
			name : "Cleric 1st-level spell",
			'class' : 'cleric',
			level : [1, 1],
			firstCol : "oncelr"
		}]
	},
	"druid" : {
		description : "I learn two cantrips and one 1st-level spell of my choice from the druid's spell list.\nI can cast the 1st-level spell at its lowest level once per long rest without using a spell slot.\nWisdom is my spellcasting ability for these.",
		spellcastingBonus : [{
			name : "Druid cantrip",
			spellcastingAbility : 5,
			'class' : 'druid',
			level : [0, 0],
			firstCol : "atwill",
			times : 2
		}, {
			name : "Druid 1st-level spell",
			'class' : 'druid',
			level : [1, 1],
			firstCol : "oncelr"
		}]
	},
	"sorcerer" : {
		description : "I learn two cantrips and one 1st-level spell of my choice from the sorcerer's spell list.\nI can cast the 1st-level spell at its lowest level once per long rest without using a spell slot.\nCharisma is my spellcasting ability for these.",
		spellcastingBonus : [{
			name : "Sorcerer cantrip",
			spellcastingAbility : 6,
			'class' : 'sorcerer',
			level : [0, 0],
			firstCol : "atwill",
			times : 2
		}, {
			name : "Sorcerer 1st-level spell",
			'class' : 'sorcerer',
			level : [1, 1],
			firstCol : "oncelr"
		}]
	},
	"warlock" : {
		description : "I learn two cantrips and one 1st-level spell of my choice from the warlock's spell list.\nI can cast the 1st-level spell at its lowest level once per long rest without using a spell slot.\nCharisma is my spellcasting ability for these.",
		spellcastingBonus : [{
			name : "Warlock cantrip",
			spellcastingAbility : 6,
			'class' : 'warlock',
			level : [0, 0],
			firstCol : "atwill",
			times : 2
		}, {
			name : "Warlock 1st-level spell",
			'class' : 'warlock',
			level : [1, 1],
			firstCol : "oncelr"
		}]
	},
	"wizard" : {
		description : "I learn two cantrips and one 1st-level spell of my choice from the wizard's spell list.\nI can cast the 1st-level spell at its lowest level once per long rest without using a spell slot.\nIntelligence is my spellcasting ability for these.",
		spellcastingBonus : [{
			name : "Wizard cantrip",
			spellcastingAbility : 4,
			'class' : 'wizard',
			level : [0, 0],
			firstCol : "atwill",
			times : 2
		}, {
			name : "Wizard 1st-level spell",
			'class' : 'wizard',
			level : [1, 1],
			firstCol : "oncelr"
		}]
	}
};
FeatsList["martial adept"] = {
	name : "Martial Adept",
	source : ["P", 168],
	descriptionFull : "You have martial training that allows you to perform special combat maneuvers. You gain the following benefits:\n \u2022 You learn two maneuvers of your choice from among those available to the Battle Master archetype in the fighter class. If a maneuver you use requires your target to make a saving throw to resist the maneuver's effects, the saving throw DC equals 8 + your proficiency bonus + your Strength or Dexterity modifier (your choice).\n \u2022 You gain one superiority die, which is a d6 (this die is added to any superiority dice you have from another source). This die is used to fuel your maneuvers. A superiority die is expended when you use it. You regain your expended superiority dice when you finish a short or long rest.",
	calculate : "event.value = 'I learn two maneuvers of my choice from those available to the Battle Master (2nd page \"Choose Feature\" button). The saving throw DC for this is ' + (8 + Number(What('Proficiency Bonus')) + Math.max(What('Str Mod'), What('Dex Mod'))) + ' (8 + proficiency bonus + Str/Dex mod). I gain one superiority die (d6), which I regain when I finish a short rest.';",
	eval : function () {
		AddFeature('Combat Superiority ', 1, '(d6)', 'short rest', 'the Martial Adept feat', 'bonus');
		DontPrint("Class Features Menu");
	},
	removeeval : function () {
		RemoveFeature('Combat Superiority ', 1);
		if (!MakeClassMenu()) Hide("Class Features Menu");
	}
};
FeatsList["medium armor master"] = {
	name : "Medium Armor Master",
	source : ["P", 168],
	descriptionFull : "You have practiced moving in medium armor to gain the following benefits:\n \u2022 Wearing medium armor doesn't impose disadvantage on your Dexterity (Stealth) checks.\n \u2022 When you wear medium armor, you can add 3, rather than 2, to your AC if you have a Dexterity of 16 or higher.",
	description : "Wearing medium armor doesn't impose disadvantage on my Dexterity (Stealth) checks. When I wear medium armor, I can add up to 3, rather than 2, to my AC if my Dexterity is 16 or higher.",
	prerequisite : "Proficiency with medium armor",
	prereqeval : function(v) { return v.mediumArmorProf; },
	eval : function () {
		Value('Medium Armor Max Mod', 3);
		ApplyArmor(What("AC Armor Description"));
	},
	removeeval : function () {
		tDoc.resetForm(['Medium Armor Max Mod']);
		ApplyArmor(What("AC Armor Description"));
	}
};
FeatsList["mobile"] = {
	name : "Mobile",
	source : ["P", 168],
	descriptionFull : "You are exceptionally speedy and agile. You gain the following benefits:\n \u2022 Your speed increases by 10 feet.\n \u2022 When you use the Dash action, difficult terrain doesn't cost you extra movement on that turn.\n \u2022 When you make a melee attack against a creature, you don't provoke opportunity attacks from that creature for the rest of the turn, whether you hit or not.",
	description : "When I use the Dash action, difficult terrain doesn't cost me extra movement that turn. When I make a melee attack against a creature, I don't provoke opportunity attacks from that creature for the rest of the turn, whether I hit or not. [+10 ft speed]",
	speed : { allModes : "+10" }
};
FeatsList["moderately armored"] = {
	name : "Moderately Armored",
	source : ["P", 168],
	descriptionFull : "You have trained to master the use of medium armor and shields, gaining the following benefits:\n \u2022 Increase your Strength or Dexterity score by 1, to a maximum of 20.\n \u2022 You gain proficiency with medium armor and shields.",
	description : "I gain proficiency with medium armor and shields. [+1 Strength or Dexterity]",
	prerequisite : "Proficiency with light armor",
	prereqeval : function(v) { return v.lightArmorProf; },
	scorestxt : "+1 Strength or Dexterity",
	armorProfs : [false, true, false, true]
};
FeatsList["mounted combatant"] = {
	name : "Mounted Combatant",
	source : ["P", 168],
	descriptionFull : "You are a dangerous foe to face while mounted. While you are mounted and aren't incapacitated, you gain the following benefits:\n \u2022 You have advantage on melee attack rolls against any unmounted creature that is smaller than your mount.\n \u2022 You can force an attack targeted at your mount to target you instead.\n \u2022 If your mount is subjected to an effect that allows it to make a Dexterity saving throw to take only half damage, it instead takes no damage if it succeeds on the saving throw, and only half damage if it fails.",
	description : "I have advantage on melee attack rolls against unmounted creatures smaller than my mount. I can force attacks targeting my mount to target me instead. When a Dex save would halve damage, my mount takes no damage on success and half damage on failure."
};
FeatsList["observant"] = {
	name : "Observant",
	source : ["P", 168],
	descriptionFull : "Quick to notice details of your environment, you gain the following benefits:\n \u2022 Increase your Intelligence or Wisdom score by 1, to a maximum of 20.\n \u2022 If you can see a creature's mouth while it is speaking a language you understand, you can interpret what it's saying by reading its lips.\n \u2022 You have a +5 bonus to your passive Wisdom (Perception) and passive Intelligence (Investigation) scores.",
	description : "If I can see a creature's mouth while it is speaking a language I understand, I can interpret what it's saying by reading its lips. I have a +5 bonus to passive Wisdom (Perception) and passive Intelligence (Investigation) scores. [+1 Intelligence or Wisdom]",
	scorestxt : "+1 Intelligence or Wisdom",
	addMod : { type : "skill", field : "passive perception", mod : 5, text : "I have a +5 bonus to passive Wisdom (Perception)." }
};
FeatsList["polearm master"] = {
	name : "Polearm Master",
	source : ["P", 168],
	descriptionFull : "You can keep your enemies at bay with reach weapons. You gain the following benefits:\n \u2022 When you take the Attack action and attack with only a glaive, halberd, quarterstaff, or spear, you can use a bonus action to make a melee attack with the opposite end of the weapon; this attack uses the same ability modifier as the primary attack. The weapon's damage die for this attack is a d4, and the attack deals bludgeoning damage.\n \u2022 While you are wielding a glaive, halberd, pike, quarterstaff, or spear, other creatures provoke an opportunity attack from you when they enter your reach.",
	description : "As a bonus action when I do the Attack action with a glaive/" + (typePF ? " " : "") + "halberd/quarterstaff/spear, I can make a 1d4 bludgeoning attack with its butt end." + (typePF ? "\n" : " ") + "While wielding a glaive/halberd/" + (typePF ? "" : " ") + "pike/quarterstaff/spear, I get an opportunity attack when a creature enters my reach.",
	weaponOptions : {
		regExpSearch : /^(?=.*(polearm|(glaive|guandao|bisento|naginata)|(halberd|\bji\b|kamayari)|(quarterstaff|\bstaff\b|\bbo\b)|(spear|qiang|\byaris?\b)))(?=.*butt)(?=.*end).*$/i,
		name : "Polearm butt end",
		source : ["P", 168],
		ability : 1,
		type : "polearm butt end",
		damage : [1, 4, "bludgeoning"],
		range : "Melee",
		description : "As bonus action after Attack action with only a glaive, halberd, spear, or quarterstaff",
		abilitytodamage : true
	},
	weaponsAdd : ["Polearm Butt End"],
	action : ['bonus action', 'Butt End Attack (after attack with polearm)'],
	weaponProfs : [false, false, ["polearm butt end"]]
};
FeatsList["resilient"] = {
	name : "Resilient",
	source : ["P", 168],
	descriptionFull : "Choose one ability score. You gain the following benefits:\n \u2022 Increase the chosen ability score by 1, to a maximum of 20.\n \u2022 You gain proficiency in saving throws using the chosen ability.",
	description : "Select an ability score using the square button on this feat line. I gain proficiency with the saving throw of that ability score and a +1 added to it.",
	choices : ["Strength", "Dexterity", "Constitution", "Intelligence", "Wisdom", "Charisma"],
	"strength" : {
		description : "I gain proficiency with Strength saving throws. [+1 Strength]",
		scores : [1, 0, 0, 0, 0, 0],
		saves : ["Str"]
	},
	"dexterity" : {
		description : "I gain proficiency with Dexterity saving throws. [+1 Dexterity]",
		scores : [0, 1, 0, 0, 0, 0],
		saves : ["Dex"]
	},
	"constitution" : {
		description : "I gain proficiency with Constitution saving throws. [+1 Constitution]",
		scores : [0, 0, 1, 0, 0, 0],
		saves : ["Con"]
	},
	"intelligence" : {
		description : "I gain proficiency with Intelligence saving throws. [+1 Intelligence]",
		scores : [0, 0, 0, 1, 0, 0],
		saves : ["Int"]
	},
	"wisdom" : {
		description : "I gain proficiency with Wisdom saving throws. [+1 Wisdom]",
		scores : [0, 0, 0, 0, 1, 0],
		saves : ["Wis"]
	},
	"charisma" : {
		description : "I gain proficiency with Charisma saving throws. [+1 Charisma]",
		scores : [0, 0, 0, 0, 0, 1],
		saves : ["Cha"]
	}
};
FeatsList["ritual caster"] = {
	name : "Ritual Caster",
	source : ["P", 169],
	descriptionFull : "You have learned a number of spells that you can cast as rituals. These spells are written in a ritual book, which you must have in hand while casting one of them.\n   When you choose this feat, you acquire a ritual book holding two 1st-level spells of your choice. Choose one of the following classes: bard, cleric, druid, sorcerer, warlock, or wizard. You must choose your spells from that class's spell list, and the spells you choose must have the ritual tag. The class you choose also determines your spellcasting ability for these spells: Charisma for bard, sorcerer, or warlock; Wisdom for cleric or druid; or Intelligence for wizard.\n   If you come across a spell in written form, such as a magical spell scroll or a wizard's spellbook, you might be able to add it to your ritual book. The spell must be on the spell list for the class you chose, the spell's level can be no higher than half your level (rounded up), and it must have the ritual tag. The process of copying the spell into your ritual book takes 2 hours per level of the spell, and costs 50 gp per level. The cost represents material components you expend as you experiment with the spell to master it, as well as the fine inks you need to record it.",
	description : "Select a spellcasting class using the square button on this feat line. I gain a book with two 1st-level ritual spells from that class' spell list. I can transcribe more ritual spells into this book and cast them as rituals only.",
	prerequisite : "Intelligence or Wisdom 13 or higher",
	prereqeval : function(v) { return What('Int') >= 13 || What('Wis') >= 13; },
	commoneval : function(chc, spellAbility) {
		if (!chc) return;
		CurrentSpells['ritual caster ' + chc] = {
			name : 'Ritual Book [' + chc.capitalize() + ']',
			ability : spellAbility,
			list : {"class" : chc, ritual : true},
			known : {spells : 'book'},
			refType : "feat"
		};
		SetStringifieds('spells'); CurrentUpdates.types.push('spells');
	},
	commonremoveeval : function(chc) {
		if (!chc) return;
		delete CurrentSpells['ritual caster ' + chc];
		SetStringifieds('spells'); CurrentUpdates.types.push('spells');
	},
	calcChanges : {
		spellAdd : [
			function (spellKey, spellObj, spName) {
				if (spName.indexOf("ritual caster ") !== -1) {
					spellObj.firstCol = "(R)";
					if (!(/.*(\d+ ?h\b|special|see b).*/i).test(spellObj.time)) {
						var numMinutes = Number(spellObj.time.replace(/(\d+) ?min.*/, "$1"));
						if (isNaN(numMinutes)) numMinutes = 0;
						spellObj.time = (numMinutes + 10) + " min";
					}
					return true;
				};
			},
			"By the Ritual Caster feat, I can cast ritual spells from my Ritual Book. Casting a spell as a ritual means adding 10 minutes to its casting time."
		]
	},
	choices : ["Bard", "Cleric", "Druid", "Sorcerer", "Warlock", "Wizard"],
	"bard" : {
		description : "I can cast spells in my ritual book as rituals only. I gain two 1st-level ritual bard spells.\nI can copy ritual bard spells that I find into my book if they are not more than half my level (2 hours and 50 gp per spell level). Charisma is my spellcasting ability for these.",
		eval : function(lvl, chc) { FeatsList["ritual caster"].commoneval(chc[1], 6); },
		removeeval : function(lvl, chc) { FeatsList["ritual caster"].commonremoveeval(chc[0]); }
	},
	"cleric" : {
		description : "I can cast spells in my ritual book as rituals only. I gain two 1st-level ritual cleric spells.\nI can copy ritual cleric spells that I find into my book if they are not more than half my level (2 hours and 50 gp per spell level). Wisdom is my spellcasting ability for these.",
		eval : function(lvl, chc) { FeatsList["ritual caster"].commoneval(chc[1], 5); },
		removeeval : function(lvl, chc) { FeatsList["ritual caster"].commonremoveeval(chc[0]); }
	},
	"druid" : {
		description : "I can cast spells in my ritual book as rituals only. I gain two 1st-level ritual druid spells.\nI can copy ritual druid spells that I find into my book if they are not more than half my level (2 hours and 50 gp per spell level). Wisdom is my spellcasting ability for these.",
		eval : function(lvl, chc) { FeatsList["ritual caster"].commoneval(chc[1], 5); },
		removeeval : function(lvl, chc) { FeatsList["ritual caster"].commonremoveeval(chc[0]); }
	},
	"sorcerer" : {
		description : "I can cast spells in my ritual book as rituals only. I gain two 1st-level ritual sorcerer spells.\nI can copy ritual sorcerer spells that I find into my book if they are not more than half my level (2 hours and 50 gp per spell level). Charisma is my spellcasting ability for these.",
		eval : function(lvl, chc) { FeatsList["ritual caster"].commoneval(chc[1], 6); },
		removeeval : function(lvl, chc) { FeatsList["ritual caster"].commonremoveeval(chc[0]); }
	},
	"warlock" : {
		description : "I can cast spells in my ritual book as rituals only. I gain two 1st-level ritual warlock spells.\nI can copy ritual warlock spells that I find into my book if they are not more than half my level (2 hours and 50 gp per spell level). Charisma is my spellcasting ability for these.",
		eval : function(lvl, chc) { FeatsList["ritual caster"].commoneval(chc[1], 6); },
		removeeval : function(lvl, chc) { FeatsList["ritual caster"].commonremoveeval(chc[0]); }
	},
	"wizard" : {
		description : "I can cast spells in my ritual book as rituals only. I gain two 1st-level ritual wizard spells.\nI can copy ritual wizard spells that I find into my book if they are not more than half my level (2 hours and 50 gp per spell level). Intelligence is my spellcasting ability for these.",
		eval : function(lvl, chc) { FeatsList["ritual caster"].commoneval(chc[1], 4); },
		removeeval : function(lvl, chc) { FeatsList["ritual caster"].commonremoveeval(chc[0]); }
	}
};
FeatsList["savage attacker"] = {
	name : "Savage Attacker",
	source : ["P", 169],
	descriptionFull : "Once per turn when you roll damage for a melee weapon attack, you can reroll the weapon's damage dice and use either total.",
	description : "Once per turn, when I roll damage for a melee weapon attack, I can reroll the weapon's damage dice and use either total."
};
FeatsList["sentinel"] = {
	name : "Sentinel",
	source : ["P", 169],
	descriptionFull : "You have mastered techniques to take advantage of every drop in any enemy's guard, gaining the following benefits:\n \u2022 When you hit a creature with an opportunity attack, the creature's speed becomes 0 for the rest of the turn.\n \u2022 Creatures provoke opportunity attacks from you even if they take the Disengage action before leaving your reach.\n \u2022 When a creature within 5 feet of you makes an attack against a target other than you (and that target doesn't have this feat), you can use your reaction to make a melee weapon attack against the attacking creature.",
	description : "Creatures I hit with opportunity attacks have 0 speed for this turn. The Disengage action doesn't work on me. When a creature within 5 ft makes an attack against a target other than me, I can use my reaction to make a melee weapon attack against the attacker.",
	action : ["reaction", " (after attack on ally)"]
};
FeatsList["sharpshooter"] = {
	name : "Sharpshooter",
	source : ["P", 170],
	descriptionFull : "You have mastered ranged weapons and can make shots that others find impossible. You gain the following benefits:\n \u2022 Attacking at long range doesn't impose disadvantage on your ranged weapon attack rolls.\n \u2022 Your ranged weapon attacks ignore half cover and three-quarters cover.\n \u2022 Before you make an attack with a ranged weapon that you are proficient with, you can choose to take a -5 penalty to the attack roll. If the attack hits, you add +10 to the attack's damage.",
	description : "My ranged weapon attacks don't have disadvantage on long range and ignore half cover and three-quarters cover. With a ranged weapon that I am proficient with, I can choose to take a -5 penalty on the attack roll for +10 on the attack's damage.",
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.isRangedWeapon || (!v.isSpell && (/thrown/i).test(fields.Description))) {
					fields.Description += (fields.Description ? '; ' : '') + "No disadv. at long range; Ignore \u00BD and \u00BE cover";
				};
			},
			"My ranged weapon attacks suffer no disadvantage for long range and ignore half cover and three-quarters cover. This includes thrown weapons.\n \u2022 If I include the words 'Power Attack', 'Sharpshooter', or 'Sharpshot' in the name or description of a ranged weapon that I'm proficient with, the calculation will put a -5 penalty on the attack's To Hit and a +10 bonus to its Damage. This does not work with thrown weapons."
		],
		atkCalc : [
			function (fields, v, output) {
				if (v.isRangedWeapon && fields.Proficiency && (/power.{0,3}attack|sharp.{0,3}shoo?t/i).test(v.WeaponText)) {
					output.extraDmg += 10;
					output.extraHit -= 5;
				};
			}, ''
		]
	}
};
FeatsList["shield master"] = {
	name : "Shield Master",
	source : ["P", 170],
	descriptionFull : "You use shields not just for protection but also for offense. You gain the following benefits while you are wielding a shield:\n \u2022 If you take the Attack action on your turn, you can use a bonus action to try to shove a creature within 5 feet of you with your shield.\n \u2022 If you aren't incapacitated, you can add your shield's AC bonus to any Dexterity saving throw you make against a spell or other harmful effect that targets only you.\n \u2022 If you are subjected to an effect that allows you to make a Dexterity saving throw to take only half damage, you can use your reaction to take no damage if you succeed on the saving throw, interposing your shield between yourself and the source of the effect.",
	description : "As a bonus action, when I use the Attack action, I can shove someone within 5 ft with my shield. I add my shield's AC bonus to Dex saves vs. effects targeting only me. As a reaction, if I succeed on a Dex save for half damage, I can interpose my shield to avoid the damage.",
	action : [['bonus action', 'Shove with shield (with Attack action)'], ['reaction', 'Interpose shield (if Dex save half dmg)']]
};
FeatsList["skilled"] = {
	name : "Skilled",
	source : ["P", 170],
	descriptionFull : "You gain proficiency in any combination of three skills or tools of your choice.",
	description : "I gain proficiency with any combination of three skills or tools of my choice.",
	skillstxt : "Choose three skills or tools"
};
FeatsList["skulker"] = {
	name : "Skulker",
	source : ["P", 170],
	descriptionFull : "You are expert at slinking through shadows. You gain the following benefits:\n \u2022 You can try to hide when you are lightly obscured from the creature from which you are hiding.\n \u2022 When you are hidden from a creature and miss it with a ranged weapon attack, making the attack doesn't reveal your position.\n \u2022 Dim light doesn't impose disadvantage on your Wisdom (Perception) checks relying on sight.",
	description : "I can try to hide when I am lightly obscured. My position is not revealed when I am hidden from a creature and miss it with a ranged weapon attack. Dim light doesn't impose disadvantage on my Wisdom (Perception) checks relying on sight.",
	prerequisite : "Dexterity 13 or higher",
	prereqeval : function(v) { return What('Dex') >= 13; },
	vision : [["No disadv. on Perception in dim light", 0]]
};
FeatsList["spell sniper"] = {
	name : "Spell Sniper",
	source : ["P", 170],
	descriptionFull : "You have learned techniques to enhance your attacks with certain kinds of spells, gaining the following benefits:\n \u2022 When you cast a spell that requires you to make an attack roll, the spell's range is doubled.\n \u2022 Your ranged spell attacks ignore half cover and three-quarters cover.\n \u2022 You learn one cantrip that requires an attack roll. Choose the cantrip from the bard, cleric, druid, sorcerer, warlock, or wizard spell list. Your spellcasting ability for this cantrip depends on the spell list you chose from: Charisma for bard, sorcerer, or warlock; Wisdom for cleric or druid; or Intelligence for wizard.",
	description : "Select a spellcasting ability using the square button on this feat line. I learn one cantrip requiring an attack roll from the spell list of a class with the chosen spellcasting ability. Any spell I cast requiring an attack roll has its range doubled and ignores half and 3/4 cover.",
	prerequisite : "The ability to cast at least one spell",
	prereqeval : function(v) { return v.isSpellcaster; },
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.spellSniper && !v.isDC && v.isSpell && (/\d+ ?(f.{0,2}t|m)/i).test(fields.Range)) {
					v.spellSniper = true;
					var rangeNmbr = fields.Range.match(/\d+([.,]\d+)?/g);
					var notNmbrs = fields.Range.split(RegExp(rangeNmbr.join('|')));
					fields.Range = '';
					rangeNmbr.forEach(function (dR, idx) {
						fields.Range += (notNmbrs[idx] ? notNmbrs[idx] : '') + (parseFloat(dR.toString().replace(',', '.') * 2));
					});
					if (notNmbrs.length > rangeNmbr.length) {
						fields.Range += notNmbrs[notNmbrs.length - 1];
					};
					if (!v.rangeM) {
						v.rangeM = 2;
					} else {
						v.rangeM *= 2;
					}
				};
			},
			"My spells and cantrips that require an attack roll have their range doubled."
		],
		spellAdd : [
			function (spellKey, spellObj, spName) {
				if (!spellObj.spellSniper && !spellObj.psionic && ((/^(booming blade|green-flame blade)$/).test(spellKey) || ((/spell attack/i).test(spellObj.description + spellObj.descriptionFull) && (/^(?!.*(-rad|touch|self)).*\d+([.,]\d+)? ?(f.{0,2}t|m).*$/i).test(spellObj.range)))) {
					spellObj.spellSniper = true;
					var rangeNmbr = spellObj.range.match(/\d+([.,]\d+)?/g);
					var notNmbrs = spellObj.range.split(RegExp(rangeNmbr.join('|')));
					spellObj.range = '';
					rangeNmbr.forEach(function (dR, idx) {
						spellObj.range += (notNmbrs[idx] ? notNmbrs[idx] : '') + (parseFloat(dR.toString().replace(',', '.') * 2));
					});
					if (notNmbrs.length > rangeNmbr.length) {
						spellObj.range += notNmbrs[notNmbrs.length - 1];
					};
					if (!spellObj.rangeM) {
						spellObj.rangeM = 2;
					} else {
						spellObj.rangeM *= 2;
					}
					return true;
				};
			},
			"My spells and cantrips that require an attack roll have their range doubled."
		]
	},
	choices : ["Intelligence caster (Wizard)", "Wisdom caster (Cleric / Druid)", "Charisma caster (Bard / Sorcerer / Warlock)"],
	"intelligence caster (wizard)" : {
		name : "Spell Sniper [Intelligence]",
		description : "Any spell that I cast that requires an attack roll has its range doubled. My ranged spell attacks ignore half cover and three-quarters cover. I learn one wizard cantrip that requires an attack roll. Intelligence is my spellcasting ability for this.",
		spellcastingBonus : {
			name : "Spell Attack Cantrip",
			spellcastingAbility : 4,
			'class' : 'wizard',
			level : [0, 0],
			attackOnly : true,
			firstCol : "atwill"
		}
	},
	"wisdom caster (cleric / druid)" : {
		name : "Spell Sniper [Wisdom]",
		description : "Any spell that I cast that requires an attack roll has its range doubled. My ranged spell attacks ignore half cover and three-quarters cover. I learn one cleric or druid cantrip that requires an attack roll. Wisdom is my spellcasting ability for this.",
		spellcastingBonus : {
			name : "Spell Attack Cantrip",
			spellcastingAbility : 5,
			'class' : ['cleric', 'druid'],
			level : [0, 0],
			attackOnly : true,
			firstCol : "atwill"
		}
	},
	"charisma caster (bard / sorcerer / warlock)" : {
		name : "Spell Sniper [Charisma]",
		description : "Any spell that I cast that requires an attack roll has its range doubled. My ranged spell attacks ignore half cover and three-quarters cover. I learn one bard, sorcerer, or warlock cantrip that requires an attack roll. Charisma is my spellcasting ability for this.",
		spellcastingBonus : {
			name : "Spell Attack Cantrip",
			spellcastingAbility : 6,
			'class' : ['bard', 'sorcerer', 'warlock'],
			level : [0, 0],
			attackOnly : true,
			firstCol : "atwill"
		}
	}
};
FeatsList["tavern brawler"] = {
	name : "Tavern Brawler",
	source : ["P", 170],
	descriptionFull : "Accustomed to rough-and-tumble fighting using whatever weapons happen to be at hand, you gain the following benefits:\n \u2022 Increase your Strength or Constitution score by 1, to a maximum of 20.\n \u2022 You are proficient with improvised weapons.\n \u2022 Your unarmed strike uses a d4 for damage.\n \u2022 When you hit a creature with an unarmed strike or an improvised weapon on your turn, you can use a bonus action to attempt to grapple the target.",
	description : "I am proficient with improvised weapons. My unarmed strike does 1d4 damage. When I hit a creature with an unarmed strike or improvised weapon on my turn, I can attempt to grapple the target as a bonus action. [+1 Strength or Constitution]",
	scorestxt : "+1 Strength or Constitution",
	action : ['bonus action', 'Grapple (on hit with unarmed/improv.)'],
	weaponProfs : [false, false, ["Improvised weapons"]],
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.baseWeaponName == "unarmed strike" || (/improvised/i).test(v.WeaponName + v.baseWeaponName) || (/improvised weapon/i).test(v.theWea.type)) {
					fields.Proficiency = true;
					if (v.isMeleeWeapon) fields.Description += (fields.Description ? '; ' : '') + 'After hit, can attempt to grapple as a bonus action';
				};
				if (v.baseWeaponName == "unarmed strike" && fields.Damage_Die == 1) {
					fields.Damage_Die = '1d4';
				};
			},
			"My unarmed strikes deal 1d4 damage instead of 1;\n \u2022 After hitting a creature with an unarmed strike or improvised weapon in melee, I can attempt to start a grapple as a bonus action."
		]
	}
};
FeatsList["tough"] = {
	name : "Tough",
	source : ["P", 170],
	descriptionFull : "Your hit point maximum increases by an amount equal to twice your level when you gain this feat. Whenever you gain a level thereafter, your hit point maximum increases by an additional 2 hit points.",
	description : "My hit point maximum increases by an amount equal to twice my character level.",
	calcChanges : {
		hp : function (totalHD) {
			return [totalHD * 2, '\n + ' + totalHD + ' \xD7 2 from the Tough feat (' + (totalHD * 2) + ')', true];
		}
	}
};
FeatsList["war caster"] = {
	name : "War Caster",
	source : ["P", 170],
	prerequisite : "The ability to cast at least one spell",
	prereqeval : function(v) { return v.isSpellcaster; },
	descriptionFull :  "You have practiced casting spells in the midst of combat, learning techniques that grant you the following benefits:\n \u2022 You have advantage on Constitution saving throws that you make to maintain your concentration on a spell when you take damage.\n \u2022 You can perform the somatic components of spells even when you have weapons or a shield in one or both hands.\n \u2022 When a hostile creature's movement provokes an opportunity attack from you, you can use your reaction to cast a spell at the creature, rather than making an opportunity attack. The spell must have a casting time of 1 action and must target only that creature.",
	description : "Advantage on Con saves to maintain concentration on spells when damaged. Perform somatic components even when holding weapons or shield in one or both hands. Cast spell of 1 action casting time that targets only one creature instead of an opportunity attack.",
	action : ["reaction", " - Opportunity Spell"],
	savetxt : { text : "Adv. on Con (Concentration) saves when damaged" }
};
FeatsList["weapon master"] = {
	name : "Weapon Master",
	source : ["P", 170],
	descriptionFull : "You have practiced extensively with a variety of weapons, gaining the following benefits:\n \u2022 Increase your Strength or Dexterity score by 1, to a maximum of 20.\n \u2022 You gain proficiency with four simple or martial weapons of your choice.",
	description : "I gain proficiency with four simple or martial weapons of my choice.\n[+1 Strength or Dexterity]",
	scorestxt : "+1 Strength or Dexterity"
};

// Add attack entry that is not in the SRD
WeaponsList["thorn whip"] = {
	regExpSearch : /^(?=.*thorn)(?=.*whip).*$/i,
	name : "Thorn Whip",
	source : ["P", 282],
	list : "spell",
	ability : 5,
	type : "Cantrip",
	damage : ["C", 6, "piercing"],
	range : "Melee, 30 ft",
	description : "Melee spell attack, pull target 10 ft closer to me (PHB 282)",
	abilitytodamage : false
};

// Add spells that are not in the SRD
SpellsList["arcane gate"] = {
	name : "Arcane Gate",
	classes : ["sorcerer", "warlock", "wizard"],
	source : ["P", 214],
	level : 6,
	school : "Conj",
	time : "1 a",
	range : "500 ft",
	components : "V,S",
	duration : "Conc, 10 min",
	description : "Two portals, up to 500 ft apart, teleport any to other side; portals are filled with opaque mist",
	descriptionFull : "You create linked teleportation portals that remain open for the duration. Choose two points on the ground that you can see, one point within 10 feet of you and one point within 500 feet of you. A circular portal, 10 feet in diameter, opens over each point. If the portal would open in the space occupied by a creature, the spell fails, and the casting is lost." + "\n   " + "The portals are two-dimensional glowing rings filled with mist, hovering inches from the ground and perpendicular to it at the points you choose. A ring is visible only from one side (your choice), which is the side that functions as a portal." + "\n   " + "Any creature or object entering the portal exits from the other portal as if the two were adjacent to each other, passing through a portal from the non-portal side has no effect. The mist that fills each portal is opaque and blocks vision through it. On your turn, you can rotate the rings as a bonus action so that the active side faces in a different direction."
};
SpellsList["armor of agathys"] = {
	name : "Armor of Agathys",
	classes : ["warlock"],
	source : ["P", 215],
	level : 1,
	school : "Abjur",
	time : "1 a",
	range : "Self",
	components : "V,S,M",
	compMaterial : "A cup of water",
	duration : "1 h",
	description : "5+5/SL temp HP; as long as temp HP last any crea that hits in melee takes 5+5/SL Cold dmg",
	descriptionFull : "A protective magical force surrounds you, manifesting as a spectral frost that covers you and your gear. You gain 5 temporary hit points for the duration. If a creature hits you with a melee attack while you have these hit points, the creature takes 5 cold damage." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, both the temporary hit points and the cold damage increase by 5 for each slot level above 1st."
};
SpellsList["arms of hadar"] = {
	name : "Arms of Hadar",
	classes : ["warlock"],
	source : ["P", 215],
	level : 1,
	school : "Conj",
	time : "1 a",
	range : "10-ft rad",
	components : "V,S",
	duration : "Instantaneous",
	save : "Str",
	description : "2d6+1d6/SL Necrotic dmg; save halves; on failed save no reactions until next turn",
	descriptionFull : "You invoke the power of Hadar, the Dark Hunger. Tendrils of dark energy erupt from you and batter all creatures within 10 feet of you. Each creature in that area must make a Strength saving throw. On a failed save, a target takes 2d6 necrotic damage and can't take reactions until its next turn. On a successful save, the creature takes half damage, but suffers no other effect." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d6 for each slot level above 1st."
};
SpellsList["aura of life"] = {
	name : "Aura of Life",
	classes : ["paladin"],
	source : ["P", 216],
	level : 4,
	school : "Abjur",
	time : "1 a",
	range : "30-ft rad",
	components : "V",
	duration : "Conc, 10 min",
	description : "Me + any crea while in area Necrotic dmg resist.; at turn start, 0 HP living in area heal 1 HP",
	descriptionFull : "Life-preserving energy radiates from you in an aura with a 30-foot radius. Until the spell ends, the aura moves with you, centered on you. Each non-hostile creature in the aura (including you) has resistance to necrotic damage, and its hit point maximum can't be reduced. In addition, a non-hostile, living creature regains 1 hit point when it starts its turn in the aura with 0 hit points."
};
SpellsList["aura of purity"] = {
	name : "Aura of Purity",
	classes : ["paladin"],
	source : ["P", 216],
	level : 4,
	school : "Abjur",
	time : "1 a",
	range : "30-ft rad",
	components : "V",
	duration : "Conc, 10 min",
	description : "Me + any crea while in area Poison dmg resist., immune to disease, adv. on saves vs. conditions",
	descriptionFull : "Purifying energy radiates from you in an aura with a 30-foot radius. Until the spell ends, the aura moves with you, centered on you. Each non-hostile creature in the aura (including you) can't become diseased, has resistance to poison damage, and has advantage on saving throws against effects that cause any of the following conditions - blinded, charmed, deafened, frightened, paralyzed, poisoned, and stunned."
};
SpellsList["aura of vitality"] = {
	name : "Aura of Vitality",
	classes : ["paladin"],
	source : ["P", 216],
	level : 3,
	school : "Evoc",
	time : "1 a",
	range : "30-ft rad",
	components : "V",
	duration : "Conc, 1 min",
	description : "I can heal 1 creature in range for 2d6 HP as a bonus action for the duration",
	descriptionFull : "Healing energy radiates from you in an aura with a 30-foot radius. Until the spell ends, the aura moves with you, centered on you. You can use a bonus action to cause one creature in the aura (including you) to regain 2d6 hit points."
};
SpellsList["banishing smite"] = {
	name : "Banishing Smite",
	classes : ["paladin"],
	source : ["P", 216],
	level : 5,
	school : "Abjur",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	description : "Next melee hit +5d10 Force dmg; if this brings target HP<50, I banish it until spell ends",
	descriptionFull : "The next time you hit a creature with a weapon attack before this spell ends, your weapon crackles with force, and the attack deals an extra 5d10 force damage to the target. Additionally, if this attack reduces the target to 50 hit points of fewer, you banish it. If the target is native to a different plane of existence than the one you're on, the target disappears, returning to its home plane. If the target is native to the plane you're on, the creature vanishes into a harmless demiplane. While there, the target is incapacitated. It remains there until the spell ends, at which point the tart reappears in the space it left or in the nearest unoccupied space if that space is occupied."
};
SpellsList["beast sense"] = {
	name : "Beast Sense",
	classes : ["druid", "ranger"],
	source : ["P", 217],
	ritual : true,
	level : 2,
	school : "Div",
	time : "1 a",
	range : "Touch",
	components : "S",
	duration : "Conc, 1 h",
	description : "Use 1 willing beast's senses; I'm blinded and deafened while doing so",
	descriptionFull : "You touch a willing beast. For the duration of the spell, you can use your action to see through the beast's eyes and hear what it hears, and continue to do so until you use your action to return to your normal senses."
};
SpellsList["blade ward"] = {
	name : "Blade Ward",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : ["P", 218],
	level : 0,
	school : "Abjur",
	time : "1 a",
	range : "Self",
	components : "V,S",
	duration : "1 rnd",
	description : "Until the end of my next turn, Bludgeoning, Piercing, and Slashing dmg resist. vs. weapons",
	descriptionFull : "You extend your hand and trace a sigil of warding in the air. Until the end of your next turn, you have resistance against bludgeoning, piercing, and slashing damage dealt by weapon attacks."
};
SpellsList["blinding smite"] = {
	name : "Blinding Smite",
	classes : ["paladin"],
	source : ["P", 219],
	level : 3,
	school : "Evoc",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	save : "Con",
	description : "Next melee hit +3d8 Radiant dmg; save or blinded; extra save at end of every turn",
	descriptionFull : "The next time you hit a creature with a melee weapon attack during this spell's duration, you weapon flares with a bright light, and the attack deals an extra 3d8 radiant damage to the target. Additionally, the target must succeed on a Constitution saving throw or be blinded until the spell ends." + "\n   " + "A creature blinded by this spell makes another Constitution saving throw at the end of each of its turns. On a successful save, it is no longer blinded."
};
SpellsList["chromatic orb"] = {
	name : "Chromatic Orb",
	classes : ["sorcerer", "wizard"],
	source : ["P", 221],
	level : 1,
	school : "Evoc",
	time : "1 a",
	range : "90 ft",
	components : "V,S,M\u0192",
	compMaterial : "A diamond worth at least 50 gp",
	duration : "Instantaneous",
	description : "Spell attack for 3d8+1d8/SL Acid, Cold, Fire, Lightning, Poison or Thunder dmg (50gp)",
	descriptionFull : "You hurl a 4-inch-diameter sphere of energy at a creature that you can see within range. You choose acid, cold, fire, lightning, poison, or thunder for the type of orb you create, and then make a ranged spell attack against the target. If the attack hits, the creature takes 3d8 damage of the type you chose." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d8 for each slot level above 1st."
};
SpellsList["circle of power"] = {
	name : "Circle of Power",
	classes : ["paladin"],
	source : ["P", 221],
	level : 5,
	school : "Abjur",
	time : "1 a",
	range : "30-ft rad",
	components : "V",
	duration : "Conc, 10 min",
	description : "Any crea while in area adv. on saves vs. magical effects; if save would half dmg it takes no dmg",
	descriptionFull : "Divine energy radiates from you, distorting and diffusing magical energy within 30 feet of you. Until the spell ends, the sphere moves with you, centered on you. For the duration, each friendly creature in the area (including you) has advantage on saving throws against spells and other magical effects. Additionally, when an affected creature succeeds on a saving throw made against a spell or magical effect that allows it to make a saving throw to take only half damage, it instead takes no damage if it succeeds on the saving throw."
};
SpellsList["cloud of daggers"] = {
	name : "Cloud of Daggers",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : ["P", 222],
	level : 2,
	school : "Conj",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M",
	compMaterial : "A sliver of glass",
	duration : "Conc, 1 min",
	description : "5-ft cube 4d4+2d4/SL Slashing dmg to all that enter or start turn in area",
	descriptionFull : "You fill the air with spinning daggers in a cube 5 feet on each side, centered on a point you choose within range. A creature takes 4d4 slashing damage when it enters the spell's area for the first time on a turn or starts its turn there." + AtHigherLevels + "when you cast this spell using a spell slot of 3rd level or higher, the damage increases by 2d4 for each slot level above 2nd."
};
SpellsList["compelled duel"] = {
	name : "Compelled Duel",
	classes : ["paladin"],
	source : ["P", 224],
	level : 1,
	school : "Ench",
	time : "1 bns",
	range : "30 ft",
	components : "V",
	duration : "Conc, 1 min",
	save : "Wis",
	description : "1 crea save or dis. on attacks vs. not-me and save if moving more than 30 ft away",
	descriptionFull : "You attempt to compel a creature into a duel. One creature that you can see within range must make a Wisdom saving throw. On a failed save, the creature is drawn to you, compelled by your divine demand. For the duration, it has disadvantage on attack rolls against creatures other than you, and must make a Wisdom saving throw each time it attempts to move to a space that is more than 30 feet away from you, if it succeeds on this saving throw, this spell doesn't restrict the target's movement for that turn." + "\n   " + "The spell ends if you attack any other creature, if you cast a spell that targets a hostile creature other than the target, if a creature friendly to you damages the target or casts a harmful spell on it, or if you end your turn more than 30 feet away from the target."
};
SpellsList["conjure barrage"] = {
	name : "Conjure Barrage",
	classes : ["ranger"],
	source : ["P", 225],
	level : 3,
	school : "Conj",
	time : "1 a",
	range : "60-ft cone",
	components : "V,S,M",
	compMaterial : "One piece of ammunition or a thrown weapon",
	duration : "Instantaneous",
	save : "Dex",
	description : "Throw weapon or ammo; copies rain down for 3d8 dmg; dmg type as weapon; save halves",
	descriptionFull : "You throw a nonmagical weapon or fire a piece of nonmagical ammunition into the air to create a cone of identical weapons that shoot forward and then disappear. Each creature in a 60-foot cone must succeed on a Dexterity saving throw. A creature takes 3d8 damage on a failed save, or half as much damage on a successful one. The damage type is the same as that of the weapon or ammunition used as a component."
};
SpellsList["conjure volley"] = {
	name : "Conjure Volley",
	classes : ["ranger"],
	source : ["P", 226],
	level : 5,
	school : "Conj",
	time : "1 a",
	range : "150 ft",
	components : "V,S,M",
	compMaterial : "One piece of ammunition or one thrown weapon",
	duration : "Instantaneous",
	save : "Dex",
	description : "Turn ammo/thrown wea into volley; 40-ft rad 20-ft high 8d8 dmg; dmg type as weapon; save halves",
	descriptionFull : "You fire a piece of nonmagical ammunition from a ranged weapon or throw a nonmagical weapon into the air and choose a point within range. Hundreds of duplicates of the ammunition or weapon fall in a volley from above and then disappear. Each creature in a 40-foot-radius. 20-foot-high cylinder centered on that point must make a Dexterity saving throw. A creature takes 8d8 damage on a failed save, or half as much damage on a successful one. The damage type is the same as that of the ammunition or weapon."
};
SpellsList["cordon of arrows"] = {
	name : "Cordon of Arrows",
	classes : ["ranger"],
	source : ["P", 228],
	level : 2,
	school : "Trans",
	time : "1 a",
	range : "5 ft",
	components : "V,S,M",
	compMaterial : "Four or more arrows or bolts",
	duration : "8 h",
	save : "Dex",
	description : "4+2/SL arrows/bolts attack first crea in 30 ft one at a time for 1d6 Piercing dmg; save halves",
	descriptionFull : "You plant four pieces of nonmagical ammunition - arrows or crossbow bolts - in the ground within range and lay magic upon them to protect an area. Until the spell ends, whenever a creature other than you comes within 30 feet of the ammunition for the first time on a turn or ends its turn there, one piece of ammunition flies up to strike it. The creature must succeed on a Dexterity saving throw or take 1d6 piercing damage. The piece of ammunition is then destroyed. The spell ends when no ammunition remains." + "\n   " + "When you cast this spell, you can designate any creatures you choose, and the spell ignores them." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the amount of ammunition that can be affected increases by two for each slot level above 2nd."
};
SpellsList["crown of madness"] = {
	name : "Crown of Madness",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : ["P", 229],
	level : 2,
	school : "Ench",
	time : "1 a",
	range : "120 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	save : "Wis",
	description : "1 humanoid save or charmed and must melee attack against crea chosen by me; extra save/rnd",
	descriptionFull : "One humanoid of your choice that you can see within range must succeed on a Wisdom saving throw or become charmed by you for the duration. While the target is charmed in this way, a twisted crown of jagged iron appears on its head, and a madness glows in its eyes." + "\n   " + "The charmed target must use its action before moving on each of its turns to make a melee attack against a creature other than itself that you mentally choose. The target can act normally on its turn if you choose no creature or if none are within its reach." + "\n   " + "On your subsequent turns, you must use your action to maintain control over the target, or the spell ends. Also, the target can make a Wisdom saving throw at the end of each of its turns. On a success, the spell ends."
};
SpellsList["crusader's mantle"] = {
	name : "Crusader's Mantle",
	classes : ["paladin"],
	source : ["P", 230],
	level : 3,
	school : "Evoc",
	time : "1 a",
	range : "30-ft rad",
	components : "V",
	duration : "Conc, 1 min",
	description : "Me and allies in range deal extra 1d4 Radiant dmg with weapon attacks",
	descriptionFull : "Holy power radiates from you in an aura with a 30-foot radius, awakening boldness in friendly creatures. Until the spell ends, the aura moves with you, centered on you. While in the aura, each non-hostile creature in the aura (including you) deals an extra 1d4 radiant damage when it hits with a weapon attack."
};
SpellsList["destructive wave"] = {
	name : "Destructive Wave",
	classes : ["paladin"],
	source : ["P", 231],
	level : 5,
	school : "Evoc",
	time : "1 a",
	range : "30-ft rad",
	components : "V",
	duration : "Instantaneous",
	save : "Con",
	description : "Any crea 5d6 Thunder + 5d6 Radiant/Necrotic dmg and knocked prone; save halves not prone",
	descriptionFull : "You strike the ground, creating a burst of divine energy that ripples outward from you. Each creature you choose within 30 feet of you must succeed on a Constitution saving throw or take 5d6 thunder damage, as well as 5d6 radiant or necrotic damage (your choice), and be knocked prone. A creature that succeeds on its saving throw takes half as much damage and isn't knocked prone."
};
SpellsList["dissonant whispers"] = {
	name : "Dissonant Whispers",
	classes : ["bard"],
	source : ["P", 234],
	level : 1,
	school : "Ench",
	time : "1 a",
	range : "60 ft",
	components : "V",
	duration : "Instantaneous",
	save : "Wis",
	description : "1 crea 3d6+1d6/SL Psychic dmg and flee; save halves and no fleeing; deaf crea are immune",
	descriptionFull : "You whisper a discordant melody that only one creature of your choice within range can hear, wracking it with terrible pain. The target must make a Wisdom saving throw. On a failed save, it takes 3d6 psychic damage and must immediately use its reaction, if available, to move as far as its speed allows away from you. The creature doesn't move into obviously dangerous ground, such as a fire or a pit. On a successful save, the target takes half as much damage and doesn't have to move away. A deafened creature automatically succeeds on the save." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d6 for each slot level above 1st."
};
SpellsList["elemental weapon"] = {
	name : "Elemental Weapon",
	classes : ["paladin"],
	source : ["P", 237],
	level : 3,
	school : "Trans",
	time : "1 a",
	range : "Touch",
	components : "V,S",
	duration : "Conc, 1 h",
	description : "+1 magical weapon; +1d4 Acid, Cold, Fire, Lightning, or Thunder dmg; SL5: +2/+2d4, SL7: +3/+3d4",
	descriptionFull : "A nonmagical weapon you touch becomes a magic weapon. Choose one of the following damage types - acid, cold, fire, lightning, or thunder. For the duration, the weapon has a +1 bonus to attack rolls and deals an extra 1d4 damage of the chosen type when it hits." + AtHigherLevels + "When you cast this spell using a spell slot of 5th or 6th level, the bonus to attack rolls increases to +2 and the extra damage increases to 2d4. When you use a spell slot of 7th level or higher, the bonus increases to +3 and the extra damage increases to 3d4."
};
SpellsList["ensnaring strike"] = {
	name : "Ensnaring Strike",
	classes : ["ranger"],
	source : ["P", 237],
	level : 1,
	school : "Conj",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	save : "Str",
	description : "Next crea hit save (Large adv.) or restrained, 1d6+1d6/SL Piercing dmg/rnd; Str check to escape",
	descriptionFull : "The next time you hit a creature with a weapon attack before this spell ends, a writhing mass of thorny vines appears at the point of impact, and the target must succeed on a Strength saving throw or be restrained by the magical vines until the spell ends. A Large or larger creature has advantage on this saving throw. If the target succeeds on the save, the vines shrivel away." + "\n   " + "While restrained by this spell, the target takes 1d6 piercing damage at the start of each of its turns. A creature restrained by the vines or one that can touch the creature can use its action to make a Strength check against your spell save DC. On a success, the target is freed." + AtHigherLevels + "If you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d6 for each slot level above 1st."
};
SpellsList["feign death"] = {
	name : "Feign Death",
	classes : ["bard", "cleric", "druid", "wizard"],
	source : ["P", 240],
	ritual : true,
	level : 3,
	school : "Necro",
	time : "1 a",
	range : "Touch",
	components : "V,S,M",
	compMaterial : "A pinch of graveyard dirt",
	duration : "1 h (D)",
	description : "Willing creature appears dead; it is blinded, incapacitated, has dmg resist. all but Psychic, and speed 0",
	descriptionFull : "You touch a willing creature and put it into a cataleptic state that is indistinguishable from death." + "\n   " + "For the spell's duration, or until you use an action to touch the target and dismiss the spell, the target appears dead to all outward inspection and to spells used to determine the target's status. The target is blinded and incapacitated, and its speed drops to 0. The target has resistance to all damage except psychic damage. If the target is diseased or poisoned when you cast the spell, or becomes diseased or poisoned while under the spell's effect, the disease and poison have no effect until the spell ends."
};
SpellsList["friends"] = {
	name : "Friends",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : ["P", 244],
	level : 0,
	school : "Ench",
	time : "1 a",
	range : "Self",
	components : "S,M",
	compMaterial : "A small amount of makeup applied to the face as this spell is cast",
	duration : "Conc, 1 min",
	description : "Adv. on Cha checks vs. 1 crea currently not hostile; when spell ends, crea knows and becomes hostile",
	descriptionFull : "For the duration, you have advantage on all Charisma checks directed at one creature of your choice that isn't hostile toward you. When the spell ends, the creature realizes that you used magic to influence its mood and becomes hostile toward you. A creature prone to violence might attack you. Another creature might seek retribution in other ways (at the DM's discretion), depending on the nature of your interaction with it."
};
SpellsList["grasping vine"] = {
	name : "Grasping Vine",
	classes : ["druid", "ranger"],
	source : ["P", 246],
	level : 4,
	school : "Conj",
	time : "1 bns",
	range : "30 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "Conjure vine with 30 ft reach; bns a to direct to 1 crea save or pulled 20 ft to vine",
	descriptionFull : "You conjure a vine that sprouts from the ground in an unoccupied space of your choice that you can see within range. When you cast this spell, you can direct the vine to lash out at a creature within 30 feet of it that you can see. That creature must succeed on a Dexterity saving throw or be pulled 20 feet directly toward the vine." + "\n   " + "Until the spell ends, you can direct the vine to lash out at the same creature or another one as a bonus action on each of your turns."
};
SpellsList["hail of thorns"] = {
	name : "Hail of Thorns",
	classes : ["ranger"],
	source : ["P", 249],
	level : 1,
	school : "Conj",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "Next ranged weapon attack, all within 5 ft of target 1d10+1d10/SL Piercing dmg; save halves",
	descriptionFull : "The next time you hit a creature with a ranged weapon attack before the spell ends, this spell creates a rain of thorns that sprouts from your ranged weapon or ammunition. In addition to the normal effect of the attack, the target of the attack and each creature within 5 feet of it must make a Dexterity saving throw. A creature takes 1d10 piercing damage on a failed save, or half as much damage on a successful one." + AtHigherLevels + "If you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d10 for each slot level above 1st (to a maximum of 6d10)."
};
SpellsList["hex"] = {
	name : "Hex",
	classes : ["warlock"],
	source : ["P", 251],
	level : 1,
	school : "Ench",
	time : "1 bns",
	range : "90 ft",
	components : "V,S,M",
	compMaterial : "The petrified eye of a newt",
	duration : "Conc, 1 h",
	description : "1 crea +1d6 Necrotic dmg from my atks; dis. on chosen ability checks; SL3: conc, 8h; SL5: conc, 24h",
	descriptionFull : "You place a curse on a creature that you can see within range. Until the spell ends, you deal an extra 1d6 necrotic damage to the target whenever you hit it with an attack. Also, choose one ability when you cast the spell. The target has disadvantage on ability checks made with the chosen ability." + "\n   " + "If the target drops to 0 hit points before this spell ends, you can use a bonus action on a subsequent turn of yours to curse a new creature." + "\n   " + "A remove curse cast on the target ends this spell early." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd or 4th level, you can maintain your concentration on the spell for up to 8 hours. When you use a spell slot of 5th level or higher, you can maintain your concentration on the spell for up to 24 hours."
};
SpellsList["hunger of hadar"] = {
	name : "Hunger of Hadar",
	classes : ["warlock"],
	source : ["P", 251],
	level : 3,
	school : "Conj",
	time : "1 a",
	range : "150 ft",
	components : "V,S,M",
	compMaterial : "A pickled octopus tentacle",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "20-ft rad blinds all while in; all start turn in 2d6 Cold dmg; all end turn in save or 2d6 Acid dmg",
	descriptionFull : "You open a gateway to the dark between the stars, a region infested with unknown horrors. A 20-foot-radius sphere of blackness and bitter cold appears, centered on a point with range and lasting for the duration. This void is filled with a cacophony of soft whispers and slurping noises that can be heard up to 30 feet away. No light, magical or otherwise, can illuminate the area, and creatures fully within the area are blinded." + "\n   " + "The void creates a warp in the fabric of space, and the area is difficult terrain. Any creature that starts its turn in the area takes 2d6 cold damage. Any creature that ends its turn in the area must succeed on a Dexterity saving throw or take 2d6 acid damage as milky, otherworldly tentacles rub against it."
};
SpellsList["lightning arrow"] = {
	name : "Lightning Arrow",
	classes : ["ranger"],
	source : ["P", 255],
	level : 3,
	school : "Trans",
	time : "1 bns",
	range : "Self",
	components : "V,S",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "Next rngd wea atk +4d8+1d8/SL Lightn. dmg, miss half; 10 ft all 2d8+1d8/SL Lightn. dmg, save half",
	descriptionFull : "The next time you make a ranged weapon attack during the spell's duration, the weapon's ammunition, or the weapon itself if it's a thrown weapon, transforms into a bolt of lightning. Make the attack roll as normal. The target takes 4d8 lightning damage on a hit, or half as much damage on a miss, instead of the weapon's normal damage." + "\n   " + "Whether you hit or miss, each creature within 10 feet of the target must make a Dexterity saving throw. Each of these creatures takes 2d8 lightning damage on a failed save, or half as much damage on a successful one." + "\n   " + "The piece of ammunition or weapon then returns to its normal form." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the damage for both effects of the spell increases by 1d8 for each slot level above 3rd."
};
SpellsList["phantasmal force"] = {
	name : "Phantasmal Force",
	classes : ["bard", "sorcerer", "wizard"],
	source : ["P", 264],
	level : 2,
	school : "Illus",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M",
	compMaterial : "A bit of fleece",
	duration : "Conc, 1 min",
	save : "Int",
	description : "1 crea save or sees 10 ft cube illusion that does 1d6 Psychic dmg/rnd; Int(Investigation) vs. Spell DC",
	descriptionFull : "You craft an illusion that takes root in the mind of a creature that you can see within range. The target must make an Intelligence saving throw. On a failed save, you create a phantasmal object, creature, or other visible phenomenon of your choice that is no larger than a 10-foot cube and that is perceivable only to the target for the duration. This spell has no effect on undead or constructs." + "\n   " + "The phantasm includes sound, temperature, and other stimuli, also evident only to the creature." + "\n   " + "The target can use its action to examine the phantasm with an Intelligence (Investigation) check against your spell save DC. If the check succeeds, the target realizes that the phantasm is an illusion, and the spell ends." + "\n   " + "While a target is affected by the spell, the target treats the phantasm as if it were real. The target rationalizes any illogical outcomes from interacting with the phantasm. For example, a target attempting to walk across a phantasmal bridge that spans a chasm falls once it steps onto the bridge. If the target survives the fall, it still believes that the bridge exists and comes up with some other explanation for its fall - it was pushed, it slipped, or a strong wind might have knocked it off." + "\n   " + "An affected target is so convinced of the phantasm's reality that it can even take damage from the illusion. A phantasm created to appear as a creature can attack the target. Similarly, a phantasm created to appear as fire, a pool of acid, or lava can burn the target. Each round on your turn, the phantasm can deal 1d6 psychic damage to the target if it is in the phantasm's area or within 5 feet of the phantasm, provided that the illusion is of a creature or hazard that could logically deal damage, such as by attacking. The target perceives the damage as a type appropriate to the illusion."
};
SpellsList["power word heal"] = {
	name : "Power Word Heal",
	classes : ["bard"],
	source : ["P", 266],
	level : 9,
	school : "Evoc",
	time : "1 a",
	range : "Touch",
	components : "V,S",
	duration : "Instantaneous",
	description : "1 crea heals all HP and stops being charmed, frightened, paralyzed, stunned; it can use rea to stand up",
	descriptionFull : "A wave of healing energy washes over the creature you touch. The target regains all its hit points. If the creature is charmed, frightened, paralyzed, or stunned, the condition ends. If the creature is prone, it can use its reaction to stand up. This spell has no effect on undead or constructs."
};
SpellsList["ray of sickness"] = {
	name : "Ray of Sickness",
	classes : ["sorcerer", "wizard"],
	source : ["P", 271],
	level : 1,
	school : "Necro",
	time : "1 a",
	range : "60 ft",
	components : "V,S",
	duration : "Instantaneous",
	save : "Con",
	description : "Spell attack for 2d8+1d8/SL Poison dmg; save or also poisoned until end of my next turn",
	descriptionFull : "A ray of sickening greenish energy lashes out toward a creature within range. Make a ranged spell attack against the target. On a hit, the target takes 2d8 poison damage and must make a Constitution saving throw. On a failed save, it is also poisoned until the end of your next turn." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d8 for each slot level above 1st."
};
SpellsList["searing smite"] = {
	name : "Searing Smite",
	classes : ["paladin"],
	source : ["P", 274],
	level : 1,
	school : "Evoc",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	save : "Con",
	description : "Next melee weapon hit +1d6+1d6/SL Fire dmg and target ignites; save to end spell or 1d6 Fire dmg",
	descriptionFull : "The next time you hit a creature with a melee weapon attack during the spell's duration, your weapon flares with white-hot intensity, and the attack deals an extra 1d6 fire damage to the target and causes the target to ignite in flames. At the start of each of its turns until the spell ends, the target must make a Constitution saving throw. On a failed save, it takes 1d6 fire damage. On a successful save, the spell ends. If the target or a creature within 5 feet of it uses an action to put out the flames, or if some other effect douses the flames (such as the target being submerged in water), the spell ends." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the initial extra damage dealt by the attack increases by 1d6 for each slot above the 1st."
};
SpellsList["staggering smite"] = {
	name : "Staggering Smite",
	classes : ["paladin"],
	source : ["P", 278],
	level : 4,
	school : "Evoc",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	save : "Wis",
	description : "Next melee weapon hit +4d6 Psychic dmg and save or dis. on atks/chks, no rea, until end next turn",
	descriptionFull : "The next time you hit a creature with a melee weapon attack during this spell's duration, your weapon pierces both body and mind, and the attack deals an extra 4d6 psychic damage to the target. The target must make a Wisdom saving throw. On a failed save, it has disadvantage on attack rolls and ability checks, and can't take reactions, until the end of its next turn."
};
SpellsList["swift quiver"] = {
	name : "Swift Quiver",
	classes : ["ranger"],
	source : ["P", 279],
	level : 5,
	school : "Trans",
	time : "1 bns",
	range : "Touch",
	components : "V,S,M",
	compMaterial : "A quiver containing at least one piece of ammunition",
	duration : "Conc, 1 min",
	description : "Quiver gives nonmagical ammo; bns a to make 2 atks with weapon that uses ammo from that quiver",
	descriptionFull : "You transmute your quiver so it produces an endless supply of nonmagical ammunition, which seems to leap into your hand when you reach for it." + "\n   " + "On each of your turns until the spell ends, you can use a bonus action to make two attacks with a weapon that uses ammunition from the quiver. Each time you make such a ranged attack, your quiver magically replaces the piece of ammunition you used with a similar piece of nonmagical ammunition. Any pieces of ammunition created by this spell disintegrate when the spell ends. If the quiver leaves your possession, the spell ends."
};
SpellsList["telepathy"] = {
	name : "Telepathy",
	classes : ["wizard"],
	source : ["P", 281],
	level : 8,
	school : "Evoc",
	time : "1 a",
	range : "Unlimited",
	components : "V,S,M",
	compMaterial : "A pair of linked silver rings",
	duration : "24 h",
	description : "1 willing crea Int>0 and I telepathic link; share words, sensory information if on same plane",
	descriptionFull : "You create a telepathic link between yourself and a willing creature with which you are familiar. The creature can be anywhere on the same plane of existence as you. The spell ends if you or the target are no longer on the same plane." + "\n   " + "Until the spell ends, you and the target can instantaneously share words, images, sounds, and other sensory messages with one another through the link, and the target recognizes you as the creature it is communicating with. The spell enables a creature with an Intelligence score of at least 1 to understand the meaning of your words and take in the scope of any sensory messages you send to it."
};
SpellsList["thorn whip"] = {
	name : "Thorn Whip",
	classes : ["druid"],
	source : ["P", 282],
	level : 0,
	school : "Trans",
	time : "1 a",
	range : "30 ft",
	components : "V,S,M",
	compMaterial : "The stem of a plant with thorns",
	duration : "Instantaneous",
	description : "Melee spell attack for 1d6 Piercing dmg and pull crea 10 ft towards me; +1d6 at CL 5, 11, and 17",
	descriptionCantripDie : "Melee spell attack for `CD`d6 Piercing dmg and pull crea 10 ft towards me",
	descriptionFull : "You create a long, vine-like whip covered in thorns that lashes out at your command toward a creature in range. Make a melee spell attack against the target. If the attack hits, the creature takes 1d6 piercing damage, and if the creature is Large or smaller, you pull the creature up to 10 feet closer to you." + "\n   " + "This spell's damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6)."
};
SpellsList["thunderous smite"] = {
	name : "Thunderous Smite",
	classes : ["paladin"],
	source : ["P", 282],
	level : 1,
	school : "Evoc",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	save : "Str",
	description : "Next melee weapon hit +2d6 Thunder dmg and save or 10 ft push and prone; audible in 300 ft",
	descriptionFull : "The first time you hit with a melee weapon attack during this spell's duration, your weapon rings with thunder that is audible within 300 feet of you, and the attack deals an extra 2d6 thunder damage to the target. Additionally, if the target is a creature, it must succeed on a Strength saving throw or be pushed 10 feet away from you and knocked prone."
};
SpellsList["tsunami"] = {
	name : "Tsunami",
	classes : ["druid"],
	source : ["P", 284],
	level : 8,
	school : "Conj",
	time : "1 min",
	range : "Sight",
	components : "V,S",
	duration : "Conc, 6 rnd",
	save : "Str",
	description : "300\u00D750\u00D7300ft (l\u00D7w\u00D7h) wall of water moves away at 50 ft/rnd; 6d10 Bludg. dmg; save halves; see B",
	descriptionMetric : "90\u00D715\u00D790m (l\u00D7w\u00D7h) wall of water moves away at 15 m/rnd; 6d10 Bludg. dmg; save halves; see B",
	descriptionFull : "A wall of water springs into existence at a point you choose within range. You can make the wall up to 300 feet long, 300 feet high, and 50 feet thick. The wall lasts for the duration." + "\n   " + "When the wall appears, each creature within its area must make a Strength saving throw. On a failed save, a creature takes 6d10 bludgeoning damage, or half as much damage on a successful save." + "\n   " + "At the start of each of your turns after the wall appears, the wall, along with any creatures in it, moves 50 feet away from you. Any Huge or smaller creature inside the wall or whose space the wall enters when it moves must succeed on a Strength saving throw or take 5d10 bludgeoning damage. A creature can take this damage only once per round. At the end of the turn, the wall's height is reduced by 50 feet, and the damage creatures take from the spell on subsequent rounds is reduced by 1d10. When the wall reaches 0 feet in height, the spell ends." + "\n   " + "A creature caught in the wall can move by swimming. Because of the force of the wave, though, the creature must make a successful Strength (Athletics) check against your spell save DC in order to move at all. If it fails the check, it can't move. A creature that moves out of the area falls to the ground."
};
SpellsList["witch bolt"] = {
	name : "Witch Bolt",
	classes : ["sorcerer", "warlock", "wizard"],
	source : ["P", 289],
	level : 1,
	school : "Evoc",
	time : "1 a",
	range : "30 ft",
	components : "V,S,M",
	compMaterial : "A twig from a tree that has been struck by lightning",
	duration : "Conc, 1 min",
	description : "Spell attack 1d12+1d12/SL Lightning dmg; 1 a repeat dmg, if consecutive; ends if out of range",
	descriptionFull : "A beam of crackling, blue energy lances out toward a creature within range, forming a sustained arc of lightning between you and the target. Make a ranged spell attack against that creature. On a hit, the target takes 1d12 lightning damage, and on each of your turns for the duration, you can use your action to deal 1d12 lightning damage to the target automatically. The spell ends if you use your action to do anything else. The spell also ends if the target is ever outside the spell's range or if it has total cover from you." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the initial damage increases by 1d12 for each slot level above 1st."
};
SpellsList["wrathful smite"] = {
	name : "Wrathful Smite",
	classes : ["paladin"],
	source : ["P", 289],
	level : 1,
	school : "Evoc",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	save : "Wis",
	description : "Next melee weapon hit +1d6 Psychic dmg and save or frightened; it can take 1 a for extra save",
	descriptionFull : "The next time you hit with a melee weapon attack during this spell's duration, your attack deals an extra 1d6 psychic damage. Additionally, if the target is a creature, it must make a Wisdom saving throw or be frightened of you until the spell ends. As an action, the creature can make a Wisdom check against your spell save DC to steel its resolve and end this spell."
};
var iFileName = "pub_20140819_HotDQ+20141104_RoT.js";
RequiredSheetVersion(13);
// This file adds the background features and magic items from the Hoard of the Dragon Queen and Rise of Tiamat  adventure books to MPMB's Character Record Sheet

// Define the source
SourceList.HotDQ={
	name : "Hoard of the Dragon Queen [background features, items]",
	abbreviation : "HotDQ",
	group : "Adventure Books",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/hoard-dragon-queen",
	date : "2014/08/19"
};
SourceList["RoT"] = {
	name : "Rise of Tiamat [items]",
	abbreviation : "RoT",
	group : "Adventure Books",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/rise-tiamat",
	date : "2014/11/04"
};

// Background features
BackgroundFeatureList["cult of the dragon infiltrator"] = {
	description : "I have infiltrated the ranks of the Cult of the Dragon. Having spied on the organization for quite some time, I am familiar with its inner workings and customs. I have a second identity as an initiate of the cult, enough of a facade to blend in as a simple grunt or servant.",
	source : [["HotDQ", 87], ["ALbackground", 0]]
};
BackgroundFeatureList["dragon scholar"] = {
	description : "I have studied dragons and their lore for many years. I can automatically identify locations built or used by dragons, and I can identify dragon eggs and scales by sight. If I fail an Intelligence check to recall lore relating to dragons, I know someone or some book that I can consult for the answer unless the DM rules that the lore is unknown.",
	source : [["HotDQ", 87], ["ALbackground", 0]]
};

// Magic Items
// The magic cauldron on page 79 is omitted as its only magic is that it functions as the material component for the Augury spell. Not something an adventurer is likely to use, with it being 50 lb.
MagicItemsList["dragongleam"] = {
	name : "Dragongleam",
	source : ["HotDQ", 69],
	type : "weapon (spear)",
	rarity : "rare",
	magicItemTable : "F",
	description : "This rusty spear is engraved with draconic runes on its crossguard which read \"Tiamat's Eyes Shine\". The spear has 10 charges. As an action while holding it, I can say this command and expend 1 charge to cast Daylight. The spear loses its magic once all charges are expended.",
	descriptionFull : "This rusty spear is engraved with draconic runes on its crossguard which read \"Tiamat's Eyes Shine\". The spear has 10 charges. While holding it, you can say the command and expend 1 charge as an action to cast the Daylight spell. The spear loses this property if it has no charges left.",
	weight : 3,
	usages : 10,
	recovery : "Never",
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["daylight"],
		selection : ["daylight"],
		firstCol : 1
	},
	spellChanges : {
		"daylight" : {
			component : "V,M\u0192"
		}
	},
	weaponsAdd : ["Dragongleam"],
	weaponOptions : {
		baseWeapon : "spear",
		regExpSearch : /dragongleam/i,
		name : "Dragongleam",
		source : ["HotDQ", 69]
	}
}
MagicItemsList["tankard of plenty"] = {
	name : "Tankard of Plenty",
	source : ["HotDQ", 74],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "A",
	description : 'This golden stein is decorated with dancing dwarves and grain patterns. Speaking the command word "Illefarn" while grasping the handle fills the tankard with three pints of rich dwarven ale. This power can be used up to three times per day.',
	descriptionFull : 'This golden stein is decorated with dancing dwarves and grain patterns. Speaking the command word ("Illefarn") while grasping the handle fills the tankard with three pints of rich dwarven ale. This power can be used up to three times per day.',
	usages : 3,
	recovery : "Day"
}
var tempDragonMaskNoteTxt = [
	desc([
		toUni("Damage Absorption") + ". You have resistance against DTYPE damage. If you already have resistance to DTYPE damage from another source, you instead have immunity to DTYPE damage. If you already have immunity to DTYPE damage from another source, whenever you are subjected to DTYPE damage, you take none of that damage and regain a number of hit points equal to half the damage dealt of that type.",
		toUni("Draconic Majesty") + ". While you are wearing no armor, you can add your Charisma bonus to your Armor Class.",
		toUni("Dragon Breath") + ". If you have a breath weapon that requires rest to recharge, it gains a recharge of 6.",
		toUni("Dragon Sight") + ". You gain darkvision out to 60 feet, or to an additional 60 feet if you already have that sense. Once per day, you can gain blindsight out to 30 feet for 5 minutes.",
		toUni("Dragon Tongue") + ". You can speak and understand Draconic. You also have advantage on any Charisma check you make against DCOLOUR dragons.",
		toUni("Legendary Resistance (1/Day)") + ". If you fail a saving throw, you can choose to succeed instead."
	]), [
		" It reshapes to fit my face and head when I attuned to it. While I'm wearing a dragon mask and attuned to it, it grants me the following benefits.",
		"\u2022 Damage Absorption. I have resistance against DTYPE damage. If I already have resistance to DTYPE damage from another source, I instead gain immunity to DTYPE damage. If I already have immunity to DTYPE damage from another source, whenever I am subjected to DTYPE damage, I take none of that damage and instead regain a number of hit points equal to half the DTYPE damage dealt.",
		"\u2022 Draconic Majesty. While I am wearing no armor, I can add my Charisma bonus to my Armor Class.",
		"\u2022 Dragon Breath. If I have a breath weapon that requires rest to recharge, it gains a recharge of 6.",
		"\u2022 Dragon Sight. I gain darkvision out to 60 ft, or to an additional 60 ft if I already have that sense. Once per day, I can gain blindsight out to 30 ft for 5 minutes.",
		"\u2022 Dragon Tongue. I can speak and understand Draconic. I also have advantage on any Charisma check I make against DCOLOUR dragons.",
		"\u2022 Legendary Resistance. Once per day when I fail a saving throw, I can choose to succeed instead."
	].join("\n   ")
];
MagicItemsList["dragon mask"] = {
	name : "Dragon Mask",
	source : ["HotDQ", 94],
	type : "wondrous item",
	rarity : "legendary",
	storyItemAL : true,
	description : "This mask reshapes to fit my head. It grants me the ability to absorb associated damage type, darkvision 60 ft, blindsight 30 ft (1/day), Legendary Resistance (1/day), adv. on Cha checks vs. a dragon type, the ability speak Draconic, and lets me add my Cha mod to AC while not wearing armor, see Notes page.",
	descriptionFull : "Each dragon mask is a legendary wondrous item that reshapes to fit the face and head of a wearer attuned to it. While you are wearing any dragon mask and attuned to it, you gain the following benefits." + tempDragonMaskNoteTxt[0].replace(/You have resistance against DTYPE damage*?\n/, "You have resistance against the mask's damage type. If you already have resistance to that damage type from another source, you instead have immunity to that damage type. If you already have immunity to that damage type from another source, whenever you are subjected to damage of that type, you take none of that damage and regain a number of hit points equal to half the damage dealt of that type.\n").replace("DCOLOUR dragons", "dragons that share the mask's color"),
	attunement : true,
	languageProfs : ["Draconic"],
	vision : [["Darkvision", "fixed 60"], ["Darkvision", "+60"]],
	usages : 1,
	recovery : "Day",
	additional : "Legendary Resistance",
	extraLimitedFeatures : [{
		name : "Dragon Mask (Blindsight 30 ft, 5 min)",
		usages : 1,
		recovery : "Day"
	}],
	extraAC : [{
		mod : "Cha",
		magic : true,
		text : "I add my Charisma modifier to AC while I'm not wearing armor.",
		stopeval : function (v) { return v.wearingArmor; }
	}],
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.theWea.dbBreathWeapon || (/^(?=.*breath)(?=.*weapon).*$/i).test(v.theWea.name)) {
					fields.Description = fields.Description.replace(/(Us(e|able)( only)? )?once per (short|long) rest/i, 'Recharge 6');
				};
			}
		]
	},
	incrementDamageRes : function (dType, dRes) {
		SetProf(
			"savetxt",
			CurrentProfs.resistance[dRes] && CurrentProfs.resistance[dRes].src.length > 1,
			{ immune : [dRes] },
			!dType ? "Mask of the Dragon Queen (magic item)" : dType + " Dragon Mask (magic item)"
		);
	},
	choices : ["Black", "Blue", "Green", "Red", "White", "Mask of the Dragon Queen"],
	"black" : {
		name : "Black Dragon Mask",
		description : "This mask reshapes to fit my head. It grants me the ability to absorb acid damage, darkvision 60 ft, blindsight 30 ft (1/day), Legendary Resistance (1/day), adv. on Cha checks vs. black dragons, the ability speak Draconic, and lets me add my Cha mod to AC while not wearing armor, and more, see Notes page.",
		descriptionLong : "This horned mask of glossy ebony has horns and a skull-like mien. The mask reshapes to fit my face and head when I attuned to it. It grants me the ability to absorb acid damage, depending on how resistant I'm to it already. Additionally, it gives me darkvision 60 ft (or +60 ft) and blindsight 30 ft once per day for 5 min, the ability speak Draconic, advantage on Charisma checks against black dragons, lets me add my Charisma modifier to AC while I'm not wearing armor, and water breathing. Once per day when I fail a saving throw, I can use the mask to succeed on it instead. See Notes page.",
		descriptionFull : "This horned mask of glossy ebony has horns and a skull-like mien. The mask reshapes to fit a wearer attuned to it. While you are wearing the mask and attuned to it, you can access the following properties." + tempDragonMaskNoteTxt[0].replace(/DTYPE/g, "acid").replace("DCOLOUR", "black") + "\n   " + toUni("Water Breathing") + ". You can breathe underwater.",
		dmgres : ["Acid"],
		changeeval : function () { MagicItemsList["dragon mask"].incrementDamageRes("Black", "acid"); },
		toNotesPage : [{
			name : "Features",
			popupName : "Features of the Black Dragon Mask",
			note : "\n   This horned mask of glossy ebony has horns and a skull-like mien." + tempDragonMaskNoteTxt[1].replace(/DTYPE/g, "acid").replace("DCOLOUR", "any") + "\n   Water Breathing. I can breathe underwater."
		}]
	},
	/*
		Although the adventure book only includes the Black Dragon Mask,
		this code also includes the Blue, Green, Red, and White Dragon Masks.
		The rules for these are found in the Rise of Tiamat Online Supplement,
		here: https://media.wizards.com/2014/downloads/dnd/RiseTiamatSupplementv0.2_Printer.pdf
	*/
	"blue" : {
		name : "Blue Dragon Mask",
		source : [["HotDQ", 0], ["RoTOS", 4]],
		description : "This mask reshapes to fit my head. It grants me the ability to absorb lightning damage, darkvision 60 ft, blindsight 30 ft (1/day), Legendary Resistance (1/day), adv. Cha checks vs. blue dragons, the ability speak Draconic, and lets me add my Cha mod to AC while not wearing armor, and more, see Notes page.",
		descriptionLong : "This mask of glossy azure has spikes around its edges and a ridged horn in its center. The mask reshapes to fit my face and head when I attuned to it. It grants me the ability to absorb lightning damage, depending on how resistant I'm to it already. Additionally, it gives me darkvision 60 ft (or +60 ft) and blindsight 30 ft once per day for 5 min, the ability speak Draconic, advantage on Charisma checks against blue dragons, lets me add my Charisma modifier to AC while I'm not wearing armor, and Lingering Shock. Once per day when I fail a saving throw, I can use the mask to succeed on it instead. See Notes page.",
		descriptionFull : "This mask of glossy azure has spikes around its edges and a ridged horn in its center. The mask reshapes to fit a wearer attuned to it. While you are wearing the mask and attuned to it, you can access the following properties." + tempDragonMaskNoteTxt[0].replace(/DTYPE/g, "lightning").replace("DCOLOUR", "blue") + "\n   " + toUni("Lingering Shock") + ". If you deal lightning damage to a creature, it can't take reactions until its next turn.",
		dmgres : ["Lightning"],
		changeeval : function () { MagicItemsList["dragon mask"].incrementDamageRes("Blue", "lightning"); },
		toNotesPage : [{
			name : "Features",
			popupName : "Features of the Blue Dragon Mask",
			note : "\n   This mask of glossy azure has spikes around its edges and a ridged horn in its center." + tempDragonMaskNoteTxt[1].replace(/DTYPE/g, "lightning").replace("DCOLOUR", "blue") + "\n   Lingering Shock. If I deal lightning damage to a creature, it can't take reactions until its next turn."
		}]
	},
	"green" : {
		name : "Green Dragon Mask",
		source : [["HotDQ", 0], ["RoTOS", 4]],
		description : "This mask reshapes to fit my head. It grants me the ability to absorb poison damage, darkvision 60 ft, blindsight 30 ft (1/day), Legendary Resistance (1/day), adv. on Cha checks vs. green dragons, the ability speak Draconic, and lets me add my Cha mod to AC while not wearing armor, and more, see Notes page.",
		descriptionLong : "This mottled green mask is surmounted by a frilled crest and has spikes along its jaw. The mask reshapes to fit my face and head when I attuned to it. It grants me the ability to absorb poison damage, depending on how resistant I'm to it already. Additionally, it gives me darkvision 60 ft (or +60 ft) and blindsight 30 ft once per day for 5 min, the ability speak Draconic, advantage on Charisma checks against green dragons, lets me add my Charisma modifier to AC while I'm not wearing armor, and water breathing. Once per day when I fail a saving throw, I can use the mask to succeed on it instead. See Notes page.",
		descriptionFull : "This mottled green mask is surmounted by a frilled crest and has leathery spiked plates along its jaw. The mask reshapes to fit a wearer attuned to it. While you are wearing the mask and attuned to it, you can access the following properties." + tempDragonMaskNoteTxt[0].replace(/DTYPE/g, "poison").replace("DCOLOUR", "green") + "\n   " + toUni("Water Breathing") + ". You can breathe underwater.",
		dmgres : ["Poison"],
		changeeval : function () { MagicItemsList["dragon mask"].incrementDamageRes("Green", "poison"); },
		toNotesPage : [{
			name : "Features",
			popupName : "Features of the Green Dragon Mask",
			note : "\n   This mottled green mask is surmounted by a frilled crest and has leathery spiked plates along its jaw." + tempDragonMaskNoteTxt[1].replace(/DTYPE/g, "poison").replace("DCOLOUR", "green") + "\n   Water Breathing. I can breathe underwater."
		}]
	},
	"red" : {
		name : "Red Dragon Mask",
		source : [["HotDQ", 0], ["RoTOS", 4]],
		description : "This mask reshapes to fit my head. It grants me the ability to absorb fire damage, darkvision 60 ft, blindsight 30 ft (1/day), Legendary Resistance (1/day), adv. on Cha checks vs. red dragons, the ability speak Draconic, and lets me add my Cha mod to AC while not wearing armor, and more, see Notes page.",
		descriptionLong : "This mask of glossy crimson has swept-back horns and spiked cheek ridges. The mask reshapes to fit my face and head when I attuned to it. It grants me the ability to absorb fire damage, depending on how resistant I'm to it already. Additionally, it gives me darkvision 60 ft (or +60 ft) and blindsight 30 ft once per day for 5 min, the ability speak Draconic, advantage on Charisma checks against red dragons, lets me add my Charisma modifier to AC while I'm not wearing armor, and Dragon Fire. Once per day when I fail a saving throw, I can use the mask to succeed on it instead. See Notes page.",
		descriptionFull : "This mask of glossy crimson has swept-back horns and spiked cheek ridges. The mask reshapes to fit a wearer attuned to it. While you are wearing the mask and attuned to it, you can access the following properties." + tempDragonMaskNoteTxt[0].replace(/DTYPE/g, "fire").replace("DCOLOUR", "red") + "\n   " + toUni("Dragon Fire") + ". If you deal fire damage to a creature or flammable object, it starts burning. At the start of each of its turns, a creature burning in this way takes 1d6 fire damage. A creature that can reach the burning target can use an action to extinguish the fire.",
		dmgres : ["Fire"],
		changeeval : function () { MagicItemsList["dragon mask"].incrementDamageRes("red", "fire"); },
		toNotesPage : [{
			name : "Features",
			popupName : "Features of the Red Dragon Mask",
			note : "\n   This mask of glossy crimson has swept-back horns and spiked cheek ridges." + tempDragonMaskNoteTxt[1].replace(/DTYPE/g, "fire").replace("DCOLOUR", "red") + "\n   Dragon Fire. If I deal fire damage to a creature or flammable object, it starts burning. At the start of each of its turns, a creature burning in this way takes 1d6 fire damage. A creature that can reach the burning target can use an action to extinguish the fire."
		}]
	},
	"white" : {
		name : "White Dragon Mask",
		source : [["HotDQ", 0], ["RoTOS", 4]],
		description : "This mask reshapes to fit my head. It grants me the ability to absorb cold damage, darkvision 60 ft, blindsight 30 ft (1/day), Legendary Resistance (1/day), adv. on Cha checks vs. white dragons, the ability speak Draconic, and lets me add my Cha mod to AC while not wearing armor, and more, see Notes page.",
		descriptionLong : "This gleaming mask is white with highlights of pale blue and is topped by a spined crest. The mask reshapes to fit my face and head when I attuned to it. It grants me the ability to absorb cold damage, depending on how resistant I'm to it already. Additionally, it gives me darkvision 60 ft (or +60 ft) and blindsight 30 ft once per day for 5 min, the ability speak Draconic, advantage on Charisma checks against white dragons, lets me add my Charisma modifier to AC while I'm not wearing armor, and Winter's Fury. Once per day when I fail a saving throw, I can use the mask to succeed on it instead. See Notes page.",
		descriptionFull : "This gleaming mask is white with highlights of pale blue and is topped by a spined crest. The mask reshapes to fit a wearer attuned to it. While you are wearing the mask and attuned to it, you can access the following properties." + tempDragonMaskNoteTxt[0].replace(/DTYPE/g, "cold").replace("DCOLOUR", "white") + "\n   " + toUni("Winter's Fury") + ". While your current hit points are equal to or less than half your hit point maximum, you deal an extra 1d8 cold damage with your melee attacks.",
		dmgres : ["Cold"],
		changeeval : function () { MagicItemsList["dragon mask"].incrementDamageRes("white", "cold"); },
		toNotesPage : [{
			name : "Features",
			popupName : "Features of the White Dragon Mask",
			note : "\n   This gleaming mask is white with highlights of pale blue and is topped by a spined crest." + tempDragonMaskNoteTxt[1].replace(/DTYPE/g, "cold").replace("DCOLOUR", "white") + "\n   Winter's Fury. While my current hit points are equal to or less than half my hit point maximum, I deal an extra 1d8 cold damage with my melee attacks."
		}]
	},
	"mask of the dragon queen" : {
		name : "Mask of the Dragon Queen",
		source : ["RoT", 94],
		description : "This mask reshapes to fit my head. It allows to absorb acid, cold, fire, lightning, and poison damage, darkvision 60 ft, blindsight 30 ft (1/day), Legendary Resistance (5/day), adv. on Cha checks vs. dragons, the ability speak Draconic, and lets me add my Cha mod to AC while not wearing armor, and more, see Notes page.",
		descriptionLong : "This mask gives me a draconic visage and covers my face, neck, and shoulders. The mask reshapes to fit my face and head when I attuned to it. It grants me the ability to absorb acid, cold, fire, lightning, and poison damage, depending on how resistant I'm already. Additionally, it gives me darkvision 60 ft (or +60 ft) and blindsight 30 ft once per day for 5 min, the ability speak Draconic, advantage on Charisma checks against dragons, lets me add my Charisma modifier to AC while not wearing armor, and more. 5 times per day when I fail a saving throw, I can use the mask to succeed on it instead. See Notes page.",
		descriptionFull : "When two or more of the dragon masks are assembled they magically transform into the Mask of the Dragon Queen. Each mask shrinks to become the modeled head of a chromatic dragon, appearing to roar its devotion to Tiamat where all the masks brought together are arranged crown-like on the wearer's head. Below the five masks, a new mask shapes itself, granting the wearer a draconic visage that covers the face, neck, and shoulders. The mask reshapes to fit a wearer attuned to it. While you are wearing the mask and attuned to it, you can access the following properties." + tempDragonMaskNoteTxt[0].replace(/You have resistance against DTYPE damage*?\n/, "You have resistance against acid, cold, fire, lightning, and poison damage. If you already have resistance to a damage type from another source, you instead have immunity to that damage type. If you already have immunity to a damage type from another source, whenever you are subjected to that damage type, you take none of that damage and regain a number of hit points equal to half the damage dealt of that type.\n").replace("DCOLOUR ", "").replace(toUni("(1/Day)"), toUni("(5/Day)")) + "\n\n   It can have the properties of any one of the colored masks, but only can have one active at a time. These are the following:\n   " + toUni("Water Breathing (black and green)") + ". You can breathe underwater.\n   " + toUni("Lingering Shock (blue)") + ". If you deal lightning damage to a creature, it can't take reactions until its next turn.\n   " + toUni("Dragon Fire (red)") + ". If you deal fire damage to a creature or flammable object, it starts burning. At the start of each of its turns, a creature burning in this way takes 1d6 fire damage. A creature that can reach the burning target can use an action to extinguish the fire.\n   " + toUni("Winter's Fury (white)") + ". While your current hit points are equal to or less than half your hit point maximum, you deal an extra 1d8 cold damage with your melee attacks.",
		dmgres : ["Acid", "Cold", "Fire", "Lightning", "Poison"],
		changeeval : function () {
			MagicItemsList["dragon mask"].incrementDamageRes("", "acid");
			MagicItemsList["dragon mask"].incrementDamageRes("", "cold");
			MagicItemsList["dragon mask"].incrementDamageRes("", "fire");
			MagicItemsList["dragon mask"].incrementDamageRes("", "lightning");
			MagicItemsList["dragon mask"].incrementDamageRes("", "poison");
		},
		toNotesPage : [{
			name : "Features",
			popupName : "Features of the Mask of the Dragon Queen",
			note : "\n   When two or more of the dragon masks are assembled they magically transform into the Mask of the Dragon Queen. Each mask shrinks to become the modeled head of a chromatic dragon, appearing to roar its devotion to Tiamat where all the masks brought together are arranged crown-like on the wearer's head. Below the five masks, a new mask shapes itself, granting the wearer a draconic visage that covers the face, neck, and shoulders." +
			tempDragonMaskNoteTxt[1].replace(/Damage Absorption.*?\n/, "Damage Absorption. I have resistance to acid, cold, fire, lightning, and poison damage. If I already have resistance to a damage type from another source, I instead have immunity to that damage type. If I already have immunity to a damage type from another source, whenever I am subjected to that damage type, I take none of that damage and regain a number of hit points equal to half the damage dealt of that type.\n").replace("DCOLOUR ", "").replace("Once per day when", "Five times per day when") +
			"\n   I can access the properties of any one of the colored masks, but only can have one active at a time. These are the following:\n   Water Breathing (black and green). I can breathe underwater.\n   Lingering Shock (blue). If I deal lightning damage to a creature, it can't take reactions until its next turn.\n   Dragon Fire (red). If I deal fire damage to a creature or flammable object, it starts burning. At the start of each of its turns, a creature burning in this way takes 1d6 fire damage. A creature that can reach the burning target can use an action to extinguish the fire.\n   Winter's Fury (white). While my current hit points are equal to or less than half my hit point maximum, I deal an extra 1d8 cold damage with my melee attacks."
		}],
		usages : 5,
		recovery : "Day",
		additional : "Legendary Resistance"
	}
}
MagicItemsList["hazirawn"] = {
	name : "Hazirawn",
	source : ["HotDQ", 94],
	type : "weapon (greatsword)",
	rarity : "legendary",
	storyItemAL : true,
	description : "This sentient, neutral evil, greatsword functions depend on whether you are attuned to it or not.",
	descriptionFull : "A sentient (neutral evil) greatsword, Hazirawn is capable of speech in Common and Netherese. Even if you aren't attuned to the sword, you gain a +1 bonus on attack and damage rolls made with this weapon and you deal an extra 1d6 necrotic damage when you hit with the weapon.\n   " + toUni("Increased Potency") + ". While you are attuned to this weapon, its bonus on attack and damage rolls increases to +2, and a hit deals an extra 2d6 necrotic damage (instead of 1d6).\n   " + toUni("Spells") + ". Hazirawn has 4 charges to cast spells. As long as the sword is attuned to you and you are holding it in your hand, you can cast Detect Magic (1 charge), Detect Evil and Good (1 charge), or Detect Thoughts (2 charges). Each night at midnight, Hazirawn regains 1d4 expended charges.\n   " + toUni("Wounding") + ". While you are attuned to the weapon, any creature that you hit with Hazirawn can't regain hit points for 1 minute. The target can make a DC 15 Constitution saving throw at the end of each of its turns, ending this effect early on a success.",
	weight : 6,
	choices : ["not attuned", "attuned"],
	"not attuned" : {
		name : "Hazirawn\u200A",
		description : "A sentient (neutral evil) greatsword, Hazirawn is capable of speech in Common and Netherese. While I'm not attuned to the sword, I gain a +1 bonus on attack and damage rolls made with it. It also deals an extra 1d6 necrotic damage on attacks made with the sword.",
		weaponsAdd : ["Hazirawn"],
		weaponOptions : {
			baseWeapon : "greatsword",
			regExpSearch : /hazirawn/i,
			name : "Hazirawn",
			source : ["HotDQ", 94],
			description : "Heavy, two-handed; +1d6 necrotic damage",
			modifiers : [1,1]
		}
	},
	"attuned" : {
		name : "Hazirawn\u200A\u200A",
		attunement : true,
		description : "This sentient, neutral evil, greatsword adds +2 to damage and to hit rolls, deals +2d6 necrotic damage, and those hit with it can't regain HP for 1 min, but can make a DC 15 Con save at the end of each turn to stop this effect. It has 4 charges to cast spells, regaining 1d4 at midnight. It speaks Common and Netherese.",
		extraLimitedFeatures : [{
			name : "Hazirawn [regains 1d4]",
			usages : 4,
			recovery : "Midnight"
		}],
		weaponsAdd : ["Hazirawn"],
		weaponOptions : {
			baseWeapon : "greatsword",
			regExpSearch : /hazirawn/i,
			name : "Hazirawn",
			source : ["HotDQ", 94],
			description : "Heavy, two-handed; +2d6 necrotic damage; Wounding (can't regain HP for 1 min, DC 15 Con save to stop)",
			modifiers : [2,2]
		},
		spellcastingBonus : [{
			name : "1 charge",
			spells : ["detect evil and good", "detect magic"],
			selection : ["detect evil and good", "detect magic"],
			firstCol : 1,
			times : 2
		}, {
			name : "2 charges",
			spells : ["detect thoughts"],
			selection : ["detect thoughts"],
			firstCol : 2
		}],
		fixedDC : 15, // assumed from the fact that its Wounding property has DC 15
		spellFirstColTitle : "Ch"
	}
}
MagicItemsList["insignia of claws"] = {
	name : "Insignia of Claws",
	source : ["HotDQ", 94],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "The jewels in the insignia flare with purple light when I enter combat, empowering my fists. While wearing the insignia, I gain a +1 bonus to the attack rolls and the damage rolls of my unarmed strikes and natural weapons. Such attacks are considered to be magical.",
	descriptionFull : "The jewels in the insignia of the Cult of the Dragon flare with purple light when you enter combat, empowering your natural fists or natural weapons.\n   While wearing the insignia you gain a +1 bonus to the attack rolls and the damage rolls you make with unarmed strikes and natural weapons. Such attacks are considered to be magical.",
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.baseWeaponName == "unarmed strike" && !(/counts as( a)? magical/i).test(fields.Description)) {
					fields.Description += (fields.Description ? '; ' : '') + 'Counts as magical';
				};
			},
			"My unarmed strikes gain a +1 bonus to their attack and damage rolls, and count as magical."
		],
		atkCalc : [
			function (fields, v, output) {
				if (v.baseWeaponName == "unarmed strike") {
					output.magic += 1;
				}
			}, ''
		]
	}
}
MagicItemsList["wand of winter"] = {
	name : "Wand of Winter",
	source : ["HotDQ", 94],
	type : "wand",
	rarity : "rare",
	magicItemTable : "G",
	description : "This wand looks and feels like an icicle and has 7 charges, regaining 1d6+1 expended charges at dawn. If I use its last charge, roll a d20. On a 20, it melts away. I can use its charges to cast spells with DC 15/+5 to hit: Ray of Frost (0 charges: 1d8, 1 charge: 2d8), Sleet Storm (3 charges), or Ice Storm (4 charges).",
	descriptionFull : "This wand looks and feels like an icicle. You must be attuned to the wand to use it.\n   The wand has 7 charges, which are used to fuel the spells within it. With the wand in hand, you can use your action to cast one of the following spells from the wand, even if you are incapable of casting spells: Ray of Frost (no charges, or 1 charge to cast at 5th level; +5 to hit with ranged spell attack), Sleet Storm (3 charges; spell save DC 15), or Ice Storm (4 charges; spell save DC 15). No components are required. The wand regains 1d6+1 expended charges each day at dawn. If you expend the wand's last charge, roll a d20. On a 20, the wand melts away, forever destroyed.",
	attunement : true,
	usages : 7,
	recovery : "dawn",
	additional : "regains 1d6+1",
	fixedDC : 15,
	fixedSpAttack : 5,
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["ray of frost"],
		selection : ["ray of frost"],
		firstCol : 1
	}, {
		name : "0 charges (at will)",
		spells : ["ray of frost"],
		selection : ["ray of frost"],
		firstCol : "atwill"
	}, {
		name : "3 charges",
		spells : ["sleet storm"],
		selection : ["sleet storm"],
		firstCol : 3
	}, {
		name : "4 charges",
		spells : ["ice storm"],
		selection : ["ice storm"],
		firstCol : 4
	}],
	calcChanges : {
		spellAdd : [
			function (spellKey, spellObj, spName, isDuplicate) {
				if (spellKey == "ray of frost" && spName == "wand of winter") {
					if (isDuplicate) {
						spellObj.firstCol = "1";
						spellObj.description = "Spell attack for 2d8 Cold dmg and -10 ft speed until start of my next turn";
					} else {
						spellObj.description = "Spell attack for 1d8 Cold dmg and -10 ft speed until start of my next turn";
					}
					return true;
				};
			},
			""
		]
	}
}
MagicItemsList["dragontooth dagger"] = {
	name : "Dragontooth Dagger",
	source : ["RoT", 94],
	type : "weapon (dagger)",
	rarity : "rare",
	magicItemTable : "H",
	description : "This dagger is fashioned from the tooth of a dragon. Its handle is its leather wrapped root and there is no crossguard. It adds a +1 bonus to attack and damage rolls made with it and deals +1d6 acid damage on a hit. Against the enemies of the Cult of the Dragon this increases to a +2 bonus and +2d6 acid damage.",
	descriptionFull : "A dagger fashioned from the tooth of a dragon. While the blade is obviously a fang or predator's tooth, the handle is leather wrapped around the root of the tooth, and there is no crossguard.\n   You gain a +1 bonus to attack and damage rolls made with this weapon. On a hit with this weapon, the target takes an extra 1d6 acid damage.\n   " + toUni("Draconic Potency") + ". Against enemies of the Cult of the Dragon, the dagger's bonus to attack and damage rolls increases to 2, and the extra acid damage increases to 2d6.",
	weight : 1,
	weaponsAdd : ["Dragontooth Dagger"],
	weaponOptions : {
		baseWeapon : "dagger",
		regExpSearch : /^(?=.*dragontooth)(?=.*dagger).*$/i,
		name : "Dragontooth Dagger",
		source : ["RoT", 94],
		description : "Finesse, light, thrown; +1d6 acid damage; Vs. Cult of the Dragon enemies: +2 magic \u0026 +2d6 acid damage",
		modifiers : [1,1]
	}
}
var iFileName = "pub_20140930_MM.js";
RequiredSheetVersion(12.999);
// This file adds all the player-material from the Monster Manual to MPMB's Character Record Sheet

// Define the source
SourceList.M={
	name : "Monster Manual",
	abbreviation : "MM",
	group : "Primary Sources",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/monster-manual",
	date : "2014/09/30"
};

// Dinosaurs not in the SRD
CreatureList["allosaurus"] = {
	name : "Allosaurus",
	source : ["M", 79],
	size : 2, //Large
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 13,
	hp : 51,
	hd : [6, 10], //[#, die]
	speed : "60 ft",
	scores : [19, 13, 17, 2, 12, 5], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 5
	},
	senses : "",
	passivePerception : 15,
	languages : "",
	challengeRating : "2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Claw",
			ability : 1,
			damage : [1, 8, "slashing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "If used after moving 30 ft straight in the same round, see Pounce trait"
		}, {
			name : "Bite",
			ability : 1,
			damage : [2, 10, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "Can be used in combination with claw while pouncing (see Pounce trait)"
		}
	],
	traits : [{
			name : "Pounce",
			description : "If the allosaurus moves at least 30 ft straight toward a creature and then hits it with a claw attack on the same turn, that target must succeed on a DC 13 Strength saving throw or be knocked prone. If the target is prone, the allosaurus can make one bite attack against it as a bonus action."
		}
	]
};
CreatureList["ankylosaurus"] = {
	name : "Ankylosaurus",
	source : ["M", 79],
	size : 1, //Huge
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 15,
	hp : 68,
	hd : [8, 12], //[#, die]
	speed : "30 ft",
	scores : [19, 11, 15, 2, 12, 5], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "",
	passivePerception : 11,
	languages : "",
	challengeRating : "3",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Tail",
			ability : 1,
			damage : [4, 6, "bludgeoning"], //[#, die, type] "" for die is allowed
			range : "Melee (10 ft)",
			description : "Target must succeed on a DC 14 Strength saving throw or be knocked prone",
			modifiers : [1, "", ""] //[to hit, to damage, add ability to damage] "" means ignore
		}
	]
};
CreatureList["pteranodon"] = {
	name : "Pteranodon",
	source : ["M", 79],
	size : 3, //Medium
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 13,
	hp : 13,
	hd : [3, 8], //[#, die]
	speed : "10 ft,\nfly 60 ft",
	scores : [12, 15, 10, 2, 9, 5], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 1
	},
	senses : "",
	passivePerception : 11,
	languages : "",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Bite",
			ability : 1,
			damage : [1, 6, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : ""
		}
	],
	traits : [{
			name : "Flyby",
			description : "The pteranodon doesn't provoke opportunity attacks when it flies out of an enemy's reach."
		}
	]
};

// Special familiars not in the SRD
CreatureList["faerie dragon"] = { // With contributions by Patrick O.
	name : "Faerie Dragon",
	source : ["M", 133],
	size : 5, //Tiny
	type : "Dragon",
	subtype : "",
	alignment : "Chaotic Good",
	ac : 15,
	hp : 14,
	hd : [4, 4],
	speed : "10 ft,\nfly 60 ft",
	scores : [3, 20, 13, 14, 12, 16], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"arcana" : 4,
		"perception" : 3,
		"stealth" : 7
	},
	senses : "Darkvision 60 ft",
	passivePerception : 13,
	languages : "Draconic, Sylvan",
	challengeRating : "1",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Bite",
			ability : 2,
			damage : [1, "", "piercing"],
			range : "Melee (5 ft)",
			description : "",
			modifiers : ["", "", false]
		}, {
			name : "Euphoria Breath (Recharge 5-6)",
			ability : 3,
			damage : ["Wis save", "", "Euphoria"],
			range : "5 ft",
			description : "For 1 min, target rolls d6 at turn start: 1-4 move random (no actions), 5-6 save again (no actions/move)",
			dc : true,
			modifiers : ["", "", false],
			tooltip : "The dragon exhales a puff of euphoria gas at one creature within 5 feet of it. The target must succeed on a DC 11 Wisdom saving throw, or for 1 minute, the target can't take reactions and must roll a d6 at the start of each of its turns to determine its behavior during the turn: 1-4 - the target takes no action or bonus action and uses all its movment to move in a random direction. 5-6 - the target doesn't move, and the only thing it can do on its turn is make a DC 11 Wisdom saving throw, ending the effect on itself on a success."
		}
	],
	traits : [{
			name : "Superior Invisibility",
			description : "As a bonus action, the dragon can magically turn invisible until its concentration ends (as with a spell). Anything it wears or carries is invisible with it."
		}, {
			name : "Limited Telepathy",
			description : "Using telepathy, the dragon can magically communicate with any other faerie dragon within 60 feet of it."
		}, {
			name : "Magic Resistance",
			description : "The dragon has advantage on saves against spells and magical effects."
		}, {
			name : "Euphoria Breath (Recharge 5-6)",
			description : "Exhale a puff of euphoria gas at a creature within 5 ft. It must succeed on a DC 11 Wisdom save, or for 1 minute, it can't take reactions and must roll a d6 at the start of each of its turns:\n 1-4 - No action or bonus action, using all movment to move in a random direction.\n 5-6 - The target does nothing except attempt another save to try end the effect on itself."
		}
	],
	features : [{
			name : "Innate Spellcasting",
			description : "Cast spells using Charisma (save DC 13), requiring no material components. The spells it knows depends on its age (and stack):\n Red: 1/day - Dancing Lights, Mage Hand, Minor Illusion\n Orange (6-10 years): 1/day - Color Spray\n Yellow (11-20 years): 1/day - Mirror Image\n Green (21-30 years): 1/day - Suggestion\n Blue (31-40 years): 1/day - Major Image\n Indigo (41-50 years): 1/day - Hallucinatory Terrain\n Violet (51+ years): 1/day - Polymorph"
		}
	]
};
CreatureList["crawling claw"] = {
	name : "Crawling Claw",
	source : ["M", 44],
	size : 5, //Tiny
	type : "Undead",
	subtype : "",
	alignment : "Neutral Evil",
	ac : 12,
	hp : 2,
	hd : [1, 4], //[#, die]
	speed : "20 ft, climb 20 ft",
	scores : [13, 14, 11, 5, 10, 4], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "Blindsight 30 ft (blind beyond this radius)",
	damage_immunities : "poison",
	condition_immunities : "charmed, exhaustion, poisoned",
	passivePerception : 10,
	languages : "understands Common but can't speak",
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Claw",
			ability : 1,
			damage : [1, 4, "bludgeoning"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "Does bludgeoning or slashing damage (claw's choice)"
		}
	],
	traits : [{
			name : "Turn Immunity",
			description : "The claw is immune to effects that turn undead."
		}
	]
};
CreatureList["peryton"] = {
	name : "Peryton",
	source : ["M", 251],
	size : 3, //Medium
	type : "Monstrosity",
	subtype : "",
	companion : "steed",
	alignment : "Chaotic Evil",
	ac : 13,
	hp : 33,
	hd : [6, 8], //[#, die]
	speed : "20 ft,\nfly 60 ft",
	scores : [16, 12, 13, 9, 12, 10], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 5
	},
	senses : "Adv. on Wis (Perception) checks using sight/smell",
	passivePerception : 16,
	languages : "understands Common and Elvish, but can't speak",
	challengeRating : "2",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
			name : "Gore",
			ability : 1,
			damage : [1, 8, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "One gore and one talons attack as an Attack action; +2d8 after 30 ft dive straight down"
		}, {
			name : "Talons",
			ability : 1,
			damage : [2, 4, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "One talons and one gore attack as an Attack action; +2d8 after 30 ft dive straight down"
		}
	],
	traits : [{
			name : "Dive Attack",
			description : "If the peryton is flying and dives at least 30 ft. straight toward a target and then hits it with a melee weapon attack, the attack deals an extra 9 (2d8) damage to the target."
		}, {
			name : "Flyby",
			description : "The peryton doesn't provoke an opportunity attack when it flies out of an enemy's reach."
		}, {
			name : "Keen Sight and Smell",
			description : "The peryton has advantage on Wisdom (Perception) checks that rely on sight or smell."
		}
	]
};

// Blights and spores
CreatureList["needle blight"] = {
	name : "Needle Blight",
	source : ["M", 32],
	size : 3, //Medium
	type : "Plant",
	subtype : "",
	alignment : "Neutral Evil",
	ac : 12,
	hp : 11,
	hd : [2, 8], //[#, die]
	speed : "30 ft",
	scores : [12, 12, 13, 4, 8, 3], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	condition_immunities : "blinded, deafened",
	senses : "Blindsight 60 ft (blind beyond this radius).",
	passivePerception : 9,
	languages : "understands Common but can't speak",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Claws",
			ability : 2,
			damage : [2, 4, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : ""
		}, {
			name : "Needles",
			ability : 2,
			damage : [2, 6, "piercing"], //[#, die, type] "" for die is allowed
			range : "30/60 ft",
			description : ""
		}
	]
};
CreatureList["twig blight"] = {
	name : "Twig Blight",
	source : ["M", 32],
	size : 4, //Small
	type : "Plant",
	subtype : "",
	alignment : "Neutral Evil",
	ac : 13,
	hp : 4,
	hd : [1, 6], //[#, die]
	speed : "20 ft",
	scores : [6, 13, 12, 4, 8, 3], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	damage_vulnerabilities : "fire",
	condition_immunities : "blinded, deafened",
	senses : "Blindsight 60 ft (blind beyond this radius).",
	passivePerception : 9,
	languages : "understands Common but can't speak",
	challengeRating : "1/8",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Claws",
			ability : 2,
			damage : [1, 4, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : ""
		}
	],
	traits : [{
			name : "False Appearance",
			description : "While the blight remains motionless, it is indistinguishable from a dead shrub."
		}
	]
};
CreatureList["vine blight"] = {
	name : "Vine Blight",
	source : ["M", 32],
	size : 3, //Medium
	type : "Plant",
	subtype : "",
	alignment : "Neutral Evil",
	ac : 12,
	hp : 26,
	hd : [4, 8], //[#, die]
	speed : "10 ft",
	scores : [15, 8, 14, 5, 10, 3], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"stealth" : 1
	},
	condition_immunities : "blinded, deafened",
	senses : "Blindsight 60 ft (blind beyond this radius).",
	passivePerception : 9,
	languages : "Common",
	challengeRating : "1/2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Constrict",
			ability : 1,
			damage : [2, 6, "bludgeoning"], //[#, die, type] "" for die is allowed
			range : "Melee (10 ft)",
			description : "Large or smaller target is grappled and restrained (escape DC 12); Can't use constrict again until grapple ends"
		}
	],
	traits : [{
			name : "False Appearance",
			description : "While the blight remains motionless, it is indistinguishable from a tangle of vines."
		}
	],
	actions : [{
			name : "Entangling Plants (Recharge 5-6)",
			description : "As an action, grasping roots and vines sprout in a 15-foot radius centered on the blight, withering away after 1 minute. For the duration, that area is difficult terrain for nonplant creatures. In addition, each creature of the blight's choice in that area when the plants appear must succeed on a DC 12 Strength saving throw or become restrained. A creature can use its action to make a DC 12 Strength check, freeing it self or another entangled creature within reach on a success."
		}
	],
	wildshapeString : "Blindsight 60 ft (blind beyond)| Immune to blinded, deafened| Entangling Plants (Recharge 5-6): As an action, 15-ft radius is difficult terrain for nonplant creatures, for 1 minute. Chosen creatures in it must make a DC 12 Str save or become restrained. A creature can use its action to make a DC 12 Str check to free itself or another within reach| False Appearance: While motionless, it's indistinguishable from a tangle of vines."
};
CreatureList["gas spore"] = {
	name : "Gas Spore",
	source : ["M", 138],
	size : 2, //Large
	type : "Plant",
	subtype : "",
	alignment : "Unaligned",
	ac : 5,
	hp : 1,
	hd : [1, 10], //[#, die]
	speed : "fly 10 ft (hover)",
	scores : [5, 1, 3, 1, 1, 1], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	condition_immunities : "blinded, deafened, frightened",
	senses : "Blindsight 30 ft (blind beyond this radius).",
	passivePerception : 5,
	languages : "",
	challengeRating : "1/2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Touch",
			ability : 1,
			damage : [1, "", "poison"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "DC 10 Con save or infected with Death Burst disease, see traits",
			modifiers : [1, "", false] //[to hit, to damage, add ability to damage] "" means ignore
		}
	],
	traits : [{
			name : "Death Burst",
			description : "The gas spore explodes when it drops to 0 hit points. Each creature within 20 feet of it must succeed on a DC 15 Constitution saving throw or take 10 (3d6) poison damage and become infected with a disease on a failed save. Creatures immune to the poisoned condition are immune to this disease.\n   Spores invade an infected creature's system, killing the creature in a number of hours equal to 1d12+the creature's Constitution score, unless the disease is removed. In half that time, the creature becomes poisoned for the rest of the duration. After the creature dies, it sprouts 2d4 Tiny gas spores that grow to full size in 7 days."
		}, {
			name : "Eerie Resemblance",
			description : "The gas spore resembles a beholder. A creature that can see the gas spore can discern its true nature with a successful DC 15 Intelligence (Nature) check."
		}
	],
	wildshapeString : "Blindsight 30 ft (blind beyond)| Immune to: blinded, deafened, frightened| Distinguishable form a beholder only with a DC 15 Int (Nature) check| When at 0 HP, explodes: all within 20 ft DC 15 Con save or 3d6 poison damage and infected with disease| The disease kills a creature in 1d12+it's Con score of hours. In half that, it becomes poisoned for the remainder. When dies, sprouts 2d4 Tiny gas spores that grow to full size in 7 days."
};
var iFileName = "pub_20141209_DMG.js";
RequiredSheetVersion(13);
// This file adds all the player-material from the Dungeon Master's Guide to MPMB's Character Record Sheet

// Define the source
SourceList.D={
	name : "Dungeon Master's Guide",
	abbreviation : "DMG",
	group : "Primary Sources",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/dungeon-masters-guide",
	date : "2014/12/09"
};

// Races
RaceList["aasimar"] = {
	regExpSearch : /^(?!.*(fallen|protector|scourge))((?=.*aasimar)|((?=.*planetouched)(?=.*(celestial|angel)))).*$/i,
	name : "Aasimar",
	source : ["D", 286],
	plural : "Aasimar",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Celestial"],
	vision : [["Darkvision", 60]],
	dmgres : ["Necrotic", "Radiant"],
	age : " reach adulthood in their late teens and live around 160 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 0, 0, 1, 2],
	trait : "Aasimar (+1 Wisdom, +2 Charisma)\n\nCelestial Legacy:\n   I know the Light cantrip.\n   Once I reach 3rd level, I can cast the Lesser Restoration spell once per long rest.\n   Once I reach 5th level, I can cast the Daylight spell once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Celestial Legacy (level 1)",
		spells : ["light"],
		selection : ["light"],
		firstCol : 'atwill'
	},
	features : {
		"lesser restoration" : {
			name : "Celestial Legacy (level 3)",
			limfeaname : "Lesser Restoration",
			usages : 1,
			minlevel : 3,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Celestial Legacy (level 3)",
				spells : ["lesser restoration"],
				selection : ["lesser restoration"],
				firstCol : 'oncelr'
			}
		},
		"daylight" : {
			name : "Celestial Legacy (level 5)",
			limfeaname : "Daylight",
			usages : 1,
			minlevel : 5,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Celestial Legacy (level 5)",
				spells : ["daylight"],
				selection : ["daylight"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["eladrin"] = {
	regExpSearch : /^(?!.*half)((?=.*eladrin)|((?=.*\b(elfs?|elves|elvish|elven)\b)(?=.*\b(feys?|feywild)\b))).*$/i,
	name : "Eladrin",
	sortname : "Elf, Fey (Eladrin)",
	source : ["D", 286],
	plural : "Eladrin",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Elvish"],
	vision : [["Darkvision", 60]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	weaponProfs : [false, false, ["longsword", "shortsword", "longbow", "shortbow"]],
	skills : ["Perception"],
	age : " typically claim adulthood around age 100 and can live to be 750 years old",
	height : " range from under 5 to over 6 feet tall (4'6\" + 2d12\")",
	weight : " weigh around 115 lb (90 + 2d10 \xD7 1d4 lb)",
	heightMetric : " range from under 1,5 to over 1,8 metres tall (140 + 5d12 cm)",
	weightMetric : " weigh around 55 kg (40 + 5d10 \xD7 2d4 / 10 kg)",
	scores : [0, 2, 0, 1, 0, 0],
	trait : "Eladrin (+2 Dexterity, +1 Intelligence)\nTrance: Elves don't need to sleep, but meditate semiconsciously, for 4 hours a day. While meditating, I can dream after a fashion; such dreams are actually mental exercises that have become reflexive through years of practice. After resting in this way, I gain the same benefit that a human does from 8 hours of sleep, thus needing only 4 hours for a long rest.\nFey Step: I can cast the Misty Step spell once using this trait. I regain the ability to do so when I finish a short rest.",
	spellcastingAbility : 4,
	features : {
		"fey step" : {
			name : "Fey Step",
			limfeaname : "Misty Step",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			spellcastingBonus : {
				name : "Fey Step",
				spells : ["misty step"],
				selection : ["misty step"],
				firstCol : 'oncesr'
			}
		}
	}
};

// Subclasses
AddSubClass("cleric", "death domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*(death|dead|dying)).*$/i,
	subname : "Death Domain",
	source : ["D", 96],
	spellcastingExtra : ["false life", "ray of sickness", "blindness/deafness", "ray of enfeeblement", "animate dead", "vampiric touch", "blight", "death ward", "antilife shell", "cloudkill"],
	features : {
		"subclassfeature1" : {
			name : "Bonus Proficiency",
			source : ["D", 96],
			minlevel : 1,
			description : "\n   " + "I gain proficiency with martial weapons",
			weaponProfs : [false, true]
		},
		"subclassfeature1.1" : {
			name : "Reaper",
			source : ["D", 96],
			minlevel : 1,
			description : "\n   " + "I learn one necromancy cantrip of my choice from any spell list" + "\n   " + "My necromancy, single-target cantrips can affect two targets within 5 ft of each other",
			spellcastingBonus : {
				name : "Reaper",
				"class" : "any",
				school : ["Necro"],
				level : [0, 0]
			},
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (spellObj.school == "Necro" && spellObj.level === 0) {
							var startDescr = spellObj.description;
							switch (spellKey) {
								case "chill touch" :
									spellObj.description = spellObj.description.replace("Spell attack", "2 crea in 5 ft spell atk").replace("Necrotic", "Necro.").replace("at CL 5, 11, and 17", "CL 5/11/17");
									break;
								case "spare the dying" :
									spellObj.description = spellObj.description.replace("1 living creature", "1 living creature (or 2 within 5 ft of each other)");
									break;
								case "toll the dead" :
								default :
									spellObj.description = spellObj.description.replace(/1 crea(ture)?/i, "2 crea in 5 ft").replace("disadvantage", "disadv.").replace("save halves", "save half");
							}
							return startDescr !== spellObj.description;
						};
					},
					"My necromancy, single-target cantrips can affect two targets within 5 ft of each other."
				]
			}
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Touch of Death",
			source : ["D", 97],
			minlevel : 2,
			description : "\n   " + "When I hit a creature with a melee attack, I can deal extra necrotic damage",
			additional : ["", "+9 damage", "+11 damage", "+13 damage", "+15 damage", "+17 damage", "+19 damage", "+21 damage", "+23 damage", "+25 damage", "+27 damage", "+29 damage", "+31 damage", "+33 damage", "+35 damage", "+37 damage", "+39 damage", "+41 damage", "+43 damage", "+45 damage"]
		},
		"subclassfeature6" : {
			name : "Inescapable Destruction",
			source : ["D", 97],
			minlevel : 6,
			description : "\n   " + "When I deal necrotic damage with spells or Channel Divinity, I ignore resistance to it"
		},
		"subclassfeature8" : {
			name : "Divine Strike",
			source : ["D", 97],
			minlevel : 8,
			description : "\n   " + "Once per turn, when I hit a creature with a weapon attack, I can do extra damage",
			additional : levels.map(function (n) {
				if (n < 8) return "";
				return "+" + (n < 14 ? 1 : 2) + "d8 necrotic damage";
			}),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (classes.known.cleric && classes.known.cleric.level > 7 && !v.isSpell) {
							fields.Description += (fields.Description ? '; ' : '') + 'Once per turn +' + (classes.known.cleric.level < 14 ? 1 : 2) + 'd8 necrotic damage';
						}
					},
					"Once per turn, I can have one of my weapon attacks that hit do extra necrotic damage."
				]
			}
		},
		"subclassfeature17" : {
			name : "Improved Reaper",
			source : ["D", 97],
			minlevel : 17,
			description : "\n   " + "If I cast a 5th-level or lower necromancy spell that has one target, I can target two" + "\n   " + "They need to be within 5 ft of each other; I have to provide material comp. for both",
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (spellObj.school == "Necro" && spellObj.level && spellObj.level < 6) {
							var startDescr = spellObj.description;
							switch (spellKey) {
								case "blindness/deafness" :
									// only 2 target if not cast at higher SL
									spellObj.description = "2 crea in 5 ft or " + spellObj.description;
									break;
								case "contagion" :
								case "inflict wounds" :
								case "ray of enfeeblement" :
									spellObj.description = spellObj.description.replace(/(Melee )?spell attack/i, "2 " + "$1".toLowerCase() + "spell atk in 5 ft").replace("spell ends", "ends");
									break;
								case "cause fear-xgte" :
									spellObj.description = "2 crea in 5 ft or 1+1/SL crea max 30 ft apart (no constr/undead), save or frightened; save end of turn";
									break;
								case "feign death" :
									spellObj.description = "2 willing crea in 5 ft appear dead; Are blinded, incapacitated, dmg resist. all but Psychic, speed 0";
									break;
								case "gentle repose" :
									spellObj.description = spellObj.description.replace("1 corpse protected from", "2 corpses in 5 ft suffer no");
									break;
								case "raise dead" :
								case "revivify" :
									spellObj.description = spellObj.description.replace("a creature's body that has", "body of 2 crea in 5 ft that").replace("cons.)", "cons. \xD72)");
									spellObj.compMaterial += " (once for each target)";
									break;
								case "speak with dead" :
									spellObj.description = spellObj.description.replace("1 corpse with mouth answers 5 questions", "2 corpses in 5 ft answer 5 questions each");
									break;
								case "enervation" :
									spellObj.description = spellObj.description.replace("action", "1 a").replace("see book", "see B");
								case "bestow curse" :
								case "blight" :
								case "cause fear-uass" :
								case "life transference" :
								case "negative energy flood" :
								default :
									spellObj.description = spellObj.description.replace(/1 crea(ture)?/i, "2 crea in 5 ft").replace("disadvantage", "disadv.").replace("save halves", "save half");
							}
							return startDescr !== spellObj.description;
						};
					},
					"My necromancy, single-target 5th-level or lower spells can affect two targets within 5 ft of each other if both are within range of the spell. The spells still require material components for each target separately."
				]
			}
		}
	}
});
AddSubClass("paladin", "oathbreaker", {
	regExpSearch : /^((?=.*blackguard)|((?=.*(oath.*breaker|breaker.*oath))((?=.*paladin)|((?=.*(exalted|sacred|holy|divine))(?=.*(knight|fighter|warrior|warlord|trooper)))))).*$/i,
	subname : "Oathbreaker",
	source : ["D", 97],
	features : {
		"subclassfeature3" : {
			name : "Channel Divinity: Control Undead",
			source : ["D", 97],
			minlevel : 3,
			description : "\n   " + "As an action, one undead (CR < paladin level) I can see in 30 ft must make a Wis save" + "\n   " + "If failed, it must obey my commands for 24 hours or until I use this on another",
			action : ["action", ""],
			spellcastingExtra : ["hellish rebuke", "inflict wounds", "crown of madness", "darkness", "animate dead", "bestow curse", "blight", "confusion", "contagion", "dominate person"]
		},
		"subclassfeature3.1" : {
			name : "Channel Divinity: Dreadful Aspect",
			source : ["D", 97],
			minlevel : 3,
			description : "\n   " + "As an action, anyone I choose within 30 ft that can see me must make a Wisdom save" + "\n   " + "If failed, it is frightened for 1 min or until it succeeds a save at the end of its turns" + "\n   " + "It can't save at the end of its turn if it's still within 30 ft of me",
			action : ["action", ""]
		},
		"subclassfeature7" : {
			name : "Aura of Hate",
			source : ["D", 97],
			minlevel : 7,
			description : "\n   " + "Fiends/undead within range and I add my Cha mod as bonus on melee weapon damage" + "\n   " + "Multiple Auras of Hate don't stack; only the strongest applies",
			additional : ["", "", "", "", "", "", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "10-foot aura", "30-foot aura", "30-foot aura", "30-foot aura"],
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (v.isMeleeWeapon) {
							fields.Description += (fields.Description ? '; ' : '') + 'Cha mod added to damage';
						}
					},
					"I add my Charisma modifier to my melee weapon damage."
				],
				atkCalc : [
					function (fields, v, output) {
						if (v.isMeleeWeapon) {
							output.extraDmg += Number(What("Cha Mod"));
						};
					}
				]
			}
		},
		"subclassfeature15" : {
			name : "Supernatural Resistance",
			source : ["P", 97],
			minlevel : 15,
			description : "\n   " + "I have resistance to bludgeoning/piercing/slashing damage from nonmagical weapons",
			dmgres : [["Bludgeoning", "Bludg. (nonmagical)"], ["Piercing", "Pierc. (nonmagical)"], ["Slashing", "Slash. (nonmagical)"]]
		},
		"subclassfeature20" : {
			name : "Dread Lord",
			source : ["D", 97],
			minlevel : 20,
			description : "\n   " + "As an action, I gain a 30-ft aura of gloom that reduces bright light to dim for 1 min" + "\n   " + "If frightened of me, foes starting their turn in the aura take 4d10 psychic damage" + "\n   " + "Attacks vs. my allies and me inside the aura have disadvantage if attackers need sight" + "\n   " + "As a bonus action, I can make a melee spell attack vs. a target inside the aura" + "\n   " + "If this attack hits, it does 3d10 + Charisma modifier necrotic damage",
			recovery : "long rest",
			usages : 1,
			action : ["action", ""]
		}
	}
});

// Firearms [weapons and ammunition] (includes contributions by grungydan)
WeaponsList["pistol"] = {
	regExpSearch : /^(?=.*pistol)(?!.*automatic).*$/i,
	name : "Pistol",
	source : ["D", 268],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [1, 10, "piercing"],
	range : "30/90 ft",
	weight : 3,
	description : "Ammunition, loading",
	abilitytodamage : true,
	ammo : "renaissance bullet"
};
WeaponsList["musket"] = {
	regExpSearch : /musket/i,
	name : "Musket",
	source : ["D", 268],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [1, 12, "piercing"],
	range : "40/120 ft",
	weight : 10,
	description : "Ammunition, loading, two handed",
	abilitytodamage : true,
	ammo : "renaissance bullet"
};
WeaponsList["pistol automatic"] = {
	regExpSearch : /^(?!.*rifle)(?=.*pistol)(?=.*automatic).*$/i,
	name : "Pistol, automatic",
	source : ["D", 268],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [2, 6, "piercing"],
	range : "50/150 ft",
	weight : 3,
	description : "Ammunition, reload (15 shots)",
	abilitytodamage : true,
	ammo : "modern bullet"
};
WeaponsList["revolver"] = {
	regExpSearch : /revolver/i,
	name : "Revolver",
	source : ["D", 268],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [2, 8, "piercing"],
	range : "40/120 ft",
	weight : 3,
	description : "Ammunition, reload (6 shots)",
	abilitytodamage : true,
	ammo : "modern bullet"
};
WeaponsList["rifle hunting"] = {
	regExpSearch : /^(?!=laser|antimatter)(?=.*hunting)(?=.*rifle).*$/i,
	name : "Hunting Rifle",
	source : ["D", 268],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [2, 10, "piercing"],
	range : "80/240 ft",
	weight : 8,
	description : "Ammunition, reload (5 shots), two handed",
	abilitytodamage : true,
	ammo : "modern bullet"
};
WeaponsList["rifle automatic"] = {
	regExpSearch : /^(?!=.*laser|antimatter)(?=.*automatic)(?=.*rifle).*$/i,
	name : "Automatic Rifle",
	source : ["D", 268],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [2, 8, "piercing"],
	range : "80/240 ft",
	weight : 8,
	description : "Ammunition, burst fire, reload (30 shots), two handed",
	abilitytodamage : true,
	ammo : "modern bullet"
};
WeaponsList["shotgun"] = {
	regExpSearch : /shotgun/i,
	name : "Shotgun",
	source : ["D", 268],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [2, 8, "piercing"],
	range : "30/90 ft",
	weight : 7,
	description : "Ammunition, reload (2 shots), two handed",
	abilitytodamage : true,
	ammo : "modern bullet"
};
WeaponsList["laser pistol"] = {
	regExpSearch : /^(?=.*laser)(?=.*pistol).*$/i,
	name : "Laser Pistol",
	source : ["D", 268],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [3, 6, "radiant"],
	range : "40/120 ft",
	weight : 2,
	description : "Ammunition, reload (50 shots), two handed",
	abilitytodamage : true,
	ammo : "energy cell"
};
WeaponsList["antimatter rifle"] = {
	regExpSearch : /^(?!.*laser)(?=.*antimatter)(?=.*rifle).*$/i,
	name : "Antimatter Rifle",
	source : ["D", 268],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [6, 8, "necrotic"],
	range : "120/360 ft",
	weight : 10,
	description : "Ammunition, reload (2 shots), two handed",
	abilitytodamage : true,
	ammo : "energy cell"
};
WeaponsList["laser rifle"] = {
	regExpSearch : /^(?!.*antimatter)(?=.*laser)(?=.*rifle).*$/i,
	name : "Laser Rifle",
	source : ["D", 268],
	list : "firearm",
	ability : 2,
	type : "Martial",
	damage : [3, 8, "radiant"],
	range : "100/300 ft",
	weight : 7,
	description : "Ammunition, reload (30 shots), two handed",
	abilitytodamage : true,
	ammo : "energy cell"
};
AmmoList["renaissance bullet"] = {
	name : "Bullets, Renaissance",
	source : ["D", 268],
	weight : 0.2,
	icon : "Bullets",
	checks : [".Bullet"],
	display : 50,
	invName : "Bullets, renaissance",
	alternatives : [/^(?=.*bullet)(?=.*renaissance).*$/i]
};
AmmoList["modern bullet"] = {
	name : "Bullets, Modern",
	source : ["D", 268],
	weight : 0.1,
	icon : "Bullets",
	checks : [".Bullet"],
	display : 50,
	invName : "Bullets, modern",
	alternatives : [/^(?=.*bullet)(?=.*modern).*$/i]
};
AmmoList["energy cell"] = {
	name : "Energy Cell",
	source : ["D", 268],
	weight : 0,
	icon : "Bullets",
	checks : [".Bullet"],
	display : 50,
	invName : "Energy Cell"
};

// Magic Items not found in the SRD
MagicItemsList["alchemy jug"] = {
	name : "Alchemy Jug",
	source : [["D", 150]],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "B",
	description : "As an action, command the jug to produce liquid; or an action to uncorked it and pour 2 gal/min. After producing, it only makes the same up to its max, until next dawn. Oil (1 qt), acid (8 fl oz), basic poison (1/2 fl oz), beer (4 gal), honey/wine (1 gal), fresh water (8 gal), mayonnaise/vinegar (2 gal), salt water (12 gal).",
	weight : 12,
	descriptionLong : "A heavy ceramic jug. As an action, the jug can be commanded to hold a chosen liquid. With another action, I can uncork the jug and pour the liquid out at 2 gallons per minute. Once commanded to produce a liquid, it can't produce a different one or more than the maximum of one, until the next dawn.\rLiquids (with maximum): acid (8 fl. oz.), basic poison (1/2 fl. oz.), beer (4 gallons), honey (1 gallon), mayonnaise (2 gallons), oil (1 quart), vinegar (2 gallons), fresh water (8 gallons), salt water (12 gallons), wine (1 gallon).",
	descriptionFull : "This ceramic jug appears to be able to hold a gallon of liquid and weighs 12 pounds whether full or empty. Sloshing sounds can be heard from within the jug when it is shaken, even if the jug is empty." + "\n   " + "You can use an action and name one liquid from the table below to cause the jug to produce the chosen liquid. Afterward, you can uncork the jug as an action and pour that liquid out, up to 2 gallons per minute. The maximum amount of liquid the jug can produce depends on the liquid you named." + "\n   " + "Once the jug starts producing a liquid, it can't produce a different one, or more of one that has reached its maximum, until the next dawn.\n\n" + toUni("Max\tLiquid\t\tMax\tLiquid") + "\n8 ounces\tAcid\t\t1 quart\tOil\n1/2 ounce\tBasic poison\t2 gallons\tVinegar\n4 gallons\tBeer\t\t8 gallons\tWater, fresh\n1 gallon\tHoney\t\t12 gallons\tWater, salt\n2 gallons\tMayonnaise\t1 gallon\tWine"
}
MagicItemsList["cap of water breathing"] = {
	name : "Cap of Water Breathing",
	source : ["D", 157],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "B",
	description : "While wearing this cap underwater, I can speak its command word as an action to create a bubble of air around my head. It allows me to breathe normally underwater. This bubble stays with me until I speak the command word again, the cap is removed, or I am no longer underwater.",
	descriptionFull : "While wearing this cap underwater, you can speak its command word as an action to create a bubble of air around your head. It allows you to breathe normally underwater. This bubble stays with you until you speak the command word again, the cap is removed, or you are no longer underwater.",
	action : [["action", ""]]
}
MagicItemsList["cloak of invisibility"] = {
	name : "Cloak of Invisibility",
	source : ["D", 158],
	type : "wondrous item",
	rarity : "legendary",
	magicItemTable : "I",
	description : "As an action, I can pull the hood of this cloak down or up over my head, making myself invisible (down) or visible again (up). While invisible, anything I carry or wear is invisible as well. It functions for 2 hours, usable in increments of 1 minute. It regains 1 hour of duration for every 12 hours not being used.",
	descriptionFull : "While wearing this cloak, you can pull its hood over your head to cause yourself to become invisible. While you are invisible, anything you are carrying or wearing is invisible with you. You become visible when you cease wearing the hood. Pulling the hood up or down requires an action.\n   Deduct the time you are invisible, in increments of 1 minute, from the cloak's maximum duration of 2 hours. After 2 hours of use, the cloak ceases to function. For every uninterrupted period of 12 hours the cloak goes unused, it regains 1 hour of duration.",
	attunement : true,
	action : [["action", " (hood up/down)"]],
	usages : "120 min",
	recovery : "Special",
	additional : "regain 1h/12h"
}
MagicItemsList["driftglobe"] = {
	name : "Driftglobe",
	source : ["D", 166],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : ["A", "B"],
	description : "By speaking its command word while within 60 ft, this glass sphere casts Light or Daylight on itself. Daylight only works once per dawn. While lit up, I can use an action to speak another command word to make it hover 5 ft off the ground and follow me at a distance of 60 ft. It stops hovering when grasped.",
	descriptionFull : "This small sphere of thick glass weighs 1 pound. If you are within 60 feet of it, you can speak its command word and cause it to emanate the Light or Daylight spell. Once used, the Daylight effect can't be used again until the next dawn.\n   You can speak another command word as an action to make the illuminated globe rise into the air and float no more than 5 feet off the ground. The globe hovers in this way until you or another creature grasps it. If you move more than 60 feet from the hovering globe, it follows you until it is within 60 feet of you. It takes the shortest route to do so. If prevented from moving, the globe sinks gently to the ground and becomes inactive, and its light winks out.",
	weight : 1,
	action : [["action", " (hover)"]],
	usages : 1,
	recovery : "dawn",
	additional : "Daylight",
	spellcastingBonus : [{
		name : "On globe",
		spells : ["light"],
		selection : ["light"],
		firstCol : "atwill"
	}, {
		name : "On globe",
		spells : ["daylight"],
		selection : ["daylight"],
		firstCol : "oncelr"
	}],
	spellChanges : {
		"light" : {
			range : "Globe",
			description : "Driftglobe sheds bright light in a 20-ft radius and dim light in an additional 20-ft radius",
			changes : "The spell can only affect the globe."
		},
		"daylight" : {
			range : "Globe",
			description : "Driftglobe shed 60-ft rad bright light + 60-ft dim light; only magical darkness of SL 4+ works in it",
			changes : "The spell can only affect the globe."
		}
	}
}
MagicItemsList["efreeti chain"] = {
	name : "Efreeti Chain",
	source : ["D", 167],
	type : "armor (chain mail)",
	rarity : "legendary",
	magicItemTable : "I",
	description : "While wearing this armor, I gain a +3 bonus to AC, I am immune to fire damage, and I can understand and speak Primordial. In addition, I can stand on and walk across molten rock as if it were solid ground.",
	descriptionFull : "While wearing this armor, you gain a +3 bonus to AC, you are immune to fire damage, and you can understand and speak Primordial. In addition, you can stand on and walk across molten rock as if it were solid ground.",
	attunement : true,
	weight : 55,
	languageProfs : ["Primordial"],
	savetxt : { immune : ["fire"] },
	armorAdd : "Efreeti Chain",
	armorOptions : [{
		regExpSearch : /^(?=.*efreeti)(?=.*chain).*$/i,
		name : "Efreeti Chain",
		source: ["D", 167],
		type : "heavy",
		ac : 19,
		stealthdis : true,
		weight : 55,
		strReq : 13
	}]
}
MagicItemsList["elixir of health"] = {
	name : "Elixir of Health",
	source : ["D", 168],
	type : "potion",
	rarity : "rare",
	magicItemTable : "C",
	description : "Once as an action, I can drink this potion or administer it to another to cure any disease, and removing the blinded, deafened, paralyzed, and poisoned conditions. The potion's clear red liquid has tiny bubbles of light in it.",
	descriptionFull : "When you drink this potion, it cures any disease afflicting you, and it removes the blinded, deafened, paralyzed, and poisoned conditions. The clear red liquid has tiny bubbles of light in it.",
	weight : 0.5
}
MagicItemsList["gloves of thievery"] = {
	name : "Gloves of Thievery",
	source : ["D", 172],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "These gloves are invisible while worn. While wearing them, I gain a +5 bonus to Dexterity (Sleight of Hand) checks and Dexterity checks made to pick locks.",
	descriptionFull : "These gloves are invisible while worn. While wearing them, you gain a +5 bonus to Dexterity (Sleight of Hand) checks and Dexterity checks made to pick locks.",
	addMod : [{ type: "skill", field : "Sleight of Hand", mod : 5, text : "I gain a +5 bonus to Dexterity (Sleight of Hand) checks while wearing Gloves of Thievery." }]
}
MagicItemsList["instrument of the bards"] = {
	name : "Instrument of the Bards",
	source : ["D", 176],
	type : "wondrous item",
	description : "If I play this exquisite, magical instruments while casting a spell that has a somatic or material component and charms on a failed save, it imposes disadvantage on that save. I can also use it to cast a set of spells, each once per dawn, using my spellcasting ability and spell save DC.",
	descriptionFull : "An instrument of the bards is an exquisite example of its kind, superior to an ordinary instrument in every way. Seven types of these instruments exist, each named after a legendary bard college. A creature that attempts to play the instrument without being attuned to it must succeed on a DC 15 Wisdom saving throw or take 2d4 psychic damage.\n   You can use an action to play the instrument and cast one of its spells. Once the instrument has been used to cast a spell, it can't be used to cast that spell again until the next dawn. The spells use your spellcasting ability and spell save DC.\n   You can play the instrument while casting a spell that causes any of its targets to be charmed on a failed saving throw, thereby imposing disadvantage on the save. This effect applies only if the spell has a somatic or a material component.\n   All instruments of the bards can be used to cast the following spells: Fly, Invisibility, Levitate, and Protection from Evil and Good.",
	attunement : true,
	weight : 3, // Magic of Faerûn (2001) page 161
	prerequisite : "Requires attunement by a bard",
	prereqeval : function(v) { return classes.known.bard ? true : false; },
	choices : ["Anstruth Harp (very rare)", "Canaith Mandolin (rare)", "Cli Lyre (rare)", "Doss Lute (uncommon)", "Fochlucan Bandore (uncommon)", "Mac-Fuirmidh Cittern (uncommon)", "Ollamh Harp (legendary)"],
	"anstruth harp (very rare)" : {
		name : "Anstruth Harp [Instrument of the Bards]",
		rarity : "very rare",
		magicItemTable : "H",
		descriptionFull : "An instrument of the bards is an exquisite example of its kind, superior to an ordinary instrument in every way. Seven types of these instruments exist, each named after a legendary bard college. A creature that attempts to play the instrument without being attuned to it must succeed on a DC 15 Wisdom saving throw or take 2d4 psychic damage.\n   You can use an action to play the instrument and cast one of its spells. Once the instrument has been used to cast a spell, it can't be used to cast that spell again until the next dawn. The spells use your spellcasting ability and spell save DC.\n   You can play the instrument while casting a spell that causes any of its targets to be charmed on a failed saving throw, thereby imposing disadvantage on the save. This effect applies only if the spell has a somatic or a material component.\n   All instruments of the bards can be used to cast the following spells: Fly, Invisibility, Levitate, and Protection from Evil and Good.\n   In addition, the Anstruth harp can be used to cast Control Weather, Cure Wounds (5th level), and Wall of Thorns.",
		spellcastingBonus : {
			name : "Once per long rest",
			spells : ["fly", "invisibility", "levitate", "protection from evil and good", "control weather", "cure wounds", "wall of thorns"],
			selection : ["fly", "invisibility", "levitate", "protection from evil and good", "control weather", "cure wounds", "wall of thorns"],
			firstCol : "oncelr",
			times : 7,
			spellcastingAbility : "class"
		},
		spellChanges : {
			"cure wounds" : {
				description : "1 living creature heals 5d8+spellcasting ability modifier HP",
				changes : "When using the Anstruth Harp to cast Cure Wounds, it is cast at 5th-level."
			},
			spellChanges : {
				"control weather" : {
					time : "1 a",
					changes : "Casting time is only an action."
				}
			}
		}
	},
	"canaith mandolin (rare)" : {
		name : "Canaith Mandolin [Instrument of the Bards]",
		rarity : "rare",
		magicItemTable : "G",
		descriptionFull : "An instrument of the bards is an exquisite example of its kind, superior to an ordinary instrument in every way. Seven types of these instruments exist, each named after a legendary bard college. A creature that attempts to play the instrument without being attuned to it must succeed on a DC 15 Wisdom saving throw or take 2d4 psychic damage.\n   You can use an action to play the instrument and cast one of its spells. Once the instrument has been used to cast a spell, it can't be used to cast that spell again until the next dawn. The spells use your spellcasting ability and spell save DC.\n   You can play the instrument while casting a spell that causes any of its targets to be charmed on a failed saving throw, thereby imposing disadvantage on the save. This effect applies only if the spell has a somatic or a material component.\n   All instruments of the bards can be used to cast the following spells: Fly, Invisibility, Levitate, and Protection from Evil and Good.\n   In addition, the Canaith mandolin can be used to cast Cure Wounds (3rd level), Dispel Magic, and Protection from Energy (lightning only).",
		spellcastingBonus : {
			name : "Once per long rest",
			spells : ["fly", "invisibility", "levitate", "protection from evil and good", "cure wounds", "dispel magic", "protection from energy"],
			selection : ["fly", "invisibility", "levitate", "protection from evil and good", "cure wounds", "dispel magic", "protection from energy"],
			firstCol : "oncelr",
			times : 7,
			spellcastingAbility : "class"
		},
		spellChanges : {
			"cure wounds" : {
				description : "1 living creature heals 3d8+spellcasting ability modifier HP",
				changes : "When using the Canaith Mandolin to cast Cure Wounds, it is cast at 3rd-level."
			},
			"protection from energy" : {
				description : "1 creature gains resistance to Lightning damage for the duration",
				changes : "When using the Canaith Mandolin to cast Protection from Energy, it can only grant resistance to lightning damage."
			}
		}
	},
	"cli lyre (rare)" : {
		name : "Cli Lyre [Instrument of the Bards]",
		rarity : "rare",
		magicItemTable : "G",
		descriptionFull : "An instrument of the bards is an exquisite example of its kind, superior to an ordinary instrument in every way. Seven types of these instruments exist, each named after a legendary bard college. A creature that attempts to play the instrument without being attuned to it must succeed on a DC 15 Wisdom saving throw or take 2d4 psychic damage.\n   You can use an action to play the instrument and cast one of its spells. Once the instrument has been used to cast a spell, it can't be used to cast that spell again until the next dawn. The spells use your spellcasting ability and spell save DC.\n   You can play the instrument while casting a spell that causes any of its targets to be charmed on a failed saving throw, thereby imposing disadvantage on the save. This effect applies only if the spell has a somatic or a material component.\n   All instruments of the bards can be used to cast the following spells: Fly, Invisibility, Levitate, and Protection from Evil and Good.\n   In addition, the Cli lyre can be used to cast Stone Shape, Wall of Fire, and Wind Wall.",
		spellcastingBonus : {
			name : "Once per long rest",
			spells : ["fly", "invisibility", "levitate", "protection from evil and good", "stone shape", "wall of fire", "wind wall"],
			selection : ["fly", "invisibility", "levitate", "protection from evil and good", "stone shape", "wall of fire", "wind wall"],
			firstCol : "oncelr",
			times : 7,
			spellcastingAbility : "class"
		}
	},
	"doss lute (uncommon)" : {
		name : "Doss Lute [Instrument of the Bards]",
		rarity : "uncommon",
		magicItemTable : "F",
		descriptionFull : "An instrument of the bards is an exquisite example of its kind, superior to an ordinary instrument in every way. Seven types of these instruments exist, each named after a legendary bard college. A creature that attempts to play the instrument without being attuned to it must succeed on a DC 15 Wisdom saving throw or take 2d4 psychic damage.\n   You can use an action to play the instrument and cast one of its spells. Once the instrument has been used to cast a spell, it can't be used to cast that spell again until the next dawn. The spells use your spellcasting ability and spell save DC.\n   You can play the instrument while casting a spell that causes any of its targets to be charmed on a failed saving throw, thereby imposing disadvantage on the save. This effect applies only if the spell has a somatic or a material component.\n   All instruments of the bards can be used to cast the following spells: Fly, Invisibility, Levitate, and Protection from Evil and Good.\n   In addition, the Doss lute can be used to cast Animal Friendship, Protection from Energy (fire only), and Protection from Poison.",
		spellcastingBonus : {
			name : "Once per long rest",
			spells : ["fly", "invisibility", "levitate", "protection from evil and good", "animal friendship", "protection from energy", "protection from poison"],
			selection : ["fly", "invisibility", "levitate", "protection from evil and good", "animal friendship", "protection from energy", "protection from poison"],
			firstCol : "oncelr",
			times : 7,
			spellcastingAbility : "class"
		},
		spellChanges : {
			"protection from energy" : {
				description : "1 creature gains resistance to Fire damage for the duration",
				changes : "When using the Doss Lute to cast Protection from Energy, it can only grant resistance to fire damage."
			}
		}
	},
	"fochlucan bandore (uncommon)" : {
		name : "Fochlucan Bandore [Instrument of the Bards]",
		rarity : "uncommon",
		magicItemTable : "F",
		descriptionFull : "An instrument of the bards is an exquisite example of its kind, superior to an ordinary instrument in every way. Seven types of these instruments exist, each named after a legendary bard college. A creature that attempts to play the instrument without being attuned to it must succeed on a DC 15 Wisdom saving throw or take 2d4 psychic damage.\n   You can use an action to play the instrument and cast one of its spells. Once the instrument has been used to cast a spell, it can't be used to cast that spell again until the next dawn. The spells use your spellcasting ability and spell save DC.\n   You can play the instrument while casting a spell that causes any of its targets to be charmed on a failed saving throw, thereby imposing disadvantage on the save. This effect applies only if the spell has a somatic or a material component.\n   All instruments of the bards can be used to cast the following spells: Fly, Invisibility, Levitate, and Protection from Evil and Good.\n   In addition, the Fochlucan bandore can be used to cast Entangle, Faerie Fire, Shillelagh, and Speak with Animals.",
		spellcastingBonus : {
			name : "Once per long rest",
			spells : ["fly", "invisibility", "levitate", "protection from evil and good", "entangle", "faerie fire", "shillelagh", "speak with animals"],
			selection : ["fly", "invisibility", "levitate", "protection from evil and good", "entangle", "faerie fire", "shillelagh", "speak with animals"],
			firstCol : "oncelr",
			times : 8,
			spellcastingAbility : "class"
		}
	},
	"mac-fuirmidh cittern (uncommon)" : {
		name : "Mac-Fuirmidh Cittern [Instrument of the Bards]",
		rarity : "uncommon",
		magicItemTable : "F",
		descriptionFull : "An instrument of the bards is an exquisite example of its kind, superior to an ordinary instrument in every way. Seven types of these instruments exist, each named after a legendary bard college. A creature that attempts to play the instrument without being attuned to it must succeed on a DC 15 Wisdom saving throw or take 2d4 psychic damage.\n   You can use an action to play the instrument and cast one of its spells. Once the instrument has been used to cast a spell, it can't be used to cast that spell again until the next dawn. The spells use your spellcasting ability and spell save DC.\n   You can play the instrument while casting a spell that causes any of its targets to be charmed on a failed saving throw, thereby imposing disadvantage on the save. This effect applies only if the spell has a somatic or a material component.\n   All instruments of the bards can be used to cast the following spells: Fly, Invisibility, Levitate, and Protection from Evil and Good.\n   In addition, the Mac-Fuirmidh cittern can be used to cast Barkskin, Cure Wounds, and Fog Cloud.",
		spellcastingBonus : {
			name : "Once per long rest",
			spells : ["fly", "invisibility", "levitate", "protection from evil and good", "barkskin", "cure wounds", "fog cloud"],
			selection : ["fly", "invisibility", "levitate", "protection from evil and good", "barkskin", "cure wounds", "fog cloud"],
			firstCol : "oncelr",
			times : 7,
			spellcastingAbility : "class"
		}
	},
	"ollamh harp (legendary)" : {
		name : "Ollamh Harp [Instrument of the Bards]",
		rarity : "legendary",
		magicItemTable : "I",
		descriptionFull : "An instrument of the bards is an exquisite example of its kind, superior to an ordinary instrument in every way. Seven types of these instruments exist, each named after a legendary bard college. A creature that attempts to play the instrument without being attuned to it must succeed on a DC 15 Wisdom saving throw or take 2d4 psychic damage.\n   You can use an action to play the instrument and cast one of its spells. Once the instrument has been used to cast a spell, it can't be used to cast that spell again until the next dawn. The spells use your spellcasting ability and spell save DC.\n   You can play the instrument while casting a spell that causes any of its targets to be charmed on a failed saving throw, thereby imposing disadvantage on the save. This effect applies only if the spell has a somatic or a material component.\n   All instruments of the bards can be used to cast the following spells: Fly, Invisibility, Levitate, and Protection from Evil and Good.\n   In addition, the Ollamh harp can be used to cast Confusion, Control Weather, and Fire Storm.",
		spellcastingBonus : {
			name : "Once per long rest",
			spells : ["fly", "invisibility", "levitate", "protection from evil and good", "confusion", "control weather", "fire storm"],
			selection : ["fly", "invisibility", "levitate", "protection from evil and good", "confusion", "control weather", "fire storm"],
			firstCol : "oncelr",
			times : 7,
			spellcastingAbility : "class"
		},
		spellChanges : {
			"control weather" : {
				time : "1 a",
				changes : "Casting time is only an action."
			}
		}
	}
}
MagicItemsList["mariner's armor"] = {
	name : "Mariner's Armor",
	nameTest : "Mariner's",
	source : ["D", 188],
	type : "armor (light, medium, or heavy)",
	rarity : "uncommon",
	magicItemTable : "B",
	description : "While wearing this armor, I have a swimming speed equal to my walking speed. In addition, whenever I start my turn underwater with 0 hit points, the armor causes me to rise 60 ft toward the surface. The armor is decorated with fish and shell motifs.",
	descriptionFull : "While wearing this armor, you have a swimming speed equal to your walking speed. In addition, whenever you start your turn underwater with 0 hit points, the armor causes you to rise 60 feet toward the surface. The armor is decorated with fish and shell motifs.",
	allowDuplicates : true,
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "suffix",
		descriptionChange : ["prefix", "armor"]
	},
	speed : { swim : { spd : "walk", enc : "walk" } }
}
MagicItemsList["potion of fire breath"] = {
	name : "Potion of Fire Breath",
	source : ["D", 187],
	type : "potion",
	rarity : "uncommon",
	magicItemTable : "B",
	description : "Once as an action, I can drink this potion or administer it to another to, for 1 hour, use a bonus action to do 4d6 fire damage at a target within 30 ft, Dex save DC 13 halves. This can be done 3 times. This potion's orange liquid flickers, and smoke fills the top of the container and wafts out whenever it is opened.",
	descriptionFull : "After drinking this potion, you can use a bonus action to exhale fire at a target within 30 feet of you. The target must make a DC 13 Dexterity saving throw, taking 4d6 fire damage on a failed save, or half as much damage on a successful one. The effect ends after you exhale the fire three times or when 1 hour has passed. This potion's orange liquid flickers, and smoke fills the top of the container and wafts out whenever it is opened.",
	weight : 0.5
}
MagicItemsList["potion of invulnerability"] = {
	name : "Potion of Invulnerability",
	source : ["D", 188],
	type : "potion",
	rarity : "rare",
	magicItemTable : "C",
	description : "Once as an action, I can drink this potion or administer it to another to have resistance to all damage for 1 minute. The potion's syrupy liquid looks like liquefied iron.",
	descriptionFull : "For 1 minute after you drink this potion, you have resistance to all damage. The potion's syrupy liquid looks like liquefied iron.",
	weight : 0.5
}
MagicItemsList["potion of longevity"] = {
	name : "Potion of Longevity",
	source : ["D", 188],
	type : "potion",
	rarity : "very rare",
	magicItemTable : "D",
	description : "Once as an action, I can drink this potion or administer it to another to reduce the consumer's physical age is by 1d6+6 years, to a minimum of 13 years. Subsequent consumptions of this type of potion have a 10% cumulative chance to instead age the consumer by 1d6+6 years.",
	descriptionLong : "Once as an action, I can drink this potion or administer it to another to reduce the consumer's physical age is by 1d6+6 years, to a minimum of 13 years. Subsequent consumptions of this type of potion have a 10% cumulative chance to instead age the consumer by 1d6+6 years. Suspended in this amber liquid are a scorpion's tail, an adder's fang, a dead spider, and a tiny heart that, against all reason, is still beating. These ingredients vanish when the potion is opened.",
	descriptionFull : "When you drink this potion, your physical age is reduced by 1d6+6 years, to a minimum of 13 years. Each time you subsequently drink a potion of longevity, there is 10 percent cumulative chance that you instead age by 1d6+6 years. Suspended in this amber liquid are a scorpion's tail, an adder's fang, a dead spider, and a tiny heart that, against all reason, is still beating. These ingredients vanish when the potion is opened.",
	weight : 0.5
}
MagicItemsList["potion of vitality"] = {
	name : "Potion of Vitality",
	source : ["D", 188],
	type : "potion",
	rarity : "very rare",
	magicItemTable : "D",
	description : "Once as an action, I can drink this potion or administer it to another to remove any exhaustion, disease, and poison affecting the consumer. For the next 24 hours, the consumer regains the maximum number of HP for any HD used. The potion's crimson liquid regularly pulses with dull light, calling to mind a heartbeat.",
	descriptionFull : "When you drink this potion, it removes any exhaustion you are suffering and cures any disease or poison affecting you. For the next 24 hours, you regain the maximum number of hit points for any Hit Die you spend. The potion's crimson liquid regularly pulses with dull light, calling to mind a heartbeat.",
	weight : 0.5
}
MagicItemsList["rod of resurrection"] = {
	name : "Rod of Resurrection",
	source : ["D", 197],
	type : "rod",
	rarity : "legendary",
	magicItemTable : "I",
	description : "This rod has 5 charges and regains 1 expended charge daily at dawn. While I hold it, I can use an action to expend 1 charge and cast Heal from it, or expend 5 charges and cast Resurrection from it. If the rod is reduced to 0 charges, roll a d20. On a 1, the rod disappears in a burst of radiance.",
	descriptionFull : "The rod has 5 charges. While you hold it, you can use an action to cast one of the following spells from it: Heal (expends 1 charge) or Resurrection (expends 5 charges).\n   The rod regains 1 expended charge daily at dawn. If the rod is reduced to 0 charges, roll a d20. On a 1, the rod disappears in a burst of radiance.",
	attunement : true,
	weight : 2,
	prerequisite : "Requires attunement by a cleric, druid, or paladin",
	prereqeval : function(v) { return classes.known.cleric || classes.known.druid || classes.known.paladin ? true : false; },
	usages : 5,
	recovery : "dawn",
	additional : "regains 1",
	spellFirstColTitle: "Ch",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["heal"],
		selection : ["heal"],
		firstCol : 1
	}, {
		name : "5 charges",
		spells : ["resurrection"],
		selection : ["resurrection"],
		firstCol : 5
	}],
	spellChanges : {
		"resurrection" : {
			time : "1 a",
			changes : "Casting time is only 1 action instead of 1 hour."
		}
	}
}
MagicItemsList["rod of the pact keeper, +1, +2, or +3"] = {
	name : "Rod of the Pact Keeper, +1, +2, or +3",
	source : ["D", 197],
	type : "rod",
	description : "While holding this rod, I gain a bonus to spell attack rolls and to the saving throw DCs of my warlock spells, determined by the rod's rarity: uncommon (+1), rare (+2), or very rare (+3). As an action once per long rest, I can regain one warlock spell slot while holding the rod.",
	descriptionFull : "While holding this rod, you gain a bonus to spell attack rolls and to the saving throw DCs of your warlock spells. The bonus is determined by the rod's rarity: uncommon (+1), rare (+2), or very rare (+3).\n   In addition, you can regain one warlock spell slot as an action while holding the rod. You can't use this property again until you finish a long rest.",
	attunement : true,
	weight : 2,
	prerequisite : "Requires attunement by a warlock",
	prereqeval : function(v) { return classes.known.warlock; },
	usages : 1,
	recovery : "long rest",
	limfeaname : "Rod of the Pact Keeper (warlock spell slot)",
	action : [["action", ""]],
	choices : ["+1 Rod (uncommon)", "+2 Rod (rare)", "+3 Rod (very rare)"],
	"+1 rod (uncommon)" : {
		name : "Rod of the Pact Keeper +1",
		rarity : "uncommon",
		magicItemTable : "F",
		description : "While holding this rod, I gain a +1 bonus to spell attack rolls and to the saving throw DCs of my warlock spells. As an action once per long rest, I can regain one warlock spell slot while holding the rod.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type != "prepare" && (/warlock/).test(spellcasters)) return 1;
				},
				"I gain a +1 bonus to spell attack rolls and to the saving throw DCs of my warlock spells."
			]
		}
	},
	"+2 rod (rare)" : {
		name : "Rod of the Pact Keeper +2",
		rarity : "rare",
		magicItemTable : "G",
		description : "While holding this rod, I gain a +2 bonus to spell attack rolls and to the saving throw DCs of my warlock spells. As an action once per long rest, I can regain one warlock spell slot while holding the rod.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type != "prepare" && (/warlock/).test(spellcasters)) return 2;
				},
				"I gain a +2 bonus to spell attack rolls and to the saving throw DCs of my warlock spells."
			]
		}
	},
	"+3 rod (very rare)" : {
		name : "Rod of the Pact Keeper +3",
		rarity : "very rare",
		magicItemTable : "H",
		description : "While holding this rod, I gain a +3 bonus to spell attack rolls and to the saving throw DCs of my warlock spells. As an action once per long rest, I can regain one warlock spell slot while holding the rod.",
		calcChanges : {
			spellCalc : [
				function (type, spellcasters, ability) {
					if (type != "prepare" && (/warlock/).test(spellcasters)) return 3;
				},
				"I gain a +3 bonus to spell attack rolls and to the saving throw DCs of my warlock spells."
			]
		}
	}
}
MagicItemsList["saddle of the cavalier"] = {
	name : "Saddle of the Cavalier",
	source : ["D", 199],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "B",
	description : "While in this saddle on a mount, I can't be dismounted against my will if I am conscious, and attack rolls against the mount have disadvantage.",
	descriptionFull : "While in this saddle on a mount, you can't be dismounted against your will if you're conscious, and attack rolls against the mount have disadvantage."
}
MagicItemsList["scroll of protection"] = {
	name : "Scroll of Protection",
	source : ["D", 199],
	type : "scroll",
	rarity : "rare",
	magicItemTable : "C",
	description : "Once as an action, I can use this to make a 5-ft radius, 10-ft high invisible barrier around myself for 5 min that moves with me and stops a creature type from entering or affecting anything within. As an action, a creature can make a DC 15 Cha check to stop being affected..",
	descriptionFull : "Each scroll of protection works against a specific type of creature chosen by the DM or determined randomly by rolling on the following table.\n\n" + [
		toUni("d100\tCreature Type\td100\tCreature Type"),
		"01-10\tAberrations\t41-50\tFey",
		"11-20\tBeasts\t\t51-75\tFiends",
		"21-30\tCelestials   \t76-80\tPlants",
		"31-40\tElementals\t81-00\tUndead",
	].join("\n") + "\nUsing an action to read the scroll encloses you in an invisible barrier that extends from you to form a 5-foot-radius, 10-foot-high cylinder. For 5 minutes, this barrier prevents creatures of the specified type from entering or affecting anything within the cylinder.\n   The cylinder moves with you and remains centered on you. However, if you move in such a way that an aberration would be inside the cylinder, the effect ends.\n   A creature can attempt to overcome the barrier by using an action to make a DC 15 Charisma check. On a success, the creature ceases to be affected by the barrier.",
	choices : ["Aberrations", "Beasts", "Celestials", "Elementals", "Fey", "Fiends", "Plants", "Undead"],
	"aberrations" : {
		name : "Scroll of Protection from Aberrations",
		description : "Once as an action, I can use this to make a 5-ft radius, 10-ft high invisible barrier around myself for 5 min that moves with me and stops aberrations from entering or affecting anything within. As an action, a creature can make a DC 15 Cha check to stop being affected. If I move so the barrier includes an aberration, it ends."
	},
	"beasts" : {
		name : "Scroll of Protection from Beasts",
		description : "Once as an action, I can use this to make a 5-ft radius, 10-ft high invisible barrier around myself for 5 minutes that moves with me and stops beasts from entering or affecting anything within. As an action, a creature can make a DC 15 Charisma check to stop being affected. If I move so the barrier includes a beast, it ends."
	},
	"celestials" : {
		name : "Scroll of Protection from Celestials",
		description : "Once as an action, I can use this to make a 5-ft radius, 10-ft high invisible barrier around myself for 5 min that moves with me and stops celestials from entering or affecting anything within. As an action, a creature can make a DC 15 Cha check to stop being affected. If I move so the barrier includes a celestial, it ends."
	},
	"elementals" : {
		name : "Scroll of Protection from Elementals",
		description : "Once as an action, I can use this to make a 5-ft radius, 10-ft high invisible barrier around myself for 5 min that moves with me and stops elementals from entering or affecting anything within. As an action, a creature can make a DC 15 Cha check to stop being affected. If I move so the barrier includes an elemental, it ends."
	},
	"fey" : {
		name : "Scroll of Protection from Fey",
		description : "Once as an action, I can use this to make a 5-ft radius, 10-ft high invisible barrier around myself for 5 minutes that moves with me and stops fey from entering or affecting anything within. As an action, a creature can make a DC 15 Charisma check to stop being affected. If I move so the barrier includes a fey, it ends."
	},
	"fiends" : {
		name : "Scroll of Protection from Fiends",
		description : "Once as an action, I can use this to make a 5-ft radius, 10-ft high invisible barrier around myself for 5 minutes that moves with me and stops fiends from entering or affecting anything within. As an action, a creature can make a DC 15 Charisma check to stop being affected. If I move so the barrier includes a fiend, it ends."
	},
	"plants" : {
		name : "Scroll of Protection from Plants",
		description : "Once as an action, I can use this to make a 5-ft radius, 10-ft high invisible barrier around myself for 5 minutes that moves with me and stops plants from entering or affecting anything within. As an action, a creature can make a DC 15 Charisma check to stop being affected. If I move so the barrier includes a plant, it ends."
	},
	"undead" : {
		name : "Scroll of Protection from Undead",
		description : "Once as an action, I can use this to make a 5-ft radius, 10-ft high invisible barrier around myself for 5 minutes that moves with me and stops undead from entering or affecting anything within. As an action, a creature can make a DC 15 Cha check to stop being affected. If I move so the barrier includes a undead, it ends."
	}
}
MagicItemsList["sending stones"] = {
	name : "Sending Stones",
	source : ["D", 199],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "C",
	description : "While I touch one of this pair of stones, I can use an action to cast Sending, targeting the bearer of the other stone. If no creature has the other stone, the spell won't cast. Once it is cast, neither stone can be used again until the next dawn. Sending allows each bearer to communicate up to 25 words.",
	descriptionFull : "Sending stones come in pairs, with each smooth stone carved to match the other so the pairing is easily recognized. While you touch one stone, you can use an action to cast the Sending spell from it. The target is the bearer of the other stone. If no creature bears the other stone, you know that fact as soon as you use the stone and don't cast the spell.\n   Once Sending is cast through the stones, they can't be used again until the next dawn. If one of the stones in a pair is destroyed, the other one becomes nonmagical.",
	spellcastingBonus : {
		name : "To other stone bearer only",
		spells : ["sending"],
		selection : ["sending"],
		firstCol : "oncelr"
	},
	usages : 1, 
	recovery : "dawn",
	spellChanges : {
		"sending" : {
			description : "Send a 25 word message to the bearer of the other Sending Stone, who can respond with 25 words",
			changes : "Using one stone of a pair of Sending Stones, the spell can only target the bearer of the other stone of the pair."
		}
	}
}
MagicItemsList["sentinel shield"] = {
	name : "Sentinel Shield",
	source : ["D", 199],
	type : "shield",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "While holding this shield, I have advantage on initiative rolls and Wisdom (Perception) checks. The shield is emblazoned with a symbol of an eye.",
	descriptionFull : "While holding this shield, you have advantage on initiative rolls and Wisdom (Perception) checks. The shield is emblazoned with a symbol of an eye.",
	weight : 6,
	shieldAdd : "Sentinel Shield",
	advantages : [["Initiative", true], ["Perception", true]],
	vision : [["Adv. on Perception checks", 0]]
}
MagicItemsList["staff of the adder"] = {
	name : "Staff of the Adder",
	source : ["D", 203],
	type : "staff",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "As a bonus action, I can speak this staff's command word to animate its snake head for 1 minute or make it inanimate again. While animated, I can use it in melee (1d6 piercing + DC 15 Con save or 3d6 poison), but it can be attacked and has AC 15 and 20 HP (full every time). If it reaches 0 HP, the staff is destroyed.",
	descriptionFull : "You can use a bonus action to speak this staff's command word and make the head of the staff become that of an animate poisonous snake for 1 minute. By using another bonus action to speak the command word again, you return the staff to its normal inanimate form.\n   You can make a melee attack using the snake head, which has a reach of 5 feet. Your proficiency bonus applies to the attack roll. On a hit, the target takes 1d6 piercing damage and must succeed on a DC 15 Constitution saving throw or take 3d6 poison damage.\n   The snake head can be attacked while it is animate. It has an Armor Class of 15 and 20 hit points. If the head drops to 0 hit points, the staff is destroyed. As long as it's not destroyed, the staff regains all lost hit points when it reverts to its inanimate form.",
	attunement : true,
	weight : 4,
	prerequisite : "Requires attunement by a cleric, druid, or warlock",
	prereqeval : function(v) { return classes.known.cleric || classes.known.druid || classes.known.warlock ? true : false; },
	action : [["bonus action", " (animate/end)"]],
	weaponsAdd : ["Animated Snake Head from Staff of the Adder"],
	weaponOptions : {
		regExpSearch : /^(?=.*snake)(?=.*head)(?=.*staff)(?=.*adder).*$/i,
		name : "Animated Snake Head from Staff of the Adder",
		source : ["D", 203],
		list : "melee",
		ability : 1,
		type : "Natural",
		damage : [1, 6, "piercing"],
		range : "Melee",
		weight : 4,
		description : "DC 15 Constitution save or 3d6 poison damage",
		abilitytodamage : false
	}
}
MagicItemsList["sword of answering"] = {
	name : "Sword of Answering",
	source : ["D", 206],
	type : "weapon (longsword)",
	rarity : "legendary",
	magicItemTable : "I",
	description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has a gem set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target.",
	descriptionFull : 'In the world of Greyhawk, only nine of these blades are known to exist. Each is patterned after the legendary sword Fragarach, which is variously translated as "Final Word." Each of the nine swords has its own name and alignment, and each bears a different gem in its pommel.\n   You gain a +3 bonus to attack and damage rolls made with this sword. In addition, while you hold the sword, you can use your reaction to make one melee attack with it against any creature in your reach that deals damage to you. You have advantage on the attack roll, and any damage dealt with this special attack ignores any damage immunity or resistance the target has.\n\n' + [
		toUni("Name\t\tAlignment\tGem"),
		"Answerer    \tChaotic good\tEmerald",
		"Back Talker\tChaotic evil\tJet",
		"Concluder    \tLawful neutral\tAmethyst",
		"Last Quip    \tChaotic neutral\tTourmaline",
		"Rebutter\t\tNeutral good\tTopaz",
		"Replier\t\tNeutral\t\tPeridot",
		"Retorter\t\tLawful good\tAquamarine",
		"Scather\t\tLawful evil\tGarnet",
		"Squelcher    \tNeutral evil\tSpinel"
	].join("\n"),
	attunement : true,
	weight : 3,
	action : [["reaction", ""]],
	weaponsAdd : ["Sword of Answering"],
	weaponOptions : {
		baseWeapon : "longsword",
		regExpSearch : /^(?=.*sword)(?=.*answering).*$/i,
		name : "Sword of Answering",
		source : ["D", 206],
		modifiers : [3, 3]
	},
	choices : ["Answerer (chaotic good)", "Back Talker (chaotic evil)", "Concluder (lawful neutral)", "Last Quip (chaotic neutral)", "Rebutter (neutral good)", "Replier (neutral)", "Retorter (lawful good)", "Scather (lawful evil)", "Squelcher (neutral evil)"],
	"answerer (chaotic good)" : {
		name : "Sword of Answering [Answerer]",
		prerequisite : "Requires attunement by a creature with the chaotic good alignment",
		prereqeval : function(v) { return (/^(?=.*chaotic)(?=.*good).*$/i).test(What("Alignment")); },
		description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has an emerald set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target."
	},
	"back talker (chaotic evil)" : {
		name : "Sword of Answering [Back Talker]",
		prerequisite : "Requires attunement by a creature with the chaotic evil alignment",
		prereqeval : function(v) { return (/^(?=.*chaotic)(?=.*evil).*$/i).test(What("Alignment")); },
		description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has jet set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target."
	},
	"concluder (lawful neutral)" : {
		name : "Sword of Answering [Concluder]",
		prerequisite : "Requires attunement by a creature with the lawful neutral alignment",
		prereqeval : function(v) { return (/^(?=.*lawful)(?=.*neutral).*$/i).test(What("Alignment")); },
		description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has an amethyst set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target."
	},
	"last quip (chaotic neutral)" : {
		name : "Sword of Answering [Last Quip]",
		prerequisite : "Requires attunement by a creature with the chaotic neutral alignment",
		prereqeval : function(v) { return (/^(?=.*chaotic)(?=.*neutral).*$/i).test(What("Alignment")); },
		description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has a tourmaline set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target."
	},
	"rebutter (neutral good)" : {
		name : "Sword of Answering [Rebutter]",
		prerequisite : "Requires attunement by a creature with the neutral good alignment",
		prereqeval : function(v) { return (/^(?=.*neutral)(?=.*good).*$/i).test(What("Alignment")); },
		description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has a topaz set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target."
	},
	"replier (neutral)" : {
		name : "Sword of Answering [Replier]",
		prerequisite : "Requires attunement by a creature with the neutral alignment",
		prereqeval : function(v) { return (/^(?=.*neutral)(?!.*(chaotic|lawful|evil|good)).*$/i).test(What("Alignment")); },
		description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has a peridot set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target."
	},
	"retorter (lawful good)" : {
		name : "Sword of Answering [Retorter]",
		prerequisite : "Requires attunement by a creature with the lawful good alignment",
		prereqeval : function(v) { return (/^(?=.*lawful)(?=.*good).*$/i).test(What("Alignment")); },
		description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has an aquamarine set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target."
	},
	"scather (lawful evil)" : {
		name : "Sword of Answering [Scather]",
		prerequisite : "Requires attunement by a creature with the lawful evil alignment",
		prereqeval : function(v) { return (/^(?=.*lawful)(?=.*evil).*$/i).test(What("Alignment")); },
		description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has a garnet set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target."
	},
	"squelcher (neutral evil)" : {
		name : "Sword of Answering [Squelcher]",
		prerequisite : "Requires attunement by a creature with the neutral evil alignment",
		prereqeval : function(v) { return (/^(?=.*neutral)(?=.*evil).*$/i).test(What("Alignment")); },
		description : "I gain a +3 bonus to attack and damage rolls made with this magical longsword that has a spinel set in its pommel. As a reaction when a creature within my reach damages me, I can make one melee attack with this sword with advantage. This attack ignores damage immunities and resistances of the target."
	}
}
MagicItemsList["sword of vengeance"] = {
	name : "Sword of Vengeance",
	nameTest : "of Vengeance",
	source : [["D", 206]],
	type : "weapon (any sword)",
	rarity : "uncommon",
	magicItemTable : "F",
	attunement : true,
	description : "This sword gives +1 to hit and damage and is cursed. I can't part with this sword and have disadv. on attacks with other weapons. If I take damage in combat, I must make a DC 15 Wis save or I will attack the attacker until it drops to 0 HP or I can't attack it in melee anymore.",
	descriptionFull : "You gain a +1 bonus to attack and damage rolls made with this magic weapon.\n   " + toUni("Curse") + ". This sword is cursed and possessed by a vengeful spirit. Becoming attuned to it extends the curse to you. As long as you remain cursed, you are unwilling to part with the sword, keeping it on your person at all times. While attuned to this weapon, you have disadvantage on attack rolls made with weapons other than this one.\n   In addition, while the sword is on your person, you must succeed on a DC 15 Wisdom saving throw whenever you take damage in combat. On a failed save you must attack the creature that damaged you until you drop to 0 hit points or it does, or until you can't reach the creature to make a melee attack against it.\n   You can break the curse in the usual ways. Alternatively, casting banishment on the sword forces the vengeful spirit to leave it. The sword then becomes a +1 weapon with no other properties.",
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "prefix",
		descriptionChange : ["replace", "sword"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /sword|scimitar|rapier/i;
			return !(testRegex).test(inObjKey) && (!inObj.baseWeapon || !(testRegex).test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/of vengeance/i).test(v.WeaponText)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + 'Cursed';
				}
			},
			'If I include the words "of Vengeance" in the name of a sword, it will be treated as the magic weapon Sword of Vengeance. It has +1 to hit and damage, but also bears a curse.'
		],
		atkCalc : [
			function (fields, v, output) {
				if (v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/of vengeance/i).test(v.WeaponText)) {
					output.magic = v.thisWeapon[1] + 1;
				}
			}, ''
		]
	}
}
MagicItemsList["tentacle rod"] = {
	name : "Tentacle Rod",
	source : ["D", 208],
	type : "rod",
	rarity : "rare",
	magicItemTable : "G",
	description : "As an action, all 3 tentacles of this rod attack with 15 ft reach, +9 to hit, dealing 1d6 bludgeoning damage. If a target is hit by all 3 it must make a DC 15 Con save or have half speed, disadv. on Dex saves, no reactions, and do action or bonus action, not both, for 1 min. It can repeat the save at the end of each of its turns.",
	descriptionLong : "As an action while holding the rod, I can direct each of its three tentacles to attack a creature I can see within 15 ft. Each tentacle makes a melee attack roll, +9 to hit, dealing 1d6 bludgeoning damage. If a target is hit by all three tentacles, it must make a DC 15 Constitution saving throw. On a failure, the creature's speed is halved, it has disadvantage on Dexterity saving throws, and it can't use reactions for 1 minute. Moreover, on each of its turns, it can take either an action or a bonus action, but not both. At the end of each of its turns, it can repeat the saving throw, ending the effect on itself on a success.",
	descriptionFull : "Made by the drow, this rod is a magic weapon that ends in three rubbery tentacles. While holding the rod, you can use an action to direct each tentacle to attack a creature you can see within 15 feet of you. Each tentacle makes a melee attack roll with a +9 bonus. On a hit, the tentacle deals 1d6 bludgeoning damage. If you hit a target with all three tentacles, it must make a DC 15 Constitution saving throw. On a failure, the creature's speed is halved, it has disadvantage on Dexterity saving throws, and it can't use reactions for 1 minute. Moreover, on each of its turns, it can take either an action or a bonus action, but not both. At the end of each of its turns, it can repeat the saving throw, ending the effect on itself on a success.",
	attunement : true,
	weight : 2,
	action : [["action", ""]],
	weaponOptions : {
		regExpSearch : /^(?=.*tentacle)(?=.*rod).*$/i,
		name : "Tentacle Rod",
		source : ["D", 208],
		ability : 0,
		type : "Magic Item",
		damage : [1, 6, "bludgeoning"],
		range : "Melee (15 ft)",
		description : "Action to use, 3 attacks; If all 3 hit same target, it DC 15 Con save, see magic item",
		abilitytodamage : false,
		modifiers : [9, ""],
		weight : 2
	}
}
MagicItemsList["tome of the stilled tongue"] = {
	name : "Tome of the Stilled Tongue",
	source : ["D", 208],
	type : "wondrous item",
	rarity : "legendary",
	magicItemTable : "I",
	description : "I can use this thick leather-bound tome as a spellbook and an arcane focus. Once per dawn while holding it, I can use a bonus action to cast a spell I have written in it, without expending a spell slot or using any verbal or somatic components. Removing the tongue on the cover erases all spells within.",
	descriptionLong : "The first few pages of this thick leather-bound tome are filled with indecipherable scrawls. The remaining pages are blank and pristine. I can use it as a spellbook and an arcane focus. Once per dawn while holding it, I can use a bonus action to cast a spell I have written in the tome, without expending a spell slot or using any verbal or somatic components. While attuned to the book, I can remove the tongue from the book's cover, permanently erasing all spells within. Vecna watches the user or this tome and sometimes has cryptic messages appear in it at midnight and fade away after they are read.",
	descriptionFull : "This thick leather-bound volume has a desiccated tongue pinned to the front cover. Five of these tomes exist, and it's unknown which one is the original. The grisly cover decoration on the first tome of the stilled tongue once belonged to a treacherous former servant of the lich-god Vecna, keeper of secrets. The tongues pinned to the covers of the four copies came from other spellcasters who crossed Vecna. The first few pages of each tome are filled with indecipherable scrawls. The remaining pages are blank and pristine.\n   If you can attune to this item, you can use it as a spellbook and an arcane focus. In addition, while holding the tome, you can use a bonus action to cast a spell you have written in this tome, without expending a spell slot or using any verbal or somatic components. Once used, this property of the tome can't be used again until the next dawn.\n   While attuned to the book, you can remove the tongue from the book's cover. If you do so, all spells written in the book are permanently erased.\n   Vecna watches anyone using this tome. He can also write cryptic messages in the book. These messages appear at midnight and fade away after they are read.",
	attunement : true,
	weight : 5,
	prerequisite : "Requires attunement by a wizard",
	prereqeval : function(v) { return classes.known.wizard ? true : false; },
	action : [["bonus action", ""]],
	usages : 1,
	recovery : "dawn"
}
MagicItemsList["weapon of warning"] = {
	name : "Weapon of Warning",
	nameTest : "of Warning",
	source : ["D", 213],
	type : "weapon (any)",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "While this magic weapon is on my person, I have advantage on initiative rolls. In addition, both me and my allies within 30 ft of me can't be surprised and the weapon magically awakens us when combat starts, except those incapacitated by something other than nonmagical sleep.",
	descriptionFull : "This magic weapon warns you of danger. While the weapon is on your person, you have advantage on initiative rolls. In addition, you and any of your companions within 30 feet of you can't be surprised, except when incapacitated by something other than nonmagical sleep. The weapon magically awakens you and your companions within range if any of you are sleeping naturally when combat begins.",
	attunement : true,
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "prefix",
		descriptionChange : ["replace", "weapon"]
	},
	advantages : [["Initiative", true]],
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && !v.isSpell && (/warning/i).test(v.WeaponText)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
				}
			},
			'If I include the word "Warning" in the name of a weapon, it will be treated as the magic weapon Weapon of Warning.'
		]
	}
}

// Sentient Items
var blackrazorFullDescription = [
	"Hidden in the dungeon of White Plume Mountain, Blackrazor shines like a piece of night sky filled with stars. Its black scabbard is decorated with pieces of cut obsidian.",
	"You gain a +3 bonus to attack and damage rolls made with this magic weapon. It has the following additional properties.",
	">>Devour Soul<<. Whenever you use it to reduce a creature to 0 hit points, the sword slays the creature devours its soul, unless it is a construct or an undead. A creature whose soul has been devoured by Blackrazor can be restored to life only by a Wish spell.",
	"When it devours a soul, Blackrazor grants you temporary hit points equal to the slain creature's hit point maximum. These hit points fade after 24 hours. As long as these temporary hit points last and you keep Blackrazor in hand, you have advantage on attack rolls, saving throws, and ability checks.",
	"If you hit an undead with this weapon, you take 1d10 necrotic damage and the target regains 1d10 hit points. If this necrotic damage reduces you to 0 hit points, Blackrazor devours your soul.",
	">>Soul Hunter<<. While you hold the weapon, you are aware of the presence of Tiny or larger creatures within 60 feet of you that aren't constructs or undead. You also can't be charmed or frightened.",
	"Blackrazor can cast the Haste spell on you once per day. It decides when to cast the spell and maintains concentration on it so that you don't have to.",
	">>Sentience<<. Blackrazor is a sentient chaotic neutral weapon with an Intelligence of 17, a Wisdom of 10, and a Charisma of 19. It has hearing and darkvision out to a range of 120 feet.",
	"The weapon can speak, read, and understand Common, and can communicate with its wielder telepathically. Its voice is deep and echoing. While you are attuned to it, Blackrazor also understands every language you know.",
	">>Personality<<. Blackrazor speaks with an imperious tone, as though accustomed to being obeyed.",
	"The sword's purpose is to consume souls. It doesn't care whose souls it eats, including the wielder's. The sword believes that all matter and energy sprang from a void of negative energy and will one day return to it. Blackrazor is meant to hurry that process along.",
	"Despite its nihilism, Blackrazor feels a strange kinship to Wave and Whelm, two other weapons locked away under White Plume Mountain. It wants the three weapons to be united again and wielded together in combat, even though it violently disagrees with Whelm and finds Wave tedious.",
	"Blackrazor's hunger for souls must be regularly fed. If the sword goes three days or more without consuming a soul, a conflict between it and its wielder occurs at the next sunset."
];
MagicItemsList["blackrazor"] = {
	name : "Blackrazor",
	source : ["D", 216],
	type : "weapon (greatsword)",
	rarity : "legendary",
	notLegalAL : true,
	description : "This sentient greatsword adds +3 to hit and damage and makes me immune to being charmed or frightened. Once per day it can cast Haste on me as it sees fit. If I use it to bring a creature to 0 HP, it devours the creature's soul, granting me temporary HP equal to the creature's max HP for 24 hours. See Notes page.",
	descriptionFull : blackrazorFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	attunement : true,
	prerequisite : "Requires attunement by a creature of non-lawful alignment",
	prereqeval : function(v) { return !(/lawful/i).test(What("Alignment")); },
	action : [["bonus action", ""]],
	weight : 6,
	weaponsAdd : ["Blackrazor"],
	weaponOptions : {
		baseWeapon : "greatsword",
		regExpSearch : /blackrazor/i,
		name : "Blackrazor",
		source : ["D", 216],
		description : "Heavy, two-handed; Devours soul; Heals undead",
		modifiers : [3,3]
	},
	toNotesPage : [{
		name : "Features",
		popupName : "Features of Blackrazor",
		note : desc(blackrazorFullDescription).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/you are /ig, "I am ").replace(/(of|on|reduces|grants) you/ig, "$1 me").replace(/you /ig, "I ") + "\n\n" + sentientItemConflictTxt
	}],
	savetxt : { immune : ["charmed", "frightened"] },
	usages : 1,
	recovery : "day",
	additional : "Haste",
	spellcastingBonus : [{
		name: "Once per day",
		spells: ["haste"],
		selection: ["haste"],
		firstCol : "oncelr"
	}],
	spellChanges : {
		"command" : {
			range : "Self",
			duration : "1 min",
			description : "I get +2 AC, speed doubled, adv. on Dex saves, extra action (1 attack, dash, disengage, hide)",
			changes : "Blackrazor casts the spell on me, so I don't need to concentrate on it."
		}
	}
}
var waveFullDescription = [
	"Held in the dungeon of White Plume Mountain, this trident is an exquisite weapon engraved with images of waves, shells, and sea creatures. Although you must worship a god of the sea to attune to this weapon, Wave happily accepts new converts.",
	"You gain a +3 bonus to attack and damage rolls made with this magic weapon. If you score a critical hit with it, the target takes extra necrotic damage equal to half its hit point maximum.",
	"The weapon also functions as a trident of fish command and a weapon of warning. It can confer the benefit of a cap of water breathing while you hold it, and you can use it as a cube of force by choosing the effect, instead of pressing cube sides to select it.",
	">>Sentience<<. Wave is a sentient weapon of neutral alignment, with an Intelligence of 14, a Wisdom of 10, and a Charisma of 18. It has hearing and darkvision out to a range of 120 feet.",
	"The weapon communicates telepathically with its wielder and can speak, read, and understand Aquan. It can also speak with aquatic animals as if using a Speak with Animals spell, using telepathy to involve its wielder in the conversation.",
	">>Personality<<. When it grows restless, Wave has a habit of humming tunes that vary from sea chanteys to sacred hymns of the sea gods.",
	"Wave zealously desires to convert mortals to the worship of one or more sea gods, or else to consign the faithless to death. Conflict arises if the wielder fails to further the weapon's objectives in the world. The trident has a nostalgic attachment to the place where it was forged, a desolate island called Thunderforge. A sea god imprisoned a family of storm giants there, and the giants forged Wave in an act of devotion to\u2014or rebellion against\u2014that god.",
	"Wave harbors a secret doubt about its own nature and purpose. For all its devotion to the sea gods, Wave fears that it was intended to bring about a particular sea god's demise. This destiny is something Wave might not be able to avert."
];
MagicItemsList["wave"] = {
	name : "Wave",
	source : ["D", 218],
	type : "weapon (trident)",
	rarity : "legendary",
	notLegalAL : true,
	description : "This sentient trident adds +3 to hit and damage and if I score a critical hit with it, the target takes extra necrotic damage equal to half its max HP. It also functions as a trident of fish command, a weapon of warning, cap of water breathing while I hold it, and I can use it as a cube of force. See Notes page.",
	descriptionFull : waveFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	attunement : true,
	prerequisite : "Requires attunement by a creature that worships a god of the sea",
	prereqeval : function(v) { return (/deep sashelas|sekolah|ulutiu|umberlee|valkur|poseidon|neptune|aegir|nehalennia|njord/i).test(What("Faith/Deity")); },
	weight : 4,
	weaponsAdd : ["Wave"],
	weaponOptions : {
		baseWeapon : "trident",
		regExpSearch : /wave/i,
		name : "Wave",
		source : ["D", 218],
		description : "Thrown, versatile (1d8); On crit: necrotic damage equal to half target max HP",
		modifiers : [3,3]
	},
	toNotesPage : [{
		name : "Features",
		popupName : "Features of Wave",
		note : desc(waveFullDescription).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/you/ig, "I") + "\n\n" + sentientItemConflictTxt
	}, {
		name : "Contained Items",
		popupName : "Descriptions of magic items contained in Wave",
		note : [
			"\n\n\u2022 Trident of Fish Command (SRD 247, DMG 209)\n   " + MagicItemsList["trident of fish command"].description,
			"\u2022 Weapon of Warning (DMG 213)\n   " + MagicItemsList["weapon of warning"].description,
			"\u2022 Cap of Water Breathing (DMG 157)\n   " + MagicItemsList["cap of water breathing"].description,
			"\u2022 Cube of Force (SRD 215, DMG 159)" + desc(MagicItemsList["cube of force"].toNotesPage[0].note)
		].join("\n\n")
	}],
	// cube of force & cap of water breathing
	action : [["action", " (Cap of Water Breathing)"], ["action", " (Cube of Force)"]],
	extraLimitedFeatures : [{
		name : "Wave [Cube of Force] (regains 1d20)",
		usages : 36,
		recovery : "dawn"
	}, {
	// trident of fish command
		name : "Wave [Fish Command] (regains 1d3)",
		usages : 3,
		recovery : "dawn"
	}],
	fixedDC : 15,
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["dominate beast"],
		selection : ["dominate beast"],
		firstCol : 1
	},
	spellChanges : {
		"dominate beast" : {
			description : "1 beast with swim speed save or charmed, follows telepathic commands, 1 a for complete control",
			changes : "Can only affect beasts with innate swim speed."
		}
	},
	// weapon of warning
	advantages : [["Initiative", true]]
}
var whelmFullDescription = [
	"Whelm is a powerful warhammer forged by dwarves and lost in the dungeon of White Plume Mountain.",
	"You gain a +3 bonus to attack and damage rolls made with this magic weapon. At dawn the day after you first make an attack roll with Whelm, you develop a fear of being outdoors that persists as long as you remain attuned to the weapon. This causes you to have disadvantage on attack rolls, saving throws, and ability checks while you can see the daytime sky.",
	">>Thrown Weapon<<. Whelm has the thrown property, with a normal range of 20 feet and a long range of 60 feet. When you hit with a ranged weapon attack using it, the target takes an extra 1d8 bludgeoning damage, or an extra 2d8 bludgeoning damage if the target is a giant. Each time you throw the weapon, it flies back to your hand after the attack. If you don't have a hand free, the weapon lands at your feet.",
	">>Shock Wave<<. You can use an action to strike the ground with Whelm and send a shock wave out from the point of impact. Each creature of your choice on the ground within 60 feet of that point must succeed on a DC 15 Constitution saving throw or become stunned for 1 minute. A creature can repeat the saving throw at the end of each of its turns, ending the effect on itself on a success. Once used, this property can't be used again until the next dawn.",
	">>Supernatural Awareness<<. While you are holding the weapon, it alerts you to the location of any secret or concealed doors within 30 feet of you. In addition, you can use an action to cast Detect Evil and Good or Locate Object from the weapon. Once you cast either spell, you can't cast it from the weapon again until the next dawn.",
	">>Sentience<<. Whelm is a sentient lawful neutral weapon with an Intelligence of 15, a Wisdom of 12, and a Charisma of 15. It has hearing and darkvision out to a range of 120 feet.",
	"The weapon communicates telepathically with its wielder and can speak, read, and understand Dwarvish. Giant, and Goblin. It shouts battle cries in Dwarvish when used in combat.",
	">>Personality<<. Whelm's purpose is to slaughter giants and goblinoids. It also seeks to protect dwarves against all enemies. Conflict arises if the wielder fails to destroy goblins and giants or to protect dwarves. Whelm has ties to the dwarf clan that created it, variously called the Dankil or the Mightyhammer clan. It longs to be returned to that clan. It would do anything to protect those dwarves from harm. The hammer also carries a secret shame. Centuries ago, a dwarf named Ctenmiir wielded it valiantly for a time. But Ctenmiir was turned into a vampire. His will was strong enough that he bent Whelm to his evil purposes, even killing members of his own clan."
];
MagicItemsList["whelm"] = {
	name : "Whelm",
	source : ["D", 218],
	type : "weapon (warhammer)",
	rarity : "legendary",
	notLegalAL : true,
	description : "This sentient warhammer adds +3 to hit and damage, has the thrown property, deals extra damage when thrown, and returns to my hand when thrown. I can use it to create a shock wave. It makes me afraid of the outdoors, so while I can see the daytime sky, I have disadv. on attacks, saves, and checks. See Notes page.",
	descriptionFull : whelmFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	attunement : true,
	prerequisite : "Requires attunement by a dwarf",
	prereqeval : function(v) { return CurrentRace.known.indexOf('dwarf') !== -1; },
	weight : 2,
	weaponsAdd : ["Whelm"],
	weaponOptions : {
		baseWeapon : "warhammer",
		regExpSearch : /whelm/i,
		name : "Whelm",
		source : ["D", 218],
		range : "Melee, 20/60 ft",
		description : "Versatile (1d10), thrown; Returning; +1d8 damage when thrown (+2d8 vs. giants)",
		modifiers : [3,3]
	},
	toNotesPage : [{
		name : "Features",
		popupName : "Features of Whelm",
		note : desc(whelmFullDescription).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/you are /ig, "I am ").replace(/(of|on|causes|alerts) you/ig, "$1 me").replace(/you /ig, "I ") + "\n\n" + sentientItemConflictTxt
	}],
	action : [["action", " (Shock Wave)"]],
	extraLimitedFeatures : [{
		name : "Whelm [Shock Wave]",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Whelm [Detect Evil and Good]",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Whelm [Locate Object]",
		usages : 1,
		recovery : "dawn"
	}],
	vision : [["Know location of secret doors", 30]],
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["detect evil and good", "locate object"],
		selection : ["detect evil and good", "locate object"],
		firstCol : "oncelr"
	}
}
var iFileName = "pub_20150407_PotA.js";
RequiredSheetVersion(13);
// This file adds the magic items from the Princes of the Apocalypse adventure to MPMB's Character Record Sheet

// Define the source
SourceList["PotA"] = {
	name : "Princes of the Apocalypse [items]",
	abbreviation : "PotA",
	group : "Adventure Books",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/princes-apocalypse",
	date : "2015/04/07"
};

// Magic Items
MagicItemsList["balloon pack"] = {
	name : "Balloon Pack",
	source : ["PotA", 222],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "C",
	description : "As an action, I can deploy the balloon to gain the effects of Levitate for 10 minutes. As a reaction, I can deploy the balloon to gain the effects of Feather Fall. After either effect ends, I descend slowly for 60 ft as it deflates. Once used in either way, the backpack is useless until recharged in an air node for 1 hour.",
	descriptionFull : "This backpack contains the spirit of an air elemental and a compact leather balloon. While you're wearing the backpack, you can deploy the balloon as an action and gain the effect of the Levitate spell for 10 minutes, targeting yourself and requiring no concentration. Alternatively, you can use a reaction to deploy the balloon when you're falling and gain the effect of the Feather Fall spell for yourself.\n   When either spell ends, the balloon slowly deflates as the elemental spirit escapes and returns to the Elemental Plane of Air. As the balloon deflates, you descend gently toward the ground for up to 60 feet. If you are still in the air at the end of this distance, you fall if you have no other means of staying aloft.\n   After the spirit departs, the backpack's property is unusable unless the backpack is recharged for 1 hour in an elemental air node, which binds another spirit to the backpack.",
	weight : 5, // as backpack
	usages : 1,
	recovery : "Air Node",
	additional : "recharge: 1 h in air node",
	action : [["action", " (Levitate)"], ["reaction", " (Feather Fall)"]],
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["feather fall", "levitate"],
		selection : ["feather fall", "levitate"],
		firstCol : 1,
		times : 2
	},
	spellChanges : {
		"feather fall" : {
			range : "Self",
			description : "I descent only 60 ft/rnd for duration or until landed, taking no falling damage",
			changes : "Using the Balloon Pack, I can only target myself."
		},
		"levitate" : {
			range : "Self",
			duration : "10 min",
			save : "",
			description : "I rise vertically, up to 20 ft; move up/down 20 ft instead of normal move",
			changes : "Using the Balloon Pack, I can only target myself, but the spell requires no concentration."
		}
	}
}
MagicItemsList["bottled breath"] = {
	name : "Bottled Breath",
	source : ["PotA", 222],
	type : "potion",
	rarity : "uncommon",
	magicItemTable : "C",
	description : "Once as an action, I can inhale this breath of elemental air or administer it to another. The target then either exhale it or hold it in. If exhaled immediately, it produces the effects of Gust of Wind. Holding it in removes the need to breathe for 1 hour, though this benefit can end early, by speaking for example.",
	descriptionFull : "This bottle contains a breath of elemental air. When you inhale it, you either exhale it or hold it.\n   If you exhale the breath, you gain the effect of the Gust of Wind spell. If you hold the breath, you don't need to breathe for 1 hour, though you can end this benefit early (for example, to speak). Ending it early doesn't give you the benefit of exhaling the breath.",
	weight : 0.5
}
MagicItemsList["claws of the umber hulk"] = {
	name : "Claws of the Umber Hulk",
	source : ["PotA", 222],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "F",
	description : "These brown iron gauntlets, shaped like umber hulk claws, cover my hands up to my elbows. While wearing both, I can tunnel 1 ft per round through solid rock and have a burrowing speed of 20 ft, but can't manipulate items or use somatic spell components. I can use them as melee weapons, dealing 1d8 slashing damage.",
	descriptionFull : "These heavy gauntlets of brown iron are forged in the shape of an umber hulk's claws, and they fit the wearer's hands and forearms all the way up to the elbow. While wearing both claws, you gain a burrowing speed of 20 feet, and you can tunnel through solid rock at a rate of 1 foot per round.\n   You can use a claw as a melee weapon while wearing it. You have proficiency with it, and it deals 1d8 slashing damage on a hit (your Strength modifier applies to the attack and damage rolls, as normal).\n   While wearing the claws, you can't manipulate objects or cast spells with somatic components.",
	weight : 1,
	attunement : true,
	speed : { burrow : { spd : "fixed20", enc : "fixed10" } },
	weaponsAdd : ["Claws of the Umber Hulk"],
	weaponOptions : {
		regExpSearch : /^(?=.*claws)(?=.*umber)(?=.*hulk).*$/i,
		name : "Claws of the Umber Hulk",
		source : ["PotA", 222],
		ability : 1,
		type : "Natural",
		damage : [1, 8, "slashing"],
		range : "Melee",
		description : "",
		abilitytodamage : true
	}
}
var tempDevastationOrbNoteTxt = [
	"A devastation orb is an elemental bomb that can be created at the site of an elemental node by performing a ritual with an elemental weapon. The type of orb created depends on the node used. For example, an air node creates a devastation orb of air. The ritual takes 1 hour to complete and requires 2,000 gp worth of special components, which are consumed.\n   A devastation orb measures 12 inches in diameter, weighs 10 pounds, and has a solid outer shell. The orb detonates 1d100 hours after its creation, releasing the elemental energy it contains. The orb gives no outward sign of how much time remains before it will detonate. Spells such as Identify and Divination can be used to ascertain when the orb will explode. An orb has AC 10, 15 hit points, and immunity to poison and psychic damage. Reducing it to 0 hit points causes it to explode instantly.\n   A special container can be crafted to contain a devastation orb and prevent it from detonating. The container must be inscribed with symbols of the orb's opposing element. For example, a case inscribed with earth symbols can be used to contain a devastation orb of air and keep it from detonating. While in the container, the orb thrums. If it is removed from the container after the time when it was supposed to detonate, it explodes 1d6 rounds later, unless it is returned to the container.\n   Regardless of the type of orb, its effect is contained within a sphere with a 1 mile radius. The orb is the sphere's point of origin. The orb is destroyed after one use.",
	desc([
		"This elemental bomb can be created at the site of an elemental node of tELEMENT by performing a ritual with an elemental weapon. The ritual takes 1 hour to complete and requires 2,000 gp worth of special components, which are consumed.",
		"A devastation orb measures 12 inches in diameter, weighs 10 pounds, and has a solid outer shell. The orb detonates 1d100 hours after its creation, releasing the elemental energy it contains. The orb gives no outward sign of how much time remains before it will detonate. Spells such as Identify and Divination can be used to ascertain when the orb will explode. An orb has AC 10, 15 hit points, and immunity to poison and psychic damage. Reducing it to 0 hit points causes it to explode instantly.",
		"A special container inscribed with symbols of oELEMENT can be crafted to contain a devastation orb of tELEMENT and prevent it from detonating. While in the container, the orb thrums. If it is removed from the container after the time when it was supposed to detonate, it explodes 1d6 rounds later, unless it is returned to the container."
	])
];
MagicItemsList["devastation orb"] = {
	name : "Devastation Orb",
	source : ["PotA", 222],
	type : "wondrous item",
	rarity : "very rare",
	magicItemTable : "G",
	description : "This 12 inch diameter orb has AC 10, 15 HP, and is immune to poison and psychic damage. it explodes 1d100 hours after its creation or when reduced to 0 HP. When detonated, it creates an effect in a 1-mile radius around it.",
	descriptionFull : tempDevastationOrbNoteTxt[0],
	weight : 10,
	allowDuplicates : true,
	choices : ["Air", "Earth", "Fire", "Water"],
	"air" : {
		name : "Devastation Orb of Air",
		description : "This 12 inch diameter orb has AC 10, 15 HP, and is immune to poison and psychic damage. it explodes 1d100 hours after its creation or when reduced to 0 HP. When detonated, it creates a powerful windstorm in 1 mile around it for 1 hour. Everything exposed to the wind is damage by it. See Notes page.",
		descriptionFull : tempDevastationOrbNoteTxt[0] + "\n   " + toUni("Air Orb") + ". When this orb detonates, it creates a powerful windstorm that lasts for 1 hour. Whenever a creature ends its turn exposed to the wind, the creature must succeed on a DC 18 Constitution saving throw or take 1d4 bludgeoning damage, as the wind and debris batter it. The wind is strong enough to uproot weak trees and destroy light structures after at least 10 minutes of exposure. Otherwise, the rules for strong wind apply, as detailed in chapter 5 of the Dungeon Master's Guide.",
		toNotesPage : [{
			name : "Features",
			popupName : "Features of the Devastation Orb of Air",
			note : tempDevastationOrbNoteTxt[1].replace(/tELEMENT/g, "air").replace(/oElement/g, "earth") + "\n  When this orb detonates, it creates a powerful windstorm within a sphere with a 1 mile radius that lasts for 1 hour. Whenever a creature ends its turn exposed to the wind, the creature must succeed on a DC 18 Constitution saving throw or take 1d4 bludgeoning damage, as the wind and debris batter it. The wind is strong enough to uproot weak trees and destroy light structures after at least 10 minutes of exposure. Otherwise, the rules for strong wind apply. A strong wind imposes disadvantage on ranged weapon attack rolls and Wisdom (Perception) checks that rely on hearing. A strong wind also extinguishes open flames, disperses fog, and makes flying by nonmagical means nearly impossible. A flying creature in a strong wind must land at the end of its turn or fall. A strong wind in a desert can create a sandstorm that imposes disadvantage on Wisdom (Perception) checks that rely on sight."
		}]
	},
	"earth" : {
		name : "Devastation Orb of Earth",
		description : "This 12 inch diameter orb has AC 10, 15 HP, and is immune to poison and psychic damage. it explodes 1d100 hours after its creation or when reduced to 0 HP. When detonated, it creates the effect of an Earthquake spell in 1 mile around it for 1 minute. See Notes page.",
		descriptionFull : tempDevastationOrbNoteTxt[0] + "\n   " + toUni("Earth Orb") + ". When this orb detonates, it subjects the area to the effects of the Earthquake spell for 1 minute (spell save DC 18). For the purpose of the spell's effects, the spell is cast on the turn that the orb explodes.",
		toNotesPage : [{
			name : "Features",
			popupName : "Features of the Devastation Orb of Earth",
			note : tempDevastationOrbNoteTxt[1].replace(/tELEMENT/g, "earth").replace(/oElement/g, "air") + desc([
				"When this orb detonates, it subjects the area to the effects of the Earthquake spell for 1 minute (spell save DC 18). For the purpose of the spell's effects, the spell is cast on the turn that the orb explodes.",
				"The Earthquake spell creates a seismic disturbance that shakes creatures and structures in contact with the ground in that area. The ground in the area becomes difficult terrain. Each creature on the ground that is concentrating must make a Constitution saving throw. On a failed save, the creature's concentration is broken.",
				"At the end of each turn this goes on, each creature on the ground in the area must make a Dexterity saving throw. On a failed save, the creature is knocked prone.",
				"This spell can have additional effects depending on the terrain in the area, as determined by the DM.",
				"\u2022 Fissures. Fissures open throughout the spell's area at the start of the turn after the orb detonates. A total of 1d6 such fissures open in locations chosen by the DM. Each is 1d10 \u00D7 10 ft deep, 10 ft wide, and extends from one edge of the area to the opposite side. A creature standing on a spot where a fissure opens must succeed on a Dexterity saving throw or fall in. A creature that successfully saves moves with the fissure's edge as it opens. A fissure that opens beneath a structure causes it to automatically collapse (see below).",
				"\u2022 Structures. The tremor deals 50 bludgeoning damage to any structure in contact with the ground in the area when the orb detonates and at the start of each of turns for the duration. If a structure drops to 0 hit points, it collapses and potentially damages nearby creatures. A creature within half the distance of a structure's height must make a Dexterity saving throw. On a failed save, the creature takes 5d6 bludgeoning damage, is knocked prone, and is buried in the rubble, requiring a DC 20 Strength (Athletics) check as an action to escape. The DM can adjust the DC higher or lower, depending on the nature of the rubble. On a successful save, the creature takes half as much damage and doesn't fall prone or become buried."
			])
		}]
	},
	"fire" : {
		name : "Devastation Orb of Fire",
		description : "This 12 inch diameter orb has AC 10, 15 HP, and is immune to poison and psychic damage. it explodes 1d100 hours after its creation or when reduced to 0 HP. When detonated, it creates a dry heat wave in 1 mile around it for 24 hours. There is extreme heat within the area and wildfires can appear within, see Notes.",
		descriptionFull : tempDevastationOrbNoteTxt[0] + "\n   " + toUni("Fire Orb") + ". When this orb detonates, it creates a dry heat wave that lasts for 24 hours. Within the area of effect, the rules for extreme heat apply, as detailed in chapter 5 of the Dungeon Master's Guide. At the end of each hour, there is a ten percent chance that the heat wave starts a wildfire in a random location within the area of effect. The wildfire covers a 10-foot-square area initially but expands to fill another 10-foot square each round until the fire is extinguished or burns itself out. A creature that comes within 10 feet of a wildfire for the first time on a turn or starts its turn there takes 3d6 fire damage.",
		toNotesPage : [{
			name : "Features",
			popupName : "Features of the Devastation Orb of Fire",
			note : tempDevastationOrbNoteTxt[1].replace(/tELEMENT/g, "fire").replace(/oElement/g, "water") + "\n  When this orb detonates, it creates a dry heat wave within a 1-mile radius sphere that lasts for 24 hours. At the end of each hour, there is a ten percent chance that the heat wave starts a wildfire in a random location within the area of effect. The wildfire covers a 10-foot-square area initially but expands to fill another 10-foot square each round until the fire is extinguished or burns itself out. A creature that comes within 10 feet of a wildfire for the first time on a turn or starts its turn there takes 3d6 fire damage.\n   Within the area of effect, the rules for extreme heat apply, as the temperature is above 100 \u00B0F. Any creature exposed to the heat and without access to drinkable water must succeed on a Constitution saving throw at the end of each hour or gain one level of exhaustion. The DC is 5 for the first hour and increases by 1 for each additional hour. Creatures wearing medium or heavy armor, or who are clad in heavy clothing, have disadvantage on the saving throw. Creatures with resistance or immunity to fire damage automatically succeed on the saving throw, as do creatures naturally adapted to hot climates."
		}]
	},
	"water" : {
		name : "Devastation Orb of Water",
		description : "This 12 inch diameter orb has AC 10, 15 HP, and is immune to poison and psychic damage. it explodes 1d100 hours after its creation or when reduced to 0 HP. When detonated, it creates torrential rainstorm in 1 mile around it for 24 hours. If bodies of water exist in the area, they rise 10 ft and flood. See Notes page.",
		descriptionFull : tempDevastationOrbNoteTxt[0] + "\n   " + toUni("Water Orb") + ". When this orb detonates, it creates a torrential rainstorm that lasts for 24 hours. Within the area of effect, the rules for heavy precipitation apply, as detailed in chapter 5 of the Dungeon Master's Guide. If there is a substantial body of water in the area, it floods after 2d10 hours of heavy rain, rising 10 feet above its banks and inundating the surrounding area. The flood advances at a rate of 100 feet per round, moving away from the body of water where it began until it reaches the edge of the area of effect: at that point, the water flows downhill (and possibly recedes back to its origin). Light structures collapse and wash away. Any Large or smaller creature caught in the flood's path is swept away. The flooding destroys crops and might trigger mudslides, depending on the terrain.",
		toNotesPage : [{
			name : "Features",
			popupName : "Features of the Devastation Orb of Water",
			note : tempDevastationOrbNoteTxt[1].replace(/tELEMENT/g, "water").replace(/oElement/g, "fire") + "\n  When this orb detonates, it creates a torrential rainstorm in a 1-mile radius sphere that lasts for 24 hours. If there is a substantial body of water in the area, it floods after 2d10 hours of heavy rain, rising 10 feet above its banks and inundating the surrounding area. The flood advances at a rate of 100 feet per round, moving away from the body of water where it began until it reaches the edge of the area of effect: at that point, the water flows downhill (and possibly recedes back to its origin). Light structures collapse and wash away. Any Large or smaller creature caught in the flood's path is swept away. The flooding destroys crops and might trigger mudslides, depending on the terrain.\n   Within the area of effect, the rules for heavy precipitation apply. Everything is lightly obscured, and creatures in the area have disadvantage on Wisdom (Perception) checks that rely on sight. Heavy rain also extinguishes open flames and imposes disadvantage on Wisdom (Perception) checks that rely on hearing."
		}]
	}
}
MagicItemsList["drown"] = {
	name : "Drown",
	source : ["PotA", 224],
	type : "weapon (trident)",
	rarity : "legendary",
	storyItemAL : true,
	description : "This trident has a +1 bonus on to hit and damage and deals +1d8 cold damage. It allows me to speak Aquan, grants me resistance to cold damage, and allows me to cast Dominate Monster on a water elemental once per dawn. It gives me a flaw, see Notes page.",
	descriptionFull : "A steel trident decorated with bronze barnacles along the upper part of its haft, Drown has a sea-green jewel just below the tines and a silver shell at the end of its haft. It floats on the surface if dropped onto water, and it floats in place if it is released underwater. The trident is always cool to the touch, and it is immune to any damage due to exposure to water. Drown contains a spark of Olhydra, the Princess of Evil Water.\n   You gain a +1 bonus to attack and damage rolls made with this magic weapon. When you hit with it, the targets take an extra 1d8 cold damage.\n   " + toUni("Water Mastery") + ". You gain the following benefits while you hold Drown:\n \u2022 You can speak Aquan fluently.\n \u2022 You have resistance to cold damage.\n \u2022 You can cast Dominate Monster (save DC 17) on a water elemental. Once you have done so, Drown can't be used this way again until the next dawn.\n\n" + toUni("Tears of Endless Anguish") + ". While inside a water node, you can perform a ritual called the Tears of Endless Anguish, using Drown to create a devastation orb of water. Once you perform the ritual, Drown can't be used to perform the ritual again until the next dawn.\n   " + toUni("Flaw") + ". Drown makes its wielder covetous. While attuned to the weapon, you gain the following flaw: \"I demand and deserve the largest share of the spoils, and I refuse to part with anything that's mine.\" In addition, if you are attuned to Drown for 24 consecutive hours, barnacles form on your skin. The barnacles can be removed with a Greater Restoration spell or similar magic, but not while you are attuned to the weapon.",
	attunement : true,
	weight : 4,
	languageProfs : ["Aquan"],
	dmgres : ["Cold"],
	usages : 1,
	recovery : "dawn",
	fixedDC : 17,
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["dominate monster"],
		selection : ["dominate monster"],
		firstCol : "oncelr"
	},
	spellChanges : {
		"dominate monster" : {
			description : "Water elemental save or charmed, follows telepathic commands, 1 a for complete control; save on dmg",
			changes : "Can only affect a water elemental."
		}
	},
	weaponsAdd : ["Drown"],
	weaponOptions : {
		baseWeapon : "trident",
		regExpSearch : /drown/i,
		name : "Drown",
		source : ["PotA", 224],
		description : "Thrown, versatile (1d8); +1d8 cold damage",
		modifiers : [1,1]
	},
	toNotesPage : [{
		name : "Features",
		popupName : "Features of Drown",
		note : [
			"A steel trident decorated with bronze barnacles along the upper part of its haft, Drown has a sea-green jewel just below the tines and a silver shell at the end of its haft. It floats on the surface if dropped onto water, and it floats in place if it is released underwater. The trident is always cool to the touch, and it is immune to any damage due to exposure to water. Drown contains a spark of Olhydra, the Princess of Evil Water.",
			"I gain a +1 bonus to attack and damage rolls made with this magic weapon. When I hit with it, the targets take an extra 1d8 cold damage.",
			"While holding Drown, I can speak Aquan fluently, have resistance to cold damage, I can cast Dominate Monster (save DC 17) on a water elemental once per dawn.",
			"While inside a water node, I can perform a ritual called the Tears of Endless Anguish, using Drown to create a Devastation Orb of Water. The ritual takes 1 hour to complete and requires 2,000 gp worth of special components, which are consumed. Once I perform the ritual, Drown can't be used to perform the ritual again until the next dawn.",
			"Drown makes me covetous. While attuned to the weapon, I gain the following flaw: \"I demand and deserve the largest share of the spoils, and I refuse to part with anything that's mine.\" In addition, if I am attuned to Drown for 24 consecutive hours, barnacles form on my skin. The barnacles can be removed with a Greater Restoration spell or similar magic, but not while I am attuned to the weapon."
		]
	}]
}
MagicItemsList["ironfang"] = {
	name : "Ironfang",
	source : ["PotA", 224],
	type : "weapon (war pick)",
	rarity : "legendary",
	storyItemAL : true,
	description : "This war pick has a +2 bonus on to hit and damage and deals +1d8 thunder damage. It allows me to speak Terran, grants me resistance to cold damage, tremorsense 60 ft, allows me to cast Dominate Monster on an earth elemental once per dawn, and to cast Shatter using 1 of its 3 charges and more, see Notes page.",
	descriptionFull : "A war pick forged from a single piece of iron, Ironfang has a fang-like head inscribed with ancient runes. The pick is heavy in the hand, but when the wielder swings the pick in anger, the weapon seems almost weightless. This weapon is immune to any form of rust, acid, or corrosion\u2014nothing seems to mark it. Ironfang contains a spark of Ogr\xE9moch, the Prince of Evil Earth.\n   You gain a +2 bonus to attack and damage rolls made with this magic weapon. When you hit with it, the target takes an extra 1d8 thunder damage.\n   " + toUni("Earth Mastery") + ". You gain the following benefits while you hold Ironfang:\n \u2022 You can speak Terran fluently.\n \u2022 You have resistance to acid damage.\n \u2022 You have tremorsense out to a range of 60 feet.\n \u2022 You can sense the presence of precious metals and stones within 60 feet of you, but not their exact location.\n \u2022 You can cast Dominate Monster (save DC 17) on an earth elemental. Once you have done so, Ironfang can't be used this way again until the next dawn.\n\n" + toUni("Shatter") + ". Ironfang has 3 charges. You can use your action to expend 1 charge and cast the 2nd-level version of Shatter (DC 17). Ironfang regains 1d3 expended charges daily at dawn.\n   " + toUni("The Rumbling") + ". While inside an earth node, you can perform a ritual called the Rumbling, using Ironfang to create a devastation orb of earth. Once you perform the ritual, Ironfang can't be used to perform the ritual again until the next dawn.\n   " + toUni("Flaw") + ". Ironfang heightens its wielder's destructive nature. While attuned to the weapon, you gain the following flaw: \"I like to break things and cause ruin.\"",
	attunement : true,
	weight : 2,
	languageProfs : ["Terran"],
	dmgres : ["Acid"],
	usages : 1,
	recovery : "dawn",
	fixedDC : 17,
	spellFirstColTitle : "Ch",
	extraLimitedFeatures : [{
		name : "Ironfang [Dominate Monster]",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Ironfang [Shatter] (regains 1d3)",
		usages : 3,
		recovery : "dawn",
	}],
	spellcastingBonus : [{
		name : "Once per dawn",
		spells : ["dominate monster"],
		selection : ["dominate monster"],
		firstCol : "oncelr"
	}, {
		name : "1 charge",
		spells : ["shatter"],
		selection : ["shatter"],
		firstCol : 1
	}],
	spellChanges : {
		"dominate monster" : {
			description : "Earth elemental save or charmed, follows telepathic commands, 1 a for complete control; save on dmg",
			changes : "Can only affect an earth elemental."
		},
		"shatter" : {
			description : "10-ft rad all 4d8 Thunder dmg; save halves; nonmagical unattended objects also take dmg",
			changes : "Cast as if using a 2nd-level spell slot."
		}
	},
	vision : [["Tremorsense", "fixed 60"]],
	weaponsAdd : ["Ironfang"],
	weaponOptions : {
		baseWeapon : "war pick",
		regExpSearch : /ironfang/i,
		name : "Ironfang",
		source : ["PotA", 224],
		description : "+1d8 thunder damage",
		modifiers : [2,2]
	},
	toNotesPage : [{
		name : "Features",
		popupName : "Features of Ironfang",
		note : [
			"A war pick forged from a single piece of iron, Ironfang has a fang-like head inscribed with ancient runes. The pick is heavy in the hand, but when the wielder swings the pick in anger, the weapon seems almost weightless. This weapon is immune to any form of rust, acid, or corrosion\u2014nothing seems to mark it. Ironfang contains a spark of Ogr\xE9moch, the Prince of Evil Earth.",
			"I gain a +2 bonus to attack and damage rolls made with this magic weapon. When I hit with it, the target takes an extra 1d8 thunder damage.",
			"While holding Ironfang, I can speak Terran fluently, have resistance to acid damage, have tremorsense out to a range of 60 ft, can sense the presence of precious metals and stones within 60 ft of me, but not their exact location, and can cast Dominate Monster (save DC 17) on an earth elemental once per dawn.",
			"Ironfang has 3 charges and regains 1d3 expended charges daily at dawn. I can use your action to expend 1 charge and cast the 2nd-level version of Shatter (DC 17).",
			"While inside an earth node, I can perform a ritual called the Rumbling, using Ironfang to create a Devastation Orb of Earth. The ritual takes 1 hour to complete and requires 2,000 gp worth of special components, which are consumed. Once I perform the ritual, Ironfang can't be used to perform the ritual again until the next dawn.",
			'Ironfang heightens my destructive nature. While attuned to the weapon, I gain the following flaw: "I like to break things and cause ruin."'
		]
	}]
}
MagicItemsList["lost crown of besilmer"] = {
	name : "Lost Crown of Besilmer",
	source : ["PotA", 223],
	type : "wondrous item",
	rarity : "legendary",
	storyItemAL : true,
	description : "This dwarven battle-helm gives me psychic resistance and adv. on saves against being charmed. It has 3 charges, regaining 1d3 at dawn. As a bonus action, I can use 1 charge to inspire an ally in 60 ft that I can see and that can see and hear me. Once before my next turn ends, it can add a d6 to one check, attack, or save.",
	descriptionFull : "This dwarven battle-helm consists of a sturdy open-faced steel helmet, decorated with a golden circlet above the brow from which seven small gold spikes project upward. You gain the following benefits while wearing the crown:\n \u2022 You have resistance to psychic damage.\n \u2022 You have advantage on saving throws against effects that would charm you.\n \u2022 You can use a bonus action to inspire one creature you can see that is within 60 feet of you and that can see or hear you. Once before the end of your next turn, the inspired creature can roll a d6 and add the number rolled to one ability check, attack roll, or saving throw it makes. This uses 1 charge from the crown. It has 3 charges, and it regains 1d3 expended charges daily at dawn.",
	attunement : true,
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	action : [["bonus action", " (inspire)"]],
	dmgres : ["Psychic"],
	savetxt : { adv_vs : ["charmed"] }
}
MagicItemsList["orcsplitter"] = {
	name : "Orcsplitter",
	source : ["PotA", 224],
	type : "weapon (greataxe)",
	rarity : "legendary",
	magicItemTable : "G",
	prerequisite : "Requires attunement by a good-aligned dwarf, fighter, or paladin",
	description : "This sentient greataxe has a +2 bonus on to hit and damage. If I roll a 20 on an attack vs. an orc with it, the orc must make a DC 17 Con save or be reduced to 0 HP. While I'm not incapacitated, I can't be surprised by orcs, and me and my allies in 30 ft can't be frightened. I can sense orcs within 120 ft. See Notes page.",
	descriptionFull : "A mighty axe wielded long ago by the dwarf king Torhild Flametongue, Orcsplitter is a battered weapon that appears unremarkable at first glance. Its head is graven with the Dwarvish runes for \"orc,\" but the runes are depicted with a gap or slash through the markings; the word \"orc\" is literally split in two.\n   You gain the following benefits while holding this magic weapon:\n \u2022 You gain a +2 bonus to attack and damage rolls made with it.\n \u2022 When you roll a 20 on an attack roll with this weapon against an orc, that orc must succeed on a DC 17 Constitution saving throw or drop to 0 hit points.\n \u2022 You can't be surprised by orcs while you're not incapacitated. You are also aware when orcs are within 120 feet of you and aren't behind total cover, although you don't know their location.\n \u2022 You and any of your friends within 30 feet of you can't be frightened while you're not incapacitated.\n\n" + toUni("Sentience") + ". Orcsplitter is a sentient, lawful good weapon with an Intelligence of 6, a Wisdom of 15, and a Charisma of 10. It can see and hear out to 120 feet and has darkvision. It communicates by transmitting emotions to its wielder, although on rare occasions it uses a limited form of telepathy to bring to the wielder's mind a couplet or stanza of ancient Dwarvish verse.\n   " + toUni("Personality") + ". Orcsplitter is grim, taciturn, and inflexible. It knows little more than the desire to face orcs in battle and serve a courageous, just wielder. It disdains cowards and any form of duplicity, deception, or disloyalty. The weapon's purpose is to defend dwarves and to serve as a symbol of dwarven resolve. It hates the traditional foes of dwarves\u2014giants, goblins, and, most of all, orcs\u2014and silently urges its possessor to meet such creatures in battle.",
	attunement : true,
	weight : 7,
	weaponsAdd : ["Orcsplitter"],
	weaponOptions : {
		baseWeapon : "greataxe",
		regExpSearch : /orcsplitter/i,
		name : "Orcsplitter",
		source : ["PotA", 224],
		description : "Heavy, two-handed; On 20 vs. Orc: it DC 17 Con save or 0 HP",
		modifiers : [2,2]
	},
	savetxt : { immune : ["frightened"] },
	toNotesPage : [{
		name : "Features",
		popupName : "Features of Orcsplitter",
		note : desc([
			'A mighty axe wielded long ago by the dwarf king Torhild Flametongue, Orcsplitter is a battered weapon that appears unremarkable at first glance. Its head is graven with the Dwarvish runes for "orc," but the runes are depicted with a gap or slash through the markings; the word "orc" is literally split in two.',
			"I gain a +2 bonus to attack and damage rolls made with it. When I roll a 20 on an attack roll with this weapon against an orc, that orc must succeed on a DC 17 Constitution saving throw or drop to 0 hit points.",
			"While I am not incapacitated, I can't be surprised by orcs and I am aware when orcs are within 120 ft of meand aren't behind total cover, although I don't know their location. Also, me and any of my friends within 30 ft of can't be frightened while I am not incapacitated.",
			"Orcsplitter is a sentient, lawful good weapon with an Intelligence of 6, a Wisdom of 15, and a Charisma of 10. It can see and hear out to 120 feet and has darkvision. It communicates by transmitting emotions to its wielder, although on rare occasions it uses a limited form of telepathy to bring to the wielder's mind a couplet or stanza of ancient Dwarvish verse.",
			"Orcsplitter is grim, taciturn, and inflexible. It knows little more than the desire to face orcs in battle and serve a courageous, just wielder. It disdains cowards and any form of duplicity, deception, or disloyalty. The weapon's purpose is to defend dwarves and to serve as a symbol of dwarven resolve. It hates the traditional foes of dwarves\u2014giants, goblins, and, most of all, orcs\u2014and silently urges its possessor to meet such creatures in battle."
		]) + "\n\n" + sentientItemConflictTxt
	}]
}
MagicItemsList["reszur"] = {
	name : "Reszur",
	source : ["PotA", 157],
	type : "weapon (dagger)",
	rarity : "uncommon",
	description : "I have a +1 bonus to attack and damage rolls made with this dagger. It doesn't make noise when it hits or cuts something. If I speaks the name \"Reszur\", which is engraved on its pommel, the blade gives off a faint, cold glow, shedding dim light in a 10-foot radius until I speak the name again.",
	descriptionFull : "You have a +1 bonus to attack and damage rolls made with this weapon, which doesn't make noise when it hits or cuts something.\n   The name \"Reszur\" is graven on the dagger's pommel. If the wielder speaks the name, the blade gives off a faint, cold glow, shedding dim light in a 10-foot radius until the wielder speaks the name again.",
	weight : 1,
	weaponsAdd : ["Dragontooth Dagger"],
	weaponOptions : {
		baseWeapon : "dagger",
		regExpSearch : /reszur/i,
		name : "Reszur",
		source : ["PotA", 157],
		description : "Finesse, light, thrown; Doesn't make any noise",
		modifiers : [1,1]
	}
}
MagicItemsList["seeker dart"] = {
	name : "Seeker Dart",
	source : ["PotA", 223],
	type : "weapon (dart)",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "Once as an action, when I whisper \"seek\" and hurl this dart, it seeks out a target of my choice within 120 ft that I have seen at least once. If the target isn't within range or there is no clear path to it, the dart's magic is spent. Else, the target must make a DC 16 Dex save or take 1d4 piercing and 3d4 lightning damage.",
	descriptionFull : "This small dart is decorated with designs like windy spirals that span the length of its shaft.\n   When you whisper the word \"seek\" and hurl this dart, it seeks out a target of your choice within 120 feet of you. You must have seen the target before, but you don't need to see it now. If the target isn't within range or if there is no clear path to it, the dart falls to the ground, its magic spent and wasted. Otherwise, elemental winds guide the dart instantly through the air to the target. The dart can pass though openings as narrow as 1 inch wide and can change direction to fly around corners.\n   When the dart reaches its target, the target must succeed on a DC 16 Dexterity saving throw or take 1d4 piercing damage and 3d4 lightning damage. The dart's magic is then spent, and it becomes an ordinary dart.",
	weight : 0.25
}
MagicItemsList["storm boomerang"] = {
	name : "Storm Boomerang",
	source : ["PotA", 223],
	type : "weapon (javelin)",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "This ranged weapon has 60/120 ft range, deals 1d4 bludgeoning and 3d4 thunder damage, and its target must make a DC 10 Con save or be stunned until its next turn ends. On a miss, it returns to the thrower's hand. Once it deals thunder damage, it can't do so or stun again until recharged in an air node for 1 hour.",
	descriptionFull : "This boomerang is a ranged weapon carved from griffon bone and etched with the symbol of elemental air. When thrown, it has a range of 60/120 feet, and any creature that is proficient with the javelin is also proficient with this weapon. On a hit, the boomerang deals 1d4 bludgeoning damage and 3d4 thunder damage, and the target must succeed on a DC 10 Constitution saving throw or be stunned until the end of its next turn. On a miss, the boomerang returns to the thrower's hand.\n   Once the boomerang deals thunder damage to a target, the weapon loses its ability to deal thunder damage and its ability to stun a target. These properties return after the boomerang spends at least 1 hour inside an elemental air node.",
	weaponsAdd : ["Storm Boomerang"],
	weaponOptions : {
		baseWeapon : "javelin",
		name : "Storm Boomerang",
		regExpSearch : /^(?=.*storm)(?=.*boomerang).*$/i,
		list : "melee",
		ability : 2,
		damage : [1, 4, "bludgeoning"],
		range : "60/120 ft",
		weight : 2,
		description : "Returns on a miss; Once: +3d4 thunder damage, target DC 10 Con save or stunned 1 turn"
	},
	usages : 1,
	recovery : "Air Node",
	additional : "recharge: 1 h in air node"
}
MagicItemsList["tinderstrike"] = {
	name : "Tinderstrike",
	source : ["PotA", 225],
	type : "weapon (dagger)",
	rarity : "legendary",
	storyItemAL : true,
	description : "This flint dagger has a +2 bonus on to hit and damage and deals +2d6 fire damage. It allows me to speak Ignan, grants me resistance to fire damage, and allows me to cast Dominate Monster on a fire elemental once per dawn. It gives me a flaw, see Notes page.",
	descriptionFull : "A flint dagger, Tinderstrike is uncommonly sharp, and sparks cascade off its edge whenever it strikes something solid. Its handle is always warm to the touch, and the blade smolders for 1d4 minutes after it is used to deal damage. It contains a spark of Imix, Prince of Evil Fire.\n   You gain a +2 bonus to attack and damage rolls made with this magic weapon. When you hit with it, the target takes an extra 2d6 fire damage.\n   " + toUni("Fire Mastery") + ". You gain the following benefits while you hold Tinderstrike:\n \u2022 You can speak Ignan fluently.\n \u2022 You have resistance to fire damage.\n \u2022 You can cast Dominate Monster (save DC 17) on a fire elemental. Once you have done so, Tinderstrike can't be used this way again until the next dawn.\n\n" + toUni("Dance of the All-Consuming Fire") + ". While inside a fire node, you can perform a ritual called the Dance of the All-Consuming Fire, using Tinderstrike to create a devastation orb of fire. Once you perform the ritual, Tinderstrike can't be used to perform the ritual again until the next dawn.\n   " + toUni("Flaw") + '. Tinderstrike makes its wielder impatient and rash. While attuned to the weapon, you gain the following flaw: "I act without thinking and take risks without weighing the consequences."',
	attunement : true,
	weight : 1,
	languageProfs : ["Ignan"],
	dmgres : ["Fire"],
	usages : 1,
	recovery : "dawn",
	fixedDC : 17,
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["dominate monster"],
		selection : ["dominate monster"],
		firstCol : "oncelr"
	},
	spellChanges : {
		"dominate monster" : {
			description : "Fire elemental save or charmed, follows telepathic commands, 1 a for complete control; save on dmg",
			changes : "Can only affect a fire elemental."
		}
	},
	weaponsAdd : ["Tinderstrike"],
	weaponOptions : {
		baseWeapon : "dagger",
		regExpSearch : /tinderstrike/i,
		name : "Tinderstrike",
		source : ["PotA", 225],
		description : "Finesse, light, thrown; +2d6 fire damage",
		modifiers : [2,2]
	},
	toNotesPage : [{
		name : "Features",
		popupName : "Features of Tinderstrike",
		note : [
			"A flint dagger, Tinderstrike is uncommonly sharp, and sparks cascade off its edge whenever it strikes something solid. Its handle is always warm to the touch, and the blade smolders for 1d4 minutes after it is used to deal damage. It contains a spark of Imix, Prince of Evil Fire.",
			"I gain a +2 bonus to attack and damage rolls made with this magic weapon. When I hit with it, the target takes an extra 2d6 fire damage.",
			"While holding Tinderstrike, I can speak Ignan fluently, have resistance to fire damage, and can cast Dominate Monster (save DC 17) on a fire elemental once per dawn.",
			"While inside a fire node, I can perform a ritual called the Dance of the All-Consuming Fire, using Tinderstrike to create a Devastation Orb of Fire. The ritual takes 1 hour to complete and requires 2,000 gp worth of special components, which are consumed. Once I perform the ritual, Tinderstrike can't be used to perform the ritual again until the next dawn.",
			'Tinderstrike makes me impatient and rash. While attuned to the weapon, I gain the following flaw: "I act without thinking and take risks without weighing the consequences."'
		]
	}]
}
MagicItemsList["weird tank"] = {
	name : "Weird Tank",
	source : ["PotA", 223],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "As an action, I can open (or close) this tank of water, allowing the water weird within it to act or not. The weird is bound to the tank, follows my telepathic commands, and acts after me in combat. If the weird is killed, a new one can be formed by placing the tank in a water node for 24 hours.",
	descriptionLong : "As an action, I can open (or close) this tank of water, allowing the water weird within it to act or not. The weird is bound to the tank, follows my telepathic commands, and acts after me in combat. If it is killed, a new one can be formed by placing the tank in a water node for 24 hours. I can close the tank as an action, but I can only close the tank after commanding the weird to retract into it or if it died. The tank has AC 15, 50 HP, vulnerability to bludgeoning damage, and immunity to poison and psychic damage. Reducing the tank to 0 hit points destroys it and the water weird contained within it.",
	descriptionFull : "A weird tank is a ten-gallon tank of blown glass and sculpted bronze with a backpack-like carrying harness fashioned from tough leather. A water weird is contained within the tank. While wearing the tank, you can use an action to open it, allowing the water weird to emerge. The water weird acts immediately after you in the initiative order, and it is bound to the tank.\n   You can command the water weird telepathically (no action required) while you wear the tank. You can close the tank as an action only if you have first commanded the water weird to retract into it or if the water weird is dead.\n   If the water weird is killed, the tank loses its magical containment property until it spends at least 24 hours inside an elemental water node. When the tank is recharged, a new water weird forms inside it.\n   The tank has AC 15, 50 hit points, vulnerability to bludgeoning damage, and immunity to poison and psychic damage. Reducing the tank to 0 hit points destroys it and the water weird contained within it.",
	weight : 120,
	attunement : true,
	action : [["action", ""]]
}
MagicItemsList["windvane"] = {
	name : "Windvane",
	source : ["PotA", 225],
	type : "weapon (spear)",
	rarity : "legendary",
	storyItemAL : true,
	description : "This spear with the finesse property has a +2 bonus on to hit and damage and deals +1d6 lightning damage. It allows me to speak Auran, grants me resistance to lightning damage, and allows me to cast Dominate Monster on an air elemental once per dawn. It gives me a flaw, see Notes page.",
	descriptionFull : "A silver spear, Windvane has dark sapphires on the filigreed surface of its polished head. Held by its shining haft, the weapon feels insubstantial, as if clutching a cool, gently flowing breeze. The spear contains a spark of Yan-C-Bin, the Prince of Evil Air.\n   You have a +2 bonus to attack and damage rolls made with this magic weapon, which has the finesse weapon property. When you hit with it, the target takes an extra 1d6 lightning damage.\n   " + toUni("Air Mastery") + ". You gain the following benefits while you hold Windvane:\n \u2022 You can speak Auran fluently.\n \u2022 You have resistance to lightning damage.\n \u2022 You can cast Dominate Monster (save DC 17) on an air elemental. Once you have done so, Windvane can't be used this way again until the next dawn.\n\n" + toUni("Song of the Four Winds") + ". While inside an air node, you can perform a ritual called the Song of the Four Winds, using Windvane to create a devastation orb of air. Once you perform the ritual, Windvane can't be used to perform the ritual again until the next dawn.\n   " + toUni("Flaw") + '. Windvane makes its wielder mercurial and unreliable. While attuned to the weapon, you gain the following flaw: "I break my vows and plans. Duty and honor mean nothing to me."',
	attunement : true,
	weight : 3,
	languageProfs : ["Auran"],
	dmgres : ["Lightning"],
	usages : 1,
	recovery : "dawn",
	fixedDC : 17,
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["dominate monster"],
		selection : ["dominate monster"],
		firstCol : "oncelr"
	},
	spellChanges : {
		"dominate monster" : {
			description : "Air elemental save or charmed, follows telepathic commands, 1 a for complete control; save on dmg",
			changes : "Can only affect an air elemental."
		}
	},
	weaponsAdd : ["Windvane"],
	weaponOptions : {
		baseWeapon : "spear",
		regExpSearch : /windvane/i,
		name : "Windvane",
		source : ["PotA", 225],
		description : "Finesse, thrown, versatile (1d6); +1d6 lightning damage",
		modifiers : [2,2]
	},
	toNotesPage : [{
		name : "Features",
		popupName : "Features of Windvane",
		note : [
			"A silver spear, Windvane has dark sapphires on the filigreed surface of its polished head. Held by its shining haft, the weapon feels insubstantial, as if clutching a cool, gently flowing breeze. The spear contains a spark of Yan-C-Bin, the Prince of Evil Air.",
			"I have a +2 bonus to attack and damage rolls made with this magic weapon, which has the finesse weapon property. When I hit with it, the target takes an extra 1d6 lightning damage.",
			"While holding Windvane, I can speak Auran fluently, have resistance to lightning damage, and can cast Dominate Monster (save DC 17) on an air elemental once per dawn.",
			"While inside an air node, I can perform a ritual called the Song of the Four Winds, using Windvane to create a Devastation Orb of Air. The ritual takes 1 hour to complete and requires 2,000 gp worth of special components, which are consumed. Once I perform the ritual, Windvane can't be used to perform the ritual again until the next dawn.",
			'Windvane makes me mercurial and unreliable. While attuned to the weapon, I gain the following flaw: "I break my vows and plans. Duty and honor mean nothing to me."'
		]
	}]
}
MagicItemsList["wingwear"] = {
	name : "Wingwear",
	source : ["PotA", 223],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "C",
	description : "This snug uniform with leathery flaps has 3 charges, regaining all when placed in an air not for 1 hour. As a bonus action, I can expend 1 charge to gain a flying speed of 30 ft until I land or have 0 altitude. At the end of each of my turns, my altitude drops by 5 ft and I must move at least 30 ft horizontally or I fall.",
	descriptionFull : "This snug uniform has symbols of air stitched into it and leathery flaps that stretch along the arms, waist, and legs to create wings for gliding. A suit of wingwear has 3 charges. While you wear the suit, you can use a bonus action and expend 1 charge to gain a flying speed of 30 feet until you land. At the end of each of your turns, your altitude drops by 5 feet. Your altitude drops instantly to 0 feet at the end of your turn if you didn't fly at least 30 feet horizontally on that turn. When your altitude drops to 0 feet, you land (or fall), and you must expend another charge to use the suit again.\n   The suit regains all of its expended charges after spending at least 1 hour in an elemental air node.",
	attunement : true,
	usages : 3,
	recovery : "Air Node",
	additional : "recharge: 1 h in air node",
	action : [["bonus action", ""]]
}
var iFileName = "pub_20150415_AL-EE.js";
RequiredSheetVersion(12.999);
// This file adds the optional backgrounds from the Adventurers League season 2 (Elemental Evil) to MPMB's Character Record Sheet

// Define the source
SourceList["AL:EE"]={
	name : "Elemental Evil Backgrounds [Mulmaster]",
	abbreviation : "AL:EE",
	group : "Adventurers League",
	url : "https://dndadventurersleague.org/wp-content/uploads/2015/04/Mulmaster-Bonds-and-Backgrounds.pdf",
	date : "2015/04/15"
};

// Backgrounds
BackgroundList["caravan specialist"] = {
	regExpSearch :  /^(?=.*caravan)(?=.*specialist).*$/i,
	name : "Caravan Specialist",
	source : [["AL:EE", 2], ["ALbackground", 0]],
	skills : ["Animal Handling", "Survival"],
	gold : 10,
	equipleft : [
		["Two-person tent", "", 20],
		["Regional map", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Wagonmaster",
	trait : [
		"Any group is only as strong as its weakest link. Everyone has to pull their own weight.",
		"There's always someone out there trying to take what I've got. Always be vigilent.",
		"Anything can be learned if you have the right teacher. Most folks just need a chance.",
		"Early to bed and early to rise; this much at least is under my control.",
		"You can listen to me or don't and wish you had. Everyone ends up on one side of that fence.",
		"Eventually my hard work will be rewarded. Maybe that time has finally come.",
		"A strong ox or horse is more reliable than most people I've met.",
		"I never had time for books, but wish I had. I admire folks who have taken the time to learn."
	],
	ideal : [
		["Service",
			"Service: Using my talents to help others is the best way of helping myself. (Good)"
		],
		["Selfish",
			"Selfish: What people don't know WILL hurt them, but why is that my problem? (Evil)"
		],
		["Wanderer",
			"Wanderer: I go where the road takes me. Sometimes that's a good thing… (Chaotic)"
		],
		["Fittest",
			"Fittest: On the open road, the law of nature wins. Victims are the unprepared. (Lawful)"
		],
		["Focused",
			"Focused: I simply have a job to do, and I'm going to do it. (Neutral)"
		],
		["Motivated",
			"Motivated: There's a reason I'm good at what I do, I pay attention to the details. (Any)"
		]
	],
	bond : [
		"My brother has a farm In Elmwood and I've helped him and his neigbors move their goods to Mulmaster and other surrounding towns. Those are good people.",
		"A caravan I lead was attacked by bandits and many innocents died. I swear that I will avenge them by killing any bandits I encounter.",
		"The Soldiery are mostly good guys who understand the importance of protecting the roads. The City Watch is who you have to look out for. If they are inspecting your goods, get ready to pay a fine.",
		"The new commander of Southroad Tower, Capt. Holke, understands the importance of safe roads. He's hired me for several jobs and I'm grateful.",
		"There's always a road I haven't traveled before. I'm always looking for new places to explore.",
		"Wealth and power mean little without the freedom to go where and when you want."
	],
	flaw : [
		"I have trouble trusting people I've just met.",
		"I enjoy the open road. Underground and tight spaces make me very nervous.",
		"I expect others to heed my orders and have little respect or sympathy if they don't.",
		"I am very prideful and have trouble admitting when I'm wrong.",
		"Once I decide on a course of action, I do not waiver.",
		"I like to explore, and my curiosity will sometimes get me into trouble."
	],
	toolProfs : ["Vehicles (land)"],
	languageProfs : [1],
	lifestyle : "poor"
};
BackgroundList["earthspur miner"] = {
	regExpSearch :  /^(?=.*earthspur)(?=.*miner).*$/i,
	name : "Earthspur Miner",
	source : [["AL:EE", 3], ["ALbackground", 0]],
	skills : ["Athletics", "Survival"],
	gold : 5,
	equipleft : [
		["Shovel or miner's pick", "", 5],
		["Block and tackle", "", 5],
		["Climber's kit", "", 12]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Deep Miner",
	trait : [
		"Nothing bothers me for long.",
		"I hate the horrors of the Underdark with a passion. They took my friends and family and almost got me.",
		"Anything worth doing takes time and patience. I have learned to plan and wait for the things I want and to be patient to achieve my goals.",
		"I can party with everyone. Whether with dwarves, or goliaths, or deep gnomes, I can find a way to have a good time.",
		"I'd rather be mining. This is okay; mining is better.",
		"I think that I will stumble upon great riches if I just keep looking.",
		"People who don't work with their hands and who live in houses are soft and weak.",
		"I wish I were more educated. I look up to people who are."
	],
	ideal : [
		["Generosity",
			"Generosity: The riches of the earth are to be shared by all. (Good)"
		],
		["Greed",
			"Greed: Gems and precious metals, I want them all for myself. (Evil)"
		],
		["Mooch",
			"Mooch: Property, schmoperty. If I need it, I take and use it. If I don't, I leave it for someone else. (Chaotic)"
		],
		["Boundaries",
			"Boundaries: Everything and everyone has its prescribed place; I respect that and expect others to do the same. (Lawful) "
		],
		["Let it Be",
			"Let it Be: I don't meddle in the affairs of others if I can avoid it. They're none of my business. (Neutral)"
		],
		["Materialist",
			"Materialist: I want riches to improve my life. (Any)"
		]
	],
	bond : [
		"The people of the Earthspur mines are my family. I will do anything to protect them.",
		"A deep gnome saved my life when I was injured and alone. I owe his people a great debt.",
		"I must behold and preserve the natural beauty of places below the earth.",
		"Gems hold a special fascination for me, more than gold, land, magic, or power.",
		"I want to explore new depths and scale new heights.",
		"Someday I'm going to find the mother lode, then I'll spend the rest of my life in luxury."
	],
	flaw : [
		"I'm uncomfortable spending time under the open sky. I'd rather be indoors or underground.",
		"I'm not used to being around other people much and sometimes get grouchy about it.",
		"Good tools are more reliable than people. In a cave in, I would save a sturdy pick before a stranger.",
		"I jealously guard my secrets, because I think others will take advantage of me if they learn what I know.",
		"I am obsessed with getting rich. I always have a scheme brewing for making it big.",
		"I'm afraid of the dark."
	],
	languageProfs : ["Dwarvish", "Undercommon"],
	lifestyle : "poor"
};
BackgroundList["harborfolk"] = {
	regExpSearch :  /harborfolk/i,
	name : "Harborfolk",
	source : [["AL:EE", 4], ["ALbackground", 0]],
	skills : ["Athletics", "Sleight of Hand"],
	gold : 5,
	equipleft : [
		["Fishing tackle", "", 4],
		["Set of dice, playing cards, or three-dragon ante", "", ""]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt pouch (with coins)", "", 1],
		["Rowboat", "", 100]
	],
	feature : "Harborfolk",
	trait : [
		"I am curious. I want to know why things are the way they are and why people do the things that they do.",
		"I can't sing, but that never stops me from doing it, loudly. Everyone loves a good sea chanty!",
		"I think the High Blade is doing a terrific job, don't you?",
		"I'm very excited that the House Built on Gold is being restored. I am a zealous worshipper of Waukeen.",
		"I am quite superstitious. I see portents in everyday occurances.",
		"I resent the rich and enjoy thwarting their plans and spoiling their fun in small ways.",
		"I have a sea story to fit every occasion.",
		"I'm a fisher, but I secretly detest eating fish. I will do anything to avoid it."
	],
	ideal : [
		["Calm",
			"Calm: For all things, there is a tide. I set sail when it is right, and mend my nets when it is not. (Lawful)"
		],
		["Windblown",
			"Windblown: I go where the winds blow. No man or woman tells me where or when to sail. (Chaotic)"
		],
		["Aspiring",
			"Aspiring: I will gain the favor of a Zor or Zora patron, maybe even one of the Blades! (Any)"
		],
		["Salty",
			"Salty: I want people to look to me as an expert on plying Mulmaster Harbor. (Any)"
		],
		["Selfless",
			"Selfless: We are all children of the sea. I help everyone in peril afloat and ashore. (Good)"
		],
		["Let them Drown",
			"Let them Drown: I refuse to risk my hide to help others. They wouldn't help me if roles were reversed. (Evil)"
		]
	],
	bond : [
		"I once lost everything but my rowboat. I'll do anything to protect it.",
		"My brother was in the Soldiery, but he was killed. I really look up to the men and women who serve.",
		"The Cloaks killed my friend for spellcasting. I'll get them back somehow, someday.",
		"The High House of Hurting helped me when I was hurt and asked nothing in return. I owe them my life.",
		"I was robbed in the Zhent ghetto once. It will not happen again.",
		"I would do anything to protect the other harborfolk. They are my family."
	],
	flaw : [
		"I drink too much, which causes me to miss the tide.",
		"I killed a drunk member of the City Watch in a brawl. I am terrified that they might find out.",
		"I oversell myself and make promises I can't keep when I want to impress someone.",
		"Book learning is a waste of time. I have no patience for people who don't speak from experience.",
		"I almost always cheat. I can't help myself.",
		"I am a secret informant for the Hawks. I send them reports about everything I see and hear, even what my friends and allies are up to."
	],
	toolProfs : [["Gaming set", 1], "Vehicles (water)"],
	lifestyle : "poor"
};
BackgroundList["mulmaster aristocrat"] = {
	regExpSearch :  /^(?=.*mulmaster)(?=.*aristocrat).*$/i,
	name : "Mulmaster Aristocrat",
	source : [["AL:EE", 5], ["ALbackground", 0]],
	skills : ["Deception", "Performance"],
	gold : 10,
	equipleft : [
		["Artisan's tools or musical instrument", "", ""]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Purse (with coins)", "", 1]
	],
	feature : "Highborn",
	trait : [
		"My ambitions are boundless. I will be a Zor or Zora one day!",
		"I must alwayss look my best.",
		"Beauty is everywhere. I can find it in even the homliest person and the most horrible tragedy.",
		"Décorum must be preserved at all costs.",
		"I will not admit I am wrong if I can avoid it.",
		"I am extremely well-educated and frequently remind others of that fact.",
		"I take what I can today, because I do not know what tomorrow holds.",
		"My life is full of dance, song, drink, and love."
	],
	ideal : [
		["Generous",
			"Generous: I have a responsibility to help and protect the less fortunate. (Good)"
		],
		["Loyal",
			"Loyal: My word, once given, is my bond. (Lawful)"
		],
		["Callous",
			"Callous: I am unconcerned with any negative effects my actions may have on the lives and fortunes of others. (Evil)"
		],
		["Impulsive",
			"Impulsive: I follow my heart. (Chaotic)"
		],
		["Ignorant",
			"Ignorant: Explanations bore me. (Neutral)"
		],
		["Isolationist",
			"Isolationist: I am concerned with the fortunes of my friends and family. Others must see to themselves. (Any)"
		]
	],
	bond : [
		"I have dedicated my wealth and my talents to the service of one of the city's many temples.",
		"My family and I are loyal supporters of High Blade Jaseen Drakehorn. Our fortunes are inexorably tied to hers. I would do anything to support her.",
		"Like many families who were close to High Blade Selfaril Uoumdolphin, mine has suffered greatly since his fall. We honor his memory in secret.",
		"My family plotted with Rassendyll Uoumdolphin brother usurped brother as High Blade. Betrayal is the quickest route to power.",
		"Wealth and power are nothing. Fulfillment can only be found in artistic expression.",
		"It's not how you feel, who you know, or what you can do - it's how you look, and I look fabulous."
	],
	flaw : [
		"I have difficulty caring about anyone or anything other than myself.",
		"Having grown up with wealth, I am careless with my finances. I overspend and am overly generous.",
		"The ends (my advancement) justify any means.",
		"I must have what I want and will brook no delay.",
		"My family has lost everything. I must keep up appearances, lest we become a laughingstock.",
		"I have no artistic sense. I hide that fact behind extreme opinons and have become a trendsetter."
	],
	toolProfs : [["Artisan's tools", 1], ["Musical instrument", 1]],
	lifestyle : "wealthy"
};
BackgroundList["phlan refugee"] = {
	regExpSearch :  /^(?=.*phlan)(?=.*refugee).*$/i,
	name : "Phlan Refugee",
	source : [["AL:EE", 6], ["ALbackground", 0]],
	skills : ["Insight", "Athletics"],
	gold : 15,
	equipleft : [
		["Set of artisan's tools", "", ""],
		["Token of the life I once knew", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Phlan Survivor",
	trait : [
		"I may have lost everything I worked for most of my life, but there's work to be done, no time to linger on the past.",
		"I worked hard to get where I am and I refuse to let a little hardship stop me from succeeding.",
		"I protect those around me, you never know when one of them will be useful.",
		"I have always gotten ahead by giving, why change now?",
		"I prepare for everything, it paid off in Phlan and it will pay off again.",
		"I will reclaim my home, though the path may be long, I will never give up hope.",
		"I never cared for personal hygiene, and am amazed that It bothers others.",
		"I am always willing to volunteer my services, just as long as don't have to do anything."
	],
	ideal : [
		["Justice",
			"Justice: Corruption brought Phlan down, I will not tolerate that any longer. (Lawful)"
		],
		["Acceptance",
			"Acceptance: Stability is a myth, to think you can control your future is futile. (Chaotic)"
		],
		["Hope",
			"Hope: I am guided by a higher power and I trust that everything will be right in the end. (Good)"
		],
		["Restraint",
			"Restraint: I hate those who caused my loss. It is all I can do not to lash out at them. (Any)"
		],
		["Strength",
			"Strength: As shown in Phlan, the strong survive. If you are weak you deserve what you get (Evil)"
		],
		["Openness",
			"Openness: I am always willing to share my life story with anyone who will listen. (Any)"
		]
	],
	bond : [
		"I have the chance at a new life and this time I am going to do things right.",
		"The Lord Regent brought this suffering upon his people. I will see him brought to justice.",
		"I await the day I will be able to return to my home in Phlan.",
		"I will never forget the debt owed to Glevith of the Welcomers. I will be ready to repay that debt when called upon.",
		"There was someone I cared about in Phlan, I will find out what happened to them.",
		"Some say my life wasn't worth saving, I will prove them wrong."
	],
	flaw : [
		"I used the lives of children to facilitate my escape from Phlan.",
		"I am a sucker for the underdog, and always bet on the loosing team.",
		"I am incapable of standing up for myself.",
		"I will borrow money from friends with no intention to repay it.",
		"I am unable to keep secrets. A secret is just an untold story.",
		"When something goes wrong, it's never my fault."
	],
	toolProfs : [["Artisan's tools", 1]],
	languageProfs : [1],
	lifestyle : "modest"
};

// Background features
BackgroundFeatureList["wagonmaster"] = {
	description : "I'm used to being in charge. My reputation has me on a short list for critical jobs, allows me to attract two more loyal workers for caravaning, and causes others to look to me for direction. I can identify the most defensible locations for camping. I have a great memory for maps and geography. While travelling, I can always find my cardinal directions.",
	source : [["AL:EE", 2], ["ALbackground", 0]]
};
BackgroundFeatureList["deep miner"] = {
	description : "I am used to navigating the deep places of the earth. I never get lost in caves or mines if I have either seen an accurate map of them or have been through them before. Furthermore, I am able to scrounge fresh water and food for myself and as many as five other people each day if I am in a mine or natural caves.",
	source : [["AL:EE", 3], ["ALbackground", 0]]
};
BackgroundFeatureList["harborfolk"] = {
	description : "I grew up on the docks and waters of Mulmaster Harbor. The harborfolk remember me and still treat me as one of them. They welcome me and my companions. While they might charge me for it, they'll always offer what food and shelter they have; they'll even hide me if the City Watch is after me (but not if the Hawks are).",
	source : [["AL:EE", 4], ["ALbackground", 0]]
};
BackgroundFeatureList["highborn"] = {
	description : "Mulmaster is run by and for its aristoracy. Every other class of citizen in the city defers to me, and even the priesthood, Soldiery, Hawks, and Cloaks treat me with deference. Other aristocrats and nobles accept me in their circles and likely know me or of me. My connections can get me the ear of a Zor or Zora under the right circumstances.",
	source : [["AL:EE", 5], ["ALbackground", 0]]
};
BackgroundFeatureList["phlan survivor"] = {
	description : "Whatever my prior standing I'm now one of the many refugees that came to Mulmaster. I'm able to find refuge with others from Phlan and those who sympathize with my plight. Within Mulmaster this means that I can find a place to sleep, recover, and hide from the watch with either other refugees from Phlan, or the Zhents within the ghettos.",
	source : [["AL:EE", 6], ["ALbackground", 0]]
};
var iFileName = "pub_20150416_EE.js";
RequiredSheetVersion(13);
// This file adds all the player-material from the Elemental Evil Player's Companion (November 2017, after the XGtE update) to MPMB's Character Record Sheet

// Define the source
SourceList.E={
	name : "Elemental Evil Player's Companion", // November 2017 version
	abbreviation : "EE",
	group : "Primary Sources",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/player%E2%80%99s-companion",
	date : "2015/04/16"
};

// Races
RaceList["aarakocra"] = {
	regExpSearch : /aarakocra/i,
	name : "Aarakocra",
	source : ["E", 5],
	plural : "Aarakocra",
	size : 3,
	speed : {
		walk : { spd : 25, enc : 15 },
		fly : { spd : 50, enc : 0 }
	},
	languageProfs : ["Common", "Aarakocra", "Auran"],
	weaponOptions : {
		baseWeapon : "unarmed strike",
		regExpSearch : /talon/i,
		name : "Talons",
		source : ["E", 5],
		damage : [1, 4, "slashing"]
	},
	weaponsAdd : ["Talons"],
	age : " rearch maturity by age 3 and live about 30 years",
	height : " are about 5 feet tall",
	weight : " weigh between 80 and 100 lb",
	heightMetric : " are about 1,5 metres tall",
	weightMetric : " weigh between 36 and 45 kg",
	scores : [0, 2, 0, 0, 1, 0],
	trait : "Aarakocra (+2 Dexterity, +1 Wisdom)\n\nFlight: I have a flying speed of 50 feet. To use this speed, I can't be wearing medium or heavy armor.\n\nTalons: My unarmed strikes deal 1d4 slashing damage on a hit."
};
RaceList["deep gnome"] = {
	regExpSearch : /^((?=.*svirfneblin)|((?=.*\bgnomes?\b)(?=.*\b(underdarks?|deep|depths?)\b))).*$/i,
	name : "Svirfneblin",
	sortname : "Gnome, Deep (Svirfneblin)",
	source : [["E", 7], ["S", 115], ["MToF", 113]],
	plural : "Svirfneblin",
	size : 4,
	speed : {
		walk : { spd : 25, enc : 15 }
	},
	languageProfs : ["Common", "Gnomish", "Undercommon"],
	vision : [["Darkvision", 120]],
	savetxt : { text : ["Adv. on Int/Wis/Cha saves vs. magic"] },
	age : " are considered full-grown adults when they reach 25 and live 200 to 250 years",
	height : " stand between 3 and 3 1/2 feet tall (2'9\" + 2d4\")",
	weight : " weigh around 90 lb (80 + 2d4 \xD7 1d4 lb)",
	heightMetric : " stand between 90 and 105 cm tall (85 + 5d4 cm)",
	weightMetric : " weigh around 50 kg (35 + 5d4 \xD7 4d4 / 10 kg)",
	scores : [0, 1, 0, 2, 0, 0],
	trait : "Svirfneblin (+1 Dexterity, +2 Intelligence)\n\nStone Camouflage:\n   I have advantage on Dexterity (stealth) checks to hide in rocky terrain."
};
RaceList["air genasi"] = {
	regExpSearch : /^(?=.*(genasi|planetouched))(?=.*\bairs?\b).*$/i,
	name : "Air genasi",
	sortname : "Genasi, Air",
	source : ["E", 9],
	plural : "Air genasi",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Primordial"],
	age : " reach adulthood in their late teens and live up to 120 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 lb (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 1, 2, 0, 0, 0],
	trait : "Air Genasi (+1 Dexterity, +2 Constitution)\n\nUnending Breath: I can hold my breath indefinitely while I am not incapacitated.\n\nMingle with the Wind: I can cast the Levitate spell once with this trait, requiring no material components, and I regain the ability to cast it this way when I finish a long rest. Constitution is my spellcasting ability for this spell.",
	spellcastingAbility : 3,
	features : {
		"levitate" : {
			name : "Mingle with the Wind",
			limfeaname : "Levitate",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Mingle with the Wind",
				spells : ["levitate"],
				selection : ["levitate"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"levitate" : {
					components : "V,S",
					compMaterial : "",
					changes : "Using Mingle with the Wind, I can cast Levitate once per long rest without requiring material components."
				}
			}
		}
	}
};
RaceList["earth genasi"] = {
	regExpSearch : /^(?=.*(genasi|planetouched))(?=.*\bearths?\b).*$/i,
	name : "Earth genasi",
	sortname : "Genasi, Earth",
	source : ["E", 9],
	plural : "Earth genasi",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Primordial"],
	age : " reach adulthood in their late teens and live up to 120 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 lb (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [1, 0, 2, 0, 0, 0],
	trait : "Earth Genasi (+1 Strength, +2 Constitution)" + (typePF ? "\n" : "") + "\nEarth Walk: I can move across difficult terrain made of earth or stone without expending extra movement." + (typePF ? "\n" : "") + "\nMerge with Stone: I can cast the Pass without Trace spell once with this trait, requiring no material components, and I regain the ability to cast it this way when I finish a long rest. Constitution is my spellcasting ability for this spell.",
	spellcastingAbility : 3,
	features : {
		"pass without trace" : {
			name : "Merge with Stone",
			limfeaname : "Pass without Trace",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Merge with Stone",
				spells : ["pass without trace"],
				selection : ["pass without trace"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"pass without trace" : {
					components : "V,S",
					compMaterial : "",
					changes : "Using Merge with Stone, I can cast Pass without Trace once per long rest without requiring material components."
				}
			}
		}
	}
};
RaceList["fire genasi"] = {
	regExpSearch : /^(?=.*(genasi|planetouched))(?=.*\bfires?\b).*$/i,
	name : "Fire genasi",
	sortname : "Genasi, Fire",
	source : ["E", 9],
	plural : "Fire genasi",
	vision : [["Darkvision", 60]],
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Primordial"],
	dmgres : ["Fire"],
	age : " reach adulthood in their late teens and live up to 120 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 lb (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 2, 1, 0, 0],
	trait : "Fire Genasi (+2 Constitution, +1 Intelligence)\n\nReach to the Blaze:\n   I know the Produce Flame cantrip.\n   Once I reach 3rd level, I can cast the Burning Hands spell once as a 1st-level spell.\n   I regain the ability to cast it this way when I finish a long rest.\n   Constitution is my spellcasting ability for these spells.",
	spellcastingAbility : 3,
	spellcastingBonus : {
		name : "Reach to the Blaze (level 1)",
		spells : ["produce flame"],
		selection : ["produce flame"],
		firstCol : 'atwill'
	},
	features : {
		"burning hands" : {
			name : "Reach to the Blaze (level 3)",
			limfeaname : "Burning Hands",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Reach to the Blaze (level 3)",
				spells : ["burning hands"],
				selection : ["burning hands"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["water genasi"] = {
	regExpSearch : /^(?=.*(genasi|planetouched))(?=.*\bwaters?\b).*$/i,
	name : "Water genasi",
	sortname : "Genasi, Water",
	source : ["E", 10],
	plural : "Water genasi",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Primordial"],
	dmgres : ["Acid"],
	age : " reach adulthood in their late teens and live up to 120 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 lb (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 2, 0, 1, 0],
	trait : "Water Genasi (+2 Constitution, +1 Wisdom)\nAmphibious: I can breathe air and water.\nSwim: I have a swimming speed of 30 feet.\nCall to the Wave: I know the Shape Water cantrip.\n   When I reach 3rd level, I can cast the Create or Destroy Water spell as a 2nd-level spell once with this trait, and I regain the ability to cast it this way when I finish a long rest.\n   Constitution is my spellcasting ability for these spells.",
	spellcastingAbility : 3,
	spellcastingBonus : {
		name : "Call to the Wave (level 1)",
		spells : ["shape water"],
		selection : ["shape water"],
		firstCol : 'atwill'
	},
	features : {
		"create or destroy water" : {
			name : "Call to the Wave (level 3)",
			limfeaname : "Create/Destroy Water (level 2)",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Call to the Wave (level 3)",
				spells : ["create or destroy water"],
				selection : ["create or destroy water"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["goliath"] = {
	regExpSearch : /goliath/i,
	name : "Goliath",
	source : [["E", 11], ["V", 108]],
	plural : "Goliaths",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Giant"],
	skills : ["Athletics"],
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " are between 6 and a half and 8 feet tall (6'2\" + 2d10\")",
	weight : " weigh between 280 and 340 lb (200 + 2d10 \xD7 2d6 lb)",
	heightMetric : " are between 2 and 2,4 metres tall (190 + 5d10 cm)",
	weightMetric : " weigh between 100 and 155 kg (90 + 5d10 \xD7 4d6 / 10 kg)",
	scores : [2, 0, 1, 0, 0, 0],
	features : {
		"stone's endurance" : {
			name : "Stone's Endurance",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["reaction", ""]
		}
	},
	trait : "Goliath (+2 Strength, +1 Constitution)" + (typePF ? "\n" : "") + "\nStone's Endurance: Once per short rest, when I take damage, I can use my reaction to reduce the damage by 1d12 + my Con" + (typePF ? "" : "stitution") + " modifier." + (typePF ? "\n" : "") + "\nPowerful Build: I count as one size larger when determining my carrying capacity and the weight I can push, drag, or lift." + (typePF ? "\n" : "") + "\nMountain Born: I'm acclimated to high altitude, including elevations above 20000 feet. I'm also naturally adapted to cold climates.",
	carryingCapacity : 2
};

// Feat
FeatsList["svirfneblin magic"] = {
	name : "Svirfneblin Magic",
	source : [["E", 7], ["S", 115], ["MToF", 114]],
	prerequisite : "Being a Svirfneblin (Deep Gnome)",
	prereqeval : function(v) { return CurrentRace.known === 'deep gnome'; },
	descriptionFull : "You have inherited the innate spellcasting ability of your ancestors. This ability allows you to cast Nondetection on yourself at will, without needing a material component. You can also cast each of the following spells once with this ability: Blindness/Deafness, Blur, and Disguise Self. You regain the ability to cast these spells when you finish a long rest.\n   Intelligence is your spellcasting ability for these spells, and you cast them at their lowest possible levels.",
	description : "I can cast Nondetection on myself at will, without a material component. I can also cast the spells Blindness/Deafness, Blur, and Disguise Self once each. I regain the ability to cast these spells when I finish a long rest. Intelligence is my spellcasting ability for these spells.",
	spellcastingBonus : [{
		name : "at will (self only)",
		spellcastingAbility : 4,
		spells : ["nondetection"],
		selection : ["nondetection"],
		firstCol : 'atwill'
	}, {
		name : "1x long rest (self only)",
		spells : ["blindness/deafness", "blur", "disguise self"],
		selection : ["blindness/deafness", "blur", "disguise self"],
		firstCol : 'oncelr',
		times : 3
	}],
	spellChanges : {
		"nondetection" : {
			range : "Self",
			components : "V,S",
			compMaterial : "",
			description : "I am hidden from all divination magic",
			changes : "Using Svirfneblin Magic, I can cast Nondetection without a material component, but only on myself."
		}
	}
};

// Spells
SpellsList["abi-dalzim's horrid wilting"] = {
	name : "Abi-Dalzim's Horrid Wilting",
	nameShort : "Abi-D's Horrid Wilting",
	nameAlt : "Horrid Wilting",
	classes : ["sorcerer", "wizard"],
	source : [["X", 150], ["E", 15]],
	level : 8,
	school : "Necro",
	time : "1 a",
	range : "150 ft",
	components : "V,S,M",
	compMaterial : "A bit of sponge",
	duration : "Instantaneous",
	save : "Con",
	description : "30-ft cube all crea 12d8 Necrotic dmg; save halves; plants/water elem. dis. const/undead immune",
	descriptionFull : "You draw the moisture from every creature in a 30-foot cube centered on a point you choose within range. Each creature in that area must make a Constitution saving throw. Constructs and undead aren't affected, and plants and water elementals make this saving throw with disadvantage. A creature takes 12d8 necrotic damage on a failed save, or half as much damage on a successful one." + "\n   " + "Nonmagical plants in the area that aren't creatures, such as trees and shrubs, wither and die instantly."
};
SpellsList["absorb elements"] = {
	name : "Absorb Elements",
	classes : ["druid", "ranger", "sorcerer", "wizard"],
	source : [["X", 150], ["E", 15]],
	level : 1,
	school : "Abjur",
	time : "1 rea",
	range : "Self",
	components : "S",
	duration : "1 rnd",
	description : "Acid, Cold, Fire, Lightning, or Thunder resistance vs. 1 atk; first melee hit next rnd +1d6+1d6/SL dmg",
	descriptionFull : "The spell captures some of the incoming energy, lessening its effect on you and storing it for your next melee attack. You have resistance to the triggering damage type until the start of your next turn. Also, the first time you hit with a melee attack on your next turn, the target takes an extra 1d6 damage of the triggering type, and the spell ends." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the extra damage increases by 1d6 for each slot level above 1st."
};
SpellsList["aganazzar's scorcher"] = {
	name : "Aganazzar's Scorcher",
	nameAlt : "Scorch", //as per the Spell Compandium's (DnD 3.5e) alternative name
	classes : ["sorcerer", "wizard"],
	source : [["X", 150], ["E", 15]],
	level : 2,
	school : "Evoc",
	time : "1 a",
	range : "30-ft line",
	components : "V,S,M",
	compMaterial : "A red dragon's scale",
	duration : "Instantaneous",
	save : "Dex",
	description : "30-ft long 5-ft wide line all creatures 3d8+1d8/SL Fire dmg; save halves",
	descriptionFull : "A line of roaring flame 30 feet long and 5 feet wide emanates from you in a direction you choose. Each creature in the line must make a Dexterity saving throw. A creature takes 3d8 fire damage on a failed save, or half as much damage on a successful one." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d8 for each slot level above 2nd."
};
SpellsList["beast bond"] = {
	name : "Beast Bond",
	classes : ["druid", "ranger"],
	source : [["X", 150], ["E", 15]],
	level : 1,
	school : "Div",
	time : "1 a",
	range : "Touch",
	components : "V,S,M",
	compMaterial : "A bit of fur wrapped in a cloth",
	duration : "Conc, 10 min",
	description : "Telepathic link with 1 beast Int<4 while in line of sight; beast has adv. on attacks vs. crea I can see",
	descriptionFull : "You establish a telepathic link with one beast you touch that is friendly to you or charmed by you. The spell fails if the beast's Intelligence is 4 or higher. Until the spell ends, the link is active while you and the beast are within line of sight of each other. Through the link, the beast can understand your telepathic messages to it, and it can telepathically communicate simple emotions and concepts back to you. While the link is active, the beast gains advantage on attack rolls against any creature within 5 feet of you that you can see."
};
SpellsList["bones of the earth"] = {
	name : "Bones of the Earth",
	classes : ["druid"],
	source : [["X", 150], ["E", 15]],
	level : 6,
	school : "Trans",
	time : "1 a",
	range : "120 ft",
	components : "V,S",
	duration : "Instantaneous",
	save : "Dex",
	description : "6+2/SL 2.5-ft rad ground burst up 30-ft, \u2265 Med. creas save or lifted, 6d6 bludg. dmg if ceiling; see B",
	descriptionFull : "You cause up to six pillars of stone to burst from places on the ground that you can see within range. Each pillar is a cylinder that has a diameter of 5 feet and a height of up to 30 feet. The ground where a pillar appears must be wide enough for its diameter, and you can target the ground under a creature if that creature is Medium or smaller. Each pillar has AC 5 and 30 hit points. When reduced to 0 hit points, a pillar crumbles into rubble, which creates an area of difficult terrain with a 10-foot radius that lasts until the rubble is cleared. Each 5-foot-diameter portion of the area requires at least 1 minute to clear by hand." + "\n   " + "If a pillar is created under a creature, that creature must succeed on a Dexterity saving throw or be lifted by the pillar. A creature can choose to fail the save." + "\n   " + "If a pillar is prevented from reaching its full height because of a ceiling or other obstacle, a creature on the pillar takes 6d6 bludgeoning damage and is restrained, pinched between the pillar and the obstacle. The restrained creature can use an action to make a Strength or Dexterity check (the creature's choice) against the spell's save DC. On a success, the creature is no longer restrained and must either move off the pillar or fall off it." + AtHigherLevels + "When you cast this spell using a spell slot of 7th level or higher, you can create."
};
SpellsList["catapult"] = {
	name : "Catapult",
	classes : ["sorcerer", "wizard"],
	source : [["X", 150], ["E", 15]],
	level : 1,
	school : "Trans",
	time : "1 a",
	range : "60 ft",
	components : "S",
	duration : "Instantaneous",
	save : "Dex",
	description : "Send 5+5/SL lb unattended object in 90 ft straight line; if hits crea, save or 3d8+1d8/SL Bludg. dmg",
	descriptionFull : "Choose one object weighing 1 to 5 pounds within range that isn't being worn or carried. The object flies in a straight line up to 90 feet in a direction you choose before falling to the ground, stopping early if it impacts against a solid surface. If the object would strike a creature, that creature must make a Dexterity saving throw. On a failed save, the object strikes the target and stops moving. When the object strikes something, the object and what it strikes each take 3d8 bludgeoning damage." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the maximum weight of objects that you can target with this spell increases by 5 pounds, and the damage."
};
SpellsList["control flames"] = {
	name : "Control Flames",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 152], ["E", 16]],
	level : 0,
	school : "Trans",
	time : "1 a",
	range : "60 ft",
	components : "S",
	duration : "Instant. or 1 h",
	description : "Nonmagical flame up to 5 cu ft; instant: expand/extinguish, 1h: brighten/dim/color/create shapes",
	descriptionFull : "You choose nonmagical flame that you can see within range and that fits within a 5-foot cube. You affect it in one of the following ways." + "\n \u2022 " + "You instantaneously expand the flame 5 feet in one direction, provided that wood or other fuel is present in the new location." + "\n \u2022 " + "You instantaneously extinguish the flames within the cube." + "\n \u2022 " + "You double or halve the area of bright light and dim light cast by the flame, change its color, or both. The change lasts for 1 hour." + "\n \u2022 " + "You cause simple shapes-such as the vague form of a creature, an inanimate object, or a location-to appear within the flames and animate as you like. The shapes last for 1 hour." + "\n   " + "If you cast this spell multiple times, you can have up to three of its non-instantaneous effects active at a time, and you can dismiss such an effect as an action."
};
SpellsList["control winds"] = {
	name : "Control Winds",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 152], ["E", 16], ["UA:D", 8]],
	level : 5,
	school : "Trans",
	time : "1 a",
	range : "300 ft",
	components : "V,S",
	duration : "Conc, 1 h",
	description : "100-ft cube of air either gusts, downdraft, or updraft; affects flying/jump/ranged; 1 a change; see B",
	descriptionFull : "You take control of the air in a 100-foot cube that you can see within range. Choose one of the following effects when you cast the spell. The effect lasts for the spell's duration, unless you use your action on a later turn to switch to a different effect. You can also use your action to temporarily halt the effect or to restart one you've halted." + "\n   " + toUni("Gusts") + ": A wind picks up within the cube, continually blowing in a horizontal direction you designate. You choose the intensity of the wind: calm, moderate, or strong. If the wind is moderate or strong, ranged weapon attacks that enter or leave the cube or pass through it have disadvantage on their attack rolls. If the wind is strong, any creature moving against the wind must spend 1 extra foot of movement for each foot moved." + "\n   " + toUni("Downdraft") + ": You cause a sustained blast of strong wind to blow downward from the top of the cube. Ranged weapon attacks that pass through the cube or that are made against targets within it have disadvantage on their attack rolls. A creature must make a Strength saving throw if it flies into the cube for the first time on a turn or starts its turn there flying. On a failed save, the creature is knocked prone." + "\n   " + toUni("Updraft") + ": You cause a sustained updraft within the cube, rising upward from the cube's bottom side. Creatures that end a fall within the cube take only half damage from the fall. When a creature in the cube makes a vertical jump, the creature can jump up to 10 feet higher than normal."
};
SpellsList["create bonfire"] = {
	name : "Create Bonfire",
	classes : ["druid", "sorcerer", "warlock", "wizard"],
	source : [["X", 152], ["E", 16]],
	level : 0,
	school : "Conj",
	time : "1 a",
	range : "60 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "5-ft cube all crea at casting or entering save or 1d8 Fire dmg; ignites flammable; +1d8 at CL 5/11/17",
	descriptionCantripDie : "5-ft cube all crea at casting or entering save or `CD`d8 Fire dmg; ignites flammable",
	descriptionFull : "You create a bonfire on ground that you can see within range. Until the spell ends, the magic bonfire fills a 5-foot cube. Any creature in the bonfire's space when you cast the spell must succeed on a Dexterity saving throw or take 1d8 fire damage. A creature must also make the saving throw when it moves into the bonfire's space for the first time on a turn or ends its turn there." + "\n   " + "The bonfire ignites flammable objects in its area that aren't being worn or carried." + "\n   " + "The spell's damage increases by 1d8 when you reach 5th level (2d8), 11th level (3d8), and 17th level (4d8)."
};
SpellsList["dust devil"] = {
	name : "Dust Devil",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 154], ["E", 17]],
	level : 2,
	school : "Conj",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M",
	compMaterial : "A pinch of dust",
	duration : "Conc, 1 min",
	save : "Str",
	description : "5-ft cube; all in 5-ft 1d8+1d8/SL Bludg. dmg and pushed 10 ft away; save halves, no push; see book",
	descriptionFull : "Choose an unoccupied 5-foot cube of air that you can see within range. An elemental force that resembles a dust devil appears in the cube and lasts for the spell's duration." + "\n   " + "Any creature that ends its turn within 5 feet of the dust devil must make a Strength saving throw. On a failed save, the creature takes 1d8 bludgeoning damage and is pushed 10 feet away from the dust devil. On a successful save, the creature takes half as much damage and isn't pushed." + "\n   " + "As a bonus action, you can move the dust devil up to 30 feet in any direction. If the dust devil moves over sand, dust, loose dirt, or light gravel, it sucks up the material and forms a 10-foot-radius cloud of debris around itself that lasts until the start of your next turn. The cloud heavily obscures its area." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d8 for each slot level above 2nd."
};
SpellsList["earthbind"] = {
	name : "Earthbind",
	classes : ["druid", "sorcerer", "warlock", "wizard"],
	source : [["X", 154], ["E", 17]],
	level : 2,
	school : "Trans",
	time : "1 a",
	range : "300 ft",
	components : "V",
	duration : "Conc, 1 min",
	save : "Str",
	description : "1 creatures save or fly speed is reduced to 0; airborne creatures safely descend at 60 ft per round",
	descriptionFull : "Choose one creature you can see within range. Yellow strips of magical energy loop around the creature. The target must succeed on a Strength saving throw, or its flying speed (if any) is reduced to 0 feet for the spell's duration. An airborne creature affected by this spell safely descends at 60 feet per round until it reaches the ground or the spell ends."
};
SpellsList["earth tremor"] = {
	name : "Earth Tremor",
	classes : ["bard", "druid", "sorcerer", "wizard"],
	source : [["X", 155], ["E", 17]],
	level : 1,
	school : "Evoc",
	time : "1 a",
	range : "10 ft",
	components : "V,S",
	duration : "Instantaneous",
	save : "Dex",
	description : "All crea in range except me save or 1d6+1d6/SL Bludgeoning dmg and prone; loose ground is dif. ter.",
	descriptionFull : "You cause a tremor in the ground within range. Each creature other than you in that area must make a Dexterity saving throw. On a failed save, a creature takes 1d6 bludgeoning damage and is knocked prone. If the ground in that area is loose earth or stone, it becomes difficult terrain until cleared, with each 5-foot-diameter portion requiring at least 1 minute to clear by hand." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d6 for each slot level above 1st."
};
SpellsList["elemental bane"] = {
	name : "Elemental Bane",
	classes : ["druid", "warlock", "wizard"],
	source : [["X", 155], ["E", 17]],
	level : 4,
	school : "Trans",
	time : "1 a",
	range : "90 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	save : "Con",
	description : "1+1/SL crea, each max 30 ft apart, save or 1 energy: lose resist. to it & +2d6 to first dmg with it/turn",
	descriptionFull : "Choose one creature you can see within range, and choose one of the following damage types - acid, cold, fire, lightning, or thunder. The target must succeed on a Constitution saving throw or be affected by the spell for its duration. The first time each turn the affected target takes damage of the chosen type, the target takes an extra 2d6 damage of that type. Moreover, the target loses any resistance to that damage type until the spell ends." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, you can target one additional creature for each slot level above 4th. The creatures must be within 30 feet of each other when you target them."
};
SpellsList["erupting earth"] = {
	name : "Erupting Earth",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 155], ["E", 17]],
	level : 3,
	school : "Trans",
	time : "1 a",
	range : "120 ft",
	components : "V,S,M",
	compMaterial : "A piece of obsidian",
	duration : "Instantaneous",
	save : "Dex",
	description : "20-ft cube all crea 3d12+1d12/SL Bludgeoning dmg; save halves; area becomes difficult terrain",
	descriptionFull : "Choose a point you can see on the ground within range. A fountain of churned earth and stone erupts in a 20-foot cube centered on that point. Each creature in that area must make a Dexterity saving throw. A creature takes 3d12 bludgeoning damage on a failed save, or half as much damage on a successful one. Additionally, the ground in that area becomes difficult terrain until cleared. Each 5-foot-square portion of the area requires at least 1 minute to clear by hand." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the damage increases by 1d12 for each slot level above 3rd."
};
SpellsList["flame arrows"] = {
	name : "Flame Arrows",
	classes : ["druid", "ranger", "sorcerer", "wizard"],
	source : [["X", 156], ["E", 18]],
	level : 3,
	school : "Trans",
	time : "1 a",
	range : "Touch",
	components : "V,S",
	duration : "Conc, 1 h",
	description : "12+2/SL ammunition drawn from touched quiver do +1d6 Fire damage on a successful hit",
	descriptionFull : "You touch a quiver containing arrows or bolts. When a target is hit by a ranged weapon attack using a piece of ammunition drawn from the quiver, the target takes an extra 1d6 fire damage. The spell's magic ends on the piece of ammunition when it hits or misses, and the spell ends when twelve pieces of ammunition have been drawn from the quiver." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the number of pieces of ammunition you can affect with this spell increases by two for each slot level above 3rd."
};
SpellsList["frostbite"] = {
	name : "Frostbite",
	classes : ["druid", "sorcerer", "warlock", "wizard"],
	source : [["X", 156], ["E", 18]],
	level : 0,
	school : "Evoc",
	time : "1 a",
	range : "60 ft",
	components : "V,S",
	duration : "Instantaneous",
	save : "Con",
	description : "1 crea save or 1d6 Cold dmg and dis. on next weapon attack roll; +1d6 at CL 5, 11, and 17",
	descriptionCantripDie : "1 crea save or `CD`d6 Cold dmg and dis. on next weapon attack roll",
	descriptionFull : "You cause numbing frost to form on one creature that you can see within range. The target must make a Constitution saving throw. On a failed save, the target takes 1d6 cold damage, and it has disadvantage on the next weapon attack roll it makes before the end of its next turn." + "\n   " + "The spell's damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6)."
};
SpellsList["gust"] = {
	name : "Gust",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["WGtE", 107], ["X", 157], ["E", 19], ["UA:D", 6]],
	level : 0,
	school : "Trans",
	time : "1 a",
	range : "30 ft",
	components : "V,S",
	duration : "Instantaneous",
	save : "Str",
	description : "Med. or smaller crea save or push 5 ft; or push unattended 5 lb obj 10 ft; or harmless sensory effect",
	descriptionFull : "You seize the air and compel it to create one of the following effects at a point you can see within range." + "\n " + "\u2022 One Medium or smaller creature that you choose must succeed on a Strength saving throw or be pushed up to 5 feet away from you." + "\n " + "\u2022 You create a small blast of air capable of moving one object that is neither held nor carried and that weighs no more than 5 pounds. The object is pushed up to 10 feet away from you. It isn't pushed with enough force to cause damage." + "\n " + "\u2022 You create a harmless sensory affect using air, such as causing leaves to rustle, wind to slam shutters shut, or your clothing to ripple in a breeze."
};
SpellsList["ice knife"] = {
	name : "Ice Knife",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 157], ["E", 19]],
	level : 1,
	school : "Conj",
	time : "1 a",
	range : "60 ft",
	components : "S,M",
	compMaterial : "A drop of water or piece of ice",
	duration : "Instantaneous",
	save : "Dex",
	description : "Ranged atk for 1d10 Piercing dmg; hit/miss 5-ft rad on target all crea save or 2d6+1d6/SL Cold dmg",
	descriptionFull : "You create a shard of ice and fling it at one creature within range. Make a ranged spell attack against the target. On a hit, the target takes 1d10 piercing damage. Hit or miss, the shard then explodes. The target and each creature within 5 feet of it must succeed on a Dexterity saving throw or take 2d6 cold damage." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the cold damage increases by 1d6 for each slot level above 1st."
};
SpellsList["immolation"] = {
	name : "Immolation",
	classes : ["sorcerer", "wizard"],
	source : [["X", 158], ["E", 19]],
	level : 5,
	school : "Evoc",
	time : "1 a",
	range : "90 ft",
	components : "V",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "1 crea save or 8d6 Fire dmg and burns for 4d6 Fire dmg/rnd; save each rnd to end; half dmg on save",
	descriptionFull : "Flames wreathe one creature you can see within range. The target must make a Dexterity saving throw. It takes 8d6 fire damage on a failed save, or half as much damage on a successful one. On a failed save, the target also burns for the spell's duration. The burning target sheds bright light in a 30-foot radius and dim light for an additional 30 feet. At the end of each of its turns, the target repeats the saving throw. It takes 4d6 fire damage on a failed save, and the spell ends on a successful one. These magical flames can't be extinguished by nonmagical means." + "\n   " + "If damage from this spell kills a target, the target is turned to ash."
};
SpellsList["investiture of flame"] = {
	name : "Investiture of Flame",
	classes : ["druid", "sorcerer", "warlock", "wizard"],
	source : [["X", 159], ["E", 19]],
	level : 6,
	school : "Trans",
	time : "1 a",
	range : "Self",
	components : "V,S",
	duration : "Conc, 10 min",
	save : "Dex",
	description : "Fire immune; Cold res.; 1d10 Fire dmg in 5 ft; 1 a 15-ft long 5-ft wide all crea 4d8 Fire dmg, save half",
	descriptionFull : "Flames race across your body, shedding bright light in a 30-foot radius and dim light for an additional 30 feet for the spell's duration. The flames don't harm you. Until the spell ends, you gain the following benefits." + "\n " + "\u2022 You are immune to fire damage and have resistance to cold damage." + "\n " + "\u2022 Any creature that moves within 5 feet of you for the first time on a turn or ends its turn there takes 1d10 fire damage." + "\n " + "\u2022 You can use your action to create a line of fire 15 feet long and 5 feet wide extending from you in a direction you choose. Each creature in the line must make a Dexterity saving throw. A creature takes 4d8 fire damage on a failed save, or half as much damage on a successful one."
};
SpellsList["investiture of ice"] = {
	name : "Investiture of Ice",
	classes : ["druid", "sorcerer", "warlock", "wizard"],
	source : [["X", 159], ["E", 19]],
	level : 6,
	school : "Trans",
	time : "1 a",
	range : "Self",
	components : "V,S",
	duration : "Conc, 10 min",
	save : "Con",
	description : "Cold immune; Fire resist; 10-ft rad dif. ter.; 1 a 15-ft cone all crea 4d6 Cold dmg, half speed, save half",
	descriptionFull : "Until the spell ends, ice rimes your body, and you gain the following benefits." + "\n " + "\u2022 You are immune to cold damage and have resistance to fire damage." + "\n " + "\u2022 You can move across difficult terrain created by ice or snow without spending extra movement." + "\n " + "\u2022 The ground in a 10-foot radius around you is icy and is difficult terrain for creatures other than you. The radius moves with you." + "\n " + "\u2022 You can use your action to create a 15-foot cone of freezing wind extending from your outstretched hand in a direction you choose. Each creature in the cone must make a Constitution saving throw. A creature takes 4d6 cold damage on a failed save, or half as much damage on a successful one. A creature that fails its save against this effect has its speed halved until the start of your next turn."
};
SpellsList["investiture of stone"] = {
	name : "Investiture of Stone",
	classes : ["druid", "sorcerer", "warlock", "wizard"],
	source : [["X", 159], ["E", 19]],
	level : 6,
	school : "Trans",
	time : "1 a",
	range : "Self",
	components : "V,S",
	duration : "Conc, 10 min",
	save : "Dex",
	description : "Nonmagical Bludg/Pierc/Slash resist.; 1 a 15-ft rad all crea save or prone; move through earth/stone",
	descriptionFull : "Until the spell ends, bits of rock spread across your body, and you gain the following benefits:" + "\n \u2022 " + "You have resistance to bludgeoning, piercing, and slashing damage from nonmagical attacks." + "\n \u2022 " + "You can use your action to create a small earthquake on the ground in a 15-foot radius centered on you. Other creatures on that ground must succeed on a Dexterity saving throw or be knocked prone." + "\n \u2022 " + "You can move across difficult terrain made of earth or stone without spending extra movement. You can move through solid earth or stone as if it was air and without destabilizing it, but you can't end your movement there. If you do so, you are ejected to the nearest unoccupied space, this spell ends, and you are stunned until the end of your next turn."
};
SpellsList["investiture of wind"] = {
	name : "Investiture of Wind",
	classes : ["druid", "sorcerer", "warlock", "wizard"],
	source : [["X", 160], ["E", 20]],
	level : 6,
	school : "Trans",
	time : "1 a",
	range : "Self",
	components : "V,S",
	duration : "Conc, 10 min",
	save : "Con",
	description : "Rngd wea atks dis. vs. me; fly 60 ft; 1 a 15-ft cube in 60 ft all 2d10 Bludg. dmg, push 10 ft, save half",
	descriptionFull : "Until the spell ends, wind whirls around you, and you gain the following benefits." + "\n " + "\u2022 Ranged weapon attacks made against you have disadvantage on the attack roll." + "\n " + "\u2022 You gain a flying speed of 60 feet. If you are still flying when the spell ends, you fall, unless you can somehow prevent it." + "\n " + "\u2022 You can use your action to create a 15-foot cube of swirling wind centered on a point you can see within 60 feet of you. Each creature in that area must make a Constitution saving throw. A creature takes 2d10 bludgeoning damage on a failed save, or half as much damage on a successful one. If a Large or smaller creature fails the save, that creature is also pushed up to 10 feet away from the center of the cube."
};
SpellsList["maelstrom"] = {
	name : "Maelstrom",
	classes : ["druid"],
	source : [["X", 160], ["E", 20]],
	level : 5,
	school : "Evoc",
	time : "1 a",
	range : "120 ft",
	components : "V,S,M",
	compMaterial : "Paper or leaf in the shape of a funnel",
	duration : "Conc, 1 min",
	save : "Str",
	description : "5-ft deep 30-ft rad dif. ter.; all crea starting turn in save or 6d6 Bludg. dmg and pulled 10 ft to center",
	descriptionFull : "A mass of 5-foot-deep water appears and swirls in a 30-foot radius centered on a point you can see within range. The point must be on ground or in a body of water. Until the spell ends, that area is difficult terrain, and any creature that starts its turn there must succeed on a Strength saving throw or take 6d6 bludgeoning damage and be pulled 10 feet toward the center."
};
SpellsList["magic stone"] = {
	name : "Magic Stone",
	classes : ["druid", "warlock"],
	source : [["X", 160], ["E", 20]],
	level : 0,
	school : "Trans",
	time : "1 bns",
	range : "Touch",
	components : "V,S",
	duration : "1 min",
	description : "Imbue 3 pebbles for spell attacks, thrown 60 ft or with sling, do 1d6+spellcasting mod Bludg. dmg",
	descriptionFull : "You touch one to three pebbles and imbue them with magic. You or someone else can make a ranged spell attack with one of the pebbles by throwing it or hurling it with a sling. If thrown, it has a range of 60 feet. If someone else attacks with the pebble, that attacker adds your spellcasting ability modifier, not the attacker's, to the attack roll. On a hit, the target takes bludgeoning damage equal to 1d6 + your spellcasting ability modifier. Hit or miss, the spell then ends on the stone." + "\n   " + "If you cast this spell again, the spell ends early on any pebbles still affected by it."
};
SpellsList["maximilian's earthen grasp"] = {
	name : "Maximilian's Earthen Grasp",
	nameShort : "Max's Earthen Grasp",
	nameAlt : "Earthen Grasp",
	classes : ["sorcerer", "wizard"],
	source : [["X", 161], ["E", 20]],
	level : 2,
	school : "Trans",
	time : "1 a",
	range : "30 ft",
	components : "V,S,M",
	compMaterial : "A miniature hand sculpted from clay",
	duration : "Conc, 1 min",
	save : "Str",
	description : "Medium hand atks 1 crea: save or 2d6 Bludg. dmg \u0026 restrained; 1 a hand moves/atks, releases; see B",
	descriptionFull : "You choose a 5-foot-square unoccupied space on the ground that you can see within range. A Medium hand made from compacted soil rises there and reaches for one creature you can see within 5 feet of it. The target must make a Strength saving throw. On a failed save, the target takes 2d6 bludgeoning damage and is restrained for the spell's duration." + "\n   " + "As an action, you can cause the hand to crush the restrained target, which must make a Strength saving throw. The target takes 2d6 bludgeoning damage on a failed save, or half as much damage on a successful one." + "\n   " + "To break out, the restrained target can use its action to make a Strength check against your spell save DC. On a success, the target escapes and is no longer restrained by the hand." + "\n   " + "As an action, you can cause the hand to reach for a different creature or to move to a different unoccupied space within range. The hand releases a restrained target if you do either."
};
SpellsList["melf's minute meteors"] = {
	name : "Melf's Minute Meteors",
	nameAlt : "Minute Meteors",
	classes : ["sorcerer", "wizard"],
	source : [["X", 161], ["E", 20]],
	level : 3,
	school : "Evoc",
	time : "1 a",
	range : "Self",
	components : "V,S,M",
	compMaterial : "Niter, sulfur, and pine tar formed into a bead",
	duration : "Conc, 10 min",
	save : "Dex",
	description : "6+2/SL meteors; at casting/bns a send up to two 120 ft for 5-ft rad all crea 2d6 Fire dmg; save half",
	descriptionFull : "You create six tiny meteors in your space. They float in the air and orbit you for the spell's duration. When you cast the spell-and as a bonus action on each of your turns thereafter-you can expend one or two of the meteors, sending them streaking toward a point or points you choose within 120 feet of you. Once a meteor reaches its destination or impacts against a solid surface, the meteor explodes. Each creature within 5 feet of the point where the meteor explodes must make a Dexterity saving throw. A creature takes 2d6 fire damage on a failed save, or half as much damage on a successful one." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the number of meteors created increases by two for each slot level above 3rd."
};
SpellsList["mold earth"] = {
	name : "Mold Earth",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 162], ["E", 21]],
	level : 0,
	school : "Trans",
	time : "1 a",
	range : "30 ft",
	components : "S",
	duration : "Instant. or 1 h",
	description : "5 cu ft earth; instant.: excavate; 1h: change to difficult or normal terrain, or change shape and color",
	descriptionFull : "You choose a portion of dirt or stone that you can see within range and that fits within a 5-foot cube. You manipulate it in one of the following ways." + "\n " + "\u2022 If you target an area of loose earth, you can instantaneously excavate it, move it along the ground, and deposit it up to 5 feet away. This movement doesn't have enough force to cause damage." + "\n " + "\u2022 You cause shapes, colors, or both to appear on the dirt or stone, spelling out words, creating images, or shaping patterns. The changes last for 1 hour." + "\n " + "\u2022 If the dirt or stone you target is on the ground, you cause it to become difficult terrain. Alternatively, you can cause the ground to become normal terrain if it is already difficult terrain. This change lasts for 1 hour." + "\n\n" + "If you cast this spell multiple times, you can have no more than two of its non-instantaneous effects active at a time, and you can dismiss such an effect as an action."
};
SpellsList["primordial ward"] = {
	name : "Primordial Ward",
	classes : ["druid"],
	source : [["X", 163], ["E", 21]],
	level : 6,
	school : "Abjur",
	time : "1 a",
	range : "Self",
	components : "V,S",
	duration : "Conc, 1 min",
	description : "Acid, Cold, Fire, Lightning, and Thunder resistance; use rea to gain 1 immunity for 1 rnd, spell ends",
	descriptionFull : "You have resistance to acid, cold, fire, lightning, and thunder damage for the spell's duration." + "\n   " + "When you take damage of one of those types, you can use your reaction to gain immunity to that type of damage, including against the triggering damage. If you do so, the resistances end, and you have the immunity until the end of your next turn, at which time the spell ends."
};
SpellsList["pyrotechnics"] = {
	name : "Pyrotechnics",
	classes : ["bard", "sorcerer", "wizard"],
	source : [["X", 163], ["E", 21]],
	level : 2,
	school : "Trans",
	time : "1 a",
	range : "60 ft",
	components : "V,S",
	duration : "Instantaneous",
	save : "Con",
	description : "5 cu ft nonma. flame extinguish, or 10-ft rad all crea save or blind 1 rnd, or 20-ft rad hvy obsc. 1 min",
	descriptionFull : "Choose an area of nonmagical flame that you can see and that fits within a 5-foot cube within range. You can extinguish the fire in that area, and you create either fireworks or smoke when you do so." + "\n   " + toUni("Fireworks") + ": The target explodes with a dazzling display of colors. Each creature within 10 feet of the target must succeed on a Constitution saving throw or become blinded until the end of your next turn." + "\n   " + toUni("Smoke") + ": Thick black smoke spreads out from the target in a 20-foot radius, moving around corners. The area of the smoke is heavily obscured. The smoke persists for 1 minute or until a strong wind disperses it."
};
SpellsList["shape water"] = {
	name : "Shape Water",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 164], ["E", 21]],
	level : 0,
	school : "Trans",
	time : "1 a",
	range : "30 ft",
	components : "S",
	duration : "Instant. or 1 h",
	description : "5 cu ft water; instant: move/change flow; 1h: simple shapes/change color or opacity/freeze",
	descriptionFull : "You choose an area of water that you can see within range and that fits within a 5-foot cube. You manipulate it in one of the following ways." + "\n " + "\u2022 You instantaneously move or otherwise change the flow of the water as you direct, up to 5 feet in any direction. This movement doesn't have enough force to cause damage." + "\n " + "\u2022 You cause the water to form into simple shapes and animate at your direction. This change lasts for 1 hour." + "\n " + "\u2022 You change the water's color or opacity. The water must be changed in the same way throughout. This change lasts for 1 hour." + "\n " + "\u2022 You freeze the water, provided that there are no creatures in it. The water unfreezes in 1 hour." + "\n\n" + "If you cast this spell multiple times, you can have no more than two of its non-instantaneous effects active at a time, and you can dismiss such an effect as an action."
};
SpellsList["skywrite"] = {
	name : "Skywrite",
	classes : ["bard", "druid", "wizard"],
	source : [["X", 165], ["E", 22]],
	ritual : true,
	level : 2,
	school : "Trans",
	time : "1 a",
	range : "Sight",
	components : "V,S",
	duration : "Conc, 1 h",
	description : "Write up to 10 words with clouds in a part of the sky I can see; strong wind can diperse the clouds",
	descriptionFull : "You cause up to ten words to form in a part of the sky you can see. The words appear to be made of cloud and remain in place for the spell's duration. The words dissipate when the spell ends. A strong wind can disperse the clouds and end the spell early."
};
SpellsList["snilloc's snowball swarm"] = {
	name : "Snilloc's Snowball Swarm",
	nameAlt : "Snowball Swarm",
	classes : ["sorcerer", "wizard"],
	source : [["X", 165], ["E", 22]],
	level : 2,
	school : "Evoc",
	time : "1 a",
	range : "90 ft",
	components : "V,S,M",
	compMaterial : "A piece of ice or a small white rock chip",
	duration : "Instantaneous",
	save : "Dex",
	description : "5-ft radius all creatures 3d6+1d6/SL Cold damage; save halves",
	descriptionFull : "A flurry of magic snowballs erupts from a point you choose within range. Each creature in a 5-foot-radius sphere centered on that point must make a Dexterity saving throw. A creature takes 3d6 cold damage on a failed save, or half as much damage on a successful one." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d6 for each slot level above 2nd."
};
SpellsList["storm sphere"] = {
	name : "Storm Sphere",
	classes : ["sorcerer", "wizard"],
	source : [["X", 166], ["E", 22]],
	level : 4,
	school : "Evoc",
	time : "1 a",
	range : "150 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	save : "Str",
	description : "20-ft rad dif. ter.; all crea now/end turn save 2d6 bludg.; bns 60 ft spell atk 4d6 lightn. dmg; +1d6/SL",
	descriptionFull : "A 20-foot-radius sphere of whirling air springs into existence centered on a point you choose within range. The sphere remains for the spell's duration. Each creature in the sphere when it appears or that ends its turn there must succeed on a Strength saving throw or take 2d6 bludgeoning damage. The sphere's space is difficult terrain." + "\n   " + "Until the spell ends, you can use a bonus action on each of your turns to cause a bolt of lightning to leap from the center of the sphere toward one creature you choose within 60 feet of the center. Make a ranged spell attack. You have advantage on the attack roll if the target is in the sphere. On a hit, the target takes 4d6 lightning damage." + "\n   " + "Creatures within 30 feet of the sphere have disadvantage on Wisdom (Perception) checks made to listen." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, the damage increases for each of its effects by 1d6 for each slot level above 4th."
};
SpellsList["thunderclap"] = {
	name : "Thunderclap",
	classes : ["bard", "druid", "sorcerer", "warlock", "wizard"],
	source : [["X", 168], ["E", 22]],
	level : 0,
	school : "Evoc",
	time : "1 a",
	range : "5 ft",
	components : "S",
	duration : "Instantaneous",
	save : "Con",
	description : "100-ft rad audible; all crea but me in area save or 1d6 Thunder dmg; +1d6 at CL 5, 11, and 17",
	descriptionCantripDie : "100-ft rad audible; all crea but me in area save or `CD`d6 Thunder dmg",
	descriptionFull : "You create a burst of thunderous sound that can be heard up to 100 feet away. Each creature within range, other than you, must succeed on a Constitution saving throw or take 1d6 thunder damage." + "\n   " + "The spell's damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6)."
};
SpellsList["tidal wave"] = {
	name : "Tidal Wave",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 168], ["E", 22]],
	level : 3,
	school : "Conj",
	time : "1 a",
	range : "120 ft",
	components : "V,S,M",
	compMaterial : "A drop of water",
	duration : "Instantaneous",
	save : "Dex",
	description : "30-ft x 10-ft, 10-ft high all crea 4d8 Bludg. dmg and prone; save halves not prone; extinguish flames",
	descriptionFull : "You conjure up a wave of water that crashes down on an area within range. The area can be up to 30 feet long, up to 10 feet wide, and up to 10 feet tall. Each creature in that area must make a Dexterity saving throw. On a failed save, a creature takes 4d8 bludgeoning damage and is knocked prone. On a successful save, a creature takes half as much damage and isn't knocked prone. The water then spreads out across the ground in all directions, extinguishing unprotected flames in its area and within 30 feet of it, and then it vanishes."
};
SpellsList["transmute rock"] = {
	name : "Transmute Rock",
	classes : ["druid", "wizard"],
	source : [["X", 169], ["E", 22]],
	level : 5,
	school : "Trans",
	time : "1 a",
	range : "120 ft",
	components : "V,S,M",
	compMaterial : "Clay and water",
	duration : "Until dispelled",
	description : "40 cu ft stone to mud or mud to stone; mud and stone restrains; mud from ceiling falls; see book",
	descriptionFull : "You choose an area of stone or mud that you can see that fits within a 40-foot cube and is within range, and choose one of the following effects." + "\n   " + toUni("Transmute Rock to Mud") + ": Nonmagical rock of any sort in the area becomes an equal volume of thick, flowing mud that remains for the spell's duration." + "\n   " + "The ground in the spell's area becomes muddy enough that creatures can sink into it. Each foot that a creature moves through the mud costs 4 feet of movement, and any creature on the ground when you cast the spell must make a Strength saving throw. A creature must also make the saving throw when it moves into the area for the first time on a turn or ends its turn there. On a failed save, a creature sinks into the mud and is restrained, though it can use an action to end the restrained condition on itself by pulling itself free of the mud." + "\n   " + "If you cast the spell on a ceiling, the mud falls. Any creature under the mud when it falls must make a Dexterity saving throw. A creature takes 4d8 bludgeoning damage on a failed save, or half as much damage on a successful one." + "\n   " + toUni("Transmute Mud to Rock") + ": Nonmagical mud or quicksand in the area no more than 10 feet deep transforms into soft stone for the spell's duration. Any creature in the mud when it transforms must make a Dexterity saving throw. On a successful save, a creature is shunted safely to the surface in an unoccupied space. On a failed save, a creature becomes restrained by the rock. A restrained creature, or another creature within reach, can use an action to try to break the rock by succeeding on a DC 20 Strength check or by dealing damage to it. The rock has AC 15 and 25 hit points, and it is immune to poison and psychic damage."
};
SpellsList["vitriolic sphere"] = {
	name : "Vitriolic Sphere",
	classes : ["sorcerer", "wizard"],
	source : [["X", 170], ["E", 23]],
	level : 4,
	school : "Evoc",
	time : "1 a",
	range : "150 ft",
	components : "V,S,M",
	compMaterial : "A drop of giant slug bile",
	duration : "Instantaneous",
	save : "Dex",
	description : "20-ft rad all crea 10d4+2d4/SL now and 5d4 Acid dmg at end next turn; save half \u0026 no dmg next rnd",
	descriptionFull : "You point at a location within range, and a glowing, 1-foot-diameter ball of emerald acid streaks there and explodes in a 20-foot-radius sphere. Each creature in that area must make a Dexterity saving throw. On a failed save, a creature takes 10d4 acid damage and another 5d4 acid damage at the end of its next turn. On a successful save, a creature takes half the initial damage and no damage at the end of its next turn." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, the initial damage increases by 2d4 for each slot level above 4th."
};
SpellsList["wall of sand"] = {
	name : "Wall of Sand",
	classes : ["wizard"],
	source : [["X", 170], ["E", 23]],
	level : 3,
	school : "Evoc",
	time : "1 a",
	range : "90 ft",
	components : "V,S,M",
	compMaterial : "A handful of sand",
	duration : "Conc, 10 min",
	description : "30\u00D710\u00D710ft (l\u00D7w\u00D7h) wall on the ground; blocks line of sight; blinded while inside; 1/3 move",
	descriptionMetric : "9\u00D73\u00D73m (l\u00D7w\u00D7h) wall on the ground; blocks line of sight; blinded while inside; 1/3 move",
	descriptionFull : "You conjure up a wall of swirling sand on the ground at a point you can see within range. You can make the wall up to 30 feet long, 10 feet high, and 10 feet thick, and it vanishes when the spell ends. It blocks line of sight but not movement. A creature is blinded while in the wall's space and must spend 3 feet of movement for every 1 foot it moves there."
};
SpellsList["wall of water"] = {
	name : "Wall of Water",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 170], ["E", 23]],
	level : 3,
	school : "Evoc",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M",
	compMaterial : "A drop of water",
	duration : "Conc, 10 min",
	description : "30\u00D71\u00D710ft (l\u00D7w\u00D7h) or 20-ft rad 20-ft high; dif. ter.; range wea dis.; Fire dmg half; Cold dmg freezes",
	descriptionMetric : "9\u00D70,3\u00D73m (l\u00D7w\u00D7h) or 6-m rad 6-m high; dif. ter.; ranged wea dis.; Fire dmg half; Cold dmg freezes",
	descriptionFull : "You conjure up a wall of water on the ground at a point you can see within range. You can make the wall up to 30 feet long, 10 feet high, and 1 foot thick, or you can make a ringed wall up to 20 feet in diameter, 20 feet high, and 1 foot thick. The wall vanishes when the spell ends. The wall's space is difficult terrain." + "\n   " + "Any ranged weapon attack that enters the wall's space has disadvantage on the attack roll, and fire damage is halved if the fire effect passes through the wall to reach its target. Spells that deal cold damage that pass through the wall cause the area of the wall they pass through to freeze solid (at least a 5-foot square section is frozen). Each 5-foot-square frozen section has AC 5 and 15 hit points. Reducing a frozen section to 0 hit points destroys it. When a section is destroyed, the wall's water doesn't fill it."
};
SpellsList["warding wind"] = {
	name : "Warding Wind",
	classes : ["bard", "druid", "sorcerer", "wizard"],
	source : [["X", 170], ["E", 23]],
	level : 2,
	school : "Evoc",
	time : "1 a",
	range : "10-ft rad",
	components : "V",
	duration : "Conc, 10 min",
	description : "Strong (20 mph) wind in area deafens/extinguishes unprotected flames/dif. ter./ranged wea have dis",
	descriptionFull : "A strong wind (20 miles per hour) blows around you in a 10-foot radius and moves with you, remaining centered on you. The wind lasts for the spell's duration." + "\n   " + "The wind has the following effects." + "\n " + "\u2022 It deafens you and other creatures in its area." + "\n " + "\u2022 It extinguishes unprotected flames in its area that are torch-sized or smaller." + "\n " + "\u2022 The area is difficult terrain for creatures other than you." + "\n " + "\u2022 The attack rolls of ranged weapon attacks have disadvantage if they pass in or out of the wind." + "\n " + "\u2022 It hedges out vapor, gas, and fog that can be dispersed by strong wind."
};
SpellsList["watery sphere"] = {
	name : "Watery Sphere",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 170], ["E", 23]],
	level : 4,
	school : "Conj",
	time : "1 a",
	range : "90 ft",
	components : "V,S,M",
	compMaterial : "A droplet of water",
	duration : "Conc, 1 min",
	save : "Str",
	description : "5-ft rad all crea < Huge save or restrained; on save ejected; save each rnd; 1 a move sphere 30 ft",
	descriptionFull : "You conjure up a sphere of water with a 5-foot radius at a point you can see within range. The sphere can hover but no more than 10 feet off the ground. The sphere remains for the spell's duration." + "\n   " + "Any creature in the sphere's space must make a Strength saving throw. On a successful save, a creature is ejected from that space to the nearest unoccupied space of the creature's choice outside the sphere. A Huge or larger creature succeeds on the saving throw automatically, and a Large or smaller creature can choose to fail it. On a failed save, a creature is restrained by the sphere and is engulfed by the water. At the end of each of its turns, a restrained target can repeat the saving throw, ending the effect on itself on a success." + "\n   " + "The sphere can restrain as many as four Medium or smaller creatures or one Large creature. If the sphere restrains a creature that causes it to exceed this capacity, a random creature that was already restrained by the sphere falls out of it and lands prone in a space within 5 feet of it." + "\n   " + "As an action, you can move the sphere up to 30 feet in a straight line. If it moves over a pit, a cliff, or other drop-off, it safely descends until it is hovering 10 feet above the ground. Any creature restrained by the sphere moves with it. You can ram the sphere into creatures, forcing them to make the saving throw." + "\n   " + "When the spell ends, the sphere falls to the ground and extinguishes all normal flames within 30 feet of it. Any creature restrained by the sphere is knocked prone in the space where it falls. The water then vanishes."
};
SpellsList["whirlwind"] = {
	name : "Whirlwind",
	classes : ["druid", "sorcerer", "wizard"],
	source : [["X", 171], ["E", 24]],
	level : 7,
	school : "Evoc",
	time : "1 a",
	range : "300 ft",
	components : "V,M",
	compMaterial : "A piece of straw",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "10-ft rad 30-ft high all crea 10d6 Bludg. dmg; save halves; restrains; 1 a move 30 ft; see book",
	descriptionFull : "A whirlwind howls down to a point that you can see on the ground within range. The whirlwind is a 10-foot-radius, 30-foot-high cylinder centered on that point. Until the spell ends, you can use your action to move the whirlwind up to 30 feet in any direction along the ground. The whirlwind sucks up any Medium or smaller objects that aren't secured to anything and that aren't worn or carried by anyone." + "\n   " + "A creature must make a Dexterity saving throw the first time on a turn that it enters the whirlwind or that the whirlwind enters its space, including when the whirlwind first appears. A creature takes 10d6 bludgeoning damage on a failed save, or half as much damage on a successful one. In addition, a Large or smaller creature that fails the save must succeed on a Strength saving throw or become restrained in the whirlwind until the spell ends. When a creature starts its turn restrained by the whirlwind, the creature is pulled 5 feet higher inside it, unless the creature is at the top. A restrained creature moves with the whirlwind and falls when the spell ends, unless the creature has some means to stay aloft." + "\n   " + "A restrained creature can use an action to make a Strength or Dexterity check against your spell save DC. If successful, the creature is no longer restrained by the whirlwind and is hurled 3d6 \u00D7 10 feet away from it in a random direction."
};

// Weapons (attack cantrips)
WeaponsList["create bonfire"] = {
	regExpSearch : /^(?=.*create)(?=.*bonfire).*$/i,
	name : "Create Bonfire",
	source : [["X", 152], ["E", 16]],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["C", 8, "fire"],
	range : "60 ft",
	description : "5-ft cube; Dex save at casting or when moved into, success - no damage; Conc, 1 min (EE 16)",
	abilitytodamage : false,
	dc : true
};
WeaponsList["frostbite"] = {
	regExpSearch : /frostbite/i,
	name : "Frostbite",
	source : [["X", 156], ["E", 18]],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["C", 6, "cold"],
	range : "60 ft",
	description : "Con save, success - no damage, fail - also disadv. on next weapon attack roll in next turn; 1 creature (EE 18)",
	abilitytodamage : false,
	dc : true
};
WeaponsList["magic stone"] = {
	regExpSearch : /^(?=.*magic)(?=.*stone).*$/i,
	name : "Magic Stone",
	source : [["X", 160], ["E", 20]],
	list : "spell",
	ability : 5,
	type : "Cantrip",
	damage : [1, 6, "bludgeoning"],
	range : "60/120 ft",
	description : "Produces 3 stones that each can be thrown (60 ft) or hurled with a sling (120 ft) as a spell attack (EE 20)",
	abilitytodamage : true
};
WeaponsList["thunderclap"] = {
	regExpSearch : /thunderclap/i,
	name : "Thunderclap",
	source : [["X", 168], ["E", 22]],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["C", 6, "thunder"],
	range : "5-ft radius",
	description : "Con save, success - no damage; all creatures in area; audible in 100 ft (EE 22)",
	abilitytodamage : false,
	dc : true
};
var iFileName = "pub_20150714_AL-RoD.js";
RequiredSheetVersion(12.999);
// This file adds the optional backgrounds from the Adventurers League season 3 (Rage of Demons) to MPMB's Character Record Sheet

// Define the source
SourceList["AL:RoD"]={
	name : "Rage of Demons Backgrounds [Hillsfar]",
	abbreviation : "AL:RoD",
	group : "Adventurers League",
	url : "https://dndadventurersleague.org/wp-content/uploads/2015/07/Hillsfar-Regional-Character-Options.pdf",
	date : "2015/07/14"
};

// Backgrounds (with contributions by AggieBear)
BackgroundList["cormanthor refugee"] = {
	regExpSearch :  /^(?=.*cormanthor)(?=.*refugee).*$/i,
	name : "Cormanthor Refugee",
	source : [["AL:RoD", 5], ["ALbackground", 0]],
	skills : ["Nature", "Survival"],
	gold : 5,
	equipleft : [
		["Two-person tent", "", 20],
		["Set of artisan's tools", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Holy symbol (type)", "", 1],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Shelter of the Elven Clergy",
	trait : [
		"I long for a home that never really existed, whether in the camps, Hillsfar, or Myth Drannor.",
		"Though I am not an elf, I am a fervent, radical worshipper of the elven gods.",
		"I live in the moment, knowing my life could be turned upside down any day.",
		"I appreciate beauty in all of its forms.",
		"I hate the dark elves and the Netherese for each driving the elves out of Cormanthyr in the past.",
		"I am a forest bumpkin who grew up in a tent in the woods and is wholly ignorant of city life.",
		"I was raised alongside children of many other races. I harbor no racial prejudices at all.",
		"The elves have just the right word for so many things that cannot be expressed as well in other languages. I pepper my speech with elven words, phrases, and sayings."
	],
	ideal : [
		["Patient",
			"Patient: The elves have taught me to think and plan for the long-term. (Lawful)"
		],
		["Rebellious",
			"Rebellious: Governments and politicians drove my family to the camps. I subtly defy authority whenever I think I can get away with it. (Chaotic)"
		],
		["Self-Absorbed",
			"Self-Absorbed: I've had to look out for number one so long that it has become second nature. (Any)"
		],
		["Wanderlust",
			"Wanderlust: I want to see as much of the world beyond the camps as I can. (Any)"
		],
		["Generous",
			"Generous: I give everything I can to help those in need, regardless of who they are. (Good)"
		],
		["To the Abyss with Them",
			"To the Abyss with Them: The people of Hillsfar cast me out. I won't risk my hide to help them. (Evil)"
		]
	],
	bond : [
		"The elves took me in when I had nowhere else to go. In return, I do what I can to help elves in need.",
		"I seek revenge against the people of Hillsfar for driving my family into the forest.",
		"My family lost everything when they were driven from Hillsfar. I strive to rebuild that fortune.",
		"The forest has provided me with food and shelter. In return, I protect forests and those who dwell within.",
		"I am deeply, tragically in love with someone whose racial lifespan is far longer or shorter than mine.",
		"Members of my extended family did not make it to the camps or have been kidnapped to fight in the Arena. I search for them tirelessly."
	],
	flaw : [
		"I am very uncomfortable indoors and underground",
		"I am haughty. I grew up among the elves and emulate them. Other races are crude in comparison.",
		"Elf this, elf that. I am sick and tired of the elves.",
		"I am a miser. Having lost everything once before, I clutch my possessions and wealth very tightly.",
		"I am a moocher. I am so used to others providing for me that I have come to expect everyone to do it.",
		"I believe the gods have cursed me, my family, and all of the Cormanthor refugees. We are all doomed, doomed I tell you!"
	],
	toolProfs : [["Artisan's tools", 1]],
	languageProfs : ["Elvish"],
	lifestyle : "poor"
};
BackgroundList["gate urchin"] = {
	regExpSearch :  /^(?=.*gate)(?=.*urchin).*$/i,
	name : "Gate Urchin",
	source : [["AL:RoD", 6], ["ALbackground", 0]],
	skills : ["Deception", "Sleight of Hand"],
	gold : 10,
	equipleft : [
		["Battered alms box", "", 1]
	],
	equipright : [
		["Common clothes", "", 3],
		["Cast-off military jacket, cap, or scarf", "", ""],
		["Belt pouch (with coins)", "", 1],
		["Musical instrument of my choice", "", ""]
	],
	feature : "Red Plume and Mage Guild Contacts",
	trait : [
		"I appreciate the simple things in life: a song, a warm meal, a sunny day. I don't need any more.",
		"My problems are always caused by others. I'm never to blame.",
		"I am afraid I could wind up back on the streets any day.",
		"I get along with everyone.",
		"I see people as marks for a con and have difficulty feeling true empathy for them.",
		"I have a real flair for matchmaking. I can find anyone a spouse!",
		"I think money is the true measure of appreciation and affection. Everything else is talk or an act.",
		"I don't like having a lot of stuff, just a few simple things I need. I don't like being tied down and tend to leave things behind when I don't need them anymore."
	],
	ideal : [
		["Loyal",
			"Loyal: I never rat out any of my friends, even when the Red Plumes or the Rogues Guild ask. (Lawful)"
		],
		["Adventurous",
			"Adventurous: I don't like doing the same thing every day. I crave variety. (Chaotic)"
		],
		["Strong",
			"Strong: Only the strong survive. I respect those who are strong and powerful. (Any)"
		],
		["Witty",
			"Witty: Brains are better than brawn. I rely on my wits and respect others who do the same. (Any)"
		],
		["Honest",
			"Honest: Others can do what they want, but I won't lie or steal, even to feed my family. (Good)"
		],
		["Ungrateful",
			"Ungrateful: Those who give, only do it to make themselves feel better. I steal from them. (Evil)"
		]
	],
	bond : [
		"The Joydancers of Lliira gave me my instrument when I really needed food. I hate them for that.",
		"Busking has taught me to love music above all else.",
		"The Rogues Guild spared me when I did a job without cutting them in. I owe them a great debt.",
		"I know people hate the Red Plumes, but some of them were really good to me. I help Red Plumes whenever I can, and I respect them. They're just doing what they have to do to get by in this world.",
		"I will be wealthy some day. My descendants will live in comfort and style.",
		"I know how hard life on the streets is. I do everything I can for those who have less than me."
	],
	flaw : [
		"Though I no longer live at the Gate, I am still always concerned about where I will get my next meal.",
		"Years of thieving have become habit. I sometimes steal from strangers without thinking about it.",
		"I am ashamed of my origins. I pretend I am higher-born and fear others will find out the truth.",
		"I think people who grew up in houses are soft, spoiled, and ungrateful. I frequently tell them so.",
		"I am still very uncomfortable wearing nice clothes, sleeping in a warm bed, and eating fine food.",
		"I do not trust anyone who has not had a hard life."
	],
	toolProfs : [["Thieves' tools", "Dex"], ["Musical instrument", 1]],
	lifestyle : "poor"
};
BackgroundList["hillsfar merchant"] = {
	regExpSearch :  /^(?=.*hillsfar)(?=.*merchant).*$/i,
	name : "Hillsfar Merchant",
	source : [["AL:RoD", 7], ["ALbackground", 0]],
	skills : ["Insight", "Persuasion"],
	gold : 25,
	equipright : [
		["Fine clothes", "", 6],
		["Signet ring", "", ""],
		["Purse (with coins)", "", 1],
		["Letter of introduction from family's trading house", "", 1]
	],
	feature : "Factor",
	featureAlt : "Trade Contact",
	trait : [
		"I fill my evenings with wine or mead and song.",
		"I greatly admire gladiators and enjoy the Arena.",
		"I take my wealth for granted. It seldom occurs to me that others aren't rich themselves.",
		"I leave broken hearts all around the Moonsea and up and down the Sword Coast.",
		"I work hard and seldom make time for fun.",
		"I am a particularly devout and pray often.",
		"The Red Plumes caught me once. I hate them.",
		"I ask a lot of questions to get information about those with whom I am working and dealing."
	],
	ideal : [
		["Frugal",
			"Frugal: I spend my money very carefully. (Lawful)"
		],
		["Profligate",
			"Profligate: I tend to spend extravagantly. (Chaotic)"
		],
		["Honest",
			"Honest: I deal with others above board. (Any)"
		],
		["Sharp",
			"Sharp: I seek to make the best deal possible. (Any)"
		],
		["Charitable",
			"Charitable: I give generously to others. (Good)"
		],
		["Greedy",
			"Greedy: I do not share my wealth with others. (Evil)"
		]
	],
	bond : [
		"I am fiercely loyal to those with whom I work.",
		"I must uphold the good name of my family.",
		"I will prove myself to my family as an adventurer.",
		"Deals are sacrosanct. I never go back on my word.",
		"I love making deals and negotiating agreements.",
		"I guard my wealth jealously."
	],
	flaw : [
		"I am a braggart. I promote myself shamelessly.",
		"I am vain. I always wear the latest fashions.",
		"I am a glutton. I eat and drink to excess.",
		"I am a snob. I want only the finest things in life.",
		"I am lazy. I want others to take care of everything.",
		"I am overconfident. I overestimate my abilities."
	],
	toolProfs : ["Vehicles (land)", "Vehicles (water)"],
	lifestyle : "wealthy"
};
BackgroundList["hillsfar smuggler"] = {
	regExpSearch :  /^(?=.*hillsfar)(?=.*smuggler).*$/i,
	name : "Hillsfar Smuggler",
	source : [["AL:RoD", 8], ["ALbackground", 0]],
	skills : ["Perception", "Stealth"],
	gold : 5,
	equipleft : [
		["Forgery kit", "", 5]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Secret Passage",
	trait : [
		"When I'm not smuggling, I gamble.",
		"I just love Halfling cooking and baking!",
		"I party with dwarves whenever I can.",
		"I'm a terrible singer, but I love to do it.",
		"I was raised to honor Chauntea and still do.",
		"The blood sports of the Arena sicken me.",
		"I think non-humans are really interesting.",
		"I exaggerate the tales of my exploits."
	],
	ideal : [
		["Fair",
			"Fair: I think everyone deserves to be treated fairly. I don't play favorites. (Lawful)"
		],
		["Impulsive",
			"Impulsive: Planning is often a waste of time. No plan survives contact with reality. It's easier to dive in and deal with the consequences. (Chaotic)"
		],
		["Curious",
			"Curious: I want to learn as much as I can about the people and places I encounter. (Any)"
		],
		["Prepared",
			"Prepared: I think success depends on preparing as much as possible in advance. (Any)"
		],
		["Respectful",
			"Respectful: I think everyone deserves to be treated with respect and dignity, regardless of their race, creed, color, or origin. (Good)"
		],
		["Corrupt",
			"Corrupt: I will break the law or act dishonestly if the money is right. (Evil)"
		]
	],
	bond : [
		"I am loyal to the Rogues Guild and would do anything for them.",
		"I love the city of Hillsfar and my fellow Hillsfarians, despite the recent problems.",
		"I admire the elves. I help them whenever I can.",
		"A gnome helped me once. I pay the favor forward.",
		"I enjoy tricking the Red Plumes at every opportunity.",
		"I smuggled agricultural goods for non-human farmers. I try to help them when I can."
	],
	flaw : [
		"My hatred for the Red Plumes burns so brightly that I have difficulty suppressing It around them.",
		"The Red Plumes caught me once before, and I was branded for my crime. If they catch me again, for any offense, the punishment will be dire..",
		"I treat all Hillsfarans poorly. I am disgusted with their failure to revolt against the Great Law of Humanity.",
		"I have difficulty trusting strangers. Anyone could be a spy for the authorities.",
		"I am greedy. There Isn't much I won't do for money.",
		"I'm an informant for the Red Plumes. They let me continue my activities, so long as I pass them information about illegal activity in Hillsfar."
	],
	toolProfs : ["Forgery kit"],
	languageProfs : [1],
	lifestyle : "modest"
};
BackgroundList["secret identity"] = {
	regExpSearch : /^(?=.*secret)(?=.*identity).*$/i,
	name : "Secret Identity",
	source : [["AL:RoD", 9], ["ALbackground", 0]],
	skills : ["Deception", "Stealth"],
	gold : 5,
	equipleft : [
		["Disguise kit", "", 3],
		["Forgery kit", "", 5]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Secret Identity",
	trait : [
		"Despite its problems, I love Hillsfar, it's the greatest city in the world. The only one for me.",
		"I move from place to place, never staying anywhere long and leaving nothing behind.",
		"I think flattery is the best way to direct attention away from me.",
		"I don't make friends easily. They're a liability I cannot afford.",
		"Risk and danger are exhilarate me. Pulling off schemes and deceptions is a rush.",
		"The First Lord is right, humans are superior. I really admire them, despite the atrocities.",
		"I avoid people of my own race, as well as things associated with my race, lest they give me away.",
		"I live for the Arena. I admire gladiators and enjoy the thrill of blood on the sands!"
	],
	ideal : [
		["Quisling",
			"Quisling: Supporting the rulers of the land and following the laws is the road to salvation. (Lawful)"
		],
		["Scoflaw",
			"Scoflaw: The laws and lawmakers are corrupt. I follow laws only when it suits me. (Chaotic))"
		],
		["Optimist",
			"Optimist: Everyone Is basically good. Though the government is misguided it will all be okay. (Any)"
		],
		["Secretive",
			"Secretive: I am in the habit of not talking about myself. My business is none of yours. (Any)"
		],
		["Heroic",
			"Heroic: I do everything I can to help non-humans, regardless of the personal cost to me. (Good)"
		],
		["Depraved",
			"Depraved: I have lost my moral compass. The ends justify most any means. (Evil)"
		]
	],
	bond : [
		"The humans of Hillsfar have inflicted terrible harm on me, my family, and my race. I will have revenge.",
		"I am part of an underground network that smuggles non-humans into and out of the city.",
		"I am a partisan. I commit minor acts of defiance against the First Lord and Red Plumes when I can.",
		"I am a spy. I report on events in and around Hillfar.",
		"My secret identity is the only thing protecting me from the Arena. I will stop at nothing to maintain it.",
		"I am madly in love with a human who does not know my true identity, and I fear rejection if I reveal it."
	],
	flaw : [
		"After years of denying who I am, I now despise myself and other members of my pathetic race.",
		"Years of hiding have made me somewhat paranoid. I trust no one.",
		"I've been lying so often and for so long that I can't help it anymore. I frequently lie for no reason at all.",
		"I am ashamed. I failed to protect a member of my family who was seized and thrown into the Area.",
		"I am struggling with maintaining my secret identity. I subconsciously want to get caught and therefore sometimes let my secret identity slip.",
		"Years of successfully deceiving others have made me cocky. I think no one can see through my lies."
	],
	toolProfs : ["Disguise kit", "Forgery kit"],
	lifestyle : "modest"
};
BackgroundList["shade fanatic"] = {
	regExpSearch : /^(?=.*shade)(?=.*fanatic).*$/i,
	name : "Shade Fanatic",
	source : [["AL:RoD", 10], ["ALbackground", 0]],
	skills : ["Deception", "Intimidation"],
	gold : 15,
	equipleft : [
		["Forgery kit", "", 5],
		["Transparent shadow cylinder", "", ""]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Signet ring", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Secret Society",
	trait : [
		"I am a bully; I try to hide it though.",
		"I let my actions speak for themselves",
		"I am important; I will not let anyone forget that.",
		"You are either with me or against me.",
		"I know it is only a time before I am betrayed by those I care for.",
		"I never understand why people get so emotional.",
		"They are out to get me. It is only my cunning that keeps me ahead of them",
		"Everyone has a choice, the one I make is always right though."
	],
	ideal : [
		["Hope",
			"Hope: I know even if I need do evil acts, history will be my redemption. (Chaos)"
		],
		["Dedicated",
			"Dedicated: I can do anything I put my mind to (Lawful)"
		],
		["Exciting",
			"Exciting: I have found the truth of the Shadovar and want to share it with everyone. (Any)"
		],
		["Frugal",
			"Frugal: I horde my possessions knowing that someday I will be called upon to give everything I have to the cause (Any)"
		],
		["Eloquent",
			"Eloquent: I use my words to sway others to my beliefs. (Any)"
		],
		["Compassionate",
			"Compassionate: It is through love that others will join In our cause. (Good)"
		]
	],
	bond : [
		"They say the Shade broke the bonds of mortality; I want to find out how.",
		"The whispers in my head remind me that there is power to be found in the shadows.",
		"For the glory of Netheril, I will grow in power.",
		"I once lived in Hillsfar, I was chased out before I was able to say farewell.",
		"My true love was a killed by the Red Plumes; I plot to make them suffer.",
		"I had a loved one die in the arena at Hillsfar; I am out to prove I am stronger than them!"
	],
	flaw : [
		"I always over exaggerate my abilities.",
		"I cannot bear to let those I care for out of my sight.",
		"I am incapable of standing up for myself.",
		"The group I am with has committed atrocities; I am always worried their actions will become public.",
		"I always enjoy a good mug of ale … or five.",
		"I know what I do is wrong, but am afraid to speak up about it."
	],
	toolProfs : ["Forgery kit"],
	languageProfs : ["Netherese"],
	lifestyle : "moderate"
};
BackgroundList["trade sheriff"] = {
	regExpSearch :  /^(?=.*trade)(?=.*sheriff).*$/i,
	name : "Trade Sheriff",
	source : [["AL:RoD", 11], ["ALbackground", 0]],
	skills : ["Investigation", "Persuasion"],
	gold : 17,
	equipleft : [
		["Thieves' tools", "", 1]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Gray cloak", "", ""],
		["Sheriff's insignia", "", ""]
	],
	feature : "Investigative Services",
	trait : [
		"I am always polite and respectful",
		"I let my actions speak for themselves",
		"I am haunted by my past having seen the murder of a close friend or family member and it is the one case I always needed to solve but have not been able to.",
		"I am quick to judge and slow to vindicate",
		"I can be very persuasive and am able to ask questions where others might not be able to.",
		"I have a quirky personality that seems to take others off their guard.",
		"My sense of humor is considered by most to be awkward",
		"Everyone has a choice, and they can always make the right choice, mine!"
	],
	ideal : [
		["Hope",
			"Hope: my job is to speak for the victim (good)"
		],
		["Dedicated",
			"Dedicated: Once I start an investigation, until told to do so, I do not quit, not matter where it leads. (Lawful)"
		],
		["Nation",
			"Nation: My city, nation, or people are all that matter (any)"
		],
		["Mercenary",
			"Mercenary: When I do investigations, I expect answers immediately (Any)"
		],
		["Eloquent",
			"Eloquent: I use my words to sway others to give me answers.(good)"
		],
		["Might",
			"Might: It is through threats and force that I get my answers (lawful)"
		]
	],
	bond : [
		"To this day an unsolved case will always leave me haunted and bother me.",
		"Through the might of my personality I will solve an investigation or puzzle.",
		"It is my right to believe what I will, just try and stop me.",
		"I need to prove my worth to my fellow Sheriffs.",
		"Someone I cared for died under suspicious circumstances. I will find out what happened to them and bring their killer to justice.",
		"I speak for those that cannot speak for themselves."
	],
	flaw : [
		"I always over exaggerate my abilities.",
		"I cannot bear to let those I care for out of my sight.",
		"I took a bribe to tank an investigation and I would do anything to keep it secret.",
		"I have little respect for those that are of \"low\" intelligence/race.",
		"I always enjoy a good mug of ale … or five to cover up my past.",
		"I speak for the First Lord of Hillsfar and make sure everyone knows it."
	],
	toolProfs : [["Thieves' tools", "Dex"]],
	languageProfs : ["Elvish"],
	lifestyle : "moderate"
};

// Background features
BackgroundFeatureList["factor"] = {
	description : "My family has assigned me the services of a loyal retainer from the business. This person can perform mundane tasks for me such as making purchases, delivering messages, and running errands. He or she will not fight for me or follow me into danger, and will leave if frequently endangered or abused. If killed, my family assigns me another within days.",
	source : [["AL:RoD", 7], ["ALbackground", 0]]
};
BackgroundFeatureList["investigative services"] = {
	description : "I have a way of communicating with others that puts them at ease. I can invoke my rank to allow me access to a crime scene or to requisition equipment or horses on a temporary basis. When entering a settlement around Hillsfar, I can identify a contact who will give me information and would help me because I want to stop anyone from disrupting trade.",
	source : [["AL:RoD", 11], ["ALbackground", 0]]
};
BackgroundFeatureList["red plume and mage guild contacts"] = {
	description : "I made friends among the Red Plumes and Mage's Guild when I lived at the Hillsfar Gate. They remember me fondly and help me in little ways when they can. I can invoke their assistance in and around Hillsfar to obtain food, simple equipment for temporary use, and to gain access to the low-security areas of their garrisons, halls, and encampments.",
	source : [["AL:RoD", 6], ["ALbackground", 0]]
};
BackgroundFeatureList["secret identity"] = {
	description : "I have created a secret identity that I use to conceal my true race and that offers a covering explanation for my presence in Hillsfar. In addition, I can forge documents, including official papers and personal letters, as long as I have seen an example of the kind of document or the handwriting I am trying to copy.",
	source : [["AL:RoD", 9], ["ALbackground", 0]]
};
BackgroundFeatureList["secret passage"] = {
	description : "I can call on my smuggler contacts to secure secret passage into or out of Hillsfar for myself and my friends, no questions asked, and no Red Plume entanglements. Because I'm calling in a favor, I can't be certain when or if they can help. In return for passage, my companions and I may owe the Rogue's Guild a favor and/or may have to pay bribes.",
	source : [["AL:RoD", 8], ["ALbackground", 0]]
};
BackgroundFeatureList["secret society"] = {
	description : "I have a special way of communicating with others who feel the same way I do about the Shade. When I enter a village or larger city, I can identify a contact who will give me information on those that would hinder my goals and those would help me simply because of my desire to see the Shade Enclave return in all its glory.",
	source : [["AL:RoD", 10], ["ALbackground", 0]]
};
BackgroundFeatureList["shelter of the elven clergy"] = {
	description : "The clerics of Elventree have vowed to care for the Cormanthor refugees. They will help me when they can, including providing me and my companions with free healing and care at temples, shrines, and other established presences in Elventree. They will also provide me (but only me) with a poor lifestyle.",
	source : [["AL:RoD", 5], ["ALbackground", 0]]
};
BackgroundFeatureList["trade contact"] = {
	description : "My family and I have trade contacts such as caravan masters, sailors, artisans, farmers, and shopkeepers throughout the Moonsea region and all along the Sword Coast. When adventuring in either of those areas, I can use those contacts to get information about the local area or to pass a message to someone in those areas, even across great distance.",
	source : [["AL:RoD", 7], ["ALbackground", 0]]
};
var iFileName = "pub_20150915_OotA.js";
RequiredSheetVersion(13);
// This file adds all the beasts and background features from the Out of the Abyss adventure book to MPMB's Character Record Sheet

// Define the source
SourceList.OotA={
	name : "Out of the Abyss [beasts, background features, items]",
	abbreviation : "OotA",
	group : "Adventure Books",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/outoftheabyss",
	date : "2015/09/15"
};

// Background features
BackgroundFeatureList["deep delver"] = {
	description : "I have a knack for finding my way in the Underdark, recalling all twists and turns with ease, such that I can always retrace my steps underground. I can determine which sources of food and water are safe to consume. I can always find sufficient food and water for myself and up to five other people in the Underdark, if sustenance is available in the area.",
	source : [["OotA", 221], ["ALbackground", 0]]
};
BackgroundFeatureList["underdark experience"] = {
	description : "I'm no casual visitor to the Underdark, but have spent considerable time there learning its ways. I'm familiar with the various races, civilizations, settlements, and travel routes of the Underdark. If I fail an Intelligence check to recall some piece of Underdark lore, I know a source I can consult for the answer unless the DM rules that the lore is unknown.",
	source : [["OotA", 221], ["ALbackground", 0]]
};

// Creatures
CreatureList["steeder"] = { // "Steeder, Female" entry so that just "steeder" also matches this entry
	name : "Steeder, Female",
	source : ["OotA", 231],
	size : 2, //Large
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 14,
	hp : 30,
	hd : [4, 10], //[#, die]
	speed : "30 ft, climb 30 ft",
	scores : [15, 16, 14, 2, 10, 3], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"stealth" : 7
	},
	senses : "Darkvision 120 ft",
	passivePerception : 10,
	languages : "",
	challengeRating : "1",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Bite",
			ability : 2,
			damage : [1, 8, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "Target also takes 2d8 acid damage, half on a DC 12 Constitution saving throw"
		}, {
			name : "Sticky Leg",
			ability : 2,
			damage : ["Grappled", "", ""], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "Medium or smaller is stuck to the steeder's leg and grappled (escape DC 12); Can't use again until grapple ends",
			modifiers : ["", "", false] //[to hit, to damage, add ability to damage] "" means ignore
		}
	],
	traits : [{
			name : "Spider Climb",
			description : "The steeder can climb difficult surfaces, including upside down on ceilings, without needing to make an ability check."
		}, {
			name : "Leap",
			description : "The steeder can expend all its movement on its turn to jump up to 90 ft vertically or horizontally, provided that its speed is at least 30 feet."
		}
	]
};
CreatureList["steeder, male"] = {
	name : "Steeder, Male",
	source : ["OotA", 231],
	size : 3, //Medium
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 12,
	hp : 13,
	hd : [2, 8], //[#, die]
	speed : "30 ft, climb 30 ft",
	scores : [15, 12, 14, 2, 10, 3], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"stealth" : 5
	},
	senses : "Darkvision 120 ft",
	passivePerception : 10,
	languages : "",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Bite",
			ability : 1,
			damage : [1, 8, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "Target also takes 1d8 acid damage, half on a DC 12 Constitution saving throw"
		}, {
			name : "Sticky Leg",
			ability : 1,
			damage : ["Grappled", "", ""], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "Small or smaller is stuck to the steeder's leg and grappled (escape DC 12); Can't use again until grapple ends",
			modifiers : ["", "", false] //[to hit, to damage, add ability to damage] "" means ignore
		}
	],
	traits : [{
			name : "Spider Climb",
			description : "The steeder can climb difficult surfaces, including upside down on ceilings, without needing to make an ability check."
		}, {
			name : "Leap",
			description : "The steeder can expend all its movement on its turn to jump up to 60 ft vertically or horizontally, provided that its speed is at least 30 feet."
		}
	]
};

// Magic Items
MagicItemsList["dawnbringer"] = {
	name : "Dawnbringer",
	source : ["OotA", 222],
	type : "weapon (longsword)",
	rarity : "legendary",
	storyItemAL : true,
	prerequisite : "Requires attunement by a creature of non-evil alignment",
	prereqeval : function(v) { return !(/evil/i).test(What("Alignment")); },
	description : "As a bonus action, I can have this hilt create a blade of radiance. It acts like a longsword that does +2 to attack and damage rolls, radiant damage (+1d8 to undead), has finesse, emits bright sunlight in a 15-ft radius and dim light in another 15 ft. I can use it to cast Lesser Restoration and it is sentient, see Notes page.",
	descriptionLong : "As a bonus action, I can have this longsword hilt create or dismiss a blade of pure radiance. It acts like a longsword that grants a +2 bonus to attack and damage rolls, does radiant damage and has the finesse property. It deals +1d8 radiant damage to undead and emits sunlight, bright light in a 15-ft radius and dim light in an additional 15ft. As an action, I can expand or reduce both the bright and dim light's radius by 5 ft each, to a maximum of 30 feet each or a minimum of 10 feet each. Once per dawn, I can use it to cast Lesser Restoration. Also, it is sentient, see Notes page.",
	descriptionFull : "Lost for ages in the Underdark, Dawnbringer appears to be a gilded longsword hilt. While grasping the hilt, you can use a bonus action to make a blade of pure radiance spring from the hilt, or cause the blade to disappear. While the blade exists, this magic longsword has the finesse property. If you are proficient with shortswords or longswords, you are proficient with Dawnbringer.\n   You gain a +2 bonus to attack and damage rolls made with this weapon, which deals radiant damage instead of slashing damage. When you hit an undead with it, that target takes an extra 1d8 radiant damage.\n   The sword's luminous blade emits bright light in a 15-foot radius and dim light for an additional 15 feet. The light is sunlight. While the blade persists, you can use an action to expand or reduce its radius of bright and dim light by 5 feet each, to a maximum of 30 feet each or a minimum of 10 feet each.\n   While holding the weapon, you can use an action to touch a creature with the blade and cast Lesser Restoration on that creature. Once used, this ability can't be used again until the next dawn.\n   " + toUni("Sentience") + ". Dawnbringer is a sentient neutral good weapon with an Intelligence of 12, a Wisdom of 15, and a Charisma of 14. It has hearing and darkvision out to a range of 120 feet.\n   The sword can speak, read, and understand Common, and it can communicate with its wielder telepathically. Its voice is kind and feminine. It knows every language you know while attuned to it.\n   " + toUni("Personality") + ". Forged by ancient sun worshippers, Dawnbringer is meant to bring light into darkness and to fight creatures of darkness. It is kind and compassionate to those in need, but fierce and destructive to its enemies.\n   Long years lost in darkness have made Dawnbringer frightened of both the dark and abandonment. It prefers that its blade always be present and shedding light in areas of darkness, and it strongly resists being parted from its wielder for any length of time." +
	// Addition from Adventurers League Content Catalogue 8.07
	"\n   If an evil creature attempts to attune to the weapon, it not only finds it impossible, but Dawnbringer attempts to take control of its wielder (DC 14 Charisma saving throw). If the weapon is successful, it insists on being taken to the surface or willingly given to the first creature it comes across that is not a member of a race indigenous to the Underdark. Dawnbringer will not allow its relinquishment to a creature that it or its wielder knows is evil, and instead compels its wielder to find a new recipient.",
	attunement : true,
	weight : 3,
	action : [["bonus action", " (start/stop)"], ["action", " (change light)"]],
	weaponsAdd : ["Dawnbringer"],
	weaponOptions : {
		baseWeapon : "longsword",
		regExpSearch : /dawnbringer/i,
		name : "Dawnbringer",
		source : ["OotA", 222],
		damage : [1, 8, "radiant"],
		description : "Finesse, versatile (1d10); +1d8 damage to undead",
		modifiers : [2, 2]
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.theWea.name == "Dawnbringer" && !fields.Proficiency) {
					fields.Proficiency = CurrentProfs.weapon.otherWea && CurrentProfs.weapon.otherWea.finalProfs.indexOf("shortsword") !== -1;
				}
			}, ''
		]
	},
	usages : 1,
	recovery : "dawn",
	additional : "Lesser Restoration",
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["lesser restoration"],
		selection : ["lesser restoration"],
		firstCol : "oncelr"
	},
	toNotesPage : [{
		name : "Features",
		popupName : "Features of Dawnbringer",
		note : desc([
			"Lost for ages in the Underdark, Dawnbringer appears to be a gilded longsword hilt. While grasping the hilt, I can use a bonus action to make a blade of pure radiance spring from the hilt, or cause the blade to disappear. While the blade exists, it functions as a magic longsword that has the finesse property. I'm proficient with it if I'm proficient with either shortswords or longswords.",
			"I gain a +2 bonus to attack and damage rolls made with this weapon, which deals radiant damage instead of slashing damage. When I hit an undead with it, that target takes an extra 1d8 radiant damage.",
			"The sword's luminous blade emits bright light in a 15-foot radius and dim light for an additional 15 ft. The light is sunlight. As an action while the blade persists, I can expand or reduce its radius of bright and dim light by 5 ft each, to a maximum of 30 ft each or a minimum of 10 ft each.",
			"As an action while holding the weapon, I can touch a creature with the blade and cast Lesser Restoration on that creature. Once used, this ability can't be used again until the next dawn.",
			"Dawnbringer is a sentient neutral good weapon with an Intelligence of 12, a Wisdom of 15, and a Charisma of 14. It has hearing and darkvision out to a range of 120 feet. The sword can speak, read, and understand Common, and it can communicate with its wielder telepathically. Its voice is kind and feminine. It knows every language you know while attuned to it.",
			"Forged by ancient sun worshippers, Dawnbringer is meant to bring light into darkness and to fight creatures of darkness. It is kind and compassionate to those in need, but fierce and destructive to its enemies.  Long years lost in darkness have made Dawnbringer frightened of both the dark and abandonment. It prefers that its blade always be present and shedding light in areas of darkness, and it strongly resists being parted from its wielder for any length of time."
		]) + "\n\n" + sentientItemConflictTxt
	}]
}
MagicItemsList["piwafwi (cloak of elvenkind)"] = {
	name : "Piwafwi",
	source : ["OotA", 222],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "While I wear this dark spider-silk cloak with its hood up, Wisdom (Perception) checks made to see me have disadv., and I have adv. on Dex (Stealth) checks made to hide, as its color shifts to camouflage me. Pulling the hood up or down requires an action. It loses its magic if exposed to sunlight for 1 uninterrupted hour.",
	descriptionFull : "This dark spider-silk cloak is made by drow. It is a cloak of elvenkind. It loses its magic if exposed to sunlight for 1 hour without interruption.\n   While you wear this cloak with its hood up, Wisdom (Perception) checks made to see you have disadvantage. and you have advantage on Dexterity (Stealth) checks made to hide, as the cloak's color shifts to camouflage you. Pulling the hood up or down requires an action.",
	attunement : true,
	action : [["action", " (hood up/down)"]],
	eval : function () {
		if (CurrentMagicItems.known.indexOf("boots of elvenkind") !== -1) {
			SetProf("advantage", true, ["Stealth", true], "Cloak and Boots of Elvenkind (magic items)");
		}
	},
	removeeval : function () {
		SetProf("advantage", false, ["Stealth", true], "Cloak and Boots of Elvenkind (magic items)");
	}
}
MagicItemsList["piwafwi of fire resistance (cloak of elvenkind)"] = {
	name : "Piwafwi of Fire Resistance",
	source : ["OotA", 222],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "While I wear this dark spider-silk cloak with its hood up, Wisdom (Perception) checks made to see me have disadv., and I get adv. on Dex (Stealth) checks made to hide. Pulling the hood up or down requires an action. It also grants me fire resistance. It loses its magic if exposed to sunlight for 1 hour without interruption.",
	descriptionFull : "This dark spider-silk cloak is made by drow. It is a cloak of elvenkind. It also grants resistance to fire damage while you wear it. It loses its magic if exposed to sunlight for 1 hour without interruption.\n   While you wear this cloak with its hood up, Wisdom (Perception) checks made to see you have disadvantage. and you have advantage on Dexterity (Stealth) checks made to hide, as the cloak's color shifts to camouflage you. Pulling the hood up or down requires an action.",
	attunement : true,
	dmgres : ["Fire"],
	action : [["action", " (hood up/down)"]],
	eval : function () {
		if (CurrentMagicItems.known.indexOf("boots of elvenkind") !== -1) {
			SetProf("advantage", true, ["Stealth", true], "Cloak and Boots of Elvenkind (magic items)");
		}
	},
	removeeval : function () {
		SetProf("advantage", false, ["Stealth", true], "Cloak and Boots of Elvenkind (magic items)");
	}
}
MagicItemsList["spell gem"] = { // not legal in AL
	name : "Spell Gem",
	source : ["OotA", 223],
	type : "wondrous item",
	notLegalAL : true,
	description : "This gem can store 1 spell in it. If it is empty, I can cast a spell as normal, but have it stored in the gem. As an action, I can cast a stored spell from it, if that spell is on my class' spell list.",
	descriptionFull : "A spell gem can contain one spell from any class's spell list. You become aware of the spell when you learn the gem's properties. While holding the gem, you can cast the spell from it as an action if you know the spell or if the spell is on your class's spell list. Doing so doesn't require any components, and doesn't require attunement. The spell then disappears from the gem.\n   If the spell is of a higher level than you can normally cast, you must make an ability check using your spellcasting ability to determine whether you cast it successfully. The DC equals 10 + the spell's level. On a failed check, the spell disappears from the gem with no other effect\n   Each spell gem has a maximum level for the spell it can store. The spell level determines the gem's rarity, the stored spell's saving throw DC, and attack bonus, as shown in the table below.\n   You can imbue the gem with a spell if you're attuned to it and it's empty. To do so, you cast the spell while holding the gem. The spell is stored in the gem instead of having any effect. Casting the spell must require either 1 action or 1 minute or longer, and the spell's level must be no higher than the gem's maximum. If the spell belongs to the school of abjuration and requires material components that are consumed, you must provide them, but they can be worth half as much as normal.\n   Once imbued with a spell, the gem can't be imbued again until the next dawn.\n   Deep gnomes created these magic gemstones and keep the creation process a secret.\n\n" + [
		toUni("Level\tStone\t\tRarity\t\tDC/Atk"),
		"Cantrip\tObsidian\t\tUncommon\t13/+5",
		"1st\tLapis Lazuli\tUncommon\t13/+5",
		"2nd\tQuartz\t\tRare\t\t13/+5",
		"3rd\tBloodstone\tRare\t\t15/+7",
		"4th\tAmber\t\tVery Rare   \t15/+9",
		"5th\tJade\t\tVery Rare   \t17/+9",
		"6th\tTopaz\t\tVery Rare   \t17/+10",
		"7th\tStar Ruby  \tLegendary \t18/+10",
		"8th\tRuby\t\tLegendary \t18/+10",
		"9th\tDiamond\t\tLegendary \t19/+11"
	].join("\n"),
	attunement : true,
	allowDuplicates : true,
	calcChanges : {
		spellAdd : [
			function (spellKey, spellObj, spName) {
				if ((/spell gem/i).test(spName) && spellObj.time != "1 a") {
					spellObj.time = "1 a";
					return true;
				}
			},
			"Spells cast into a Spell Gem can only have a casting time of either 1 action or 1 minute or longer.\n \u2022 Spells cast from a Spell Gem always require 1 action to cast."
		],
		spellList : [
			function(spList, spName, spType) {
				// only continue for spell gems
				if (!(/spell gem/i).test(CurrentSpells[spName].name)) return;
				// create the notspells array if it didn't already exist
				if (!spList.notspells) spList.notspells = [];
				// now add all the spells of this spell gem's level that have a casting time of 1 reaction or 1 bonus action
				for (var spell in SpellsList) {
					var aSp = SpellsList[spell];
					if (aSp.level <= spList.level[1] && aSp.time && (/1 (rea|bns)/i).test(aSp.time)) spList.notspells.push(spell);
				}
			}, ""
		]
	},
	toNotesPage : [{
		name : "Storing Spells",
		popupName : "Casting spells into a Spell Gems",
		page3notes : true,
		note : [
			"Casting a spell stored from a spell gem doesn't require attunement",
			"Only spells with a casting time of 1 action or 1 min or more can be stored in a spell gem",
			"Imbuing a spell gem requires casting a spell as normal, but the spell produces no effect",
			"I only need to provide half the costly material components for abjuration spells to imbue"
		]
	}],
	choices : ["Obsidian (cantrip, uncommon)", "Lapis Lazuli (1st-level, uncommon)", "Quartz (2nd-level, rare)", "Bloodstone (3rd-level, rare)", "Amber (4th-level, very rare)", "Jade (5th-level, very rare)", "Topaz (6th-level, very rare)", "Star Ruby (7th-level, legendary)", "Ruby (8th-level, legendary)", "Diamond (9th-level, legendary)"],
	"obsidian (cantrip, uncommon)" : {
		name : "Spell Gem [Obsidian]",
		rarity : "uncommon",
		description : "This gem can store one cantrip. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 13 and +5 spell attack.",
		fixedDC : 13,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,0],
			psionic : false,
			firstCol : "checkbox",
			times : 16
		}
	},
	"lapis lazuli (1st-level, uncommon)" : {
		name : "Spell Gem [Lapis Lazuli]",
		rarity : "uncommon",
		description : "This gem can store one spell up to 1st-level. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 13 and +5 spell attack. If the spell's level is higher than I can cast, I need to make a DC 11 check with my spellcasting ability or the spell has no effect.",
		fixedDC : 13,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,1],
			psionic : false,
			firstCol : "checkbox",
			times : 16
		}
	},
	"quartz (2nd-level, rare)" : {
		name : "Spell Gem [Quartz]",
		rarity : "rare",
		description : "This gem can store one spell up to 2nd-level. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 13 and +5 spell attack. If the spell's level is higher than I can cast, I need to make a DC 12 check with my spellcasting ability or the spell has no effect.",
		fixedDC : 13,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,2],
			psionic : false,
			firstCol : "checkbox",
			times : 16
		}
	},
	"bloodstone (3rd-level, rare)" : {
		name : "Spell Gem [Bloodstone]",
		rarity : "rare",
		description : "This gem can store one spell up to 3rd-level. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 15 and +7 spell attack. If the spell's level is higher than I can cast, I need to make a DC 13 check with my spellcasting ability or the spell has no effect.",
		fixedDC : 15,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,3],
			psionic : false,
			firstCol : "checkbox",
			times : 16
		}
	},
	"amber (4th-level, very rare)" : {
		name : "Spell Gem [Amber]",
		rarity : "very rare",
		description : "This gem can store one spell up to 4th-level. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 15 and +9 spell attack. If the spell's level is higher than I can cast, I need to make a DC 14 check with my spellcasting ability or the spell has no effect.",
		fixedDC : 15,
		fixedSpAttack : 9,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,4],
			psionic : false,
			firstCol : "checkbox",
			times : 16
		}
	},
	"jade (5th-level, very rare)" : {
		name : "Spell Gem [Jade]",
		rarity : "very rare",
		description : "This gem can store one spell up to 5th-level. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 17 and +9 spell attack. If the spell's level is higher than I can cast, I need to make a DC 15 check with my spellcasting ability or the spell has no effect.",
		fixedDC : 17,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,5],
			psionic : false,
			firstCol : "checkbox",
			times : 16
		}
	},
	"topaz (6th-level, very rare)" : {
		name : "Spell Gem [Topaz]",
		rarity : "very rare",
		description : "This gem can store one spell up to 6th-level. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 17, +10 spell attack. If the spell's level is higher than I can cast, I need to make a DC 16 check with my spellcasting ability or the spell has no effect.",
		fixedDC : 17,
		fixedSpAttack : 10,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,6],
			psionic : false,
			firstCol : "checkbox",
			times : 16
		}
	},
	"star ruby (7th-level, legendary)" : {
		name : "Spell Gem [Star Ruby]",
		rarity : "legendary",
		description : "This gem can store one spell up to 7th-level. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 18, +10 spell attack. If the spell's level is higher than I can cast, I need to make a DC 17 check with my spellcasting ability or the spell has no effect.",
		fixedDC : 18,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,7],
			psionic : false,
			firstCol : "checkbox",
			times : 16
		}
	},
	"ruby (8th-level, legendary)" : {
		name : "Spell Gem [Ruby]",
		rarity : "legendary",
		description : "This gem can store one spell up to 8th-level. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 18, +10 spell attack. If the spell's level is higher than I can cast, I need to make a DC 18 check with my spellcasting ability or the spell has no effect.",
		fixedDC : 18,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,8],
			psionic : false,
			firstCol : "checkbox",
			times : 16
		}
	},
	"diamond (9th-level, legendary)" : {
		name : "Spell Gem [Diamond]",
		rarity : "legendary",
		description : "This gem can store one spell up to 9th-level. I can cast such a spell into the empty gem. As an action, I can cast the spell stored in it (if it's on my class' spell list), with DC 19, +11 spell attack. If the spell's level is higher than I can cast, I need to make a DC 19 check with my spellcasting ability or the spell has no effect.",
		fixedDC : 19,
		spellFirstColTitle : "Us", // used
		spellcastingBonus : {
			level : [0,9],
			psionic : false,
			firstCol : "checkbox",
			times : 16
		}
	}
}
MagicItemsList["stonespeaker crystal"] = {
	name : "Stonespeaker Crystal",
	source : ["OotA", 223],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "This crystal has 10 charges, regaining 1d6+4 at dawn, which I can use to cast its spells. When I use its last charge, roll a d20. On a 1, it vanishes. It gives me adv. on Int (Investigation) checks. When I cast an abjuration spell, I can expend 1 charge per level of the spell to substitute one material component of the spell.",
	descriptionFull : "Created by the stone giant librarians of Gravenhollow, this nineteen-inch-long shard of quartz grants you advantage on Intelligence (Investigation) checks while it is on your person.\n   The crystal has 10 charges. While holding it, you can use an action to expend some of its charges to cast one of the following spells from it: Speak with Animals (2 charges), Speak with Dead (4 charges), or Speak with Plants (3 charges).\n   When you cast a Divination spell, you can use the crystal in place of one material component that would normally be consumed by the spell, at a cost of 1 charge per level of the spell. The crystal is not consumed when used in this way.\n   The crystal regains 1d6+4 expended charges daily at dawn. If you expend the crystal's last charge, roll a d20. On a 1, the crystal vanishes, lost forever.",
	attunement : true,
	weight : 1,
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "2 charges",
		spells : ["speak with animals"],
		selection : ["speak with animals"],
		firstCol : 2
	}, {
		name : "3 charges",
		spells : ["speak with plants"],
		selection : ["speak with plants"],
		firstCol : 3
	}, {
		name : "4 charges",
		spells : ["speak with dead"],
		selection : ["speak with dead"],
		firstCol : 4
	}],
	advantages : [["Investigation", true]]
}
MagicItemsList["wand of viscid globs"] = {
	name : "Wand of Viscid Globs",
	source : ["OotA", 223],
	type : "wand",
	rarity : "rare",
	magicItemTable : "G",
	description : "This black wand has 7 charges, regaining 1d6+1 at midnight. If its last charge is used, roll a d20. On a 1, it melts. As an action, I can expend 1 charge to make a ranged attack roll on a target in 60 ft (with my spellcasting ability). On a hit, it is restrained for 1 hour. The wand is destroyed if exposed to sunlight for 1 hour.",
	descriptionFull : "Crafted by the drow, this slim black wand has 7 charges. While holding it, you can use an action to expend 1 of its charges to cause a small glob of viscous material to launch from the tip at one creature within 60 feet of you. Make a ranged attack roll against the target, with a bonus equal to your spellcasting modifier (or your Intelligence modifier, if you don't have a spellcasting modifier) plus your proficiency bonus. On a hit, the glob expands and dries on the target, which is restrained for 1 hour. After that time, the viscous material cracks and falls away.\n   Applying a pint or more of alcohol to the restrained creature dissolves the glob instantly, as does the application of oil of etherealness or universal solvent. The glob also dissolves instantly if exposed to sunlight. No other nonmagical process can remove the viscous material until it deteriorates on its own.\n   The wand regains 1d6+1 expended charges daily at midnight. If you expend the wands last charge, roll a d20. On a 1, the wand melts into harmless slime and is destroyed.\n   A wand of viscous globs is destroyed if exposed to sunlight for 1 hour without interruption.",
	attunement : true,
	weight : 1,
	usages : 7,
	recovery : "Midnight",
	additional : "regains 1d6+1",
	action : [["action", ""]],
	weaponsAdd : ["Wand of Viscid Globs"],
	weaponOptions : {
		name : "Wand of Viscid Globs",
		source : ["OotA", 223],
		ability : 4,
		type : "Spell",
		damage : ["\u2015", "", "Restrained"],
		range : "60 ft",
		description : "1 charge; Lasts 1 hour or until exposed to sunlight, a pint of alcohol, oil of etherealness, or universal solvent",
		abilitytodamage : false
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.theWea.name === "Wand of Viscid Globs") {
					// get the highest spellcasting ability score
					var abiArr = [];
					for (var aCast in CurrentSpells) {
						if (!isNaN(CurrentSpells[aCast].ability)) abiArr.push(CurrentSpells[aCast].ability);
					}
					var abiDone = [];
					var abiModArr = [];
					for (var i = 0; i < abiArr.length; i++) {
						if (!abiArr[i] || abiDone.indexOf(abiArr[i]) !== -1) continue;
						abiDone.push(abiArr[i]);
						var thisMod = What(AbilityScores.abbreviations[abiArr[i] - 1]);
						if (thisMod > Math.max.apply(Math, abiModArr)) fields.Mod = abiArr[i];
						abiModArr.push(thisMod);
					}
				}
			}, ''
		]
	}
}
var iFileName = "pub_20151103_SCAG.js";
RequiredSheetVersion(13);
// This file adds all the player-material from Sword Coast Adventure Guide to MPMB's Character Record Sheet

// Define the source
SourceList.S={
	name : "Sword Coast Adventure Guide",
	abbreviation : "SCAG",
	group : "Primary Sources",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/sc-adventurers-guide",
	date : "2015/11/03"
};

// Races
RaceList["ghostwise halfling"] = {
	regExpSearch : /^(?=.*\b(halflings?|hobbits?)\b)(?=.*ghostwise).*$/i,
	name : "Ghostwise halfling",
	sortname : "Halfling, Ghostwise",
	plural : "Ghostwise halflings",
	source : ["S", 110],
	size : 4,
	speed : {
		walk : { spd : 25, enc : 15 }
	},
	languageProfs : ["Common", "Halfling"],
	savetxt : { adv_vs : ["frightened"] },
	age : " reach adulthood at age 20 and live around 150 years",
	height : " average about 3 feet tall (2'7\" + 2d4\")",
	weight : " weigh around 40 lb (35 + 2d4 lb)",
	heightMetric : " average about 90 cm tall (80 + 5d4)",
	weightMetric : " weigh around 18 kg (16 + 5d4 / 10 kg)",
	scores : [0, 2, 0, 0, 1, 0],
	trait : "Ghostwise Halfling (+2 Dexterity, +1 Wisdom)" + (typePF ? "\n" : " ") + "\nLucky: When I roll a 1 on an attack roll, ability check, or saving throw, I can reroll the die and must use the new roll." + (typePF ? "\n" : " ") + "\nHalfling Nimbleness: I can move through the space of any creature that is of a size larger than me." + (typePF ? "\n" : " ") + "\nSilent Speech: I can speak telepathically to any one creature within 30 feet of me. It only understands me if we share a language."
};
RaceList["gray dwarf"] = {
	regExpSearch : /^((?=.*\bduergars?\b)|((?=.*\b(dwarfs?|dwarves|dwarfish|dwarvish|dwarven)\b)(?=.*\b(grey|gray|underdark)\b))).*$/i,
	name : "Duergar",
	sortname : "Dwarf, Gray (Duergar)",
	source : [["S", 104], ["MToF", 81]],
	plural : "Duergar",
	size : 3,
	speed : {
		walk : { spd : 25, enc : 25 }
	},
	languageProfs : ["Common", "Dwarvish", "Undercommon"],
	vision : [["Darkvision", 120], ["Sunlight Sensitivity", 0]],
	savetxt : { adv_vs : ["charmed", "illusions", "paralyzed", "poison"] },
	dmgres : ["Poison"],
	weaponProfs : [false, false, ["battleaxe", "handaxe", "warhammer", "light hammer"]],
	toolProfs : [["Smith, brewer, or mason tools", 1]],
	age : " are considered young until they are 50 and live about 350 years",
	height : " stand between 4 and 5 feet tall (3'8\" + 2d4\")",
	weight : " weigh around 150 lb (115 + 2d4 \xD7 2d6 lb)",
	heightMetric : " stand between 1,2 and 1,5 metres tall (110 + 5d4 cm)",
	weightMetric : " weigh around 70 kg (55 + 5d4 \xD7 4d6 / 10 kg)",
	scores : [1, 0, 2, 0, 0, 0],
	trait : "Duergar (+2 Constitution, +1 Strength)\nStonecunning: Whenever I make an Int (History) check related to the origin of stonework, I am considered proficient in the skill and add double my proficiency bonus to the check.\nSunlight Sensitivity: Disadvantage on attack rolls and Wisdom (Perception) checks that rely on sight when I or what I am trying to attack/perceive is in direct sunlight.\nDuergar Magic: 3rd: Enlarge/Reduce to enlarge; 5th: Invisibility. If not in direct sunlight," + (!typePF ? "\n" : " ") + "I can cast both spells on myself once per long rest without material components, using Int.",
	spellcastingAbility : 4,
	features : {
		"enlarge" : {
			name : "Duergar Magic (level 3)",
			limfeaname : "Enlarge (self only)",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Duergar Magic (level 3)",
				spells : ["enlarge/reduce"],
				selection : ["enlarge/reduce"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"enlarge/reduce" : {
					name : "Enlarge",
					range : "Self",
					components : "V,S",
					compMaterial : "",
					description : "I'm enlarged, adv. on Str checks/aves and +1d4 on weapon dmg; Can't cast this in direct sunlight",
					changes : "Using Duergar Magic, I cast Enlarge/Reduce while I'm not in direct sunlight, but only to enlarge myself."
				}
			}
		},
		"invisibility" : {
			name : "Duergar Magic (level 5)",
			limfeaname : "Invisibility (self only)",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Duergar Magic (level 5)",
				spells : ["invisibility"],
				selection : ["invisibility"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"invisibility" : {
					range : "Self",
					components : "V,S",
					compMaterial : "",
					description : "Me and my worn/carried invisible until I attack or cast; Can't cast this spell in direct sunlight",
					changes : "Using Duergar Magic, I can cast Invisibility while I'm not in direct sunlight, but only on myself."
				}
			}
		}
	}
};
if (!RaceList["deep gnome"]) {  //reprint from Elemental Evil Player's Companion
	RaceList["deep gnome"] = {
		regExpSearch : /^((?=.*svirfneblin)|((?=.*\bgnomes?\b)(?=.*\b(underdarks?|deep|depths?)\b))).*$/i,
		name : "Svirfneblin",
		sortname : "Gnome, Deep (Svirfneblin)",
		source : [["E", 7], ["S", 115], ["MToF", 113]],
		plural : "Svirfneblin",
		size : 4,
		speed : {
			walk : { spd : 25, enc : 15 }
		},
		languageProfs : ["Common", "Gnomish", "Undercommon"],
		vision : [["Darkvision", 120]],
		savetxt : { text : ["Adv. on Int/Wis/Cha saves vs. magic"] },
		age : " are considered full-grown adults when they reach 25 and live 200 to 250 years",
		height : " stand between 3 and 3 1/2 feet tall (2'9\" + 2d4\")",
		weight : " weigh around 90 lb (80 + 2d4 \xD7 1d4 lb)",
		heightMetric : " stand between 90 and 105 cm tall (85 + 5d4 cm)",
		weightMetric : " weigh around 50 kg (35 + 5d4 \xD7 4d4 / 10 kg)",
		scores : [0, 1, 0, 2, 0, 0],
		trait : "Svirfneblin (+1 Dexterity, +2 Intelligence)\n\nStone Camouflage:\n   I have advantage on Dexterity (stealth) checks to hide in rocky terrain."
	};
}

// Racial variants
AddRacialVariant("half-elf", "aquatic", {
	regExpSearch : /aquatic/i,
	name : "Half-aquatic elf",
	source : ["S", 116],
	plural : "Half-aquatic elves",
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : 30, enc : 20 }
	},
	skillstxt : "",
	trait : "Half-Aquatic Elf (+2 Charisma and +1 to two other ability scores of my choice)\n\nSwimming Speed:\n   My aquatic heritage gives me a swimming speed of 30 feet."
});
AddRacialVariant("half-elf", "cantrip", {
	regExpSearch : /cantrip/i,
	name : "Half-high elf",
	source : ["S", 116],
	plural : "Half-high elves",
	skillstxt : "",
	trait : "Half-High Elf (+2 Charisma and +1 to two other ability scores of my choice)\n\nCantrip:\n   I know one cantrip of my choice from the wizard spell list.\n   Intelligence is my spellcasting ability for it.",
	spellcastingAbility : 4,
	spellcastingBonus : {
		name : "High Elf Cantrip",
		"class" : "wizard",
		level : [0, 0],
		firstCol : 'atwill'
	}
});
AddRacialVariant("half-elf", "drow magic", {
	regExpSearch : /^(?=.*drow)(?=.*magic).*$/i,
	name : "Half-drow",
	source : ["S", 116],
	plural : "Half-drow",
	skillstxt : "",
	trait : "Half-drow (+2 Charisma and +1 to two other ability scores of my choice)\n\nDrow Magic:\n   I know the Dancing Lights cantrip.\n   Once I reach 3rd level, I can cast the Faerie Fire spell once per long rest.\n   Once I reach 5th level, I can also cast the Darkness spell once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Drow Magic (level 1)",
		spells : ["dancing lights"],
		selection : ["dancing lights"],
		firstCol : 'atwill'
	},
	features : {
		"faerie fire" : {
			name : "Drow Magic (level 3)",
			limfeaname : "Faerie Fire",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Drow Magic (level 3)",
				spells : ["faerie fire"],
				selection : ["faerie fire"],
				firstCol : 'oncelr'
			}
		},
		"darkness" : {
			name : "Drow Magic (level 5)",
			limfeaname : "Darkness",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Drow Magic (level 5)",
				spells : ["darkness"],
				selection : ["darkness"],
				firstCol : 'oncelr'
			}
		}
	}
});
AddRacialVariant("half-elf", "elf weapon training", {
	regExpSearch : /^(?=.*\b(elf|elven)\b)(?=.*weapon)(?=.*training).*$/i,
	source : ["S", 116],
	skillstxt : "",
	trait : "Half-Elf (+2 Charisma and +1 to two other ability scores of my choice)",
	weaponProfs : [false, false, ["longsword", "shortsword", "longbow", "shortbow"]]
});
AddRacialVariant("half-elf", "fleet of foot", {
	regExpSearch : /^(?=.*fleet)(?=.*\b(foot|feet)\b).*$/i,
	name : "Half-wood elf",
	source : ["S", 116],
	plural : "Half-wood elves",
	speed : {
		walk : { spd : 35, enc : 25 }
	},
	skillstxt : "",
	trait : "Half-Wood Elf (+2 Charisma and +1 to two other ability scores of my choice)"
});
AddRacialVariant("half-elf", "mask of the wild", {
	regExpSearch : /^(?=.*\bmasks?\b)(?=.*\bwilds?\b).*$/i,
	name : "Half-wood elf",
	source : ["S", 116],
	plural : "Half-wood elves",
	skillstxt : "",
	trait : "Half-Wood Elf (+2 Charisma and +1 to two other ability scores of my choice)\n\nMask of the Wild:\n   I can attempt to hide even when I am only lightly obscured by foliage, heavy rain, falling snow, mist, and other natural phenomena."
});
AddRacialVariant("tiefling", "devil's tongue", {
	regExpSearch : /^(?=.*devil)(?=.*tongue).*$/i,
	name : "Devil's tongue tiefling",
	source : ["S", 118],
	plural : "Devil's tongue tieflings",
	trait : "Devil's Tongue Tiefling (+1 Intelligence, +2 Charisma)\n\nDevil's Tongue:\n   I know the Vicious Mockery cantrip.\n   At 3rd level, I can cast the Charm Person spell once per long rest as a 2nd-level spell.\n   At 5th level, I can also cast the Enthrall spell once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingBonus : {
		name : "Devil's Tongue (level 1)",
		spells : ["vicious mockery"],
		selection : ["vicious mockery"],
		firstCol : 'atwill'
	},
	features : {
		"charm person" : {
			name : "Devil's Tongue (level 3)",
			limfeaname : "Charm Person (2 targets)",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Devil's Tongue (level 3)",
				spells : ["charm person"],
				selection : ["charm person"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"charm person" : {
					description : "2 humanoids, max 30 ft apart, save or charmed; advantage on save if I or my allies are fighting it",
					changes : "Using Devil's Tongue, I cast Charm Person as if I'm using a 2nd-level spell slot, affecting 2 humanoids."
				}
			}
		},
		"enthrall" : {
			name : "Devil's Tongue (level 5)",
			limfeaname : "Enthrall",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Devil's Tongue (level 5)",
				spells : ["enthrall"],
				selection : ["enthrall"],
				firstCol : 'oncelr'
			}
		}
	}
});
AddRacialVariant("tiefling", "hellfire", {
	regExpSearch : /hellfire/i,
	name : "Hellfire tiefling",
	source : ["S", 118],
	plural : "Hellfire tieflings",
	trait : "Hellfire Tiefling (+1 Intelligence, +2 Charisma)\n\nInfernal Legacy (Hellfire):\n   I know the Thaumaturgy cantrip.\n   At 3rd level, I can cast the Burning Hands spell once per long rest as a 2nd-level spell.\n   At 5th level, I can also cast the Darkness spell once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	features : {
		"burning hands" : {
			name : "Hellfire Legacy (level 3)",
			limfeaname : "Burning Hands (4d6)",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Hellfire Legacy (level 3)",
				spells : ["burning hands"],
				selection : ["burning hands"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"burning hands" : {
					description : "4d6 Fire damage; save halves; unattended flammable objects ignite",
					changes : "Using Hellfire Legacy, I cast Burning Hands as if I'm using a 2nd-level spell slot, doing 4d6 Fire damage."
				}
			}
		},
		"darkness" : {
			name : "Hellfire Legacy (level 5)",
			limfeaname : "Darkness",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Infernal Legacy (level 5)",
				spells : ["darkness"],
				selection : ["darkness"],
				firstCol : 'oncelr'
			}
		}
	}
});
AddRacialVariant("tiefling", "winged", {
	regExpSearch : /wing/i,
	name : "Winged tiefling",
	source : [["S", 118]],
	plural : "Winged tieflings",
	speed : {
		walk : { spd : 30, enc : 20 },
		fly : { spd : 30, enc : 0 }
	},
	trait : "Winged Tiefling (+1 Intelligence, +2 Charisma)\n\nWings:\n   I have bat-like wings sprouting from my shoulder blades that give me flying speed of 30 feet when I'm not wearing heavy armor.",
	features : "",
	spellcastingAbility : "",
	spellcastingBonus : ""
});
RunFunctionAtEnd(function() {
	if (!RaceList.tiefling) return;
	var tRace = {
		objname : "feral tiefling",
		replaceTraitTxt : ["+1 Intelligence, +2 Charisma", "+2 Dexterity, +1 Intelligence"],
		replaceNameTxt : ["tiefling", "feral tiefling"],
		regExpSearch : /^(?=.*feral)((?=.*tiefling)|(?=.*planetouched)(?=.*(hell|abyss|fiend|devil))).*$/i,
		name : "Feral tiefling",
		sortname : "Tiefling, Feral",
		source : ["S", 118],
		plural : "Feral tieflings",
		scores : [0, 2, 0, 1, 0, 0],
		trait : "Feral Tiefling (+2 Dexterity, +1 Intelligence)\n\nInfernal Legacy:\n   I know the Thaumaturgy cantrip.\n   At 3rd level, I can cast the Hellish Rebuke spell once per long rest as a 2nd-level spell.\n   At 5th level, I can also cast the Darkness spell once per long rest.\n   Charisma is my spellcasting ability for these spells."
	};
	// Create the RaceList entry
	RaceList[tRace.objname] = eval(RaceList.tiefling.toSource());
	for (var rFea in tRace) {
		if ((/objname|replaceTraitTxt|replaceNameTxt/).test(rFea)) continue;
		RaceList[tRace.objname][rFea] = tRace[rFea];
	};
	// Create feral tiefling variants
	RaceList[tRace.objname].variants.forEach( function(nVar) {
		RaceSubList[tRace.objname + "-" + nVar] = eval(RaceSubList["tiefling-" + nVar].toSource());
		var thisVar = RaceSubList[tRace.objname + "-" + nVar];
		thisVar.trait = thisVar.trait.replace(tRace.replaceTraitTxt[0], tRace.replaceTraitTxt[1]);
		thisVar.trait = thisVar.trait.replace(tRace.replaceNameTxt[0].capitalize(), tRace.replaceNameTxt[1].capitalize());
		thisVar.name = thisVar.name.replace(tRace.replaceNameTxt[0], tRace.replaceNameTxt[1]);
		thisVar.plural = thisVar.plural.replace(tRace.replaceNameTxt[0], tRace.replaceNameTxt[1]);
	});
});

// Subclasses
AddSubClass("barbarian", "battlerager", {
	regExpSearch : /(battlerager|kuldjargh)/i,
	subname : "Path of the Battlerager",
	fullname : "Battlerager",
	source : ["S", 121],
	abilitySave : 6,
	features : {
		"subclassfeature3" : {
			name : "Battlerager Armor",
			source : ["S", 121],
			minlevel : 3,
			description : desc([
				"I gain proficiency with spiked armor both as an armor and as a weapon",
				"As a bonus action while raging, I can attack once with my armor spikes",
				"With my spiked armor I do 3 piercing damage when I use my Attack action to grapple"
			]),
			action : ["bonus action", "Armor Spikes attack (in rage)"],
			armorOptions : {
				regExpSearch : /^(?!.*(dragon|draconic|beast))(?=.*spike(d|s))(?=.*armou?r).*$/i,
				name : "Spiked armor",
				source : ["S", 121],
				type : "medium",
				ac : 14,
				stealthdis : true,
				weight : 45
			},
			weaponOptions : {
				regExpSearch : /^(?=.*armou?r)(?=.*spike).*$/i,
				name : "Armor spikes",
				source : ["S", 121],
				ability : 1,
				type : "armor spikes",
				damage : [1, 4, "piercing"],
				range : "Melee",
				description : "Does 3 piercing damage when grappling during my Attack action",
				abilitytodamage : true
			},
			weaponProfs : [false, false, ["armor spikes"]],
			weaponsAdd : ['Armor Spikes'],
			eval : function() {
				AddString('Proficiency Armor Other Description', 'Spiked Armor', ', ');
			},
			removeeval : function () {
				RemoveString('Proficiency Armor Other Description', 'Spiked Armor');
			}
		},
		"subclassfeature6" : {
			name : "Reckless Abandon",
			source : ["S", 121],
			minlevel : 6,
			description : "\n   " + "If I use Reckless Attack during rage, I also gain temporary HP equal to my Con mod"
		},
		"subclassfeature10" : {
			name : "Battlerager Charge",
			source : ["S", 121],
			minlevel : 10,
			description : "\n   " + "As a bonus action while raging, I can use the Dash action",
			action : ["bonus action", " (in rage)"]
		},
		"subclassfeature14" : {
			name : "Spiked Retribution",
			source : ["S", 121],
			minlevel : 14,
			description : "\n   " + "When I'm hit in melee by an attacker within 5 ft, it takes 3 piercing damage" + "\n   " + "This only works while I'm wearing spiked armor, in rage, and I'm not incapacitated"
		}
	}
});
AddSubClass("cleric", "arcana domain", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*(arcana|magic|wizardry)).*$/i,
	subname : "Arcana Domain",
	source : ["S", 125],
	spellcastingExtra : ["detect magic", "magic missile", "magic weapon", "nystul's magic aura", "dispel magic", "magic circle", "arcane eye", "leomund's secret chest", "planar binding", "teleportation circle"],
	features : {
		"subclassfeature1" : {
			name : "Arcane Initiate",
			source : ["S", 125],
			minlevel : 1,
			description : "\n   " + "I gain proficiency with Arcana and two wizard cantrips that count as cleric cantrips",
			skills : ["Arcana"],
			spellcastingBonus : {
				name : "Arcane Initiate",
				"class" : "wizard",
				level : [0, 0],
				times : 2
			}
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Arcane Abjuration",
			source : ["S", 125],
			minlevel : 2,
			description : "\n   " + "As an action, one celestial, elemental, fey, or fiend within 30 ft must make a Wis save" + "\n   " + "If it fails and is able to see/hear me, it is turned for 1 min or until it takes damage" + "\n   " + "Turned: move away, never within 30 ft of me, no reactions or actions other than Dash" + "\n   " + "Turned: may Dodge instead of Dash when nowhere to move and unable to escape bonds" + "\n   " + "If its CR is low enough and it is not on its home plane, it is banished for 1 min instead" + "\n   " + "Banished: sent to home plane, reappearing where it was if the effect ends before 1 min",
			additional : ["", "", "", "", "CR 1/2 or lower", "CR 1/2 or lower", "CR 1/2 or lower", "CR 1 or lower", "CR 1 or lower", "CR 1 or lower", "CR 2 or lower", "CR 2 or lower", "CR 2 or lower", "CR 3 or lower", "CR 3 or lower", "CR 3 or lower", "CR 4 or lower", "CR 4 or lower", "CR 4 or lower", "CR 4 or lower"],
			action : ["action", ""]
		},
		"subclassfeature6" : {
			name : "Spell Breaker",
			source : ["S", 126],
			minlevel : 6,
			description : "\n   " + "When I restore HP to an ally with a 1st-level or higher spell, I can also end one spell" + "\n   " + "The chosen spell on the ally ends if it is equal or lower level to the spell slot level used",
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {							
						var startDescr = spellObj.description;
						switch (spellKey) {
							case "mass heal" :
								spellObj.description = "Heal 700 hp, split over crea in range; also cures blindness, deafness, and all diseases; spell breaker";
								break;
							case "power word heal" :
								spellObj.description = spellObj.description.replace(/heals all.*/i, "full hp; no longer charmed, frightened, paralyzed, stunned; can stand up as rea; spell breaker");
								break;
							case "goodberry" :
								spellObj.description = spellObj.description.replace("Create ", "").replace("lose potency after ", "remain");
							case "regenerate" :
								spellObj.description = spellObj.description.replace(" for rest of duration", "");
							case "heal" :
								spellObj.description = spellObj.description.replace("all diseases", "diseases");
							case "cure wounds" :
							case "healing word" :
							case "life transference" :
							case "mass cure wounds" :
							case "mass healing word" :
							case "prayer of healing" :
								spellObj.description = spellObj.description.replace(/creatures?/i, "crea").replace("within", "in").replace("spellcasting ability modifier", "spellcasting ability mod") + "; spell breaker";
						}
						return startDescr !== spellObj.description;
					},
					"When I cast a spell that restores hit points to another creature than myself, I can also end a spell affecting the target. This spell can be of the same level of the spell slot used to cast the healing spell, or lower."
				]
			}
		},
		"subclassfeature8" : {
			name : "Potent Spellcasting",
			source : ["S", 126],
			minlevel : 8,
			description : "\n   " + "I add my Wisdom modifier to the damage I deal with my cleric cantrips",
			calcChanges : {
				atkCalc : [
					function (fields, v, output) {
						if (classes.known.cleric && classes.known.cleric.level > 7 && v.thisWeapon[3] && v.thisWeapon[4].indexOf('cleric') !== -1 && SpellsList[v.thisWeapon[3]].level === 0) {
							output.extraDmg += What('Wis Mod');
						};
					},
					"My cleric cantrips get my Wisdom modifier added to their damage."
				],
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (spName != "cleric" || !What("Wis Mod") || Number(What("Wis Mod")) <= 0 || spellObj.psionic || spellObj.level !== 0) return;
						if (spellKey == "shillelagh") {
							spellObj.description = spellObj.description.replace("1d8", "1d8+" + What("Wis Mod"));
							return true;
						}
						return genericSpellDmgEdit(spellKey, spellObj, "\\w+\\.?", "Wis", true);
					},
					"My cleric cantrips get my Wisdom modifier added to their damage."
				]
			}
		},
		"subclassfeature17" : {
			name : "Arcane Mastery",
			source : ["S", 126],
			minlevel : 17,
			description : "\n   " + "I add four wizards spells, a 6th, 7th, 8th, and 9th-level spell, to my domain spells" + "\n   " + "As any domain spell, these spells are automatically prepared and count as cleric spells",
			spellcastingBonus : [{
				name : "Arcane Mastery (6)",
				"class" : "wizard",
				level : [6, 6],
				firstCol : 'markedbox'
			}, {
				name : "Arcane Mastery (7)",
				"class" : "wizard",
				level : [7, 7],
				firstCol : 'markedbox'
			}, {
				name : "Arcane Mastery (8)",
				"class" : "wizard",
				level : [8, 8],
				firstCol : 'markedbox'
			}, {
				name : "Arcane Mastery (9)",
				"class" : "wizard",
				level : [9, 9],
				firstCol : 'markedbox'
			}]
		}
	}
});
AddSubClass("fighter", "purple dragon knight", {
	regExpSearch : /^(((?=.*purple)(?=.*dragon)(?=.*knight))|(?=.*banneret)).*$/i,
	subname : "Purple Dragon Knight",
	fullname : "Purple Dragon Knight",
	source : ["S", 128],
	features : {
		"subclassfeature3" : {
			name : "Rallying Cry",
			source : ["S", 128],
			minlevel : 3,
			description : "\n   " + "When I use Second Wind, I also heal three allies within 60 ft that can see or hear me",
			additional : levels.map(function (n) {
				return n < 3 ? "" : n + " HP";
			}),
			action : [["bonus action", "Second Wind (+Rallying Cry)", "Second Wind"]]
		},
		"subclassfeature7" : {
			name : "Royal Envoy",
			source : ["S", 128],
			minlevel : 7,
			description : "\n   " + "I gain proficiency with the Persuasion skill and I gain expertise with the Persuasion skill" + "\n   " + "If already proficient, I can choose Animal Handling, Insight, Intimidation, or Performance",
			skillstxt : "Persuasion proficiency and expertise; If already proficient, choose one from Animal Handling, Insight, Intimidation, or Performance",
			skills : ["Persuasion", "full"]
		},
		"subclassfeature10" : {
			name : "Inspiring Surge",
			source : ["S", 128],
			minlevel : 10,
			description : "\n   " + "When I use my Action Surge, I can inspire an ally within 60 ft that can see or hear me" + "\n   " + "The ally can then use its reaction to make one melee or ranged weapon attack",
			additional : levels.map(function (n) {
				return n < 10 ? "" : n < 18 ? "1 ally" : "2 allies";
			})
		},
		"subclassfeature15" : {
			name : "Bulwark",
			source : ["S", 128],
			minlevel : 15,
			description : "\n   " + "When I use Indomitable to reroll a Int, Wis, or Cha save, I can extend it to an ally" + "\n   " + "The ally can reroll its failed saving throw against the same effect and take the result" + "\n   " + "It only works if not incapacitated and the ally is within 60 ft and can see or hear me"
		}
	}
});
AddSubClass("monk", "way of the long death", {
	regExpSearch : /^(?=.*\blong)(?=.*\b(death|dead))((?=.*(monk|monastic))|(((?=.*martial)(?=.*(artist|arts)))|((?=.*spiritual)(?=.*warrior)))).*$/i,
	subname : "Way of the Long Death",
	source : ["S", 130],
	features : {
		"subclassfeature3" : {
			name : "Touch of Death",
			source : ["S", 130],
			minlevel : 3,
			description : "\n   " + "If I reduce someone within 5 ft to 0 HP, I gain Wis mod + monk level temporary HP"
		},
		"subclassfeature6" : {
			name : "Hour of Reaping",
			source : ["S", 130],
			minlevel : 6,
			description : "\n   " + "As an action, all creatures within 30 feet of me must make a Wisdom saving throw" + "\n   " + "On a failed save the creature is frightened until the end of my next turn",
			action : ["action", ""]
		},
		"subclassfeature11" : {
			name : "Mastery of Death",
			source : ["S", 131],
			minlevel : 11,
			additional : "1 ki point",
			description : "\n   " + "When I'm reduced to 0 HP, I can expend 1 ki point to have 1 HP instead",
			extraname : "Way of the Long Death 17",
			"touch of the long death" : {
				name : "Touch of the Long Death",
				source : ["S", 131],
				description : " [1-10 ki points]" + "\n   " + "As an action, a target within 5 ft takes 2d10 necrotic damage per ki point I spent" + "\n   " + "It can make a Constitution saving throw to half the damage",
				action : ["action", ""]
			},
			autoSelectExtrachoices : [{
				extrachoice : "touch of the long death",
				minlevel : 17
			}]
		}
	}
});
AddSubClass("monk", "way of the sun soul", {
	regExpSearch : /^(?=.*\bsun)(?=.*\b(soul|spirit))((?=.*(warrior|monk|monastic))|(((?=.*martial)(?=.*(artist|arts)))|((?=.*spiritual)(?=.*warrior)))).*$/i,
	subname : "Way of the Sun Soul",
	source : [["S", 131], ["X", 35]],
	features : {
		"subclassfeature3" : {
			name : "Radiant Sun Bolt",
			source : [["S", 131], ["X", 35]],
			minlevel : 3,
			additional : "1 ki point for 2 extra attacks",
			description : desc([
				"I gain a ranged spell attack that I can use as an attack in the Attack action",
				"If I do this and spend 1 ki point, I can make 2 of these attacks as a bonus action"
			]),
			action : ["bonus action", " (2\u00D7 with Attack action)"],
			weaponOptions : {
				regExpSearch : /^(?=.*radiant)(?=.*(sun|light))(?=.*bolt).*$/i,
				name : "Radiant Sun Bolt",
				source : [["S", 131], ["X", 35]],
				ability : 2,
				type : "Spell",
				damage : [1, 4, "radiant"],
				range : "30 ft",
				description : "If used in an Attack action, spend 1 ki point to use it twice as a bonus action",
				monkweapon : true,
				abilitytodamage : true
			},
			weaponsAdd : ['Radiant Sun Bolt'],
			extraname : "Way of the Sun Soul 6",
			"searing arc strike" : {
				name : "Searing Arc Strike",
				source : [["S", 131], ["X", 35]],
				description : desc([
					"After taking the Attack action, I can cast Burning Hands as a bonus action [PHB 220]",
					"For every additional ki point I spend, Burning hands is cast at 1 higher spell level",
					"The maximum total ki points I can spend for this (including the 2) is half my Monk level"
				]),
				additional : levels.map(function (n) {
					if (n < 3) return "";
					var xtrKi = Math.max(0,Math.floor(n/2) - 2);
					return "2 ki points + max " + xtrKi + " ki point" + (xtrKi == 1 ? "" : "s");
				}),
				action : ["bonus action", " (after Attack action)"],
				spellcastingBonus : {
					name : "Searing Arc Strike",
					spells : ["burning hands"],
					selection : ["burning hands"],
					firstCol : 2
				},
				spellFirstColTitle : "Ki",
				spellChanges : {
					"burning hands" : {
						time : "1 bns",
						description : "3d6+1d6/extra Ki Fire dmg; save halves; unattended flammable objects ignite (ki max 1/2 monk lvl)",
						changes : "After I use the Attack action, I can cast Burning Hands as a bonus action by spending 2 ki points. I can even spend additional ki points to increase its spell level. The total amount of ki points I can spend on it is half my monk level."
					}
				}
			},
			autoSelectExtrachoices : [{
				extrachoice : "searing arc strike",
				minlevel : 6
			}]
		},
		"subclassfeature11" : {
			name : "Searing Sunburst",
			source : [["S", 131], ["X", 35]],
			minlevel : 11,
			description : desc([
				"As an action, anyone in a 20-ft radius light on a point within 150 ft makes a Con save",
				"If failed and not behind opaque total cover, take 2d6 (+ 2d6/ki point) radiant damage"
			]),
			action : ["action", ""],
			additional : "0 ki points + max 3 ki points"
		},
		"subclassfeature17" : {
			name : "Sun Shield",
			source : [["S", 131], ["X", 35]],
			minlevel : 17,
			description : desc([
				"As a reaction, when I'm hit by a melee attack, I can deal 5 + Wis mod radiant damage",
				"I can only do this while my light aura is on; I can turn it on/off as a bonus action"
			]),
			action : [["bonus action", " (start/stop)"], ["reaction", " (hit in melee)"]],
			additional : "30-ft rad bright + 30-ft dim light"
		}
	}
});
AddSubClass("paladin", "oath of the crown", {
	regExpSearch : /^(?=.*(crown|king|country))(((?=.*paladin)|((?=.*(exalted|sacred|holy|divine))(?=.*(knight|fighter|warrior|warlord|trooper))))).*$/i,
	subname : "Oath of the Crown",
	source : ["S", 133],
	features : {
		"subclassfeature3" : {
			name : "Channel Divinity: Champion Challenge",
			source : ["S", 133],
			minlevel : 3,
			description : "\n   " + "I can compel any chosen creatures within 30 ft of me to make a Wisdom save" + "\n   " + "If failed, a target is unable to willingly move more than 30 ft away from me" + "\n   " + "The effect ends if I'm incapacitated, die, or it is moved more than 30 ft away from me",
			action : ["action", ""],
			spellcastingExtra : ["command", "compelled duel", "warding bond", "zone of truth", "aura of vitality", "spirit guardians", "banishment", "guardian of faith", "circle of power", "geas"]
		},
		"subclassfeature3.1" : {
			name : "Channel Divinity: Turn the Tide",
			source : ["S", 133],
			minlevel : 3,
			description : "\n   " + "As a bonus action, any chosen creatures within 30 ft that can hear me regain HP" + "\n   " + "Each regain 1d6 + my Charisma modifier HP, up to half of its total HP",
			action : ["bonus action", ""]
		},
		"subclassfeature7" : {
			name : "Divine Allegiance",
			source : ["S", 133],
			minlevel : 7,
			description : "\n   " + "When a creature within 5 feet of me takes damage, I can substitute my HP for it" + "\n   " + "The creature takes no damage and I take all of it; this damage can't be prevented",
			action : ["reaction", ""]
		},
		"subclassfeature15" : {
			name : "Unyielding Spirit",
			source : ["S", 133],
			minlevel : 15,
			description : "\n   " + "I have advantage on saving throws against effects that paralyze or stun",
			savetxt : { adv_vs : ["paralyzed", "stunned"] }
		},
		"subclassfeature20" : {
			name : "Exalted Champion",
			source : ["S", 133],
			minlevel : 20,
			description : "\n   " + "As an action, I gain the following benefits for 1 hour or until I'm incapacitated:" + "\n    - " + "Resistance to bludgeoning, piercing, and slashing damage from nonmagical weapons" + "\n    - " + "My allies within 30 ft of me and I have advantage on Wisdom and Death saves",
			recovery : "long rest",
			usages : 1,
			action : ["action", ""]
		}
	}
});
AddSubClass("rogue", "mastermind", {
	regExpSearch : /^(?!.*(barbarian|bard|cleric|druid|fighter|monk|paladin|ranger|sorcerer|warlock|wizard))(?=.*(mastermind|strategist)).*$/i,
	subname : "Mastermind",
	fullname : "Mastermind",
	source : [["S", 135], ["X", 46]],
	features : {
		"subclassfeature3" : {
			name : "Master of Intrigue",
			source : [["S", 135], ["X", 46]],
			minlevel : 3,
			description : desc([
				"I gain proficiency with disguise kits, forgery kits, one gaming set, and two languages",
				"I can mimic speech patterns and accents if I've heard them for at least 1 minute"
			]),
			languageProfs : [2],
			toolProfs : ["Disguise kit", "Forgery kit", ["Gaming set", 1]]
		},
		"subclassfeature3.1" : {
			name : "Master of Tactics",
			source : [["S", 135], ["X", 46]],
			minlevel : 3,
			description : desc([
				"I can use the Help action as a bonus action",
				"This even works if the ally attacks a target within 30 ft of me that can see or hear me"
			]),
			action : ["bonus action", ""]
		},
		"subclassfeature9" : {
			name : "Insightful Manipulator",
			source : [["S", 135], ["X", 46]],
			minlevel : 9,
			description : desc([
				"By spending 1 minute observing/interacting outside of combat I can learn capabilities",
				"The DM tells me if the target is my equal, superior, or inferior in regard to two things:",
				" - Intelligence score    - Wisdom score    - Charisma score    - Class levels (if any)"
			])
		},
		"subclassfeature13" : {
			name : "Misdirection",
			source : [["S", 135], ["X", 46]],
			minlevel : 13,
			description : desc([
				"As a reaction, I can redirect an attack meant for me to a creature within 5 ft of me",
				"This only works if the creature is providing me with cover against the attack"
			]),
			action : ["reaction", ""]
		},
		"subclassfeature17" : {
			name : "Soul of Deceit",
			source : [["S", 135], ["X", 46]],
			minlevel : 17,
			description : desc([
				"My thoughts can't be read by telepathy or similar means; I can project false thoughts",
				"For that, I must pass a Cha (Deception) vs. Wis (Insight) check to fool the mind reader",
				"Magic always determines I'm truthful; I can't be magically compelled to tell the truth"
			])
		}
	}
});
AddSubClass("rogue", "swashbuckler", {
	regExpSearch : /^(?!.*(barbarian|bard|cleric|druid|fighter|monk|paladin|ranger|sorcerer|warlock|wizard))(?=.*swashbuckl).*$/i,
	subname : "Swashbuckler",
	fullname : "Swashbuckler",
	source : [["S", 135], ["X", 47]],
	features : {
		"subclassfeature3" : {
			name : "Fancy Footwork",
			source : [["S", 135], ["X", 47]],
			minlevel : 3,
			description : desc([
				"Enemies I make a melee attack against in my turn can't use opportunity attacks on me",
				"This lasts until the end of my current turn"
			])
		},
		"subclassfeature3.1" : {
			name : "Rakish Audacity",
			source : [["S", 136], ["X", 47]],
			minlevel : 3,
			description : desc([
				"I don't need advantage to sneak attack if my target is the only one within 5 ft of me",
				"I still can't sneak attack if I have disadv.; I add my Charisma modifier to initiative rolls"
			]),
			addMod : { type : "skill", field : "Init", mod : "Cha", text : "I can add my Charisma modifier to initiative rolls." }
		},
		"subclassfeature9" : {
			name : "Panache",
			source : [["S", 136], ["X", 47]],
			minlevel : 9,
			description : desc([
				"As an action, I can beguile a creature that hears and understands me, for 1 minute",
				"It must succeed a Wis (Insight) check opposed by my Cha (Persuasion) or be affected as:",
				"\u2022 A hostile target gains disadv. on attacks and can't do opportunity attacks vs. not-me",
				"  This effect ends if an ally attacks or casts a spell vs. it, or if it and I are 60 ft apart",
				"\u2022 Targets that are not hostile are charmed and regard me as a friendly acquaintance",
				"  This effect ends if me or an ally do anything harmful to it"
			]),
			action : ["action", ""]
		},
		"subclassfeature13" : {
			name : "Elegant Maneuver",
			source : [["S", 136], ["X", 47]],
			minlevel : 13,
			description : "\n   " + "As a bonus action, I can gain adv. on my next Dex (Acrobatics) or Str (Athletics) check",
			action : ["bonus action", ""]
		},
		"subclassfeature17" : {
			name : "Master Duelist",
			source : [["S", 136], ["X", 47]],
			minlevel : 17,
			description : "\n   " + "Once per short rest, when I miss with an attack roll, I can roll again with advantage",
			recovery : "short rest",
			usages : 1
		}
	}
});
AddSubClass("sorcerer", "storm sorcery", {
	regExpSearch : /^(?=.*(sorcerer|witch))((?=.*(storm|tempest|hurricane))|((?=.*air)(?=.*element))).*$/i,
	subname : "Storm Sorcery",
	fullname : "Storm Sorcerer",
	source : [["S", 137], ["X", 51]],
	features : {
		"subclassfeature1" : {
			name : "Wind Speaker",
			source : [["S", 137], ["X", 52]],
			minlevel : 1,
			description : "\n   " + "I can speak, read, and write Primordial (and its dialects Aquan, Auran, Ignan, Terran)",
			languageProfs : ["Primordial"]
		},
		"subclassfeature1.1" : {
			name : "Tempestuous Magic",
			source : [["S", 137], ["X", 52]],
			minlevel : 1,
			description : desc([
				"As a bonus action, before or after casting a 1st-level or higher spell, I can fly 10 ft",
				"This movement doesn't provoke opportunity attacks as whirling gust of air surround me"
			]),
			action : ["bonus action", " (with casting)"]
		},
		"subclassfeature6" : {
			name : "Heart of the Storm",
			source : [["S", 137], ["X", 52]],
			minlevel : 6,
			description : desc([
				"I have resistance to lightning and thunder damage",
				"When I start casting a 1st-level or higher spell that deals lightning or thunder damage,",
				"I deal lightning or thunder damage to a creature within 10 ft of me that I can see"
			]),
			additional : levels.map(function (n) { return n < 6 ? "" : Math.floor(n/2) + " damage"; }),
			dmgres : ["Lightning", "Thunder"]
		},
		"subclassfeature6.1" : {
			name : "Storm Guide",
			source : [["S", 137], ["X", 52]],
			minlevel : 6,
			description : desc([
				"As an action, I can stop rain around me in 20-ft radius; bonus action for it to resume",
				"As a bonus action, I can choose the direction of wind around me in a 100-ft radius",
				"This lasts until the end of my next turn and doesn't alter the wind's speed"
			]),
			action : ["bonus action", ""]
		},
		"subclassfeature14" : {
			name : "Storm's Fury",
			source : [["S", 137], ["X", 52]],
			minlevel : 14,
			description : desc([
				"As a reaction when hit by a melee attack, I can deal lightning damage to the attacker",
				"The attacker must also make a Strength save or be pushed up to 20 ft away from me"
			]),
			action : ["reaction", ""],
			additional : levels.map(function (n) { return n < 14 ? "" : n + " lightning damage"; })
		},
		"subclassfeature18" : {
			name : "Wind Soul",
			source : [["S", 137], ["X", 52]],
			minlevel : 18,
			description : desc([
				"I have immunity to lightning and thunder damage and gain magical 60 ft fly speed",
				"As an action, I reduce my fly speed to 30 ft and give allies 30 ft fly speed for 1 hour",
				"I can do this once per short rest for up to 3 + my Charisma modifier allies within 30 ft"
			]),
			action : ["action", ""],
			savetxt : { immune : ["lightning", "thunder"] },
			speed : { fly : { spd : "fixed 60", enc : "fixed 60" } },
			usages : 1,
			recovery : "short rest"
		}
	}
});
AddSubClass("warlock", "the undying", {
	regExpSearch : /^(?!.*light)(?=.*warlock)(?=.*(immortal|undying|neverending|unending)).*$/i,
	subname : "the Undying",
	source : ["S", 139],
	spellcastingExtra : ["false life", "ray of sickness", "blindness/deafness", "silence", "feign death", "speak with dead", "aura of life", "death ward", "contagion", "legend lore"],
	features : {
		"subclassfeature1" : {
			name : "Among the Dead",
			source : ["S", 139],
			minlevel : 1,
			description : "\n   " + "I learn the Spare the Dying cantrip and gain advantage on saving throws vs. diseases" + "\n   " + "If an undead targets me directly with an attack or spell, it must make a Wisdom save" + "\n   " + "On a fail, it must choose a new target or forfeit its attack or harmful spell" + "\n   " + "On a success or if I attack or cast a harmful spell on it, it is immune for 24 hours",
			savetxt : { adv_vs : ["disease"] },
			spellcastingBonus : {
				name : "Among the Dead",
				spells : ["spare the dying"],
				selection : ["spare the dying"]
			}
		},
		"subclassfeature6" : {
			name : "Defy Death",
			source : ["S", 140],
			minlevel : 6,
			description : "\n   " + "I regain 1d8 + my Constitution modifier in HP when I succeed on a Death saving throw" + "\n   " + "I also regain this amount whenever I use Spare the Dying to stabilize a creature",
			recovery : "long rest",
			usages : 1
		},
		"subclassfeature10" : {
			name : "Undying Nature",
			source : ["S", 140],
			minlevel : 10,
			description : "\n   " + "I can hold my breath indefinitely; I don't require food, water, or sleep (I still need rest)" + "\n   " + "I age more slowly, only 1 year for every 10 years that pass; I can't be magically aged"
		},
		"subclassfeature14" : {
			name : "Indestructible Life",
			source : ["S", 140],
			minlevel : 14,
			description : "\n   " + "As a bonus action, I can regain HP and reattach severed body parts",
			action : ["bonus action", ""],
			recovery : "short rest",
			usages : 1,
			additional : levels.map(function (n) { return n < 14 ? "" : "1d8 + " + n + " HP"; })
		}
	}
});
AddSubClass("wizard", "bladesinging", {
	regExpSearch : /(bladesinging|bladesinger)/i,
	subname : "Tradition of Bladesinging",
	fullname : "Bladesinger",
	attacks : [1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
	source : ["S", 142],
	features : {
		"subclassfeature2" : {
			name : "Training in War and Song",
			source : ["S", 142],
			minlevel : 2,
			description : "\n   " + "I gain proficiency with light armor, a one-handed melee weapon, and Performance",
			armorProfs : [true, false, false, false],
			skills : ["Performance"]
		},
		"subclassfeature2.1" : {
			name : "Bladesong",
			source : ["S", 142],
			minlevel : 2,
			description : "\n   " + "As a bonus action, I can start the bladesong for 1 minute; I can dismiss it at any time" + "\n   " + "It stops when I wear a shield, medium or heavy armor, or attack with two hands" + "\n   " + "While the bladesong is active I have the following benefits:" + "\n    - " + "Intelligence modifier (min 1) to AC" + "\n    - " + "Base walking speed increases by 10 foot" + "\n    - " + "Advantage on Dexterity (Acrobatics) checks" + "\n    - " + "Intelligence modifier (min 1) to concentration saves for maintaining conc. on a spell",
			action : ["bonus action", " (start)"],
			recovery : "short rest",
			usages : 2
		},
		"subclassfeature10" : {
			name : "Song of Defense",
			source : ["S", 142],
			minlevel : 10,
			description : "\n   " + "As a reaction while my bladesong is active, I can expend a spell slot to reduce damage" + "\n   " + "The damage I take is reduced by 5 for every level of the spell slot I expend",
			action : ["reaction", " (in bladesong)"]

		},
		"subclassfeature14" : {
			name : "Song of Victory",
			source : ["S", 142],
			minlevel : 14,
			description : "\n   " + "While my bladesong is active, I can add my Int mod to melee weapon attack damage",
			calcChanges : {
				atkCalc : [
					function (fields, v, output) {
						if (classes.known.wizard && classes.known.wizard.level > 13 && v.isMeleeWeapon && (/blade.?song/i).test(v.WeaponText)) {
							output.extraDmg += What('Int Mod');
						};
					},
					"If I include the word 'Bladesong' in the name or description of a melee weapon, it gets my Intelligence modifier added to its Damage."
				]
			}
		}
	}
});

// New Totem Warrior options
var AmendTotemWarriorSCAG = function() {
	if (!ClassSubList["barbarian-totem warrior"] || ClassSubList["barbarian-totem warrior"].source.indexOf("P") === -1) return;
	var TWadds = [{
		name : "Elk",
		addto : "subclassfeature3.1",
		feature : {
			name : "Elk Spirit",
			source : ["S", 122],
			description : "\n   " + "While raging without heavy armor, my base walking speed increases with 15 foot"
		}
	}, {
		name : "Tiger",
		addto : "subclassfeature3.1",
		feature : {
			name : "Tiger Spirit",
			source : ["S", 122],
			description : "\n   " + "While raging, I can add 10 feet to my long jump and 3 feet to my high jump distance"
		}
	}, {
		name : "Elk",
		addto : "subclassfeature6",
		feature : {
			name : "Aspect of the Elk",
			source : ["S", 122],
			description : "\n   " + "While mounted or on foot and not incapacitated, my travel pace is doubled" + "\n   " + "I can extend this benefit to up to ten companions, while they are within 60 ft of me"
		}
	}, {
		name : "Tiger",
		addto : "subclassfeature6",
		feature : {
			name : "Aspect of the Tiger",
			source : ["S", 122],
			description : "\n   " + "I gain proficiency with two skills chosen from: Athletics, Acrobatics, Stealth, or Survival",
			skillstxt : "Choose two from Athletics, Acrobatics, Stealth, and Survival"
		}
	}, {
		name : "Elk",
		addto : "subclassfeature14",
		feature : {
			name : "Elk Attunement",
			source : ["S", 122],
			description : "\n   " + "As a bonus action while raging, I can move through Large or smaller creature's space" + "\n   " + "It must make a Strength save of DC 8 + Strength modifier + Proficiency bonus" + "\n   " + "If failed, it is knocked prone and takes 1d12 + Strength modifier bludgeoning damage",
			action : ["bonus action", " (in rage)"]
		}
	}, {
		name : "Tiger",
		addto : "subclassfeature14",
		feature : {
			name : "Tiger Attunement",
			source : ["S", 122],
			description : "\n   " + "As a bonus action while raging, I can make a melee weapon attack on these conditions:" + "\n    - " + "I move at least 20 ft in a straight line towards the target that is Large or smaller" + "\n    - " + "I make a melee weapon attack against it after the bonus action",
			action : ["bonus action", " (in rage)"]
		}
	}]
	var TW = ClassSubList["barbarian-totem warrior"].features;
	for (var i = 0; i < TWadds.length; i++) {
		var tA = TWadds[i];
		var TWfea = TW[tA.addto];
		TWfea.choices.push(tA.name);
		TWfea[tA.name.toLowerCase()] = tA.feature;
	};
}();

// Backgrounds
BackgroundList["far traveler"] = {
	regExpSearch : /^(?=.*far)(?=.*traveler).*$/i,
	name : "Far Traveler",
	source : [["S", 148], ["ALbackground", 0]],
	skills : ["Insight", "Perception"],
	gold : 5,
	equipleft : [
		["Gaming set or musical instrument", "", ""],
		["Poorly wrought maps", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Piece of jewelry worth 10 gp", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "All Eyes on You",
	trait : [
		"I have different assumptions from those around me concerning personal space, blithely invading others' space in innocence, or reacting to ignorant invasion of my own.",
		"I have my own ideas about what is and is not food, and I find the eating habits of those around me fascinating, confusing, or revolting.",
		"I have a strong code of honor or sense of propriety that others don't comprehend.",
		"I express affection or contempt in ways that are unfamiliar to others.",
		"I honor my deities through practices that are foreign to this land.",
		"I begin or end my day with small traditional rituals that are unfamiliar to those around me."
	],
	ideal : [
		["Open",
			"Open: I have much to learn from the kindly folk I meet along my way. (Good)"
		],
		["Reserved",
			"Reserved: As someone new to these strange lands, I am cautious and respectful in my dealings. (Lawful)"
		],
		["Adventure",
			"Adventure: I'm far from home, and everything is strange and wonderful! (Chaotic)"
		],
		["Cunning",
			"Cunning: Though I may not know their ways, neither do they know mine, which can be to my  advantage. (Evil)"
		],
		["Inquisitive",
			"Inquisitive: Everything is new, but I have a thirst to learn. (Neutral)"
		],
		["Suspicious",
			"Suspicious: I must be careful, for I have no way of telling friend from foe here. (Any)"
		]
	],
	bond : [
		"So long as I have this token from my homeland, I can face any adversity in this strange land.",
		"The gods of my people are a comfort to me so far from home.",
		"I hold no greater cause than my service to my people.",
		"My freedom is my most precious possession. I'll never let anyone take it from me again.",
		"I'm fascinated by the beauty and wonder of this new land.",
		"Though I had no choice, I lament having to leave my loved one(s) behind. I hope to see them again one day."
	],
	flaw : [
		"I am secretly (or not so secretly) convinced of the superiority of my own culture over that of this foreign land.",
		"I pretend not to understand the local language in order to avoid interactions I would rather not have.",
		"I have a weakness for the new intoxicants and other pleasures of this land.",
		"I don't take kindly to some of the actions and motivations of the people of this land, because these folk are different from me.",
		"I consider the adherents of other gods to be deluded innocents at best, or ignorant fools at worst.",
		"I have a weakness for the exotic beauty of the people of these lands."
	],
	extra : [
		"Select Why You Are Here",
		"Emissary",
		"Exile",
		"Fugitive",
		"Pilgrim",
		"Sightseer",
		"Wanderer"
	],
	toolProfs : [["Gaming set or musical instrument", 1]],
	languageProfs : [1],
	lifestyle : "modest"
};

// Background variants
AddBackgroundVariant("soldier", "city watch", {
	regExpSearch : /^(?=.*city)(?=.*(watch|guard)).*$/i,
	name : "City Watch",
	source : [["S", 145], ["ALbackground", 0]],
	skills : ["Athletics", "Insight"],
	equipright : [
		["Uniform of my unit", "", 3],
		["Insignia of rank", "", ""],
		["Horn", "", 2],
		["Manacles", "", 6],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Watcher's Eye",
	extra : "",
	toolProfs : "",
	languageProfs : [2],
	lifestyle : "modest"
});
AddBackgroundVariant("guild artisan", "clan crafter", {
	regExpSearch : /^(?=.*clan)(?=.*(crafter|smith|builder|miner)).*$/i,
	name : "Clan Crafter",
	source : [["S", 145], ["ALbackground", 0]],
	skills : ["History", "Insight"],
	equipleft : [
		["Set of artisan's tools", "", ""],
		["Maker's mark chisel", "", 0.5]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Belt pouch (with coins and 10 gp gem)", "", 1],
	],
	feature : "Respect of the Stout Folk",
	extra : "",
	languageProfs : ["Dwarvish"],
	lifestyle : "comfortable"
});
AddBackgroundVariant("sage", "cloistered scholar", {
	regExpSearch : /^(?=.*cloistered)(?=.*scholar).*$/i,
	name : "Cloistered Scholar",
	source : [["S", 146], ["ALbackground", 0]],
	skills : ["History"],
	skillstxt : "History and choose one from Arcana, Nature, and Religion",
	gold : 10,
	equipleft : [
		["Ink, 1 ounce bottle of", 1, ""],
		["Quill", "", ""],
		["Parchment, sheets of", 1, ""],
		["Small penknife", "", 0.5],
		["Borrowed book", "", 5]
	],
	equipright : [
		["Scholar's robes", "", 3],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Library Access",
	extra : ["Name your Library"],
	languageProfs : [2],
	lifestyle : "modest"
});
AddBackgroundVariant("guild artisan", "courtier", {
	regExpSearch : /courtier/i,
	name : "Courtier",
	source : [["S", 146], ["ALbackground", 0]],
	skills : ["Insight", "Persuasion"],
	gold : 5,
	equipleft : "",
	equipright : [
		["Fine clothes", "", 3],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Court Functionary",
	extra : "",
	toolProfs : "",
	languageProfs : [2],
	lifestyle : "comfortable"
});
AddBackgroundVariant("acolyte", "faction agent", {
	regExpSearch : /^(?=.*agent)(?=.*(faction|harper|order of the gauntlet|emerald enclave|lord.?s alliance|zhentarim)).*$/i,
	name : "Faction Agent",
	source : [["S", 147], ["ALbackground", 0]],
	skills : ["Insight"],
	skillstxt : "Insight and choose one Intelligence, Wisdom, or Charisma skill",
	gold : 15,
	equipleft : [
		["Copy of seminal faction's text", "", ""]
	],
	equipright : [
		["Common clothes", "", 3],
		["Badge or emblem of faction", "", ""],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Safe Haven",
	extra : [
		"Select a Faction",
		"The Harpers",
		"The Order of the Gauntlet",
		"The Emerald Enclave",
		"The Lord's Alliance",
		"The Zhentarim"
	],
	languageProfs : [2],
	lifestyle : "modest"
});
AddBackgroundVariant("folk hero", "inheritor", {
	regExpSearch : /inheritor/i,
	name : "Inheritor",
	source : [["S", 150], ["ALbackground", 0]],
	skills : ["Survival"],
	skillstxt : "Survival and choose one from Arcana, History, and Religion",
	gold : 15,
	equipleft : [
		["Gaming set or musical instrument", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["The inheritance", "", ""],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Inheritance",
	extra : [
		"Select an Inheritance",
		"Document such as a map, letter, or journal",
		"A trinket",
		"Article of clothing",
		"Piece of jewelry",
		"Arcane book or formulary",
		"Written story, song, poem, or secret",
		"Tattoo or other body marking"
	],
	toolProfs : [["Gaming set or musical instrument", 1]],
	languageProfs : [1],
	lifestyle : "wealthy"
});
AddBackgroundVariant("soldier", "investigator", {
	regExpSearch : /investigator/i,
	name : "Investigator",
	source : [["S", 145], ["ALbackground", 0]],
	skills : ["Insight", "Investigation"],
	equipright : [
		["Uniform", "", 3],
		["Insignia of rank", "", ""],
		["Horn", "", 2],
		["Manacles", "", 6],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Watcher's Eye",
	extra : "",
	toolProfs : "",
	languageProfs : [2]
});
AddBackgroundVariant("soldier", "knight of the order", {
	regExpSearch : /^(?=.*knight)(?=.*order).*$/i,
	name : "Knight of the Order",
	source : [["S", 151], ["ALbackground", 0]],
	skills : ["Persuasion"],
	skillstxt : "Persuasion and choose one from Arcana, History, Nature, and Religion",
	equipright : [
		["Traveler's clothes", "", 4],
		["Signet, banner, or seal of rank", "", ""],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Knightly Regard",
	extra : ["Name your Knightly Order"],
	toolProfs : [["Gaming set or musical instrument", 1]],
	languageProfs : [1],
	lifestyle : "comfortable"
});
AddBackgroundVariant("soldier", "mercenary veteran", {
	regExpSearch : /^(?=.*mercenary)(?=.*(veteran|soldier)).*$/i,
	name : "Mercenary Veteran",
	source : [["S", 152], ["ALbackground", 0]],
	skills : ["Athletics", "Persuasion"],
	equipright : [
		["Uniform of my company", "", 4],
		["Insignia of rank", "", ""],
		["Gaming set", "", ""],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Mercenary Life",
	extra : ["Name your Mercenary Company"],
	lifestyle : "modest"
});
AddBackgroundVariant("criminal", "urban bounty hunter", {
	regExpSearch : /^(?=.*urban)(?=.*bounty)(?=.*hunter).*$/i,
	name : "Urban Bounty Hunter",
	source : [["S", 153], ["ALbackground", 0]],
	skills : "",
	skillstxt : "Choose two from Deception, Insight, Persuasion, and Stealth",
	gold : 20,
	equipright : [
		["Appropriate Clothes", "", 3],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Ear to the Ground",
	extra : "",
	toolProfs : [["Gaming set, instrument, or thieves' tools", 2]],
	lifestyle : "poor"
});
AddBackgroundVariant("outlander", "uthgardt tribe member", {
	regExpSearch : /^(?=.*(uthgardt|barbarian|nomad|clan))(?=.*tribe)(?=.*member).*$/i,
	name : "Uthgardt Tribe Member",
	source : [["S", 153], ["ALbackground", 0]],
	equipright : [
		["Traveler's clothes", "", 4],
		["Hunting trap", "", 25],
		["Totemic token or tattoos of tribal totem", "", ""],
		["Belt pouch (with coins)", "", 1],
	],
	feature : "Uthgardt Heritage",
	extra : "",
	toolProfs : [["Artisan's tools or musical instrument", 1]],
	languageProfs : [1],
	lifestyle : "poor"
});
AddBackgroundVariant("noble", "waterdhavian noble", {
	regExpSearch : /^(?=.*(waterdhavian|waterdeep))(?=.*noble).*$/i,
	name : "Waterdhavian Noble",
	source : [["S", 154], ["ALbackground", 0]],
	gold : 20,
	equipleft : [
		["Scroll of pedigree", "", ""],
		["Skin of fine zzar or wine", "", 5] // weight based on waterskin
	],
	equipright : [
		["Fine clothes", "", 6],
		["Signet ring or brooch", "", ""],
		["Purse (with coins)", "", 1],
	],
	feature : "Kept in Style",
	toolProfs : [["Gaming set or musical instrument", 1]],
	languageProfs : [1],
	lifestyle : "wealthy"
});

// Background features
BackgroundFeatureList["court functionary"] = {
	description : "My knowledge of how bureaucracies function lets me gain access to the records and inner workings of any noble court or government I encounter. I know or can easily acquire the knowledge who the movers and shakers are, whom to go to for the favors I seek, and what the current intrigues of interest in the group are.",
	source : [["S", 147], ["ALbackground", 0]]
};
BackgroundFeatureList["all eyes on you"] = {
	description : "My accent, mannerisms, figures of speech all mark me as foreign. Curious glances are directed my way wherever I go. A nuisance, but I also gain the friendly interest of the curious. I can parley this attention into access I might not otherwise have, for me and my companions. Nobles, scholars, merchants, and guilds, might be among the interested.",
	source : [["S", 149], ["ALbackground", 0]]
};
BackgroundFeatureList["ear to the ground"] = {
	description : "I am in frequent contact with people in my chosen segment of society. These people might be associated with the criminal underworld, the rough-and-tumble folk of the streets, or members of high society. This connection comes in the form of a contact in any city I visit, a person who provides information about the people and places of the local area.",
	source : [["S", 153], ["ALbackground", 0]]
};
BackgroundFeatureList["inheritance"] = {
	description : "The item I inherited has a special significance, history, power, and/or important value. When I begin my adventuring career, I can decide whether to tell my companions about it right away. Rather than attracting attention to myself, I could decide to keep it a secret until I learn more about what it means to me and what it can do for me.",
	source : [["S", 150], ["ALbackground", 0]]
};
BackgroundFeatureList["kept in style"] = {
	description : "While I am in Waterdeep or elsewhere in the North my house sees to my everyday needs. My name and signet are sufficient to cover most of my expenses; the inns, taverns, and festhalls I frequent are glad to record my debt and send an accounting to my family's estate. This advantage enables me to take 2 gp of my daily lifestyle costs down to 0 gp.",
	source : [["S", 154], ["ALbackground", 0]]
};
BackgroundFeatureList["knightly regard"] = {
	description : "I receive shelter and succor from members of my knightly order and its sympathizers. Religious knightly orders get aid from temples and communities of my deity. Civic order knights get help from the community they serve. Philosophical order knights can find help from those they have aided in pursuit of their ideals, and those who share those ideals.",
	source : [["S", 151], ["ALbackground", 0]]
};
BackgroundFeatureList["library access"] = {
	description : "I have free access to most of the library I work at, though it might have repositories of lore that are too valuable, magical, or secret to permit anyone immediate access. I have a working knowledge of my cloister's personnel and bureaucracy, and I know how to navigate those connections. I am likely to gain preferential treatment at other libraries.",
	source : [["S", 146], ["ALbackground", 0]]
};
BackgroundFeatureList["mercenary life"] = {
	description : "I know the mercenary life well. I am able to identify mercenary company emblems, and I know a little about any such company, including the leaders, reputation, and who hired them recently. I can find the locales where mercenaries abide anywhere, as long as I speak the language. My mercenary work between adventures affords me a comfortable lifestyle.",
	source : [["S", 152], ["ALbackground", 0]]
};
BackgroundFeatureList["respect of the stout folk"] = {
	description : "No one esteems clan crafters quite so highly as dwarves do. I always have free room and board in any place where shield dwarves or gold dwarves dwell, and the individuals in such a settlement might vie among themselves to determine who can offer me (and possibly my compatriots) the finest accommodations and assistance.",
	source : [["S", 145], ["ALbackground", 0]]
};
BackgroundFeatureList["safe haven"] = {
	description : "As a faction agent, I have access to a secret network of support and operatives who can provide assistance on my adventures. I know secret signs and passwords to identify such operatives, who can provide me with access to a hidden safe house, free room and board, or assistance in finding information. These agents never risk their lives or identity for me.",
	source : [["S", 147], ["ALbackground", 0]]
};
BackgroundFeatureList["uthgardt heritage"] = {
	description : "I have an excellent knowledge of my tribe's territory, and surrounding terrain and natural resources. I am familiar enough with any wilderness area that I can find twice as much food and water as one normally would. I can call upon the hospitality of my people, and those allied, often including members of druid circles, nomadic elves, and priesthoods.",
	source : [["S", 154], ["ALbackground", 0]]
};
BackgroundFeatureList["watcher's eye"] = {
	description : "My experience in enforcing the law, and dealing with lawbreakers, gives me a feel for local laws and criminals. I can easily find the local outpost of the watch, guards or a similar organization, and just as easily pick out the dens of criminal activity in a community. I am far more likely to be welcome in the former locations rather than the latter, however.",
	source : [["S", 145], ["ALbackground", 0]]
};

WeaponsList["booming blade"] = {
	regExpSearch : /^(?=.*booming)(?=.*blade).*$/i,
	name : "Booming Blade",
	source : ["S", 142],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["Bd8/Cd8", "", "thunder"],
	range : "With melee wea",
	description : "First damage added to the attack; second to the target if it moves next round (SCAG 142)",
	abilitytodamage : false
};
WeaponsList["green-flame blade"] = {
	regExpSearch : /^(?=.*green)(?=.*flame)(?=.*blade).*$/i,
	name : "Green-Flame Blade",
	source : ["S", 143],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["Bd8/Bd8", "", "fire"],
	range : "With melee wea",
	description : "First damage added to the attack; second to a target within 5 ft (SCAG 143)",
	abilitytodamage : true
};
WeaponsList["lightning lure"] = {
	regExpSearch : /^(?=.*lightning)(?=.*lure).*$/i,
	name : "Lightning Lure",
	source : ["S", 143],
	list : "spell",
	ability : 5,
	type : "Cantrip",
	damage : ["C", 8, "lightning"],
	range : "15 ft",
	description : "Str save; success - nothing; fail - pulled 10 ft closer to me, only take damage if end within 5 ft of me (SCAG 143)",
	abilitytodamage : false,
	dc : true
};
WeaponsList["sword burst"] = {
	regExpSearch : /^(?=.*sword)(?=.*burst).*$/i,
	name : "Sword Burst",
	source : ["S", 143],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["C", 6, "force"],
	range : "5 ft",
	description : "Dex save, success - no damage; all creatures in range (SCAG 143)",
	abilitytodamage : false,
	dc : true
};

// Feat
if (!FeatsList["svirfneblin magic"]) {
	FeatsList["svirfneblin magic"] = {
		name : "Svirfneblin Magic",
		source : [["E", 7], ["S", 115], ["MToF", 114]],
		prerequisite : "Being a Svirfneblin (Deep Gnome)",
		prereqeval : function(v) { return CurrentRace.known === 'deep gnome'; },
		descriptionFull : "You have inherited the innate spellcasting ability of your ancestors. This ability allows you to cast Nondetection on yourself at will, without needing a material component. You can also cast each of the following spells once with this ability: Blindness/Deafness, Blur, and Disguise Self. You regain the ability to cast these spells when you finish a long rest.\n   Intelligence is your spellcasting ability for these spells, and you cast them at their lowest possible levels.",
		description : "I can cast Nondetection on myself at will, without a material component. I can also cast the spells Blindness/Deafness, Blur, and Disguise Self once each. I regain the ability to cast these spells when I finish a long rest. Intelligence is my spellcasting ability for these spells.",
		spellcastingBonus : [{
			name : "at will (self only)",
			spellcastingAbility : 4,
			spells : ["nondetection"],
			selection : ["nondetection"],
			firstCol : 'atwill'
		}, {
			name : "1x long rest (self only)",
			spells : ["blindness/deafness", "blur", "disguise self"],
			selection : ["blindness/deafness", "blur", "disguise self"],
			firstCol : 'oncelr',
			times : 3
		}],
		spellChanges : {
			"nondetection" : {
				range : "Self",
				components : "V,S",
				compMaterial : "",
				description : "I am hidden from all divination magic",
				changes : "Using Svirfneblin Magic, I can cast Nondetection without a material component, but only on myself."
			}
		}
	};
}

// Spells
SpellsList["booming blade"] = {
	name : "Booming Blade",
	classes : ["sorcerer", "warlock", "wizard"],
	source : ["S", 142],
	level : 0,
	school : "Evoc",
	time : "1 a",
	range : "5 ft",
	components : "V,M",
	compMaterial : "A weapon",
	duration : "Instantaneous",
	description : "Melee wea atk with cast; if hit, it 0d8, if it moves next rnd it 1d8 Thunder dmg; +1d8 at CL5, 11, \u0026 17",
	descriptionCantripDie : "Melee wea atk with cast; if hit, it `CD-1`d8 Thunder dmg, and if it moves next rnd it `CD`d8 Thunder dmg",
	descriptionFull : "As part of the action used to cast this spell, you must make a melee attack with a weapon against one creature within the spell's range, otherwise the spell fails. On a hit, the target suffers the attack's normal effects, and it becomes sheathed in booming energy until the start of your next turn. If the target willingly moves before then, it immediately takes 1d8 thunder damage, and the spell ends.\n   This spell's damage increases when you reach higher levels. At 5th level, the melee attack deals an extra 1d8 thunder damage to the target, and the damage the target takes for moving increases to 2d8. Both damage rolls increase by 1d8 at 11th level and 17th level."
};
SpellsList["green-flame blade"] = {
	name : "Green-Flame Blade",
	classes : ["sorcerer", "warlock", "wizard"],
	source : ["S", 143],
	level : 0,
	school : "Evoc",
	time : "1 a",
	range : "5 ft",
	components : "V,M",
	compMaterial : "A weapon",
	duration : "Instantaneous",
	description : "Melee wea atk with cast; atk +0d8 Fire dmg, crea in 5 ft 0d8+spell mod Fire dmg; +1d8 at CL5/11/17",
	descriptionCantripDie : "Melee wea atk with cast; if hit, atk does +`CD-1`d8 Fire dmg, 1 crea in 5 ft `CD-1`d8+spellcasting ability modifier Fire dmg",
	descriptionFull : "As part of the action used to cast this spell, you must make a melee attack with a weapon against one creature within the spell's range, otherwise the spell fails. On a hit, the target suffers the attack's normal effects, and green fire leaps from the target to a different creature of your choice that you can see within 5 feet of it. The second creature takes fire damage equal to your spellcasting ability modifier.\n   This spell's damage increases when you reach higher levels. At 5th level, the melee attack deals an extra 1d8 fire damage to the target, and the fire damage to the second creature increases to 1d8 + your spellcasting ability modifier. Both damage rolls increase by 1d8 at 11th level and 17th level."
};
SpellsList["lightning lure"] = {
	name : "Lightning Lure",
	classes : ["sorcerer", "warlock", "wizard"],
	source : ["S", 143],
	level : 0,
	school : "Evoc",
	time : "1 a",
	range : "15 ft",
	components : "V",
	duration : "Instantaneous",
	save : "Str",
	description : "1 crea I see save or pulled 10 ft to me; if it end in 5 ft, 1d8 Lightning dmg; +1d8 at CL 5, 11, and 17",
	descriptionCantripDie : "1 crea I see save or pulled 10 ft to me; if it end in 5 ft, `CD`d8 Lightning dmg",
	descriptionFull : "You create a lash of lightning energy that strikes at one creature of your choice that you can see within range. The target must succeed on a Strength saving throw or be pulled up to 10 feet in a straight line toward you and then take 1d8 lightning damage if it is within 5 feet of you." + "\n   " + "This spell's damage increases by 1d8 when you reach 5th level (2d8), 11th level (3d8), and 17th level (4d8)."
};
SpellsList["sword burst"] = {
	name : "Sword Burst",
	classes : ["sorcerer", "warlock", "wizard"],
	source : ["S", 143],
	level : 0,
	school : "Conj",
	time : "1 a",
	range : "5 ft",
	components : "V",
	duration : "Instantaneous",
	save : "Dex",
	description : "All crea in range save or 1d6 Force damage; +1d6 at CL 5, 11, and 17",
	descriptionCantripDie : "All crea in range save or `CD`d6 Force damage",
	descriptionFull : "You create a momentary circle of spectral blades that sweep around you. Each creature within range, other than you, must succeed on a Dexterity saving throw or take 1d6 force damage." + "\n   " + "This spell's damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6)."
};
var iFileName = "pub_20160315_CoS.js";
RequiredSheetVersion(13);
// This file adds the backgrounds from the Curse of Strahd adventure book and the optional backgrounds from the Adventurers League season 4 (Curse of Strahd) to MPMB's Character Record Sheet

// Define the sources
SourceList.CoS={
	name : "Curse of Strahd [background, items, pack]",
	abbreviation : "CoS",
	group : "Adventure Books",
	url : "https://media.wizards.com/2016/downloads/DND/CoS_Character_Options.pdf",
	date : "2016/03/15"
};
SourceList["AL:CoS"]={
	name : "Curse of Strahd Backgrounds", // v1.1
	abbreviation : "AL:CoS",
	group : "Adventurers League",
	url : "https://dndadventurersleague.org/wp-content/uploads/2016/06/Curse-of-Strahd-Backgrounds-v1.1.pdf",
	date : "2016/04/07"
};

// Backgrounds (with contributions by RCanine)
BackgroundList["haunted one"] = {
	regExpSearch : /haunted/i,
	name : "Haunted One",
	source : [["CoS", 209], ["ALbackground", 0]],
	skills : "",
	skillstxt : "Choose two from Arcana, Investigation, Religion, and Survival", // As only one skill proficiency in Curse of Strahd, but that was corrected in Curse of Strahd: Character Options
	languageProfs : [1],
	gold : 0,
	equipleft : [
		["Chest, with:", "", 25],
		["Crowbar", "", 5],
		["Hammer", "", 3],
		["Wooden Stakes", 3, 1],
		["Holy symbol", "", 1],
		["Holy water, flasks of", "", 1],
		["Manacles", "", 6],
		["Steel Mirror", "", 0.5],
		["Oil, flasks of", "", 1],
		["Tinderbox", "", 1],
		["Torch", 3, 1]
	],
	equipright : [
		["Common clothes", "", 3],
		["Trinket of special significance", "", ""]
	],
	feature : "Heart of Darkness",
	trait : [
		"I don't run from evil. Evil runs from me.",
		"I like to read and memorize poetry. It keeps me calm and brings me fleeting moments of happiness.",
		"I spend money freely and live life to the fullest, knowing that tomorrow I might die.",
		"I live for the thrill of the hunt.",
		"I don't talk about the thing that torments me. I'd rather not burden others with my curse.",
		"I expect danger around every corner.",
		"I refuse to become a victim, and I will not allow others to be victimized.",
		"I put no trust in divine beings."
	],
	ideal : [
		["Sacrifice", "Sacrifice: I try to help those in need, no matter what the personal cost. (Good)"],
		["Desperation", "Desperation: I'll stop the spirits that haunt me or die trying. (Any)"],
		["Cleansing", "Cleansing: I kill monsters to make the world a safer place, and to exorcise my own demons. (Good)"],
		["Vigilante", "Vigilante: I have a dark calling that puts me above the law. (Chaotic)"],
		["Preparation", "Preparation: I like to know my enemy's capabilities and weaknesses before rushing into battle. (Lawful)"],
		["Destruction", "Destruction: I'm a monster that destroys other monsters, and anything else that gets in my way. (Evil)"]
	],
	bond : [
		"I keep my thoughts and discoveries in a journal. My journal is my legacy.",
		"I would sacrifice my life and my soul to protect the innocent.",
		"My torment drove away the person I love. I strive to win back the love I've lost.",
		"A terrible guilt consumes me. I hope that I can find redemption through my actions.",
		"There's evil in me, I can feel it. It must never be set free.",
		"I have a child to protect. I must make the world a safer place for him (or her)."
	],
	flaw : [
		"I have certain rituals that I must follow every day. I can never break them.",
		"I assume the worst in people.",
		"I feel no compassion for the dead. They're the lucky ones.",
		"I have an addiction.",
		"I am a purveyor of doom and gloom who lives in a world without hope.",
		"I talk to spirits that no one else can see."
	],
	extra : [
		"Select a Harrowing Event",
		"Monster spared my life",
		"Born under a dark star",
		"Haunted by an apparition",
		"Dark arts in the family",
		"An oni took my sibling",
		"Memory of cured lycanthropy",
		"Raised by a hag",
		"Studied an eldritch tome",
		"Formerly possessed by a fiend",
		"Avenged a murder"
	],
};
BackgroundList["black fist double agent"] = {
	regExpSearch : /black\W*fist/i,
	name : "Black Fist Double Agent",
	source : [["AL:CoS", 2], ["ALbackground", 0]],
	skills : ["Deception", "Insight"],
	gold : 15,
	equipleft : [
		["Disguise kit", "", 3],
		["Tears of Virulence emblem", "", ""],
		["Writ of free agency", "", ""],
		["Set of artisan's tools or gaming set", "", ""]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt Pouch (with coins)", "", ""]
	],
	feature : "Double Agent",
	trait : [
		"People are only as trustworthy as you are valuable to them. Always strive to be the most valuable person around.",
		"My eloquence and sophistication are tools I use to avoid arousing suspicion myself.",
		"I am a thrill-seeker, excited by covert and dangerous missions.",
		"I live by my wits and always check every lock twice, just to be certain.",
		"I never admit to my mistakes lest they be used against me.",
		"I take every effort to be unnoticeable and blend into the crowd. Passersby rarely give me a second look.",
		"I am prepared for any eventuality; including the day my usefulness as a spy comes to an end.",
		"I always make certain to know my enemy before acting, lest I bite off more than I can chew."
	],
	ideal : [
		["Suspicious", "Suspicious: In my experience, everybody has something to hide, and what they hide can usually hurt me. (Any)"],
		["Secretive", "Secretive: I trade in secrets, and am not about to let any of mine slip. (Any)"],
		["Hedonist", "Hedonist: Life is short. I live my life to the fullest, as I know any day could be my last. (Chaotic)"],
		["Selfless", "Selfless: I use my position to help the downtrodden avoid persecution from the authorities. (Good)"],
		["Patriotic" , "Patriotic: I am a loyal supporter of Phlan and its leaders, and see my role as a solemn duty and necessary evil to prevent anarchy. (Lawful)"],
		["Manipulative", "Manipulative: I use my knowledge to blackmail and manipulate others to my own benefit. (Evil)"]
	],
	bond : [
		"I was framed for a crime I did not commit, and seek to bring the true culprit to justice.",
		"I am a part of an underground network that smuggles innocent civilians out of the city prior to being raided by the authorities.",
		"I miss the glory days of Phlan, before the coming of the dragon.",
		"I seek to prove myself worthy of joining the Black Fist as a member of their order.",
		"My sister was killed by a Tear of Virulence, and now I feed them false information whenever possible.",
		"My family was wrongly imprisoned, and I act as an informant in order to secure their release."
	],
	flaw : [
		"I think too highly of myself, and have an exaggerated sense of self-importance.",
		"I have difficulty trusting strangers. I see spies and informants everywhere.",
		"Years of getting away with minor crimes has left me believing that I am above the law, and have diplomatic immunity above my station.",
		"Years of seeing innocent people suffer have left me despondent and pessimistic for the future.",
		"My desire for vengeance often gets me into trouble",
		"I am spendthrift, and share my wealth with the patrons of my favorite tavern."
	],
	toolProfs : ["Disguise Kit", ["Artisan's tools or gaming set", 1]],
	lifestyle : "modest"
};
BackgroundList["dragon casualty"] = {
	regExpSearch : /^(?=.*dragon)(?=.*casualty).*$/i,
	name : "Dragon Casualty",
	source : [["AL:CoS", 3], ["ALbackground", 0]],
	skills : ["Intimidation", "Survival"],
	toolProfs : ["Based on my origin"],
	gold : 5,
	equipleft : [
		["Loaf of moldy bread", "", 1],
		["Cast-off Vorgansharax scale", "", ""]
	],
	equipright : [
		["Tattered Rags", "", 3],
		["Dagger", "", 1],
		["Belt Pouch (with coins)", "", ""]
	],
	feature : "Dragonscarred",
	extra : [
		"Select an Origin (or Disfigurement)",
		"Dockworker",
		"Fisherman",
		"Tradesperson",
		"Merchant",
		"Black Fist Soldier",
		"Adventurer",
		"Visitor",
		"Entertainer",
		"Scholar",
		"Healer",
		"Criminal",
		"Unskilled laborer",
		"",
		"- Disfigurements (optional):",
		"Extensive scarring",
		"Small non-functional wing(s)",
		"Misshapen, wing-like membrane(s)",
		"Elongated, claw-like hand(s) or feet",
		"Painful green scales embedded in skin",
		"Bulbous, reptilian eye(s)",
		"Enlarged dorsal spines",
		"Small irregular spines instead of hair"
	],
	trait : [
		"I am driven to escape my past, and rarely stay in one place long.",
		"I know secrets of the Maimed Virulence, but fear the harm that may befall me should others learn them.",
		"Speaking of my ordeal helps sooth the still open wounds in my soul.",
		"My former life is meaningless, and was ripped to shreds by the claws of Vorgansharax. All that matters now is what I do with the future.",
		"I have faced the worst a dragon can deliver and survived. I am fearless, and my resolve unshakable.",
		"I am haunted my tortured past, and wake at night screaming at half-remembered horrors.",
		"I sleep with my back to a wall or tree, and a weapon within arm's reach.",
		"I am slow to trust, but incredibly loyal to those who have earned it."
	],
	ideal : [
		["Survivor", "Survivor: No matter the cost, I will take any action necessary to survive (any)"],
		["Independence", "Independence: When in trouble, the only person I can rely on is myself (Chaotic)"],
		["Compassionate", "Compassionate: I have suffered long at the hands of a Dragon, and take pitty and compassion on the suffering of others (Good)"],
		["Secretive", "Secretive: I am withdrawn, and hide my monstrous appearance for fear of drawing unwanted attention. (Chaotic)"],
		["Justice", "Justice: I have been wronged, and will not allow the same fate to befall others. (Lawful)"],
		["Sycophant", "Sycophant: During my ordeal, I became a willing servant of the Maimed Virulence, and spy on his behalf. (Evil)"]
	],
	bond : [
		"I have sworn vengeance on the Maimed Virulence and those that follow him.",
		"I long to reunite with friends and family who may dwell among the Phlan Refugees, and protect them.",
		"While a prisoner of the Maimed Virulence, I overheard rumors of an item or treasure the Dragon seeks. I will have that treasure for myself!",
		"I seek to reclaim and rebuild my former life to the best of my ability.",
		"I have been reborn as a child of Vorgansharax. I will claim my birthright as his chosen heir and successor.",
		"I attribute my survival to the work of the divine, and seek to prove myself worthy of the honor."
	],
	flaw : [
		"I have been touched with dragon-greed, and have a lust for wealth which can never be satisfied.",
		"I secretly believe others are plotting to harm me.",
		"I no longer enjoy the simple pleasures in life. Food is but ashes and bile in my throat.",
		"Anyone who refuses to celebrate my celebrity does not deserve my company.",
		"I am paranoid and overly suspicious of others. Anyone may be an agent of the Maimed Virulence.",
		"Once I make up my mind, I follow my chosen course of action regardless of the consequences."
	],
	languageProfs : ["Draconic"],
	lifestyle : "wretched"
};
BackgroundList["iron route bandit"] = {
	regExpSearch : /^(?=.*iron)(?=.*route)(?=.*bandit).*$/i,
	name : "Iron Route Bandit",
	source : [["AL:CoS", 5], ["ALbackground", 0]],
	skills : ["Animal Handling", "Stealth"],
	toolProfs : [["Gaming set", 1], "Vehicles (land)"],
	gold : 5,
	equipleft : [
		["Backpack, with:", "", 5],
		["Bag of 1000 ball bearings", 1, 2],
		["String, feet of", 10, ""],
		["Bell", "", ""],
		["Candles", 5, ""],
		["Crowbar", "", 5],
		["Hammer", "", 3],
		["Pitons", 10, .25],
		["Hooded lantern", "", 2],
		["Oil, flasks of", 2, 1],
		["Rations, days of", 5, 2],
		["Tinderbox", "", 1],
		["Waterskin", "", 5],
		["Hempen rope, feet of", 50, 0.2]
	],
	equipright : [
		["Dark common clothes", "", 3],
		["Pack Saddle", "", ""],
		["Belt Pouch (with coins)", "", ""]
	],
	feature : "Black-Market Breeder",
	trait : [
		"If people leave their gear unsecured, they must not want it very much.",
		"I feel more comfortable sleeping under the open sky.",
		"I always pre-plan my escape should things go bad; I always like to have an exit strategy.",
		"I tend to give animal owners breeding and care advice whether or not they want it.",
		"I lost a pet as a child and sadly reflect on it to this day.",
		"I always form a powerful, emotional bond with my mount.",
		"I recoil at the thought of killing someone else's pet or mount.",
		"I prefer to hang to the back of a scuffle or discussion. Better to have my enemies in front of me."
	],
	ideal : [
		["Loyalty", "Loyalty: Never bite the hand that feeds. (Good)"],
		["Unpredictability", "Unpredictability: Keep your enemy guessing and off-balance like a confused deer. (Chaotic)"],
		["Power", "Power: I strive to become leader of the pack at all costs. (Lawful)"],
		["Freedom", "Freedom: I bow to no one I don't respect. (Chaotic)"],
		["Resourcefulness", "Resourcefulness: Our wits are our most valuable resource in troubled times. (Any)"],
		["Unity", "Unity: Lone wolves fail where the pack succeeds. (Any)"]
	],
	bond : [
		"I cannot leave a harmed animal behind; I must save it or put it out of its misery.",
		"I leave behind my own personal calling cards when I do a job.",
		"I do not trust people who do not have a pet, mount, or furry companion.",
		"The pelt I wear on my back was from an animal that died saving my life, I will always cherish it.",
		"If my pet does not like you, I do not like you!",
		"Once you've ridden with me and fought by my side, I'll be there for you odds be damned."
	],
	flaw : [
		"I talk to animals; I believe they understand me, even if they do not.",
		"I growl at and bite anyone who gets too close to my food while I am eating.",
		"I strongly dislike enclosed spaces and require intoxication or firm encouragement to enter them.",
		"I robbed the wrong caravan once. The owner is a powerful merchant who holds a grudge.",
		"I'm an inveterate gambler.",
		"I judge people based on how well they stand their ground in a fight. I got not time for cowards…"
	],
	lifestyle : "poor"
};
BackgroundList["phlan insurgent"] = {
	regExpSearch : /^(?=.*phlan)(?=.*insurgent).*$/i,
	name : "Phlan Insurgent",
	source : [["AL:CoS", 6], ["ALbackground", 0]],
	skills : ["Stealth", "Survival"],
	toolProfs : [["Artisan's tools", 1], "Vehicles (land)"],
	gold : 5,
	equipleft : [
		["Caltrops", 20, 0.1],
		["Small trinket of my life before", "", ""],
		["Healer's kit", "", 3]
	],
	equipright : [
		["Dark common clothes", "", 3],
		["Belt Pouch (with coins)", "", ""]
	],
	feature : "Guerilla",
	extra : [
		"Select an Origin",
		"Fisher",
		"Hunter",
		"Craftsperson",
		"Priest/Priestess",
		"Cook",
		"City Watch",
		"Servant",
		"Unskilled laborer",
		"Stojanow river worker",
		"Twilight Marsh worker",
		"Mantor's Library scribe",
		"Clergy of Ilmater",
		"Laughing Goblin server",
		"Black Fist guard",
		"House Sokol retainer",
		"Bay of Phlan dockworker"
	],
	trait : [
		"My patience knows no bounds, so long as my goal is in sight.",
		"In life and in struggle, the ends justify my actions.",
		"If you aren't helping me, you'd best at least stay out of my way.",
		"I long for the life that was taken away from me.",
		"Friends and family perished, tragically, before my eyes. I hope never to undergo that again.",
		"Making the right choices in life are important to me. The choices I make might save not just my life, but the lives of others as well.",
		"I can never allow my foes to get the drop on me.",
		"Time is a precious resource that I must spend wisely."
	],
	ideal : [
		["Leadership", "Leadership: The oppressed need someone to inspire them to courageous acts. (Good)"],
		["Unpredictability", "Unpredictability: Keeping the enemy guessing and off-balance is my tactical strength. (Chaos)"],
		["Determination", "Determination: Threats to my home must be eliminated at all costs. (Any)"],
		["Freedom", "Freedom: Those who are enslaved and unjustly imprisoned deserve my aid. (Good)"],
		["Resourcefulness", "Resourcefulness: Our wits are our most valuable resource in troubled times. (Any)"],
		["Unity", "Unity: Working together, we can overcome all obstacles, even the most seemingly insurmountable ones. (Any)"]
	],
	bond : [
		"I'll never let my fellow insurgents down. They are my only remaining friends.",
		"I was separated from a loved one during my escape from town. I will find them.",
		"One of the Tears of the Virulence was a trusted friend, until the day they betrayed the city. They will pay harshly for their transgressions.",
		"An item I hold close is my last remaining connection to the family I lost during the fall.",
		"The dragon who took my past life away from me will feel the full extent of my vengeance.",
		"The knowledge in Mantor's Library is an irreplaceable treasure that must be protected."
	],
	flaw : [
		"I have no respect for those who flee. I harbor a deep grudge against the citizens who abandoned Phlan.",
		"Ale is the only way I can escape the desperation of my circumstances.",
		"It doesn't take much to get me into a fight.",
		"Being an insurgent means doing things that aren't always ethical. I'm still learning to live with that.",
		"My desire to liberate Phlan oftentimes clouds my judgement, despite my best efforts.",
		"I relentlessly despise the Maimed Virulence and his allies. I'd abandon other goals in order to strike out at them"
	],
	lifestyle : "poor"
};
BackgroundList["stojanow prisoner"] = {
	regExpSearch : /^(?=.*stojanow)(?=.*prisoner).*$/i,
	name : "Stojanow Prisoner",
	source : [["AL:CoS", 8], ["ALbackground", 0]],
	skills : ["Deception", "Perception"],
	toolProfs : [["Gaming set", 1], ["Thieves' tools", "Dex"]],
	gold : 10,
	equipleft : [
		["Small knife", "", 0.25],
		["Small trinket from my life before", "", ""]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt Pouch (with coins)", "", ""]
	],
	feature : "Ex-Convict",
	trait : [
		"I am a bully; others will suffer as I have.",
		"I always say yes even when I mean no; it's just easier.",
		"I aim to misbehave.",
		"I go out of my way to frustrate or anger those in power.",
		"I strive to obey the law. I will never again make the mistake of going against authority.",
		"I always plan everything out. The one time I let others plan things it did not end well for me.",
		"I take blame to protect others from pain.",
		"I horde information, you never know what may come in handy."
	],
	ideal : [
		["Loss", "Loss: I freely give those who offend me what was so brutally denied me, death. (Chaos)"],
		["Dedication", "Dedication: I never betray those who trust me. (Law)"],
		["Vengeance", "Vengeance: I use any means to get information I need; I have been well taught. (Evil)"],
		["Redemption", "Redemption: Everyone deserves a second chance. (Good)"],
		["Resilience", "Resilience: I can survive any challenge. (Any)"],
		["Leadership", "Leadership: The best teams are made up of those that society has discarded. (Any)"]
	],
	bond : [
		"I take up arms to help establish a free Phlan.",
		"The horrors of my time in Stojanow haunt my dreams, only after a day of hard work can I find sleep.",
		"I am indebted to those who freed me from prison, I will repay this debt.",
		"My torturer survived the attack that set me free, I will find him/her.",
		"I will not rest while others suffer fates similar to mine.",
		"I am searching for a way to heal the scars of Stojanow, both physical and emotional."
	],
	flaw : [
		"During stressful times, I find myself crying for no reason.",
		"My nerve endings are shot from the interrogations; I am numb to all but the harshest touch.",
		"I am incapable of standing up for myself.",
		"I folded under the torture, and gave information that I promised would be kept secret. My life would be in jeopardy if others found out.",
		"Survival is worth more than friendship.",
		"The ghosts from my past hinder my actions."
	],
	lifestyle : "poor"
};
BackgroundList["ticklebelly nomad"] = {
	regExpSearch : /^(?=.*ticklebelly)(?=.*nomad).*$/i,
	name : "Ticklebelly Nomad",
	source : [["AL:CoS", 9], ["ALbackground", 0]],
	skills : ["Animal Handling", "Nature"],
	toolProfs : ["Herbalism Kit"],
	gold : 5,
	equipleft : [
		["Herbalism kit", "", 3],
		["Small tribal jewelry", "", ""],
		["Hunting trap", "", 25]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt Pouch (with coins)", "", ""]
	],
	feature : "At Home in the Wild",
	trait : [
		"I eagerly inject myself into the unknown.",
		"Villages, towns, and cities do not suit me. I'd rather be out in the wilderness any day.",
		"I accomplish my tasks efficiently, using as few resources as possible.",
		"It's difficult for me to remain in one place for long.",
		"I loudly brag about my tribe every chance I get.",
		"Having walked among giants, I am fearless in the face of bigger creatures.",
		"I am quiet and reserved, but observant. Nothing escapes my attention.",
		"My word is my bond. I see a promise to completion, even if it conflicts with my beliefs."
	],
	ideal : [
		["Kinship", "Kinship: Family is most important in life. Though I may be far from my own, the bonds of family must be protected in others' lives as well. (Good)"],
		["Preservation", "Preservation: Nature must not be despoiled by encroaching civilization. (Any)"],
		["Wanderlust", "Wanderlust: One must expand their horizons by seeing the world and exploring. (Chaos)"],
		["Isolation", "Isolation: My tribe and its ways must be protected and shielded from outside influence. (Neutral)"],
		["Protection", "Protection: Threats to the land and to the people must be dealt with at any and all costs. (Law)"],
		["Belonging", "Belonging: All creatures have a place in the world, so I strive to help others find theirs. (Good)"]
	],
	bond : [
		"I ache to return to my tribe and the family I left, but cannot until my obligations are fulfilled.",
		"The dragon cultists that invaded my homeland stole away one of my tribe's people. I will not know rest until I've found them.",
		"The dragon's presence in the hills destroyed valuable territory and resulted in deaths within my tribe. The creature must pay for what it has done.",
		"I carry a trinket that spiritually and emotionally ties me to my people and my home.",
		"I discovered a strange relic in the hills during my tribe's wanderings. I must discover what it is.",
		"One of the stone giant clans from the Giant's Cairn has graced me with a mark of kinship."
	],
	flaw : [
		"I throw myself and my friends into situations rarely ever thinking about consequences.",
		"Unfamiliar people and surroundings put me on edge.",
		"I have absolutely no patience for slowpokes and those who prove indecisive.",
		"My desire to experience new things causes me to make unsafe choices.",
		"I am overly protective of nature, sometimes to the detriment of my companions and myself.",
		"My lack of worldliness often proves my undoing in social, commercial, and hostile situations."
	],
	languageProfs : ["Giant"],
	lifestyle : "poor"
};

// Background features
BackgroundFeatureList["at home in the wild"] = {
	description : "In the wilderness, my home, I can find a place to hide, rest, or recuperate that is secure enough to conceal me from most natural threats, but not all supernatural, magical, or threats that actively seek me out. However, this feature doesn't shield or conceal me from scrying, mental probing, nor from threats that don't need the five senses to find me.",
	source : [["AL:CoS", 9], ["ALbackground", 0]]
};
BackgroundFeatureList["black-market breeder"] = {
	description : "I know how to find people who are always looking for stolen animals and vehicles, for pit fights or getaways during an illegal job. This provides me with information of what such animals & vehicles are in high demand in the area, but also offer to give me favors and information (DM choice) if I bring such animals and vehicles to them.",
	source : [["AL:CoS", 5], ["ALbackground", 0]]
};
BackgroundFeatureList["double agent"] = {
	description : "I have a trusty contact in the Tears of Virulence garrison in Phlan to whom I pass information. In exchange, I get away with minor criminal offenses in Phlan. My Black Fists contacts can help me get an audience with the Lord Regent, the Lord Sage, Black Fists members, or deposed nobles who are sympathetic to the Phlan refugees and insurgents.",
	source : [["AL:CoS", 2], ["ALbackground", 0]]
};
BackgroundFeatureList["dragonscarred"] = {
	description : "My extensive scars from being tortured by Vorgansharax give me fame and notoriety, but it is difficult to disguise my appearance and hide from prying eyes. I can use this to gain access to people and places I might not otherwise have, for me and my companions. However, I fear that my afflictions are not completely mundane, as they burn and writhe.",
	source : [["AL:CoS", 3], ["ALbackground", 0]]
};
BackgroundFeatureList["ex-convict"] = {
	description : "The knowledge gained during my incarceration lets me gain insight into local guards and jailors. I know which will accept bribes, or look the other way for me. I can also seek shelter for myself from authorities with other criminals in the area.",
	source : [["AL:CoS", 8], ["ALbackground", 0]]
};
BackgroundFeatureList["guerilla"] = {
	description : "I've come to know the surrounding other natural features in which I can take refuge--or set up ambushes. I can quickly survey my environment for advantageous features. Additionally, I can scavenge around my natural surroundings to cobble together simple supplies (such as improvised torches, rope, patches of fabric, etc.) that are consumed after use.",
	source : [["AL:CoS", 6], ["ALbackground", 0]]
};
BackgroundFeatureList["heart of darkness"] = {
	description : "Those who look into my eyes can see that I have faced unimaginable horror and that I am no stranger to darkness. Though they might fear me, commoners will extend me every courtesy and do their utmost to help. Unless I have shown myself to be a danger to them, they will even take up arms to fight with me, should I find myself facing an enemy alone.",
	source : [["CoS", 209], ["ALbackground", 0]]
};

// Equipment pack
PacksList.monsterhunter = {
	name : "Monster hunter's pack (33 gp)",
	source : ["CoS", 209],
	items : [
		["Chest, with:", "", 25],
		["Crowbar", "", 5],
		["Hammer", "", 3],
		["Wooden stake", 3, 1],
		["Amulet holy symbol", "", ""],
		["Holy water, flasks of", 1, 1],
		["Manacles", "", 6],
		["Steel mirror", "", 0.5],
		["Oil, flasks of", 1, 1],
		["Tinderbox", "", 1],
		["Torches", 3, 1]
	]
};

// Magic Items
MagicItemsList["plantslayer battleaxe"] = {
	name : "Plantslayer Battleaxe", // name taken from Adventurers League Content Catalogue v8.07, page 28
	nameAlt : "Adventurer's Battleaxe",
	source : ["CoS", 198],
	type : "weapon (battleaxe)",
	rarity : "rare",
	magicItemTable : "F",
	description : "This battleaxe's handle is carved with leaves and vines. It deals an extra 1d8 slashing damage against ordinary plants and plant creatures. When a creature of non-good alignment makes an attack with it, it sprouts thorns, dealing 1 magical piercing damage to the wielder after the attack is made.",
	descriptionFull : "The axe's handle is carved with leaves and vines, and it weighs half as much as a normal battleaxe. When the axe hits a plant, whether an ordinary plant or a plant creature, the target takes an extra 1d8 slashing damage. When a creature of non-good alignment wields the axe, it sprouts thorns whenever its wielder makes an attack with it. These thorns prick the wielder for 1 piercing damage after the attack is made, and this damage is considered magical.",
	weight : 2,
	weaponsAdd : ["Plantslayer Battleaxe"],
	weaponOptions : {
		baseWeapon : "battleaxe",
		regExpSearch : /^(?=.*plantslayer)(?=.*battleaxe).*$/i,
		name : "Plantslayer Battleaxe",
		source : ["CoS", 198],
		description : "Versatile (1d10); +1d8 damage vs. plants",
		weight : 2
	}
}
MagicItemsList["blood spear"] = {
	name : "Blood Spear",
	source : ["CoS", 221],
	type : "weapon (spear)",
	rarity : "uncommon",
	magicItemTable : "G",
	description : "This spear drains the life from those it kills and transfers that life to its wielder, imbuing that individual with the stamina to keep fighting. When I use it to reduce the target to 0 HP, I gain 2d6 temporary HP. If I'm chosen by Kavan to wield this spear, I gain a +2 bonus to attack and damage rolls made with it.",
	descriptionFull : "Kavan was a ruthless chieftain whose tribe lived in the Balinok Mountains centuries before the arrival of Strahd von Zarovich. Although he was very much alive, Kavan had some traits in common with vampires: he slept during the day and hunted at night, he drank the blood of his prey, and he lived underground. In battle, he wielded a spear stained with blood. His was the first blood spear, a weapon that drains life from those it kills and transfers that life to its wielder, imbuing that individual with the stamina to keep fighting.\n   When you hit with a melee attack using this magic spear and reduce the target to 0 hit points, you gain 2d6 temporary hit points.\n   Any creature can wield the spear, but only the character chosen by Kavan to wield it gains a +2 bonus to attack and damage rolls made with this magic weapon.",
	attunement : true,
	weight : 3,
	choices : ["Chosen of Kavan", "Not a chosen of Kavan"],
	"chosen of kavan" : {
		name : "Blood\u200A Spear",
		weaponsAdd : ["Blood Spear"],
		weaponOptions : {
			baseWeapon : "spear",
			regExpSearch : /^(?=.*blood)(?=.*spear).*$/i,
			name : "Blood Spear",
			source : ["CoS", 221],
			description : "Thrown, versatile (1d8); If used to reduce target to 0 HP, I gain 2d6 temp HP",
			modifiers : [2,2]
		}
	},
	"not a chosen of kavan" : {
		name : "Blood\u200A\u200A Spear",
		weaponsAdd : ["Blood Spear"],
		weaponOptions : {
			baseWeapon : "spear",
			regExpSearch : /^(?=.*blood)(?=.*spear).*$/i,
			name : "Blood Spear",
			source : ["CoS", 221],
			description : "Thrown, versatile (1d8); If used to reduce target to 0 HP, I gain 2d6 temp HP"
		}
	}
}
MagicItemsList["green copper ewer"] = {
	name : "Green Copper Ewer",
	source : ["CoS", 188],
	type : "wondrous item",
	rarity : "unknown",
	description : "Any poisonous liquid poured into the ewer is instantly transformed into an equal amount of sweet wine. If I speak the ewer's command word while grasping its handle, the ewer fills with 1 gallon of wine. After doing so, it can't produce more wine until the next dawn.",
	descriptionFull : "Any poisonous liquid poured into the ewer is instantly transformed into an equal amount of sweet wine. Furthermore, a creature that grasps the ewer's handle can command the ewer to fill with 1 gallon of wine, and it can't produce more wine until the next dawn."
}
MagicItemsList["gulthias staff"] = {
	name : "Gulthias Staff",
	source : ["CoS", 221],
	type : "staff",
	rarity : "rare",
	magicItemTable : "G",
	description : "This black wooden quarterstaff has 10 charges, regaining 1d6+4 at dusk. When I hit with it in melee, I can use 1 charge to regain HP equal to the damage dealt, but I must make a DC 12 Wis save or be afflicted by short-term madness (DMG 259). While attuned to it, evil plant creatures are indifferent to me.",
	descriptionLong : "This spongy, black wooden quarterstaff has 10 charges, regaining 1d6+4 at dusk. When I hit with it in melee, I can use 1 charge to regain HP equal to the damage dealt, but I must make a DC 12 Wis save or be afflicted by short-term madness (see table at SRD 201 or DMG 259). While I'm attuned to the staff, evil plant creatures don't regard me as hostile unless I harm them. If it is broken or burned to ashes, it releases an inhuman scream that can be heard out to 300 ft. All blights that can hear the scream immediately wither and die.",
	descriptionFull : "Made from the branch of a Gulthias tree (see the blights entry of the Monster Manual), a Gulthias staff is a spongy, black length of wood. Its evil makes beasts visibly uncomfortable while within 30 feet of it. The staff has 10 charges and regains 1d6+4 of its expended charges daily at dusk.\n   If the staff is broken or burned to ashes, its wood releases a terrible, inhuman scream that can be heard out to a range of 300 feet. All blights that can hear the scream immediately wither and die.\n   " + toUni("Vampiric Strike") + ". The staff can be wielded as a magic quarterstaff. On a hit, it deals damage as a normal quarterstaff, and you can expend 1 charge to regain a number of hit points equal to the damage dealt by the weapon. Each time a charge is spent, red blood oozes from the staff's pores, and you must succeed on a DC 12 Wisdom saving throw or be afflicted with short term madness (see \"Madness\" in chapter 8 of the Dungeon Master's Guide).\n   " + toUni("Blight Bane") + ". While you are attuned to the staff, blights and other evil plant creatures don't regard you as hostile unless you harm them.",
	attunement : true,
	weight : 4,
	usages : 10,
	recovery : "Dusk",
	additional : "regains 1d6+4",
	weaponsAdd : ["Gulthias Staff"],
	weaponOptions : {
		baseWeapon : "quarterstaff",
		regExpSearch : /^(?=.*gulthias)(?=.*staff).*$/i,
		name : "Gulthias Staff",
		source : ["CoS", 221],
		description : "Versatile (1d8); On hit, 1 charge to regain HP equal to damage dealt but DC 12 Wis save or madness"
	},
}
MagicItemsList["holy symbol of ravenkind"] = {
	name : "Holy Symbol of Ravenkind",
	source : ["CoS", 222],
	type : "wondrous item",
	rarity : "legendary",
	storyItemAL : true,
	prerequisite : "Requires attunement by a cleric or paladin of good alignment",
	prereqeval : function(v) { return (/good/i).test(What("Alignment")) && (classes.known.cleric || classes.known.paladin); },
	description : "This platinum amulet has 10 charges, regaining 1d6+4 at dawn. As an action, I can use 1 charge to hold vampires (see 3rd page notes). I can use 3 charges with Turn Undead to give disadv. on its saves. As an action, ican use 5 charges to shed daylight, 30-ft radius bright light and dim light for another 30-ft for 10 minutes.",
	descriptionFull : "The Holy Symbol of Ravenkind is a unique holy symbol sacred to the good-hearted faithful of Barovia. It predates the establishment of any church in Barovia. According to legend, it was delivered to a paladin named Lugdana by a giant raven - or an angel in the form of a giant raven. Lugdana used the holy symbol to root out and destroy nests of vampires until her death. The high priests of Ravenloft kept and wore the holy symbol after Lugdana's passing.\n   The holy symbol is a platinum amulet shaped like the sun, with a large crystal embedded in its center.\n   The holy symbol has 10 charges for the following properties. It regains 1d6+4 charges daily at dawn.\n   " + toUni("Hold Vampires") + ". As an Action, you can expend 1 charge and present the holy symbol to make it flare with holy power. Vampires and vampire spawn within 30 feet of the holy symbol when it flares must make a DC 15 Wisdom saving throw. On a failed save, a target is paralyzed for 1 minute. It can repeat the saving throw at the end of its turns to end the effect on itself.\n   " + toUni("Turn Undead") + ". If you have the Turn Undead or the Turn the Unholy feature, you can expend 3 charges when you present the holy symbol while using that feature. When you do so, undead have disadvantage on their saving throws against the effect.\n   " + toUni("Sunlight") + ". As an action, you can expend 5 charges while presenting the holy symbol to make it shed bright light in a 30-foot radius and dim light for an additional 30 feet. The light is sunlight and lasts for 10 minutes or until you end the effect (no action required).",
	attunement : true,
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	action : [["action"]],
	toNotesPage : [{
		name : "Hold Vampires",
		popupName : "Hold Vampires feature of Holy Symbol of Ravenkind",
		page3notes : true,
		note : [
			"As an action, I can use 1 charge to have all vampires within 30 ft make a DC 15 Wis save",
			"If failed, a target is paralyzed for 1 minute but can repeat the save at the end of its turns"
		],
		additional : "1 charge"
	}]
}
MagicItemsList["icon of ravenloft"] = {
	name : "Icon of Ravenloft",
	source : ["CoS", 222],
	type : "wondrous item",
	rarity : "legendary",
	storyItemAL : true,
	prerequisite : "Requires attunement by a creature of good alignment",
	prereqeval : function(v) { return (/good/i).test(What("Alignment")); },
	description : "All within 30 ft of this silver statue are under the effect of Protection from Evil and Good that works against fiends and undead. As an action while attuned to it, I can cast Augury or Cure Wounds (3d8+3, 30 ft range) from it, each once per dawn and if I use it for my Turn Undead, the DC increases by 2.",
	descriptionFull : "The Icon of Ravenloft is a 12-inch tall statuette made of the purest silver, weighing 10 pounds. It depicts a cleric kneeling in supplication.\n   The icon was given to Strahd by the archpriest Ciril Romulich, an old family friend, to consecrate the castle and its chapel.\n   While within 30 feet of the icon, a creature is under the effect of a Protection from Evil and Good spell against fiends and undead. Only a creature attuned to the icon can use its other properties.\n   " + toUni("Augury") + ". You can use an action to cast an Augury spell from the icon, with no material components required. Once used, this property can't be used again until the next dawn.\n   " + toUni("Bane of the Undead") + ". You can use the icon as a holy symbol while using the Turn Undead or Turn the Unholy feature. If you do so, increase the save DC by 2.\n   " + toUni("Cure Wounds") + ". While holding the icon, you can take an action to heal one creature that you can see within 30 feet of you. The target regains 3d8+3 hit points, unless it is an undead, a construct, or a fiend. Once used, this property can't be used again until the next dawn.",
	attunement : true,
	weight : 10,
	extraLimitedFeatures : [{
		name : "Icon of Ravenloft [Augury]",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Icon of Ravenloft [Cure Wounds]",
		usages : 1,
		recovery : "dawn"
	}],
	spellcastingBonus : [{
		name : "All in 30 ft",
		spells : ["protection from evil and good"],
		selection : ["protection from evil and good"],
		firstCol : "markedbox"
	}, {
		name : "Once per dawn",
		spells : ["augury", "cure wounds"],
		selection : ["augury", "cure wounds"],
		firstCol : "oncelr",
		times : 2
	}],
	spellChanges : {
		"protection from evil and good" : {
			range : "30-ft rad",
			time : "Always",
			description : "All in range immune to fear, charm, and possession by fiends and undead, they also disadv. on attacks",
			duration : "Unlimited",
			changes : "All within 30 ft of the Icon of Ravenloft have this spell protect them from undead and fiends."
		},
		"augury" : {
			time : "1 a",
			changes : "Using the Icon of Ravenloft, it only takes an action to cast."
		},
		"cure wounds" : {
			range : "30 ft",
			description : "1 living creature heals 3d8+3 HP if it not an undead, construct, or fiend",
			changes : "Using the Icon of Ravenloft, it has a range of 30 ft and always heals 3d8+3 HP, but can't affect undead, a construct, or a fiend."
		}
	}
}
MagicItemsList["lost sword"] = {
	name : "Lost Sword",
	source : ["CoS", 81],
	type : "weapon (shortsword)",
	rarity : "very rare",
	magicItemTable : "G",
	prerequisite : "Requires attunement by a creature of lawful good alignment",
	prereqeval : function(v) { return (/^(?=.*lawful)(?=.*good).*$/i).test(What("Alignment")); },
	description : "This lawful good shortsword is sentient (Int 11, Wis 13, Cha 13). It adds +1 to hit and damage and shines bright light in a 15-ft radius and dim light for an additional 15 ft. Attuning to it takes only 1 minute. Once per dawn, I can use it to cast Crusader's Mantle. Its purpose is to fight evil. See Notes page.",
	descriptionFull : "The Lost Sword is a sentient lawful good +1 shortsword (Intelligence 11, Wisdom 13, Charisma 13). It has hearing and normal vision out to a range of 120 feet. It communicates by transmitting emotion to the creature carrying or wielding it.\n   The sword's purpose is to fight evil. The sword has the following additional properties:\n \u2022 The sword continually sheds bright light in a 15-foot radius and dim light for an additional 15 feet. Only by destroying the sword can this light be extinguished.\n \u2022 A lawful good creature can attune itself to the sword in 1 minute.\n \u2022 While attuned to the weapon, the sword's wielder can use the sword to cast the Crusader's Mantle spell. Once used, this property of the sword can't be used again until the next dawn.",
	attunement : true,
	weight : 2,
	usages : 1,
	recovery : "dawn",
	additional : "Crusader's Mantle",
	weaponsAdd : ["Lost Sword"],
	weaponOptions : {
		baseWeapon : "shortsword",
		regExpSearch : /^(?=.*lost)(?=.*sword).*$/i,
		name : "Lost Sword",
		source : ["CoS", 81],
		modifiers : [1,1]
	},
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["crusader's mantle"],
		selection : ["protection from evil and good"],
		firstCol : "oncelr"
	},
	toNotesPage : [{
		name : "Features",
		popupName : "Features of the Lost Sword",
		note : desc([
			"The Lost Sword is a sentient lawful good +1 shortsword.",
			"A lawful good creature can attune itself to the sword in 1 minute.",
			"It continually sheds bright light in a 15-ft radius and dim light for an additional 15 ft. Only by destroying the sword can this light be extinguished.",
			"While attuned to the weapon, the sword's wielder can use the sword to cast the Crusader's Mantle spell. Once used, this property of the sword can't be used again until the next dawn.",
			"It has Intelligence 11, Wisdom 13, and Charisma 13 and can hear and see as a human out to a range of 120 ft. It communicates by transmitting emotion to the creature carrying or wielding it. The sword's purpose is to fight evil."
		]) + "\n\n" + sentientItemConflictTxt
	}]
}
MagicItemsList["saint markovia's thighbone"] = {
	name : "Saint Markovia's Thighbone",
	source : ["CoS", 222],
	type : "weapon (mace)",
	rarity : "rare",
	description : "This mace sheds bright light in a 20-ft radius and dim light for another 20 ft while held. Fiends and undead hit with it take +2d6 radiant damage, become frightened of me until my next turn ends, and if below 26 HP after its damage, must make a DC 15 Wis save or die. If it hits an undead, it crumbles after the combat.",
	descriptionFull : "Saint Markovia's thighbone has the properties of a mace of disruption. If it scores one or more hits against a vampire or a vampire spawn in the course of a single battle, the thighbone crumbles into dust once the battle concludes.\n   As a youth, Markovia followed her heart and became a priest of the Morninglord soon after her eighteenth birthday. She proved to be a charismatic proselytizer and, before the age of thirty, had gained a reputation for allowing no evil to stand before her.\n   Markovia had long considered Strahd a mad tyrant, but only after his transformation into a vampire did she dare to challenge him. As she rallied her followers and prepared to march on Castle Ravenloft, Strahd sent a group of vampire spawn to her abbey. They confronted Markovia and were destroyed to a one.\n   Suffused with confidence born of a righteous victory, Markovia advanced on Castle Ravenloft. A great battle raged from the catacombs to the parapets. In the end, Markovia never returned to Barovia, and Strahd long afterward walked with a limp and a grimace of pain. It is said that he trapped Markovia in a crypt beneath his castle, and her remains linger there yet.\n   The essence of Markovia's saintliness passed partly into her bones as the rest of her body decomposed. Her remaining thighbone is imbued with power that inflicts grievous injury on the undead.\n   Mace of Disruption. When you hit a fiend or an undead with this magic weapon, that creature takes an extra 2d6 radiant damage. If the target has 25 hit points or fewer after taking this damage, it must succeed on a DC 15 Wisdom saving throw or be destroyed. On a successful save, the creature becomes frightened of you until the end of your next turn.\n   While you hold this weapon, it sheds bright light in a 20-foot radius and dim light for an additional 20 feet.",
	attunement : true,
	weight : 4,
	weaponsAdd : ["Saint Markovia's Thighbone"],
	weaponOptions : {
		baseWeapon : "mace",
		regExpSearch : /^(?=.*markovia)(?=.*thighbone).*$/i,
		name : "Saint Markovia's Thighbone",
		source : ["CoS", 222],
		description : "Fiend/undead +2d6 radiant damage, frightened until my next turn ends, and if hp<26, DC 15 Wis save or die"
	}
}
MagicItemsList["silver dragon shield +2"] = {
	name : "Silver Dragon Shield +2",
	source : ["CoS", 68],
	type : "shield",
	rarity : "rare",
	description : "While holding this shield, I have a +2 bonus to AC. This bonus is in addition to the shield's normal bonus to AC. It is emblazoned with a stylized silver dragon that is the emblem of the Order of the Silver Dragon. The shield whispers warnings to me, granting me a +2 bonus to initiative while I am not incapacitated.",
	descriptionFull : "While holding this shield, you have a +2 bonus to AC. This bonus is in addition to the shield's normal bonus to AC.\n   The shield is emblazoned with a stylized silver dragon that is the emblem of the Order of the Silver Dragon (see Curse of Strahd, chapter 7). The shield whispers warnings to its bearer, granting a +2 bonus to initiative if the bearer isn't incapacitated.",
	weight : 6,
	shieldAdd : "Silver Dragon Shield +2",
	addMod : [{ type : "skill", field : "Init", mod : 2, text : "While I carry the Silver Dragon Shield, it whispers warnings to me, granting me a +2 bonus to initiative rolls." }]
}
MagicItemsList["statuette of saint markovia"] = {
	name : "Statuette of Saint Markovia",
	source : ["CoS", 152],
	type : "wondrous item",
	rarity : "unknown",
	storyItemAL : true,
	description : "This golden statuette grants any good-aligned creature that carries it a +1 bonus to saving throws.",
	descriptionFull : "This golden statuette grants any good-aligned creature that carries it a +1 bonus to saving throws.",
	addMod : [{ type : "save", field : "all", mod : 1, text : "While I carry the Statuette of Saint Markovia, I gain a +1 bonus to all my saving throws." }]
}
MagicItemsList["sunsword"] = {
	name : "Sunsword",
	source : ["CoS", 223],
	type : "weapon (longsword)",
	rarity : "legendary",
	storyItemAL : true,
	description : "As a bonus action, I can have this hilt create a blade of radiance. It acts like a longsword with +2 to hit and damage, does radiant damage (+1d8 to undead), has finesse, emits bright sunlight in a 15-ft radius and dim light in another 15 ft. As an action, I can change the light's radius by 5 ft. It is sentient, see Notes page.",
	descriptionLong : "As a bonus action, I can have this longsword hilt create or dismiss a blade of pure radiance. While the blade exists, it acts like a longsword that has +2 to attack and damage rolls, does radiant damage, and has the finesse property. It deals +1d8 damage to undead and emits sunlight, bright light in a 15-ft radius and dim light in an additional 15-ft radius. As an action, I can expand or reduce both the bright and dim light's radius by 5 ft each, to a maximum of 30 ft each or a minimum of 10 ft each. I'm proficient with it if I'm proficient with either longswords or shortswords. It is sentient, see Notes page.",
	descriptionFull : "The Sunsword is a unique blade once possessed by Strahd's brother, Sergei von Zarovich. In its original form, it had a platinum hilt and guard, and a thin crystal blade as strong as steel.\n   Strahd employed a powerful wizard named Khazan to destroy the weapon after Sergei's death. The first part of the process required the hilt and the blade to be separated, which Khazan accomplished. While Khazan was busying himself destroying the blade, his apprentice stole the hilt and fled. Khazan later located his apprentice's mutilated corpse in the Svalich Woods, but the hilt was nowhere to be found. To avoid the vampire's wrath, Khazan told Strahd that the entire weapon had been destroyed.\n   The hilt, which is sentient, knows that it can never be reunited with its original crystal blade. It has, however, gained the properties of a sun blade.\n   While grasping the hilt, you can use a bonus action to cause a blade of pure radiance to spring into existence, or make the blade disappear. While the blade exists, this magic longsword has the finesse property. If you are proficient with shortswords or longswords, you are proficient with the sun blade.\n   You gain a +2 bonus to attack and damage rolls made with this weapon, which deals radiant damage instead of slashing damage. When you hit an undead with it, that target takes an extra 1d8 radiant damage.\n   The sword's luminous blade emits bright light in a 15-foot radius and dim light for an additional 15 feet. The light is sunlight. While the blade persists, you can use an action to expand or reduce its radius of bright and dim light by 5 feet each, to a maximum of 30 feet each or a minimum of 10 feet each.\n   " + toUni("Sentience") + ". The Sunsword is a sentient chaotic good weapon with an Intelligence of 11, a Wisdom of 17, and a Charisma of 16. It has hearing and normal vision out to a range of 60 feet. The weapon communicates by transmitting emotions to the creature carrying it or wielding it.\n   " + toUni("Personality") + ". The Sunsword's special purpose is to destroy Strahd, not so much because it wants to free the land of Barovia from evil but because it wants revenge for the loss of its crystal blade. The weapon secretly fears its own destruction.",
	attunement : true,
	weight : 3,
	action : [["bonus action", " (start/stop)"], ["action", " (change light)"]],
	weaponsAdd : ["Sunsword"],
	weaponOptions : {
		baseWeapon : "longsword",
		regExpSearch : /sunsword/i,
		name : "Sunsword",
		source : ["CoS", 223],
		damage : [1, 8, "radiant"],
		description : "Finesse, versatile (1d10); +1d8 damage to undead",
		modifiers : [2, 2]
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.theWea.name == "Sunsword" && !fields.Proficiency) {
					fields.Proficiency = CurrentProfs.weapon.otherWea && CurrentProfs.weapon.otherWea.finalProfs.indexOf("shortsword") !== -1;
				}
			}, ''
		]
	},
	toNotesPage : [{
		name : "Features",
		popupName : "Features of Sunsword",
		note : desc([
			"The Sunsword is a unique blade once possessed by Strahd's brother, Sergei von Zarovich. In its original form, it had a platinum hilt and guard, and a thin crystal blade as strong as steel.",
			"Strahd employed a powerful wizard named Khazan to destroy the weapon after Sergei's death. The first part of the process required the hilt and the blade to be separated, which Khazan accomplished. While Khazan was busying himself destroying the blade, his apprentice stole the hilt and fled. Khazan later located his apprentice's mutilated corpse in the Svalich Woods, but the hilt was nowhere to be found. To avoid the vampire's wrath, Khazan told Strahd that the entire weapon had been destroyed.",
			"The hilt, which is sentient, knows that it can never be reunited with its original crystal blade. It has, however, gained the properties of a sun blade. While grasping the hilt, I can use a bonus action to make a blade of pure radiance spring from the hilt, or cause the blade to disappear. While the blade exists, it functions as a magic longsword that has the finesse property. I'm proficient with it if I'm proficient with either shortswords or longswords.",
			"I gain a +2 bonus to attack and damage rolls made with this weapon, which deals radiant damage instead of slashing damage. When I hit an undead with it, that target takes an extra 1d8 radiant damage.",
			"The sword's luminous blade emits bright light in a 15-foot radius and dim light for an additional 15 ft. The light is sunlight. As an action while the blade persists, I can expand or reduce its radius of bright and dim light by 5 ft each, to a maximum of 30 ft each or a minimum of 10 ft each.",
			"The Sunsword is a sentient chaotic good weapon with an Intelligence of 11, a Wisdom of 17, and a Charisma of 16. It has hearing and normal vision out to a range of 60 feet. The weapon communicates by transmitting emotions to the creature carrying it or wielding it.",
			"The Sunsword's special purpose is to destroy Strahd, not so much because it wants to free the land of Barovia from evil but because it wants revenge for the loss of its crystal blade. The weapon secretly fears its own destruction"
		]) + "\n\n" + sentientItemConflictTxt
	}]
}
var iFileName = "pub_20160906_SKT.js";
RequiredSheetVersion(13);
// This file adds the beasts from the Storm King's Thunder adventure book to MPMB's Character Record Sheet

// Define the source
SourceList.SKT={
	name : "Storm King's Thunder [beasts, items]",
	abbreviation : "SKT",
	group : "Adventure Books",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/storm-kings-thunder",
	date : "2016/09/06"
};

// Creatures
CreatureList["sheep"] = {
	name : "Sheep",
	source : ["SKT", 142],
	size : 4, //Small
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 10,
	hp : 3,
	hd : [1, 6],
	speed : "30 ft",
	scores : [12, 10, 11, 2, 10, 5],
	saves : ["", "", "", "", "", ""],
	senses : "",
	passivePerception : 10,
	languages : "",
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 0,
	attacks : [],
	traits : [{
		name : "Sure-Footed",
		description : "The sheep has advantage on Strength and Dexterity saving throws made against effects that would knock it prone."
	}]
};
CreatureList["pig"] = {
	name : "Pig",
	source : ["SKT", 143],
	size : 3, //Medium
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 10,
	hp : 5,
	hd : [1, 8],
	speed : "30 ft",
	scores : [13, 11, 12, 2, 9, 5],
	saves : ["", "", "", "", "", ""],
	senses : "",
	passivePerception : 9,
	languages : "",
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 0,
	attacks : []
};
CreatureList["crag cat"] = {
	name : "Crag Cat",
	source : ["SKT", 240],
	size : 2, //Large
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 13,
	hp : 34,
	hd : [4, 10], //[#, die]
	speed : "40 ft",
	scores : [16, 17, 16, 4, 14, 8], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 4,
		"stealth" : 7
	},
	senses : "Darkvision 60 ft",
	passivePerception : 14,
	languages : "",
	challengeRating : "1",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Claw",
			ability : 1,
			damage : [1, 8, "slashing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "If used after moving 20 ft straight in the same round, see Pounce trait"
		}, {
			name : "Bite",
			ability : 1,
			damage : [1, 10, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "Can be used in combination with claw while pouncing (see Pounce trait)"
		}
	],
	traits : [{
			name : "Nondetection",
			description : "The crag cat can't be targeted or detected by any divination magic or perceived through magical scrying sensors."
		}, {
			name : "Pounce",
			description : "If the crag cat moves at least 20 ft straight toward a creature and then hits it with a claw attack on the same turn, that target must succeed on a DC 13 Strength saving throw or be knocked prone. If the target is prone, the crag cat can make one bite attack against it as a bonus action."
		}, {
			name : "Spell Turning",
			description : "The crag cat has advantage on saving throws against any spell that targets only the cat (not an area). If the crag cat's saving throw succeeds and the spell is of 7th level or lower, the spell has no effect on the crag cat and instead targets the caster."
		}
	],
	wildshapeString : "Darkvision 60 ft| Nondetection: can't be targeted or detected by divination magic or scrying| Pounce: if target is hit with a claw attack after moving 20 ft straight on the same turn, DC 13 Str save or knocked prone and can make one bite attack against it as a bonus action| Spell Turning: adv. on saves vs. spells that targets only me (not area). If successful and spell is 7th level or lower, no effect and instead targets the caster"
};
CreatureList["hulking crab"] = {
	name : "Hulking Crab",
	source : ["SKT", 240],
	size : 1, //Huge
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 17,
	hp : 76,
	hd : [8, 12], //[#, die]
	speed : "20 ft, swim 30 ft",
	scores : [19, 8, 16, 3, 11, 3], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"stealth" : 2
	},
	senses : "Blindsight 30 ft",
	passivePerception : 10,
	languages : "",
	challengeRating : "5",
	proficiencyBonus : 3,
	attacksAction : 2,
	attacks : [{
			name : "Claws",
			ability : 2,
			damage : [1, "", "slashing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "",
			modifiers : [-4, "", false], //[to hit, to damage, add ability to damage] "" means ignore
		}
	],
	traits : [{
			name : "Amphibious",
			description : "The hulking crab can breate air and water."
		}, {
			name : "Shell Camouflage",
			description : "While the hulking crab remains motionless with its eyestalks and pincers tucked close to its body, it resembles a natural formation or a pile of detritus. A creature within 30 feet of it can discern its true nature with a DC 15 Intelligence (Nature) check."
		}
	]
};
CreatureList["tressym"] = {
	name : "Tressym",
	source : ["SKT", 242],
	size : 5, //Tiny
	type : "Beast",
	subtype : "",
	companion : sheetVersion >= 13 ? "familiar_not_al" : "familiar",
	alignment : "Unaligned",
	ac : 12,
	hp : 5,
	hd : [2, 4], //[#, die]
	speed : "40 ft, climb 30 ft, fly 40 ft",
	scores : [3, 15, 10, 11, 12, 12], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 5,
		"stealth" : 4
	},
	damage_immunities : "poison",
	condition_immunities : "poisoned",
	senses : "Darkvision 60 ft; Adv. on Wis (Perception) checks using smell",
	passivePerception : 15,
	languages : "understands Common but can't speak",
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Claws",
			ability : 2,
			damage : [1, "", "slashing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "",
			modifiers : [-4, "", false], //[to hit, to damage, add ability to damage] "" means ignore
		}
	],
	traits : [{
			name : "Detect Invisibility",
			description : "Within 60 feet of the tressym, magical invisibility fails to conceal anything from the tressym's sight."
		}, {
			name : "Keen Smell",
			description : "The tressym has advantage on Wisdom (Perception) checks that rely on smell."
		}, {
			name : "Poison Sense",
			description : "The tressym can detect whether a substance is poisonous by taste, touch, or smell."
		}
	],
	wildshapeString : "\u25C6 Languages: understands Common but can't speak.\n\u25C6 Senses: Darkvision 60 ft; Advantage on Wisdom (Perception) checks that rely on smell.\n\u25C6 Detect Invisibility: Magical invisibility fails to conceal anything from sight, out to 60 ft.\n\u25C6 Immune to: poison damage, poisoned condition.\n\u25C6 Poison Sense: Detect whether a substance is poisonous by taste, touch, or smell."
};

// Magic Items
MagicItemsList["banner of the krig rune"] = {
	name : "Banner of the Krig Rune",
	source : ["SKT", 233],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "As an action, I can furl or unfurl this 5 ft by 3 ft banner. While it is unfurled and I'm attuned to it, I can use its magical properties to see invisible creatures, and each once per short rest emanate courage or protect from ranged attacks. I can even transfer them over to a place, destroying the banner in the process. See Notes.",
	descriptionFull : "Crafted from a thick, red fabric, this banner measures 5 feet high and 3 feet wide. The krig (war) rune is displayed on the fabric with round, metal plates sewn into it. It can be attached to a 10-foot pole to serve as a standard. Furling or unfurling the banner requires an action. The banner has the following properties.\n   " + toUni("Mark of Courage") + ". As a bonus action, you can touch the unfurled banner and cause it to emanate courage. You and your allies are immune to the frightened condition while within 20 feet of it. This benefit lasts for 10 minutes or until the banner is furled. Once you use this property, you can't use it again until you finish a short or long rest.\n   " + toUni("Sentinel Standard") + ". You can see invisible creatures while they are within 20 feet of the unfurled banner and within your line of sight.\n   " + toUni("Standard's Shield") + ". As a bonus action, you can touch the unfurled banner and invoke this power. Any ranged attack roll that targets you or an ally of yours has disadvantage if the target is within 20 feet of the unfurled banner. This benefit lasts for 1 minute or until the banner is furled. Once you use this property, you can't use it again until you finish a short or long rest.\n   " + toUni("Gift of Battle") + ". You can transfer the banner's magic to a place by tracing the krig rune on the ground with your finger. The point where you trace it becomes the center of a spherical area of magic that has a 500-foot radius and that is fixed to the place. The transfer takes 8 hours of work that requires the banner to be within 5 feet of you and during which you choose creatures, creature types, or both that will benefit from the magic. At the end, the banner is destroyed, and the area gains the following property:\n   While in the 500-foot-radius sphere, the creatures you chose during the transfer process are immune to the frightened condition and gain a +1 bonus to attack rolls and AC.",
	attunement : true,
	action : [
		["bonus action", "Mark of Courage (Krig Banner)"],
		["bonus action", "Standard's Shield (Krig Banner)"]
	],
	extraLimitedFeatures : [{
		name : "Mark of Courage (Krig Banner)",
		usages : 1,
		recovery : "short rest"
	}, {
		name : "Standard's Shield (Krig Banner)",
		usages : 1,
		recovery : "short rest"
	}],
	toNotesPage : [{
		name : "Features",
		popupName : "Banner of the Krig Rune Features",
		note : [
			"Crafted from a thick, red fabric, this banner measures 5 ft high and 3 ft wide. The krig (war) rune is displayed on the fabric with round, metal plates sewn into it. It can be attached to a 10-ft pole to serve as a standard. Furling or unfurling the banner requires an action. The banner has the following properties.",
			"As a bonus action, I can touch the unfurled banner and use the Mark of Courage, have it emanate courage. Me and my allies are immune to the frightened condition while within 20 ft of it. This benefit lasts for 10 minutes or until the banner is furled. Once I use this property, I can't use it again until I finish a short or long rest.",
			"I can see invisible creatures while they are within 20 ft of the unfurled banner and within my line of sight.",
			"As a bonus action, I can touch the unfurled banner and invoke the Standard's Shield power. While within 20 ft of the unfurled banner, me an my allies are protected from ranged attacks. Any ranged attack roll targetting those protected has disadvantage. This benefit lasts for 1 minute or until the banner is furled. Once I use this property, I can't use it again until I finish a short or long rest.\n",
			"I can transfer the banner's magic to a place by tracing the krig rune on the ground with my finger. The point where I trace it becomes the center of a spherical area of magic that has a 500-ft radius and that is fixed to the place. The transfer takes 8 hours of work that requires the banner to be within 5 ft of me and during which I choose creatures, creature types, or both that will benefit from the magic. At the end, the banner is destroyed, and the creatures I chose during the transfer process are immune to the frightened condition and gain a +1 bonus to attack rolls and AC while within the area."
		]
	}]
}
MagicItemsList["blod stone"] = {
	name : "Blod Stone",
	source : ["SKT", 233],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "D",
	description : "As an action while I carry this diamond with the blod rune, I can divine the location of the creature nearest to me that is related to the blood in the item and that isn't undead. I sense the distance and direction of the creature. The diamond is worth at least 5000 gp. If it is destroyed, the blood inside evaporates.",
	descriptionFull : "This diamond contains the blood of a creature\u2014blood that appears in the form of the blod (blood) rune. While the item is on your person, you can use your action to divine the location of the creature nearest to you that is related to the blood in the item and that isn't undead. You sense the distance and direction of the creature relative to your location. The creature is either the one whose blood is in the item or a blood relative.\n   This item is made from a large diamond worth at least 5,000 gp. When the blood of a creature is poured onto it during the creation process, the blood seeps into the heart of the gem. If the gem is destroyed, the blood evaporates and is gone forever. A vengeful being might use a blod stone to hunt down an entire bloodline. Such stones are sometimes given as gifts to siblings or handed down from parent to child.",
	attunement : true,
	action : [["action", ""]]
}
MagicItemsList["claw of the wyrm rune"] = {
	name : "Claw of the Wyrm Rune",
	source : ["SKT", 233],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "This silvered dragon's claw gives me resistance to dragon breath weapons. As an action 3 times per dawn, I can have a dragon within 30 ft make a DC 15 Con save or gain vulnerability to all damage types until the end of my next turn. I can transfer its magic to a place, destroying the claw in the process. See book.",
	descriptionFull : "This dragon's claw has been covered with a coat of molten silver, upon which has been inscribed the wyrm (dragon) rune. The claw has the following properties.\n   " + toUni("Wyrmslayer") + ". As an action, you can point the claw at a dragon within 30 feet of you. The dragon must then succeed on a DC 15 Constitution saving throw or gain vulnerability to all damage types until the end of your next turn. This property can be used three times. The claw regains all expended uses at the next dawn.\n   " + toUni("Wyrm Shield") + ". While the claw is displayed on your person, you have resistance to the damage caused by any dragon's breath weapon.\n   " + toUni("Wyrm Ward") + ". You can transfer the c1aw's magic to a place by tracing the wyrm rune on the ground with your finger. The point where you trace it becomes the center of a spherical area of magic that has a 100-foot radius and that is fixed to the place. The transfer takes 8 hours of work that requires the claw to be within 5 feet of you. At the end, the claw is destroyed, and the area gains the following property:\n   While in the 100-foot-radius sphere, any dragon has disadvantage on saving throws and can have a flying speed no higher than 10 feet.",
	attunement : true,
	dmgres : ["Dragon Breath Weapons"],
	action : [["action", ""]],
	usages : 3,
	recovery : "dawn"
}
MagicItemsList["conch of teleportation"] = {
	name : "Conch of Teleportation",
	source : ["SKT", 234],
	type : "wondrous item",
	rarity : "very rare",
	storyItemAL : true,
	description : "This 2.5 ft conch shell is inscribed with the uvar rune. As an action once per dawn, I can blow into the shell, teleporting myself and up to 8 willing creatures to a predetermined location without any chance of mishap. The location is determined at creation of the item and can't be changed.",
	descriptionFull : "This item is an ordinary, albeit rather large, conch shell that has been inscribed with the uvar rune. The conch measures 2\xBD feet long and weighs 20 pounds.\n   As an action, you can cast the Teleport spell by blowing into the shell. The destination is fixed, and there is no chance of either a mishap or the spell being off target. Anyone teleported by the conch appears in a specific location designated by the item's creator at the time the uvar rune is inscribed on the conch. It doesn't allow teleportation to any other destination. Once its spell is cast, the conch can't be used again until the next dawn.",
	weight : 20,
	attunement : true,
	action : [["action", ""]],
	usages : 1,
	recovery : "dawn"
}
MagicItemsList["gavel of the venn rune"] = {
	name : "Gavel of the Venn Rune",
	source : ["SKT", 234],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "This wooden gavel imposes disadv. on attacks against me before my first turn in a combat. As an action once per long rest, I can strike it on a hard surface and have the first creature that deals damage with an attack within 60 ft of the strike take half that damage itself as psychic damage. Can transfer rune, see book.",
	descriptionFull : "This wooden gavel is small by giant reckoning but nearly the size of a warhammer in human hands. The venn (friend) rune is inscribed in mithral in the base of the haft. Among giants, this item is used as part of rituals to resolve disputes. The gavel has the following properties.\n   " + toUni("Arbiters Shield") + ". At the start of every combat, attack rolls against you have disadvantage before the start of your first turn, provided that the gavel is on your person.\n   " + toUni("Bond of Amity") + ". As an action, you can use the gavel to strike a point on a hard surface. The first time in the next minute that a creature within 60 feet of that point deals damage to another creature with an attack that hits, the attacker takes psychic damage equal to half the damage it dealt to the target. Once you use this property, you can't use it again until you finish a long rest.\n   " + toUni("Gift of Truth") + ". You can transfer the gavel's magic to a place by tracing the venn rune on the ground with your finger. The point where you trace it becomes the center of a spherical area of magic that has a 30-foot radius and that is fixed to the place. The transfer takes 8 hours of work that requires the gavel to be within 5 feet of you. At the end, the gavel is destroyed, and the area gains the following property:\n   Whenever a creature utters a lie while within the 30-foot-radius sphere, that creature takes 5 psychic damage and flinches visibly.",
	attunement : true,
	action : [["action", ""]],
	usages : 1,
	recovery : "long rest"
}
MagicItemsList["gurt's greataxe"] = {
	name : "Gurt's Greataxe",
	source : ["SKT", 234],
	type : "weapon (greataxe)",
	rarity : "legendary",
	notLegalAL : true,
	description : "This giant-sized greataxe adds +1 to hit and damage and deals 3d12 slashing damage (+2d12 vs. humans). When in an area that is below 0 \u00B0F, it sheds bright light in a 20-ft radius and dim light for another 20 ft. As an action once per dawn, I can use it to cast Heat Metal (DC 13) that deals cold damage instead of fire.",
	descriptionFull : "In the Year of the Icy Axe (123 DR), the frost giant Lord Gurt fell to Uthgar Gardolfsson\u2014leader of the folk who would become the Uthgardt barbarians\u2014in a battle that marked the ascendance of humankind over the giants in the Dessarin Valley. Gurt's greataxe was buried in Morgur's Mound until it was unearthed and brought back to Waterdeep. After laying in the city's vaults for decades, the axe was given to Harshnag, a frost giant adventurer, in recognition of his service to Waterdeep. Uthgardt barbarians recognize the weapon on sight and attack any giant that wields it.\n   You gain a +1 bonus to attack and damage rolls made with this magic weapon. It is sized for a giant, weighs 325 pounds, and deals 3d12 slashing damage on a hit, plus an extra 2d12 slashing damage if the target is human.\n   The axe sheds light as a torch when the temperature around it drops below 0 degrees Fahrenheit. The light can't be shut off in these conditions.\n   As an action, you can cast a version of the Heat Metal spell (save DC 13) that deals cold damage instead of fire damage. Once this power is used, it can't be used again until the next dawn.",
	attunement : true,
	weight : 325,
	usages : 1,
	recovery : "dawn",
	weaponsAdd : ["Gurt's Greataxe"],
	weaponOptions : {
		baseWeapon : "greataxe",
		regExpSearch : /^(?=.*gurt)(?=.*greataxe).*$/i,
		name : "Gurt's Greataxe",
		source : ["SKT", 234],
		damage : [3, 12, "slashing"],
		weight : 325,
		description : "Heavy, two-handed; +2d12 damage against humans",
		modifiers : [1, 1]
	},
	fixedDC : 13,
	spellcastingBonus : {
		name : "Deals cold damage",
		spells : ["heat metal"],
		selection : ["heat metal"],
		firstCol : "oncelr"
	},
	spellChanges : {
		"heat metal" : {
			description : "1 metal obj 2d8 cold dmg to touch; save or drop obj; if held: dis. attacks/checks; bns a cool obj again",
			changes : "Using Gurt's Greataxe, the spell deals cold damage instead of fire."
		}
	}
}
MagicItemsList["ingot of the skold rune"] = {
	name : "Ingot of the Skold Rune",
	source : ["SKT", 234],
	magicItemTable : "H",
	description : "I can use the ingot as it is, or transfer its runic properties over to a shield or two-handed melee weapon.",
	descriptionFull : "This appears to be a simple ingot of iron ore, about a foot long and a few inches across. Inspection of its surface reveals the faint, silvery outline of the skold (shield) rune. The ingot has the following properties, which work only while it's on your person.\n   " + toUni("Runic Shield") + ". You have a +1 bonus to AC.\n   " + toUni("Shield Bond") + ". As a bonus action, choose a creature that you can see within 30 feet of you, other than yourself. Until the end of your next turn, any damage the target takes is reduced to 1, but you take half the damage prevented in this way. The damage you take can't be reduced in any way. Once you use this property, you can't use it again until you finish a short or long rest.\n   " + toUni("Shield Ward") + ". You can transfer the ingot's magic to a nonmagical item\u2014a shield or a two-handed melee weapon-by tracing the skold rune there with your finger. The transfer takes 8 hours of work that requires the two items to be within 5 feet of each other. At the end, the ingot is destroyed, and the rune appears in silver on the chosen item, which gains a benefit based on its form:\n \u2022 " + toUni("Shield.") + ". The shield is now a rare magic item that requires attunement. Its magic gives you a +1 bonus to AC, and the first time after each of your long rests that damage reduces you to 0 hit points, you are instead reduced to 1 hit point. You must be wielding the shield to gain these benefits.\n \u2022 " + toUni("Weapon.") + ". The weapon is now an uncommon magic weapon. It grants you a +1 bonus to AC while you're holding it.",
	choices : ["Ingot", "Transferred to a shield", "Transferred to a two-handed melee weapon"],
	"ingot" : {
		name : "Ingot of the Skold Rune ",
		type : "wondrous item",
		rarity : "very rare",
		description : "This iron ingot gives me +1 AC. As a bonus action, I can use it to choose a creature within 30 ft other than myself. Until the end of my next turn, any damage it takes is reduced to 1, but I take half the prevented damage and this damage can't be reduced in any way. I can transfer the rune to a shield or weapon, see book.",
		attunement : true,
		extraAC : [{name : "Skold Rune", mod : 1, magic : true, text : "I gain a +1 bonus to AC while attuned."}],
		action : [["bonus action", ""]]
	},
	"transferred to a shield" : {
		name : "Skold Rune Shield",
		type : "shield",
		rarity : "rare",
		description : "This shield gives my +1 AC on top of its normal bonus to AC. While carrying it, the first time after a long rest that damage reduces me to 0 HP, I drop to 1 HP instead.",
		shieldAdd : ["Skold Rune Shield", 3, 6],
		usages : 1,
		recovery : "long rest"
	},
	"transferred to a two-handed melee weapon" : {
		name : "Skold Rune Weapon",
		type : "weapon (any two-handed melee)",
		rarity : "uncommon",
		description : "This magic weapon grants me a +1 bonus to AC.",
		extraAC : [{name : "Skold Rune", mod : 1, magic : true, text : "I gain a +1 bonus to AC while attuned."}],
		chooseGear : {
			type : "weapon",
			prefixOrSuffix : "brackets",
			descriptionChange : ["replace", "weapon"],
			itemName1stPage : ["suffix", "Skold Rune"],
			excludeCheck : function (inObjKey, inObj) {
				return !(/melee/i).test(inObj.range) || !(/\b(2|two).?hand(ed)?s?\b/i).test(inObj.description);
			}
		},
		calcChanges : {
			atkAdd : [
				function (fields, v) {
					if (!v.theWea.isMagicWeapon && !v.isSpell && (/^(?=.*\bskold\b)(?=.*(rune|runic)).*$/i).test(v.WeaponText)) {
						v.theWea.isMagicWeapon = true;
						fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					}
				},
				'If I include the words "Skold Rune" in the name of a weapon, it will be treated as the magic weapon Skold Rune Weapon.'
			]
		}
	}
}
MagicItemsList["korolnor scepter"] = {
	name : "Korolnor Scepter",
	source : ["SKT", 234],
	type : "weapon (club)",
	rarity : "legendary",
	storyItemAL : true,
	description : "This tapered mithral rod the size of a dwarf's forearm has 10 charges, regaining 1d6+4 at dawn. It can be wielded as a +3 club. As an action while below sea level, I can expend 1 charge to determine the distance to the surface. I can also use the charges to cast Sending (2 charges) and Teleport (3 charges).",
	descriptionFull : "The Korolnor Scepter is one of ten Ruling Scepters of Shanatar, forged by the dwarven gods and given to the ruling houses of the ancient dwarven empire. The Korolnor Scepter's location was unknown for the longest time until a storm giant queen, Neri, found it in a barnacle-covered shipwreck at the bottom of the Trackless Sea. The Ruling Scepters are all roughly the same size and shape, but their materials and properties vary.\n   The Korolnor Scepter is a tapered mithral rod as thick and long as a dwarf's forearm, with a small platinum knob at the bottom and a rounded disk adorned with a ring of seven tiny blue gems at the top.\n   You gain a +3 bonus to attack and damage rolls made with this scepter, which can be wielded as a magic club.\n   You can use the properties of the Wyrmskull Throne, as well as the properties of the scepter itself. The scepter has 10 charges, and it regains 1d6+4 expended charges at dawn. Its properties are as follows.\n   If you are underground or underwater, you can use an action to expend 1 charge to determine the distance to the surface.\n   As an action: you can expend 2 charges to cast the Sending spell from the scepter.\n   As an action: you can expend 3 charges to cast the Teleport spell from the scepter. If the destination is within 60 feet of the Wyrmskull Throne, there is no chance of a teleport error or mishap occurring.",
	attunement : true,
	weight : 2,
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	spellFirstColTitle: "Ch",
	spellcastingBonus : [{
		name : "2 charges",
		spells : ["sending"],
		selection : ["sending"],
		firstCol : 2
	}, {
		name : "3 charges",
		spells : ["teleport"],
		selection : ["teleport"],
		firstCol : 3
	}],
	weaponsAdd : ["Korolnor Scepter"],
	weaponOptions : {
		baseWeapon : "club",
		regExpSearch : /^(?=.*korolnor)(?=.*scepter).*$/i,
		name : "Korolnor Scepter",
		source : ["SKT", 234],
		modifiers : [3, 3]
	}
}
MagicItemsList["navigation orb"] = {
	name : "Navigation Orb",
	source : ["SKT", 235],
	type : "wondrous item",
	rarity : "very rare",
	storyItemAL : true,
	description : "This hollow 7-ft diameter sphere of thin, polished mithral bears the skye rune and is keyed to a particular cloud castle. It only works while within that castle. As an action while touching it, I can use it to move the cloud castle 1 mph until commanded otherwise, have it stop, or turn 90 degrees.",
	descriptionFull : "A navigation orb is a hollow, 7-foot-diameter sphere of thin, polished mithral with a large skye (cloud) rune embossed on its outer surface. The orb levitates 10 feet above the ground and is keyed to a particular cloud castle, allowing you to control that castle's altitude and movement while the orb is inside the castle. If the orb is destroyed or removed from its castle, the castle's altitude and location remain fixed until the orb is returned or replaced.\n   As an action, you can cause one of the following effects to occur if you are touching the orb:\n   The castle moves at a speed of 1 mph in a straight line, in a direction of your choice, until the castle stops or is made to stop, or until another action is used to change its direction. If this movement brings the castle into contact with the ground, the castle lands gently.\n   The castle, if it is moving, comes to a gradual stop.\n   The castle makes a slow, 90-degree turn clockwise or counterclockwise (turning a northerly view into a westerly view, for example). The castle can turn while it is moving in a straight line.\n   Any creature touching the orb knows the altitude of the base of the castle above the ground or water below it.",
	attunement : true
}
MagicItemsList["opal of the ild rune"] = {
	name : "Opal of the Ild Rune",
	source : ["SKT", 235],
	magicItemTable : "G",
	description : "I can use the opal as it is, or transfer its runic properties over to a suit of armor or weapon.",
	descriptionFull : "This triangular fire opal measures about three inches on each side and is half an inch thick. The ild (fire) rune shimmers within its core, causing it to be slightly warm to the touch. The opal has the following properties, which work only while it's on your person.\n   " + toUni("Ignite") + ". As an action, you can ignite an object within 10 feet of you. The object must be flammable, and the fire starts in a circle no larger than 1 foot in diameter.\n   " + toUni("Fires Friend") + ". You have resistance to cold damage.\n   " + toUni("Fire Tamer") + ". As an action, you can extinguish any open flame within 10 feet of you. You choose how much fire to extinguish in that radius.\n   " + toUni("Gift of Flame") + ". You can transfer the opal's magic to a nonmagical item\u2014a weapon or a suit of armor\u2014by tracing the ild rune there with your finger. The transfer takes 8 hours of work that requires the two items to be within 5 feet of each other. At the end, the opal is destroyed, and the rune appears in red on the chosen item, which gains a benefit based on its form:\n \u2022 " + toUni("Weapon.") + ". The weapon is now an uncommon magic weapon. It deals an extra 1d6 fire damage to any target it hits.\n \u2022 " + toUni("Armor.") + ". The armor is now a rare magic item that requires attunement. You have resistance to cold damage while wearing the armor.",
	choices : ["Opal", "Transferred to a suit of armor", "Transferred to a weapon"],
	"opal" : {
		name : "Opal of the Ild Rune ",
		type : "wondrous item",
		rarity : "rare",
		description : "This triangular fire opal gives me resistance to cold damage. As an action, I can use it to extinguish any open flame within 10 ft. I choose how much fire to extinguish in that radius. I can undertake an 8 hour ritual to transfer the rune to a suit of armor or weapon, see book.",
		attunement : true,
		dmgres : ["Cold"],
		action : [["action", ""]]
	},
	"transferred to a suit of armor" : {
		name : "Ild Rune Armor",
		type : "armor (any)",
		rarity : "rare",
		description : "This magic armor gives me resistance to cold damage.",
		attunement : true,
		dmgres : ["Cold"],
		chooseGear : {
			type : "armor",
			prefixOrSuffix : "brackets",
			descriptionChange : ["prefix", "armor"],
			itemName1stPage : ["suffix", "Ild Rune"]
		}
	},
	"transferred to a weapon" : {
		name : "Ild Rune Weapon",
		type : "wondrous item",
		rarity : "uncommon",
		description : "This magic weapon deals +1d6 fire damage to any target it hits.",
		chooseGear : {
			type : "weapon",
			prefixOrSuffix : "brackets",
			descriptionChange : ["replace", "weapon"],
			itemName1stPage : ["suffix", "Ild Rune"]
		},
		calcChanges : {
			atkAdd : [
				function (fields, v) {
					if (!v.theWea.isMagicWeapon && !v.isSpell && (/^(?=.*\bild\b)(?=.*(rune|runic)).*$/i).test(v.WeaponText)) {
						v.theWea.isMagicWeapon = true;
						fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
						fields.Description += (fields.Description ? '; ' : '') + '+1d6 fire damage';
					}
				},
				'If I include the words "Ild Rune" in a the name of a weapon, it will be treated as the magic weapon Ild Rune Weapon, which deals +1d6 fire damage.'
			]
		}
	}
}
MagicItemsList["orb of the stein rune"] = {
	name : "Orb of the Stein Rune",
	source : ["SKT", 235],
	magicItemTable : "G",
	description : "I can use the orb as it is, or transfer its runic properties over to a shield or pair of boots.",
	descriptionFull : "This orb of granite is about the size of an adult human's fist. The stein (stone) rune appears on it in the form of crystalline veins that run across the surface. The orb has the following properties, which work only while it's on your person.\n   " + toUni("Indomitable Stand") + ". As an action, you can channel the orb's magic to hold your ground. For the next minute or until you move any distance, you have advantage on all checks and saving throws to resist effects that force you to move. In addition, any enemy that moves to a space within 10 feet of you must succeed on a DC 12 Strength saving throw or be unable to move any farther this turn.\n   " + toUni("Stone Soul") + ". You can't be petrified.\n   " + toUni("Earthen Step") + ". You can cast Meld into Stone as a bonus action. Once you use this property, you can't use it again until you finish a short or long rest.\n   " + toUni("Gift of Stone") + ". You can transfer the orb's magic to a nonmagical item\u2014a shield or a pair of boots\u2014by tracing the stein rune there with your finger. The transfer takes8 hours of work that requires the two items to be within 5 feet of each other. At the end, the orb is destroyed, and the rune appears in silver on the chosen item, which gains a benefit based on its form:\n \u2022 " + toUni("Shield.") + ". The shield is now a rare magic item that requires attunement. While you wield it, you have resistance to all damage dealt by ranged weapon attacks.\n \u2022 " + toUni("Boots.") + ". The pair of boots is now an uncommon magic item that requires attunement. While you wear the boots, you have advantage on Strength saving throws, and you can use your reaction to avoid being knocked prone.",
	choices : ["Orb", "Transferred to a shield", "Transferred to a pair of boots"],
	"orb" : {
		name : "Orb of the Stein Rune ",
		type : "wondrous item",
		rarity : "rare",
		description : "TThis orb gives me petrification immunity. As a bonus action once per short rest, I can cast Meld Into Stone. As an action, I can hold my ground for 1 min or until I move any distance, giving me adv. on saves/checks vs. moving and enemies moving to a space in 10 ft must make a DC 12 Str save or have speed 0 for this turn.",
		attunement : true,
		savetxt : { immune : ["petrified"] },
		action : [["action", ""]],
		spellcastingBonus : {
			name : "Once per short rest",
			spells : ["meld into stone"],
			selection : ["meld into stone"],
			firstCol : "oncesr"
		},
		spellChanges : {
			"meld into stone" : {
				time : "1 bns",
				changes : "Using the Orb of the Stein Rune, I can cast this as a bonus action."
			}
		}
	},
	"transferred to a shield" : {
		name : "Stein Rune Shield",
		type : "shield",
		rarity : "rare",
		description : "This shield gives my resistance to all damage dealt by range weapon attack.",
		attunement : true,
		shieldAdd : "Stein Rune Shield",
		dmgres : ["Ranged Weapon Attacks"]
	},
	"transferred to a pair of boots" : {
		name : "Stein Rune Boots",
		type : "wondrous item",
		rarity : "uncommon",
		description : "These pair of boots give me advantage on Strength saving throws. As a reaction, I can avoid being knocked prone.",
		attunement : true,
		savetxt : { text : ["Adv. on Str saves"] },
		advantages : ["Strength", true],
		action : [["reaction", ""]]
	}
}
MagicItemsList["pennant of the vind rune"] = {
	name : "Pennant of the Vind Rune",
	source : ["SKT", 235],
	magicItemTable : "H",
	description : "I can use the pennant as it is, or transfer its runic properties over to a suit of armor, pair of boots, or cloak.",
	descriptionFull : "This blue pennant is crafted from silk and is five feet long and whips about as if buffeted by a wind. The vind (wind) rune appears on its surface, looking almost like a cloud. The pennant has the following properties, which work only while it's on your person.\n   " + toUni("Wind Step") + ". As an action, you fly up to 20 feet. If you don't land at the end of this flight, you fall unless you have another means of staying aloft.\n   " + toUni("Comforting Wind") + ". You can't suffocate.\n   " + toUni("Winds Grasp") + ". As a reaction when you fall, you can cause yourself to take no damage from the fall. Once you use this property, you can't use it again until you finish a short or long rest.\n   " + toUni("Wind Walker") + ". While you are attuned to this rune, you can cast Levitate as a bonus action. Once you use this property, you can't use it again until you finish a short or long rest.\n   " + toUni("Gift of Wind") + ". You can transfer the pennant's magic to a nonmagical item\u2014a suit of armor, a pair of boots, or a cloak\u2014by tracing the vind rune there with your finger. The transfer takes 8 hours of work that requires the two items to be within 5 feet of each other. At the end, the pennant is destroyed, and the rune appears in silver on the chosen item, which gains a benefit based on its form:\n \u2022 " + toUni("Armor.") + ". The armor is now an uncommon magic item that requires attunement. You gain a bonus to speed of 5 feet while you wear the armor, and if it normally imposes disadvantage on Stealth checks, it no longer does so.\n \u2022 " + toUni("Boots/Cloak.") + ". The pair of boots or cloak is now a rare magic item that requires attunement. While wearing the item, you can convert up to 20 feet of your movement on each of your turns into flight. If you don't land at the end of this flight, you fall unless you have another means of staying aloft. You can also cast Feather Fall once from the item, and you regain the ability to do so when you finish a short or long rest.",
	choices : ["Pennant", "Transferred to a suit of armor", "Transferred to a pair of boots or cloak"],
	"pennant" : {
		name : "Pennant of the Vind Rune ",
		type : "wondrous item",
		rarity : "very rare",
		description : "This blue pennant stops me from suffocating. As an action, I can fly up to 20 ft, but won't stay aloft at the end of it. As a reaction once per short rest when I fall, I can use Wind Grasp to take no damage from the fall. As a bonus action once per short rest, I can cast Levitate. I can transfer this rune, see book.",
		attunement : true,
		savetxt : { immune : ["suffocation"] },
		action : [
			["action", "Wind Step (Vind Rune)"],
			["reaction", "Winds Grasp (Vind Rune)"]
		],
		extraLimitedFeatures : [{
			name : "Levitate (Vind Rune)",
			usages : 1,
			recovery : "short rest"
		}, {
			name : "Winds Grasp (Vind Rune)",
			usages : 1,
			recovery : "short rest"
		}],
		spellcastingBonus : {
			name : "Once per short rest",
			spells : ["levitate"],
			selection : ["levitate"],
			firstCol : "oncesr"
		},
		spellChanges : {
			"levitate" : {
				time : "1 bns",
				changes : "Using the Pennant of the Vind Rune, I can cast this as a bonus action."
			}
		}
	},
	"transferred to a suit of armor" : {
		name : "Vind Rune Armor",
		type : "armor (any)",
		rarity : "uncommon",
		description : "This magic armor doesn't impose disadvantage on stealth checks and gives me a 5 ft bonus to my speed.",
		attunement : true,
		speed : { allModes : "+5" },
		chooseGear : {
			type : "armor",
			prefixOrSuffix : "brackets",
			descriptionChange : ["prefix", "armor"],
			itemName1stPage : ["suffix", "Ild Rune"]
		}
	},
	"transferred to a pair of boots or cloak" : {
		name : "Vind Rune Boots or Cloak",
		nameAlt : "Vind Rune Boots",
		nameTest : "Vind Rune Cloak",
		type : "wondrous item",
		rarity : "rare",
		description : "While wearing this item, I can convert up to 20 ft of my movement on each of my turns into flight. If I don't land at the end of this flight, I fall unless I have other means of staying aloft. Once per short rest, I can use this item to cast Feather Fall.",
		attunement : true,
		usages : 1,
		recovery : "short rest",
		spellcastingBonus : {
			name : "Once per short rest",
			spells : ["feather fall"],
			selection : ["feather fall"],
			firstCol : "oncesr"
		}
	}
}
MagicItemsList["potion of giant size"] = {
	name : "Potion of Giant Size",
	source : ["SKT", 236],
	type : "potion",
	rarity : "legendary",
	description : "Once as an action, I can drink this potion of pale white liquid or administer it to another to grow to Huge for 24 hours. This gives Str 25, +5 ft reach, double max HP (current HP also doubles), and roll three times damage die for weapons. When its effect ends, HP above the max HP becomes temporary HP.",
	descriptionFull : "When you drink this potion, you become Huge for 24 hours if you are Medium or smaller, otherwise the potion does nothing. For that duration, your Strength becomes 25, if it isn't already higher, and your hit point maximum is doubled (your current hit points are doubled when you drink the potion). In addition, the reach of your melee attacks increases by 5 feet.\n   Everything you are carrying and wearing also increases in size for the duration. When rolling damage for weapons enlarged in this manner, roll three times the normal number of dice; for example, an enlarged longsword would deal 3d8 slashing damage (instead of1d8), or 3d10 slashing damage (instead of 1d10) when used with two hands.\n   When the effect ends, any hit points you have above your hit point maximum become temporary hit points. This potion is a pale white liquid made from the tongue of a giant clam, with a pungent aroma akin to that of rotting algae. It tastes sweet, however, when consumed."
}
MagicItemsList["robe of serpents"] = {
	name : "Robe of Serpents",
	source : ["SKT", 236],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "As a bonus action, I can remove one of the 1d4+3 emblazoned, brightly colored snakes from this robe and have it turn into a giant poisonous snake within 5 ft of me. It acts on my initiative and attacks those hostile to me. It disappears after 1 hour, when it drops to 0 HP, or when I dismiss it (no action).",
	descriptionFull : "A robe of serpents is a stylish silk garment that is popular among wealthy nobles and retired assassins. The robe is emblazoned with 1d4+3 stylized serpents, all brightly colored.\n   As a bonus action on your turn, you can transform one of the robe's serpents into a giant poisonous snake. The snake instantly falls from the robe, slithers into an unoccupied space next to you, and acts on your initiative count. The snake can tell friendly creatures from hostile ones and attacks the latter. The snake disappears in a harmless puff of smoke after 1 hour, when it drops to 0 hit points, or when you dismiss it (no action required). Once detached, a snake can't return to the robe. When all of the robe's snakes have detached, the robe becomes a nonmagical garment.",
	attunement : true,
	action : [["bonus action", ""]],
	usages : "1d4+3",
	recovery : "Never"
}
MagicItemsList["rod of the vonindod"] = {
	name : "Rod of the Vonindod",
	source : ["SKT", 236],
	type : "rod",
	rarity : "rare",
	magicItemTable : "F",
	description : "This 4 ft adamantine rod sized for a giant has 10 charges and regains 1d6+4 expended charges daily at dawn. I can expend 1 charge to cast Locate Object from it which has a range of 10 miles when used to locate objects made of adamantine. It has two prongs at one end and a molded handle grip on the other.",
	descriptionFull : "The fire giant Duke Zalto hired a wizard to craft several of these adamantine rods. Each measures 4 feet long, weighs 100 pounds, and is sized to fit comfortably in a fire giant's hand. The rod has two prongs at one end and a molded handle grip on the opposite end.\n   The rod has 10 charges and regains 1d6+4 of its expended charges daily at dawn. As an action, you can grasp it by the handle and expend 1 charge to cast the Locate Object spell from it. When the rod is used to detect objects made of adamantine, such as fragments of the Vonindod construct, its range increases to 10 miles.",
	weight : 100,
	attunement : true,
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["locate object"],
		selection : ["locate object"],
		firstCol : 1
	},
	spellChanges : {
		"locate object" : {
			description : "Learn direction to closest described kind or specific obj in 1000 ft (10 miles if adamantine); see book",
			changes : "Using the Rod of the Vonindod, the spell detection range increases to 10 miles when used to locate adamantine objects."
		}
	}
}
MagicItemsList["shard of the ise rune"] = {
	name : "Shard of the Ise Rune",
	type : "wondrous item",
	source : ["SKT", 236],
	magicItemTable : "H",
	description : "I can use the shard as it is, or transfer its runic properties over to a cloak or a pair of boots.",
	descriptionFull : "This shard of ice is long and slender, roughly the size of a dagger. The ise (ice) rune glows within it. The shard has the following properties, which work only while it's on your person.\n   " + toUni("Frigid Touch") + ". As an action, you can touch a body of water and freeze the water in a 10-foot-radius sphere around the spot you touched. Once you use this property, you can't use it again until you finish a short or long rest.\n   " + toUni("Frost Friend") + ". You have resistance to fire damage.\n   " + toUni("Icy Mantle") + ". As an action, you can touch yourself or another creature with water on your finger. The water creates an icy mantle of protection. The next time within the next minute that the target takes bludgeoning, slashing, or piercing damage, that damage is reduced to 0, and the mantle is destroyed. Once you use this property, you can't use it again until you finish a short or long rest.\n   " + toUni("Winter's Howl") + ". As an action, you can cast Sleet Storm (spell save DC 17). You regain this ability after you finish a short or long rest.\n   " + toUni("Gift of Frost") + ". You can transfer the shard's magic to a nonmagical item\u2014a cloak or a pair of boots-by tracing the ise rune there with your finger. The transfer takes 8 hours of work that requires the two items to be within 5 feet of each other. At the end, the shard is destroyed, and the rune appears in blue on the chosen item, which gains a benefit based on its form:\n \u2022 " + toUni("Cloak.") + ". The cloak is now a rare magic item that requires attunement. While wearing it, you have resistance to fire damage, and you have advantage on Dexterity (Stealth) checks made while in snowy terrain.\n \u2022 " + toUni("Boots.") + ". The pair of boots is now a rare magic item that requires attunement. While wearing it, you ignore difficult terrain while walking, and you can walk on water.",
	attunement : true,
	choices : ["Shard", "Transferred to a cloak", "Transferred to a pair of boots"],
	"shard" : {
		name : "Shard of the Ise Rune ",
		rarity : "very rare",
		description : "This shard of ice gives me fire resistance. As an action, I can use Frigid Touch, freezing water in a 10-ft radius where I touch it, or Icy Mantle, to prevent the first bludgeoning, slashing, or piercing damagein the next minute for a creature I touch. I can use it to cast Sleet Storm (DC 17). I can do all 3 each once per short rest.",
		dmgres : ["Fire"],
		action : [
			["action", "Frigid Touch (Ise Rune)"],
			["action", "Icy Mantle (Ise Rune)"]
		],
		extraLimitedFeatures : [{
			name : "Frigid Touch (Ise Rune)",
			usages : 1,
			recovery : "short rest"
		}, {
			name : "Icy Mantle (Ise Rune)",
			usages : 1,
			recovery : "short rest"
		}, {
			name : "Sleet Storm (Ise Rune)",
			usages : 1,
			recovery : "short rest"
		}],
		fixedDC : 17,
		spellcastingBonus : {
			name : "Once per short rest",
			spells : ["sleet storm"],
			selection : ["sleet storm"],
			firstCol : "oncesr"
		}
	},
	"transferred to a cloak" : {
		name : "Ise Rune Cloak",
		rarity : "rare",
		description : "While wearing this cloak, I have resistance to fire damage, and I have advantage on Dexterity (Stealth) checks made while in snowy terrain.",
		dmgres : ["Fire"]
	},
	"transferred to a pair of boots" : {
		name : "Ise Rune Boots",
		rarity : "rare",
		description : "While wearing these boots, I ignore difficult terrain while walking, and I can walk on water."
	}
}
MagicItemsList["ring of hardened magma"] = {
	name : "Ring of Hardened Magma",
	source : ["SKT", 105], // Raven Rock ancient relic
	type : "ring",
	rarity : "unknown",
	storyItemAL : true,
	description : "Warm orange light spills from minuscule cracks that form on this rings outer surface. It automatically resizes to fit the creature attuned to it. It has 6 charges which can be used to cast Conjure Minor Elementals (summoning 4 magma mephits or 4 magmins) or Fire Shield (warm shield version only), costing 1 charge each.",
	descriptionFull : "This ring is sized for a fire giant's finger. When a creature attunes to the ring, it magically shrinks to fit that creature's index finger, and warm orange light spills from minuscule cracks that form on its outer surface. The ring has 6 charges. While attuned to the ring, a creature can expend 1 charge to cast conjure minor elementals (summoning either four magma mephits or four magmins, as the wearer wishes) or fire shield (warm shield version only) from the ring. Once all of its charges are spent, the ring loses its spellcasting properties but retains its resizing property.",
	attunement : true,
	usages : 6,
	recovery : "never",
	spellcastingAbility : "class", // https://www.sageadvice.eu/2015/11/27/hat-of-disguise-dc/
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["conjure minor elementals", "fire shield"],
		selection : ["conjure minor elementals", "fire shield"],
		firstCol : 1,
		times : 2
	},
	spellChanges : {
		"conjure minor elementals" : {
			description : "Summon 4 magma mephits or 4 magmins that obey my verbal commands",
			changes : "Using the Ring of Hardened Magma, the spell summons either four magma mephits or four magmins."
		},
		"fire shield" : {
			description : "Fiery shield gives resistance to Cold damage and deals 2d8 Fire damage to melee attackers",
			changes : "Using the Ring of Hardened Magma, the spell can only produce the warm shield."
		}
	}
}
MagicItemsList["red dragon's thighbone"] = {
	name : "Red Dragon's Thighbone",
	source : ["SKT", 105], // Raven Rock ancient relic
	type : "weapon (greatclub)",
	rarity : "very rare",
	magicItemTable : "G",
	description : "This 14-ft long, 250 lb red dragon's thighbone can be used as a greatclub by a giant. It magically shrinks to a size that a creature that attunes to it can wield it effectively as a greatclub. It deals an extra 2d8 bludgeoning damage whenever it hits a creature of the dragon type.",
	descriptionFull : "This 14-ft long, 250 lb red dragon's thighbone can be used as a greatclub by a giant. If a creature attunes to the greatclub, it magically shrinks to a size that the creature can wield effectively. The greatclub is considered a magic weapon that deals an extra 2d8 bludgeoning damage whenever it hits a dragon (including any creature of the dragon type).",
	attunement : true,
	weight : 10,
	weaponsAdd : ["Red Dragon's Thighbone"],
	weaponOptions :{
		baseWeapon : "greabclub",
		regExpSearch : /^(?=.*red)(?=.*dragon)(?=.*thighbone).*$/i,
		name : "Red Dragon's Thighbone",
		source : ["SKT", 105],
		description : "Two-handed; +2d6 damage vs. dragons",
	}
}
MagicItemsList["ancient relic boulder"] = {
	name : "Ancient Relic Boulder",
	source : ["SKT", 105], // One Stone ancient relic
	type : "wondrous item",
	rarity : "unknown",
	storyItemAL : true,
	description : "As an action once per 7 days, I can use this stone to cast either Control Weather or Divination. As an action once per 24 hours, I can have it shrink to 6-inch diameter, 25 lb, or enlarge to normal, 15-ft diameter, 24000 lb. Anything the enlarged boulder falls on takes 10d10 bludgeoning damage, DC 15 Dex save to avoid.",
	descriptionFull : "This boulder is a relic of giantkind that was shaped, carved, and abandoned long ago by a stone giant earth shaman. Any character who succeeds on a DC 15 Intelligence (Arcana) check can tell that the engraved lines adorning its outer surface are carefully designed to channel magical energy. A detect magic spell reveals an aura of transmutation magic emanating from it and casting identify spell on the boulder allows one to learn its magical properties, each of which is activated by tracing specific lines on its surface:\n \u2022 A creature can use an action to cast the control weather spell or the divination spell from the stone. Once either spell is cast, this property can't be used again for 7 days.\n \u2022 A creature can use an action to shrink the stone to the size of a 6-inch-diameter orb weighing 25 pounds, or enlarge the boulder to its normal size (15-foot diameter) and weight (12 tons). Anything the enlarged boulder falls on takes 55 (10d10) bludgeoning damage. A creature can avoid taking this damage by tumbling out of the way with a successful DC 15 Dexterity saving throw. Once the reducing or enlarging effect is used, this property can't be used again for 24 hours.",
	weight : 25,
	action : [["action", " (shrink/enlarge)"]],
	extraLimitedFeatures : [{
		name : "Ancient Relic Boulder (spell)",
		usages : 1,
		recovery : "7 days"
	}, {
		name : "Ancient Relic Boulder (shrink/enlarge)",
		usages : 1,
		recovery : "24 h"
	}],
	spellcastingBonus : {
		name : "",
		spells : ["control weather", "divination"],
		selection : ["control weather", "divination"],
		times : 2
	},
	spellChanges : {
		"control weather" : {
			time : "1 a",
			changes : "Using the Ancient Relic Boulder, the spell takes only 1 action to cast."
		}
	}
}
var iFileName = "pub_20161115_VGtM.js";
RequiredSheetVersion(13);
// This file adds all the player-material from Volo's Guide to Monsters to MPMB's Character Record Sheet

// Define the source
SourceList.V={
	name : "Volo's Guide to Monsters",
	abbreviation : "VGtM",
	group : "Primary Sources",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/volos-guide-to-monsters",
	date : "2016/11/15"
};

// Races
RaceList["fallen aasimar"] = {
	regExpSearch : /^((?=.*aasimar)|((?=.*planetouched)(?=.*(celestial|angel))))(?=.*fallen).*$/i,
	name : "Fallen Aasimar",
	source : [["V", 104]],
	plural : "Fallen Aasimar",
	sortname : "Aasimar, Fallen",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Celestial"],
	vision : [["Darkvision", 60]],
	dmgres : ["Necrotic", "Radiant"],
	age : " reach adulthood in their late teens and live around 160 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [1, 0, 0, 0, 0, 2],
	trait : "Fallen Aasimar (+1 Strength, +2 Charisma)" + (typePF ? "\n" : " ") + "Light Bearer: I know the Light cantrip.\nHealing Hands: As an action, once per long rest, I can touch to heal for my level in HP.\nNecrotic Shroud: Once per long rest when I'm 3rd level, I can use an action to transform, causing all within 10 ft of me to make a Cha" + (typePF ? "" : "risma") + " saving throw (DC 8 + Cha mod + Prof bonus) or be frightened of me until the end of my next turn. This lasts for 1 minute or until I end it as a bonus action. Once on my turn I can have one of my attacks or spells deals my level in extra necrotic damage to one target.",
	abilitySave : 6,
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Light Bearer",
		spells : ["light"],
		selection : ["light"],
		firstCol : 'atwill'
	},
	features : {
		"healing hands" : {
			name : "Healing Hands",
			usages : 1,
			minlevel : 1,
			recovery : "long rest",
			additional : levels.map(function (n) { return n + " HP"; }),
			action : ["action", ""]
		},
		"necrotic shroud" : {
			name : "Necrotic Shroud",
			usages : 1,
			minlevel : 3,
			recovery : "long rest",
			additional : levels.map(function (n) { return n < 3 ? "" : "+" + n + " damage"; }),
			action : [["action", " (start)"], ['bonus action', ' (end)']]
		}
	}
};
RaceList["protector aasimar"] = {
	regExpSearch : /^((?=.*aasimar)|((?=.*planetouched)(?=.*(celestial|angel))))(?=.*protector).*$/i,
	name : "Protector Aasimar",
	source : [["V", 104]],
	plural : "Protector Aasimar",
	sortname : "Aasimar, Protector",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Celestial"],
	vision : [["Darkvision", 60]],
	dmgres : ["Necrotic", "Radiant"],
	age : " reach adulthood in their late teens and live around 160 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 0, 0, 1, 2],
	trait : "Protector Aasimar (+1 Wisdom, +2 Charisma)\nLight Bearer: I know the Light cantrip.\nHealing Hands: As an action, once per long rest, I can touch to heal for my level in HP.\nRadiant Soul: Once per long rest when I'm 3rd level, I can use an action to transform, gaining glimmer in my eyes and two incorporeal wings. For 1 minute or until I end it as a bonus action, I have 30 feet fly speed; once on my turn I can have one of my attacks or spells deal my level in extra radiant damage to one target.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Light Bearer",
		spells : ["light"],
		selection : ["light"],
		firstCol : 'atwill'
	},
	features : {
		"healing hands" : {
			name : "Healing Hands",
			usages : 1,
			minlevel : 1,
			recovery : "long rest",
			additional : levels.map(function (n) { return n + " HP"; }),
			action : ["action", ""]
		},
		"radiant soul" : {
			name : "Radiant Soul",
			usages : 1,
			minlevel : 3,
			recovery : "long rest",
			additional : levels.map(function (n) { return n < 3 ? "" : "+" + n + " damage"; }),
			action : [["action", " (start)"], ['bonus action', ' (end)']]
		}
	}
};
RaceList["scourge aasimar"] = {
	regExpSearch : /^((?=.*aasimar)|((?=.*planetouched)(?=.*(celestial|angel))))(?=.*scourge).*$/i,
	name : "Scourge Aasimar",
	source : [["V", 104]],
	plural : "Scourge Aasimar",
	sortname : "Aasimar, Scourge",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Celestial"],
	vision : [["Darkvision", 60]],
	dmgres : ["Necrotic", "Radiant"],
	age : " reach adulthood in their late teens and live around 160 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 1, 0, 0, 2],
	trait : "Scourge Aasimar (+1 Constitution, +2 Charisma)" + (typePF ? "\n" : " ") + "Light Bearer: I know the Light cantrip.\nHealing Hands: As an action, once per long rest, I can touch to heal for my level in HP.\nRadiant Consumption: Once per long rest when I'm 3rd level, I can use an action to radiate bright light in 10-ft radius and dim light for another 10-ft, for 1 minute or until I end it as a bonus action. Once on my turn my attack or spell deals my level in extra radiant damage to one target, and at the end of my turns all creatures within 10 ft of me, including myself, take half my level in radiant damage.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Light Bearer",
		spells : ["light"],
		selection : ["light"],
		firstCol : 'atwill'
	},
	features : {
		"healing hands" : {
			name : "Healing Hands",
			usages : 1,
			minlevel : 1,
			recovery : "long rest",
			additional : levels.map(function (n) { return n + " HP"; }),
			action : ["action", ""]
		},
		"radiant consumption" : {
			name : "Radiant Consumption",
			usages : 1,
			minlevel : 3,
			recovery : "long rest",
			additional : levels.map(function (n) {
				if (n < 3) return ""
				return  Math.ceil(n/2) + "/" + n + " damage";
			}),
			action : [["action", " (start)"], ['bonus action', ' (end)']]
		}
	}
};
RaceList["bugbear"] = {
	regExpSearch : /bugbear/i,
	name : "Bugbear",
	source : ["V", 119],
	plural : "Bugbears",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Goblin"],
	vision : [["Darkvision", 60]],
	skills : ["Stealth"],
	age : " rearch adulthood at age 16 and live up to 80 years",
	height : " are between 6 and 8 feet tall (6'0\" + 2d12\")",
	weight : " weigh between 250 and 350 lb (200 + 2d12 \xD7 2d6 lb)",
	heightMetric : " are between 1,9 and 2,4 metres tall (185 + 5d12 cm)",
	weightMetric : " weigh between 115 and 160 kg (90 + 5d12 \xD7 4d6 / 10 kg)",
	scores : [2, 1, 0, 0, 0, 0],
	features : {
		"surprise attack" : {
			name : "Surprise Attack",
			minlevel : 1,
			usages : 1,
			recovery : "Combat",
			additional : "2d6"
		}
	},
	trait : "Bugbear (+2 Strength, +1 Dexterity)\nPowerful Build: I count as one size larger when determining my carrying capacity and the weight I can push, drag, or lift.\nLong-Limbed: I have an additional 5 feet reach with melee attacks that I make on my turn.\nSurprise Attack: If I hit a surprised creature on my first turn in combat, that attack deals an extra 2d6 damage. I can do this only once per combat.",
	carryingCapacity : 2
};
RaceList["firbolg"] = {
	regExpSearch : /firbolg/i,
	name : "Firbolg",
	source : ["V", 106],
	plural : "Firbolg",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Elvish", "Giant"],
	age : " reach adulthood around 30 and can live for 500 years",
	height : " are between 6 and half and 8 feet tall (6'2\" + 2d12\")",
	weight : " weigh between 240 and 300 lb (175 + 2d12 \xD7 2d6 lb)",
	heightMetric : " are between 2 and 2,5 metres tall (190 + 5d12 cm)",
	weightMetric : " weigh between 110 and 135 kg (80 + 5d12 \xD7 4d6 / 10 kg)",
	scores : [1, 0, 0, 0, 2, 0],
	trait : "Firbolg (+1 Strength, +2 Wisdom)" + (typePF ? "\n" : " ") + "Hidden Step: Once per short rest, as a bonus action, I turn invisible until the start of my next turn as per the invisibility spell.\nPowerful Build: I count as one size larger for the weight I can carry.\nFirbolg Magic: I can cast the Detect Magic and Disguise Self spells each once per short rest. With Disguise Self I can seem up to 3 feet shorter. Wisdom is my ability for these spells.\nSpeech of Beast and Leaf: I can make my words understood, in a limited manner, by beasts and plants. I have advantage on Charisma checks to influence them.",
	spellcastingAbility : 5,
	features : {
		"firbolg magic (detect magic)" : {
			name : "Firbolg Magic (Detect Magic)",
			limfeaname : "Detect Magic",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			spellcastingBonus : {
				name : "Firbolg Magic",
				spells : ["detect magic"],
				selection : ["detect magic"],
				firstCol : 'oncesr'
			}
		},
		"firbolg magic (disguise self)" : {
			name : "Firbolg Magic (Disguise Self)",
			limfeaname : "Disguise Self",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			spellcastingBonus : {
				name : "Firbolg Magic",
				spells : ["disguise self"],
				selection : ["disguise self"],
				firstCol : 'oncesr'
			}
		},
		"hidden step" : {
			name : "Hidden Step",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", ""]
		}
	},
	carryingCapacity : 2
};
RaceList["goblin"] = {
	regExpSearch : /^(?=.*\bgoblins?\b)(?!.*hobgoblin|bugbear).*$/i,
	name : "Goblin",
	source : [["V", 119], ["G", 17]],
	plural : "Goblins",
	size : 4,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Goblin"],
	vision : [["Darkvision", 60]],
	age : " rearch adulthood at age 8 and live up to 60 years",
	height : " are between 3 and a half and 4 feet tall (3'5\" + 2d4\")",
	weight : " weigh between 40 and 70 lb (35 + 2d4 \xD7 1 lb)",
	heightMetric : " are between 100 and 120 cm tall (100 + 5d4 cm)",
	weightMetric : " weigh between 20 and 30 kg (17 + 5d4 \xD7 2 / 10 kg)",
	scores : [0, 2, 1, 0, 0, 0],
	features : {
		"fury of the small" : {
			name : "Fury of the Small",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			additional : levels.map(function (n) { return "+" + n + " damage"; })
		},
		"nimble escape" : {
			name : "Nimble Escape",
			minlevel : 1,
			action : ["bonus action", " (disengage/hide)"]
		}
	},
	trait : "Goblin (+2 Dexterity, +1 Constitution)\n\nFury of the Small: Once per short rest, when I hit a creature of a size category larger than mine, I deal extra damage equal to my level.\n\nNimble Escape: As a bonus action, I can take the Disengage or Hide action."
};
if (!RaceList["goliath"]) { //reprint from Elemental Evil Player's Companion
	RaceList["goliath"] = {
		regExpSearch : /goliath/i,
		name : "Goliath",
		source : [["E", 11], ["V", 108]],
		plural : "Goliaths",
		size : 3,
		speed : {
			walk : { spd : 30, enc : 20 }
		},
		languageProfs : ["Common", "Giant"],
		skills : ["Athletics"],
		age : " reach adulthood in their late teens and live less than 100 years",
		height : " are between 6 and a half and 8 feet tall (6'2\" + 2d10\")",
		weight : " weigh between 280 and 340 lb (200 + 2d10 \xD7 2d6 lb)",
		heightMetric : " are between 2 and 2,4 metres tall (190 + 5d10 cm)",
		weightMetric : " weigh between 100 and 155 kg (90 + 5d10 \xD7 4d6 / 10 kg)",
		scores : [2, 0, 1, 0, 0, 0],
		features : {
			"stone's endurance" : {
				name : "Stone's Endurance",
				minlevel : 1,
				usages : 1,
				recovery : "short rest",
				tooltip : "",
				action : ["reaction", ""]
			}
		},
		trait : "Goliath (+2 Strength, +1 Constitution)" + (typePF ? "\n" : "") + "\nStone's Endurance: Once per short rest, when I take damage, I can use my reaction to reduce the damage by 1d12 + my Con" + (typePF ? "" : "stitution") + " modifier." + (typePF ? "\n" : "") + "\nPowerful Build: I count as one size larger when determining my carrying capacity and the weight I can push, drag, or lift." + (typePF ? "\n" : "") + "\nMountain Born: I'm acclimated to high altitude, including elevations above 20000 feet. I'm also naturally adapted to cold climates.",
		carryingCapacity : 2
	};
};
RaceList["hobgoblin"] = {
	regExpSearch : /hobgoblin/i,
	name : "Hobgoblin",
	source : ["V", 119],
	plural : "Hobgoblins",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Goblin"],
	vision : [["Darkvision", 60]],
	armorProfs : [true, false, false, false],
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh between 150 and 200 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh between 70 and 90 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 2, 1, 0, 0],
	features : {
		"saving face" : {
			name : "Saving Face",
			minlevel : 1,
			usages : 1,
			recovery : "short rest"
		}
	},
	trait : "Hobgoblin (+2 Constitution, +1 Intelligence)\n\nMartial Training: I am proficient with two martial weapons of my choice and light armor.\n\nSaving Face: Once per short rest, when I miss an attack roll or fail an ability check or a saving throw, I can gain a bonus to the roll equal to the number of allies I can see within 30 feet of me (max +5)."
};
RaceList["kenku"] = {
	regExpSearch : /kenku/i,
	name : "Kenku",
	source : ["V", 109],
	plural : "Kenku",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	skillstxt : "Choose two from Acrobatics, Deception, Stealth, and Sleight of Hand",
	languageProfs : ["Common", "Auran"],
	age : " reach maturity at about 12 years old and can live to 60",
	height : " are around 5 feet tall (4'4\" + 2d8\")",
	weight : " weigh between 90 and 120 lb (70 + 2d8 \xD7 1d4 lb)",
	heightMetric : " are around 1,5 metres tall (135 + 5d8 cm)",
	weightMetric : " weigh between 40 and 55 kg (35 + 5d8 \xD7 2d4 / 10 kg)",
	scores : [0, 2, 0, 0, 1, 0],
	trait : "Kenku (+2 Dexterity, +1 Wisdom)" + (typePF ? "\n" : "") + "\nExpert Forgery: Kenku can duplicate other creatures' handwriting and craftwork. I have advantage on all checks made to produce forgeries or duplicates of existing objects." + (typePF ? "\n" : "") + "\nMimicry: I can mimic any sounds I have heard, including voices, but can otherwise not speak. Creatures hearing these sounds can determine they are imitations with a successful Wisdom (Insight) check opposed by my Charisma (Deception)."
};
RaceList["kobold"] = {
	regExpSearch : /kobold/i,
	name : "Kobold",
	source : ["V", 119],
	plural : "Kobolds",
	size : 4,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Draconic"],
	vision : [["Darkvision", 60], ["Sunlight Sensitivity", 0]],
	age : " reach adulthood at age 6 and can live up to 120 years, but rarely do so",
	height : " are between 2 and 3 feet tall (2'1\" + 2d4\")",
	weight : " weigh between 25 and 35 lb (25 + 2d4 \xD7 1 lb)",
	heightMetric : " are between 65 and 90 cm tall (63 + 5d4 cm)",
	weightMetric : " weigh between 10 and 15 kg (11 + 5d4 \xD7 2 / 10 kg)",
	scores : [-2, 2, 0, 0, 0, 0],
	features : {
		"grovel, cower, and beg" : {
			name : "Grovel, Cower, and Beg",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["action", ""]
		}
	},
	trait : "Kobold (-2 Strength, +2 Dexterity)\nSunlight Sensitivity: Disadvantage on attack rolls and Wisdom (Perception) checks that rely on sight when I or what I am trying to attack/perceive is in direct sunlight.\nGrovel, Cower, and Beg: As an action, I can distract all foes within 10 feet of me that can see me so that my allies gain advantage on attack rolls against them.\nPack Tactics: I have advantage on attack rolls against creatures when at least one of my allies is within 5 feet of that creature and that ally is not incapacitated."
};
RaceList["lizardfolk"] = {
	regExpSearch : /lizard(folk|man|men)/i,
	name : "Lizardfolk",
	source : ["V", 111],
	plural : "Lizardfolk",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : 30, enc : 20 }
	},
	skillstxt : "Choose two from Animal Handling, Nature, Perception, Stealth, and Survival",
	languageProfs : ["Common", "Draconic"],
	weaponOptions : {
		baseWeapon : "unarmed strike",
		regExpSearch : /\bbite\b/i,
		name : "Bite",
		source : ["V", 113],
		damage : [1, 6, "piercing"]
	},
	weaponsAdd : ["Bite"],
	armorOptions : {
		regExpSearch : /^(?=.*natural)(?=.*armou?r).*$/i,
		name : "Natural Armor",
		source : ["V", 113],
		ac : 13
	},
	armorAdd : "Natural Armor",
	age : " reach maturity around age 14 and rarely live longer than 60 years",
	height : " range from 5 to well over 6 feet tall (4'9\" + 2d10\")",
	weight : " weigh around 200 lb (120 + 2d10 \xD7 2d6 lb)",
	heightMetric : " range from 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 95 kg (55 + 5d10 \xD7 4d6 / 10 kg)",
	scores : [0, 0, 2, 0, 1, 0],
	features : {
		"cunning artisan" : {
			name : "Cunning Artisan",
			minlevel : 1,
			usages : 1,
			recovery : "short rest"
		},
		"hungry jaws" : {
			name : "Hungry Jaws",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", ""]
		}
	},
	trait : "Lizardfolk (+2 Constitution, +1 Wisdom) Bite: I can use my fanged maw to make unarmed strikes dealing 1d6 piercing damage." + (typePF ? "\n" : " ") + "Cunning Artisan: As part of a short rest I can harvest parts of a slain creature to make a shield, club, javelin, or 1d4 darts/blowgun needles. This requires a suitable corpse and appropriate tools." + (typePF ? "\n" : " ") + "Hold Breath: I can hold my breath for up to 15 minutes at a time." + (typePF ? "\n" : " ") + "Natural Armor: I have an AC of 13 + Dexterity modifier + shield." + (typePF ? "\n" : " ") + "Hungry Jaws: As a bonus action, once per short rest, I can make a special bite attack and if it hits I gain temporary HP equal to my Con modifier (min 1)."
};
RaceList["orc"] = {
	regExpSearch : /^(?!.*half)(?=.*\bor(c|k)).*$/i,
	name : "Orc",
	source : ["V", 120],
	plural : "Orcs",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Orc"],
	vision : [["Darkvision", 60]],
	skills : ["Intimidation"],
	age : " reach adulthood at age 12 and live up to 50 years",
	height : " are usually over 6 feet tall (5'4\" + 2d8\")",
	weight : " weigh between 230 and 280 lb (175 + 2d8 \xD7 2d6 lb)",
	heightMetric : " are usually over 1,8 metres tall (160 + 5d8 cm)",
	weightMetric : " weigh between 100 and 125 kg (80 + 5d8 \xD7 4d6 / 10 kg)",
	scores : [2, 0, 1, -2, 0, 0],
	features : {
		"aggressive" : {
			name : "Aggressive",
			minlevel : 1,
			action : ["bonus action", " (dash to enemy)"]
		}
	},
	trait : "Orc (+2 Strength, +1 Constitution, -2 Intelligence)\n\nPowerful Build: I count as one size larger when determining my carrying capacity and the weight I can push, drag, or lift.\n\nAggressive: As a bonus action, I can move up to my speed toward an enemy that I can see or hear. I must end my move closer to this enemy than I started.",
	carryingCapacity : 2
};
RaceList["tabaxi"] = {
	regExpSearch : /tabaxi/i,
	name : "Tabaxi",
	source : ["V", 113],
	plural : "Tabaxi",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 },
		climb : { spd : 20, enc : 10 }
	},
	skills : ["Perception", "Stealth"],
	languageProfs : ["Common", 1],
	vision : [["Darkvision", 60]],
	weaponOptions : {
		baseWeapon : "unarmed strike",
		regExpSearch : /^(?=.*fanged)(?=.*claw).*$/i,
		name : "Fanged Claws",
		source : ["V", 115],
		damage : [1, 4, "slashing"]
	},
	weaponsAdd : ["Fanged Claws"],
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " range from 5 to well over 6 feet tall (4'10\" + 2d10\")",
	weight : " weigh around 150 lb (90 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 70 kg (40 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 2, 0, 0, 0, 1],
	features : {
		"feline agility" : {
			name : "Feline Agility",
			minlevel : 1,
			usages : 1,
			recovery : " Turn",
			additional : "still for 1 turn to recover",
			tooltip : " (can be replenished by not moving for one whole turn)"
		}
	},
	trait : "Tabaxi (+2 Dexterity, +1 Charisma)\n\nCat's Claws: I can use my fanged claws to make unarmed strikes dealing 1d4 slashing damage. They also give me a climbing speed of 20 feet.\n\nFeline Agility: When moving on my turn in combat, I can move double my speed. Once I do this, I can't do it again until I don't move at all on one of my turns."
};
RaceList["triton"] = {
	regExpSearch : /triton/i,
	name : "Triton",
	source : ["V", 115],
	plural : "Triton",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Primordial"],
	dmgres : ["Cold"],
	age : " reach maturity around age 15 and can live up to 200 years",
	height : " are around 5 feet tall (4'6\" + 2d10\")",
	weight : " weigh around 150 lb (90 + 2d10 \xD7 2d4 lb)",
	heightMetric : " are around 1,6 metres tall (135 + 5d10 cm)",
	weightMetric : " weigh around 70 kg (40 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [1, 0, 1, 0, 0, 1],
	trait : "Triton (+1 Strength, +1 Constitution +1 Charisma)\nControl Air and Water: I can cast the Fog Cloud spell. Once I reach 3rd level, I can cast the Gust of Wind spell. Once I reach 5th level, I can cast the Wall of Water spell. All three spells can be used once per long rest. Charisma is my spellcasting ability for these spells.\nEmissary of the Sea: I can communicate simple ideas to beasts that can breathe water.\nGuardians of the Depths: I have resistance to cold damage and ignore all drawbacks from a deep, underwater environment." + (typePF ? "\n" : " ") + "Amphibious: I can breathe air and water.",
	spellcastingAbility : 6,
	features : {
		"fog cloud" : {
			name : "Control Air and Water (level 1)",
			limfeaname : "Fog Cloud",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Control Air and Water (1)",
				spells : ["fog cloud"],
				selection : ["fog cloud"],
				firstCol : 'oncelr'
			}
		},
		"gust of wind" : {
			name : "Control Air and Water (level 3)",
			limfeaname : "Gust of Wind",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Control Air and Water (3)",
				spells : ["gust of wind"],
				selection : ["gust of wind"],
				firstCol : 'oncelr'
			}
		},
		"wall of water" : {
			name : "Control Air and Water (level 5)",
			limfeaname : "Wall of Water",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Control Air and Water (5)",
				spells : ["wall of water"],
				selection : ["wall of water"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["yuan-ti pureblood"] = {
	regExpSearch : /^(?=.*yuan.ti)(?=.*pure.?blood).*$/i,
	name : "Yuan-Ti Pureblood",
	source : ["V", 120],
	plural : "Yuan-Ti Purebloods",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Abyssal", "Draconic"],
	vision : [["Darkvision", 60]],
	savetxt : {
		immune : ["poison"],
		adv_vs : ["magic"]
	},
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	improvements : "Yuan-Ti Pureblood: +1 Intelligence, +2 Charisma;",
	scores : [0, 0, 0, 1, 0, 2],
	trait : "Yuan-Ti Pureblood (+1 Intelligence, +2 Charisma)\n\nInnate Spellcasting:\n   I know the Poison Spray cantrip.\n   I can cast Animal Friendship on snakes at will.\n   Once I reach 3rd level, I can cast Suggestion once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : [{
		name : "Innate Spellcasting (level 1)",
		spells : ["poison spray"],
		selection : ["poison spray"],
		firstCol : 'atwill'
	}, {
		name : "Innate Spellcasting (level 1)",
		spells : ["animal friendship"],
		selection : ["animal friendship"],
		firstCol : 'atwill'
	}],
	features : {
		"suggestion" : {
			name : "Innate Spellcasting (level 3)",
			limfeaname : "Suggestion",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Innate Spellcasting (level 3)",
				spells : ["suggestion"],
				selection : ["suggestion"],
				firstCol : 'oncelr'
			}
		}
	}
};

// Creatures
CreatureList["aurochs"] = {
	name : "Aurochs",
	source : ["V", 207],
	size : 2, //Large
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 11,
	hp : 38,
	hd : [4, 10], //[#, die]
	speed : "50 ft",
	scores : [20, 10, 19, 2, 12, 5], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "",
	passivePerception : 11,
	languages : "",
	challengeRating : "2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Gore",
			ability : 1,
			damage : [2, 8, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "If used after moving 20 ft straight in the same round, see Charge trait"
		}
	],
	traits : [{
			name : "Charge",
			description : "If the aurochs moves at least 20 ft straight toward a target and then hits it with a gore attack on the same turn, the target takes an extra 9 (2d8) piercing damage. A targeted creature must succeed on a DC 15 Strength saving throw or be knocked prone."
		}
	]
};
CreatureList["cow"] = {
	name : "Cow",
	source : ["V", 207],
	size : 2, //Large
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 10,
	hp : 15,
	hd : [2, 10], //[#, die]
	speed : "30 ft",
	scores : [18, 10, 12, 2, 10, 4], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "",
	passivePerception : 10,
	languages : "",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Gore",
			ability : 1,
			damage : [1, 6, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "If used after moving 20 ft straight in the same round, deals extra 2d6 damage (Charge)"
		}
	],
	traits : [{
			name : "Charge",
			description : "If the cow moves at least 20 ft straight toward a target and then hits it with a gore attack on the same turn, the target takes an extra 7 (2d6) piercing damage."
		}
	]
};
CreatureList["ox"] = {
	name : "Ox",
	source : ["V", 208],
	size : 2, //Large
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 10,
	hp : 15,
	hd : [2, 10], //[#, die]
	speed : "30 ft",
	scores : [18, 10, 12, 2, 10, 4], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "",
	passivePerception : 10,
	languages : "",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Gore",
			ability : 1,
			damage : [1, 6, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "If used after moving 20 ft straight in the same round, deals extra 2d6 damage (Charge)"
		}
	],
	traits : [{
			name : "Charge",
			description : "If the ox moves at least 20 ft straight toward a target and then hits it with a gore attack on the same turn, the target takes an extra 7 (2d6) piercing damage."
		}, {
			name : "Beast of Burden",
			description : "The oxen is considered to be a Huge animal for the purpose of determining its carrying capacity."
		}
	]
};
CreatureList["deep rothe"] = {
	name : "Deep Roth\xE9",
	source : ["V", 208],
	size : 3, //Medium
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 10,
	hp : 13,
	hd : [2, 8], //[#, die]
	speed : "30 ft",
	scores : [18, 10, 12, 2, 10, 4], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "Darkvision 60 ft",
	passivePerception : 10,
	languages : "",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Gore",
			ability : 1,
			damage : [1, 6, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "If used after moving 20 ft straight in the same round, deals extra 2d6 damage (Charge)"
		}
	],
	traits : [{
			name : "Charge",
			description : "If the deep roth\xE9 moves at least 20 ft straight toward a target and then hits it with a gore attack on the same turn, the target takes an extra 7 (2d6) piercing damage."
		}, {
			name : "Innate Spellcasting",
			description : "The deep roth\xE9's spellcasting ability is Charisma. It can innately cast Dancing Lights at will, requiring no components."
		}
	]
};
CreatureList["rothe"] = {
	name : "Roth\xE9",
	source : ["V", 208],
	size : 2, //Large
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 10,
	hp : 15,
	hd : [2, 10], //[#, die]
	speed : "30 ft",
	scores : [18, 10, 12, 2, 10, 4], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "Darkvision 30 ft",
	passivePerception : 10,
	languages : "",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Gore",
			ability : 1,
			damage : [1, 6, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "If used after moving 20 ft straight in the same round, deals extra 2d6 damage (Charge)"
		}
	],
	traits : [{
			name : "Charge",
			description : "If the Roth\xE9 moves at least 20 ft straight toward a target and then hits it with a gore attack on the same turn, the target takes an extra 7 (2d6) piercing damage."
		}
	]
};
CreatureList["stench kow"] = {
	name : "Stench Kow",
	source : ["V", 208],
	size : 2, //Large
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 10,
	hp : 15,
	hd : [2, 10], //[#, die]
	speed : "30 ft",
	scores : [18, 10, 12, 2, 10, 4], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	damage_resistances : "cold, fire, and poison damage",
	senses : "Darkvision 60 ft",
	passivePerception : 10,
	languages : "",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Gore",
			ability : 1,
			damage : [1, 6, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "If used after moving 20 ft straight in the same round, deals extra 2d6 damage (Charge)"
		}
	],
	traits : [{
			name : "Charge",
			description : "If the stench kow moves at least 20 ft straight toward a target and then hits it with a gore attack on the same turn, the target takes an extra 7 (2d6) piercing damage."
		}, {
			name : "Stench",
			description : "Any creature other than a stench kow starting its turn within 5 ft of a stench kow must make a DC 12 Constitution saving throw or be poisoned until the start of the creature's next turn. On a successful saving throw, the creature is immune to the stench of all stench kows for 1 hour."
		}
	],
	wildshapeString : "Darkvision 60 ft | Resistant to: cold, fire, poison | Charge: If the stench kow moves at least 20 ft straight toward a target and then hits it with a gore attack on the same turn, it deals extra 2d6 piercing damage | Stench: Any creature starting its turn within 5 ft of a stench kow must make a DC 12 Con save or be poisoned until the start of the its next turn. On a success, it is immune to the stench of all stench kows for 1 hour"
};
CreatureList["dolphin"] = {
	name : "Dolphin",
	source : ["V", 208],
	size : 3, //Medium
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 12,
	hp : 11,
	hd : [2, 8], //[#, die]
	speed : "swim 60 ft",
	scores : [14, 13, 13, 6, 12, 7], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 3
	},
	senses : "Blindsight 60 ft",
	passivePerception : 13,
	languages : "",
	challengeRating : "1/8",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Slam",
			ability : 1,
			damage : [1, 6, "bludgeoning"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "If used after moving 30 ft straight in the same round, deals extra 1d6 damage (Charge)"
		}
	],
	traits : [{
			name : "Charge",
			description : "If the dolphin moves at least 30 ft straight toward a target and then hits it with a gore attack on the same turn, the target takes an extra 3 (1d6) bludgeoning damage."
		}, {
			name : "Hold Breath",
			description : "The dolphin can hold its breath for 20 minutes."
		}
	]
};
CreatureList["cranium rat"] = {
	name : "Cranium Rat",
	source : ["V", 133],
	size : 5, //Tiny
	type : "Beast",
	subtype : "",
	alignment : "Lawful Evil",
	ac : 12,
	hp : 2,
	hd : [1, 4], //[#, die]
	speed : "30 ft",
	scores : [2, 14, 10, 4, 11, 8], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "Darkvision 30 ft",
	passivePerception : 10,
	languages : "",
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Bite",
			ability : 2,
			damage : [1, "", "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "",
			modifiers : ["", "", false], //[to hit, to damage, add ability to damage] "" means ignore
		}
	],
	traits : [{
			name : "Illumination",
			description : "As a bonus action, the cranium rat can shed dim light from its brain in a 5-foot radius or extinguish the light."
		}, {
			name : "Telepathic Shroud",
			description : "The cranium rat is immune to any effect that would sense its emotions or read its thoughts, as well as to all divination spells."
		}
	]
};
CreatureList["brontosaurus"] = {
	name : "Brontosaurus",
	source : [["V", 139], ["ToA", 215]],
	size : 0, //Gargantuan
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 15,
	hp : 121,
	hd : [9, 20], //[#, die]
	speed : "30 ft",
	scores : [21, 9, 17, 2, 10, 7], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", 6, "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "",
	passivePerception : 10,
	languages : "",
	challengeRating : "5",
	proficiencyBonus : 3,
	attacksAction : 1,
	attacks : [{
			name : "Stomp",
			ability : 1,
			damage : [5, 8, "bludgeoning"], //[#, die, type] "" for die is allowed
			range : "Melee (20 ft)",
			description : "Target must succeed on a DC 14 Strength saving throw or be knocked prone"
		}, {
			name : "Tail",
			ability : 1,
			damage : [6, 8, "bludgeoning"], //[#, die, type] "" for die is allowed
			range : "Melee (20 ft)",
			description : ""
		}
	]
};
CreatureList["deinonychus"] = {
	name : "Deinonychus",
	source : [["V", 139], ["ToA", 217]],
	size : 3, //Medium
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 13,
	hp : 26,
	hd : [4, 8], //[#, die]
	speed : "40 ft",
	scores : [15, 15, 14, 4, 12, 6], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 3
	},
	senses : "",
	passivePerception : 13,
	languages : "",
	challengeRating : "1",
	proficiencyBonus : 2,
	attacksAction : 3,
	attacks : [{
			name : "Claw",
			ability : 1,
			damage : [1, 8, "slashing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "Two claw and one bite as one Attack action; If used after moving 20 ft straight in the same round, see Pounce trait"
		}, {
			name : "Bite",
			ability : 1,
			damage : [1, 8, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "Two claw and one bite as one Attack action (also, see Pounce trait)"
		}
	],
	traits : [{
			name : "Multiattack",
			description : "The deinonychus makes three attacks: two with its claws and one with its bite."
		}, {
			name : "Pounce",
			description : "If the deinonychus moves at least 20 ft straight toward a creature and then hits it with a claw attack on the same turn, that target must succeed on a DC 12 Strength saving throw or be knocked prone. If the target is prone, the deinonychus can make one bite attack against it as a bonus action."
		}
	]
};
CreatureList["dimetrodon"] = {
	name : "Dimetrodon",
	source : [["V", 139], ["ToA", 217]],
	size : 3, //Medium
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 12,
	hp : 19,
	hd : [3, 8], //[#, die]
	speed : "30 ft, swim 20 ft",
	scores : [14, 10, 15, 2, 10, 5], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 2
	},
	senses : "",
	passivePerception : 12,
	languages : "",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Bite",
			ability : 1,
			damage : [2, 6, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : ""
		}
	]
};
CreatureList["hadrosaurus"] = {
	name : "Hadrosaurus",
	source : [["V", 140], ["ToA", 224]],
	size : 2, //Large
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 11,
	hp : 19,
	hd : [3, 10], //[#, die]
	speed : "40 ft",
	scores : [15, 10, 13, 2, 10, 5], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 2
	},
	senses : "",
	passivePerception : 12,
	languages : "",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Tail",
			ability : 1,
			damage : [1, 10, "bludgeoning"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : ""
		}
	]
};
CreatureList["quetzalcoatlus"] = {
	name : "Quetzalcoatlus",
	source : [["V", 140], ["ToA", 230]],
	size : 1, //Huge
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 13,
	hp : 30,
	hd : [4, 12], //[#, die]
	speed : "10 ft, fly 80 ft",
	scores : [15, 13, 13, 2, 10, 5], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 2
	},
	senses : "",
	passivePerception : 12,
	languages : "",
	challengeRating : "2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Bite",
			ability : 1,
			damage : [3, 6, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (10 ft)",
			description : "If used after diving 30 ft towards a target, the attack deals 3d6 extra damage (Dive Attack)"
		}
	],
	traits : [{
			name : "Dive Attack",
			description : "If the quetzalcoatlus is flying and dives at least 30 ft toward a creature and then hits it with a bite attack, the attack deals an extra 10 (3d6) damage to the target."
		}, {
			name : "Flyby",
			description : "The quetzalcoatlus doesn't provoke opportunity attacks when it flies out of an enemy's reach."
		}
	]
};
CreatureList["stegosaurus"] = {
	name : "Stegosaurus",
	source : [["V", 140], ["ToA", 231]],
	size : 1, //Huge
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 13,
	hp : 76,
	hd : [8, 12], //[#, die]
	speed : "40 ft",
	scores : [20, 9, 17, 2, 11, 5], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "",
	passivePerception : 10,
	languages : "",
	challengeRating : "4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Bite",
			ability : 1,
			damage : [6, 6, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (10 ft)",
			description : ""
		}
	]
};
CreatureList["velociraptor"] = {
	name : "Velociraptor",
	source : [["V", 140], ["ToA", 235]],
	size : 5, //Tiny
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 13,
	hp : 10,
	hd : [3, 4], //[#, die]
	speed : "30 ft",
	scores : [6, 14, 13, 4, 12, 6], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 3
	},
	senses : "",
	passivePerception : 13,
	languages : "",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
			name : "Bite",
			ability : 2,
			damage : [1, 6, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "One bite and one claw attack as an Attack action"
		}, {
			name : "Claw",
			ability : 2,
			damage : [1, 4, "slashing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "One bite and one claw attack as an Attack action"
		}
	],
	traits : [{
			name : "Pack Tactics",
			description : "The velociraptor has advantage on an attack roll against a creature if at least one of the velociraptor's allies is within 5 ft of the creature and the ally isn't incapacitated."
		}
	]
};
CreatureList["gazer"] = {
	name : "Gazer",
	source : ["V", 126],
	size : 5, //Tiny
	type : "Aberration",
	subtype : "",
	alignment : "Neutral Evil",
	ac : 13,
	hp : 13,
	hd : [3, 4], //[#, die]
	speed : "0 ft, fly 30 ft",
	scores : [3, 17, 14, 3, 10, 7], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", 2, ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 4,
		"stealth" : 5
	},
	senses : "Darkvision 60 ft",
	passivePerception : 14,
	languages : "",
	challengeRating : "1/2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Bite",
			ability : 2,
			damage : [1, "", "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : ""
		}, {
			name : "Eye Rays",
			ability : 3,
			damage : ["Special", "", ""], //[#, die, type] "" for die is allowed
			range : "60 ft",
			description : "Shoot two randomly determined different rays as one action; Each ray has its own target; See traits",
			dc : true,
			modifiers : ["", "", false], //[to hit, to damage, add ability to damage] "" means ignore
		}
	],
	traits : [{
			name : "Aggressive",
			description : "As a bonus action, the gazer moves its speed toward an enemy that it can see."
		}, {
			name : "Mimicry",
			description : "The gazer can mimic simple speech it has heard, in any language. Any who hear this can tell it is an imitation with a successful DC 10 Wis (Insight) check."
		}
	],
	actions : [{
			name : "Eye Rays",
			description : "1. Dazing Ray: Wisdom saving throw or charmed until the start of the gazer's next turn. While charmed, half speed and disadv. on attacks.\n2. Fear Ray: Wisdom saving throw or frightened until the start of the gazer's next turn.\n3. Frost Ray: Target must make a Dexterity saving throw or 10 (3d6) cold damage.\n4. Telekinetic Ray: Medium or smaller creature, Strength saving throw or be moved up to 30 ft away from the gazer. If it is an up to 10 lb unattended object, the gazer moves it up to 30 ft in any direction. It can exert fine control on objects this way."
		}
	]
};

// Magic Items
MagicItemsList["mind blade"] = {
	name : "Mind Blade",
	source : ["V", 81],
	type : "weapon (any sword)",
	rarity : "rare",
	description : "Mind flayers can turn any nonmagical sword into a mind blade. Only one creature can attune to this sword: either a specific mind flayer or one of its thralls. In the hands of its intended wielder, the mind blade is a magic weapon that deals an extra 2d6 psychic damage to any target it hits.",
	descriptionFull : "Mind flayers can turn any nonmagical sword into a mind blade. Only one creature can attune to it: either a specific mind flayer or one of its thralls. In the hands of any other creature, the mind blade functions as a normal sword of its kind. In the hands of its intended wielder, the mind blade is a magic weapon that deals an extra 2d6 psychic damage to any target it hits.",
	attunement : true,
	prerequisite : "Requires attunement by the creature this armor was made for: either a specific mind flayer or one of its thralls",
	prereqeval : function (v) { return false; },
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "sword"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /sword|scimitar|rapier/i;
			return !(testRegex).test(inObjKey) && (!inObj.baseWeapon || !(testRegex).test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/^(?=.*mind)(?=.*blade).*$/i).test(v.WeaponText)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + '+2d6 psychic damage';
				}
			},
			'If I include the words "Mind Blade" in a the name of a sword, it will be treated as the magic weapon Mind Blade, which adds +2d6 psychic damage on any hit as long as attuned to its intended wielder.'
		]
	}
}
MagicItemsList["mind carapace armor"] = {
	name : "Mind Carapace Armor",
	source : ["V", 81],
	type : "armor (heavy)",
	rarity : "uncommon",
	description : "Only one creature can attune to this armor: either a specific mind flayer or one of its thralls. To its intended wearer, the armor grants advantage on Intelligence, Wisdom, and Charisma saving throws and makes its wearer immune to the frightened condition.",
	descriptionFull : "Any nonmagical suit of heavy armor can be turned by mind flayers into mind carapace armor. Only one creature can attune to it: either a specific mind flayer or one of its thralls. While worn by any other creature, the mind carapace armor functions as normal armor of its kind. To its intended wearer, the armor grants advantage on Intelligence, Wisdom, and Charisma saving throws and makes its wearer immune to the frightened condition.",
	attunement : true,
	prerequisite : "Requires attunement by the creature this armor was made for: either a specific mind flayer or one of its thralls",
	prereqeval : function (v) { return false; },
	savetxt : { text : ["Adv. on Int, Wis, and Cha saves"], immune : ["frightened"] },
	advantages : [["Intelligence", true], ["Wisdom", true], ["Charisma", true]],
	allowDuplicates : true,
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "brackets",
		descriptionChange : ["prefix", "armor"],
		itemName1stPage : ["suffix", "Mind Carapace"],
		excludeCheck : function (inObjKey, inObj) {
			return !(/heavy/i).test(inObj.type);
		}
	}
}
MagicItemsList["mind lash"] = {
	name : "Mind Lash",
	source : ["V", 81],
	type : "weapon (whip)",
	rarity : "rare",
	description : "This magic whip strips away a creature's will to survive as it also strips away flesh and deals +2d4 psychic damage on each hit. Any target taking psychic damage must succeed on a DC 15 Wisdom save or have disadv. on Int, Wis, and Cha saves for 1 minute. It can repeat the save at the end of each of its turns.",
	descriptionFull : "In the hands of any creature other than a mind flayer, a mind lash functions as a normal whip. In the hands of an illithid, this magic weapon strips away a creature's will to survive as it also strips away flesh, dealing an extra 2d4 psychic damage to any target it hits. Any creature that takes psychic damage from the mind lash must also succeed on a DC 15 Wisdom saving throw or have disadvantage on Intelligence, Wisdom, and Charisma saving throws for 1 minute. The creature can repeat the saving throw at the end of each of its turns, ending the effect on itself on a success.",
	attunement : true,
	weight : 3,
	prerequisite : "Requires attunement by an illithid",
	prereqeval : function (v) { return (/mind flayer|illithid/i).test(What("Race")); },
	weaponsAdd : ["Mind Lash"],
	weaponOptions : {
		baseWeapon : "whip",
		regExpSearch : /^(?=.*mind)(?=.*lash).*$/i,
		name : "Mind Lash",
		source : ["V", 81],
		description : "Finesse, reach; +2d4 psychic damage; DC 15 Wis save or disadv. on Int/Wis/Cha saves for 1 min"
	}
}
MagicItemsList["shield of far sight"] = {
	name : "Shield of Far Sight",
	source : ["V", 81],
	type : "shield",
	rarity : "rare",
	description : "The mind flayer that created this shield can see through its eye with 60 ft darkvision while it is on the same plane. While peering through this magical eye, the mind flayer can use its Mind Blast action as though it were standing behind the shield. If a shield of far sight is destroyed, its creator is blinded for 2d12 hours.",
	descriptionFull : "A mind flayer skilled at crafting magic items creates a shield of far sight by harvesting an eye from an intelligent humanoid and magically implanting it on the outer surface of a nonmagical shield. The shield becomes a magic item once the eyes is implanted, whereupon the mind flayer can give the shield to a thrall or hang it on a wall in its lair. As long as the shield is on the same plane of existence as its creator, the mind flayer can see through the shield's eye, which has darkvision out to a range of 60 feet. While peering through this magical eye, the mind flayer can use its Mind Blast action as though it were standing behind the shield.\n   If a shield of far sight is destroyed, the mind flayer that created it is blinded for 2d12 hours.",
	weight : 6,
	shieldAdd : "Shield of Far Sight"
}
MagicItemsList["survival mantle"] = {
	name : "Survival Mantle",
	source : ["V", 81],
	type : "armor (half plate)",
	rarity : "unknown",
	description : "This mantle functions as a half plate and takes just as long to don or doff. It encases portions of my shoulders, neck, and chest so that I can breathe normally in any environment (including a vacuum) and gives me advantage on saving throws against gases (such as Cloudkill, Stinking Cloud, or inhaled poisons).",
	descriptionFull : "This carapace-like augmentation encases portions of the wearer's shoulders, neck, and chest. A survival mantle is equivalent to a suit of nonmagical half plate armor and takes just as long to don or doff. It can't be worn with other kinds of armor.\n   A creature wearing a survival mantle can breathe normally in any environment (including a vacuum) and has advantage on saving throws against harmful gases (such as those created by a Cloudkill spell, a Stinking Cloud spell, inhaled poisons, and the breath weapons of some dragons).",
	weight : 40,
	savetxt : { adv_vs : ["gases"] },
	armorAdd : "Survival Mantle",
	armorOptions : {
		regExpSearch : /^(?=.*survival)(?=.*mantle).*$/i,
		name : "Survival Mantle",
		source : ["V", 81],
		type : "medium",
		ac : 15,
		stealthdis : true,
		weight : 40
	}
}
var iFileName = "pub_20170404_TftYP.js";
RequiredSheetVersion(12.999);
// This file adds the beasts from the Tales from the Yawning Portal adventure book to MPMB's Character Record Sheet

// Define the source
SourceList.TftYP={
	name : "Tales from the Yawning Portal [beasts, items]",
	abbreviation : "TftYP",
	group : "Adventure Books",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/tales-yawning-portal",
	date : "2017/04/04"
};

// Creatures
CreatureList["giant crayfish"] = {
	name : "Giant Crayfish",
	source : ["TftYP", 235],
	size : 2, //Large
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 15,
	hp : 45,
	hd : [7, 10], //[#, die]
	speed : "30 ft, swim 30 ft",
	scores : [15, 13, 13, 1, 9, 3], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"stealth" : 3
	},
	senses : "Blindsight 30 ft",
	passivePerception : 9,
	languages : "",
	challengeRating : "2",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
			name : "Claw",
			ability : 1,
			damage : [1, 10, "bludgeoning"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "Target grappled on hit (escape DC 12); 2 claw attacks as Attack action, if not grappling with claw"
		}
	],
	traits : [{
			name : "Amphibious",
			description : "The giant crayfish can breathe air and water."
		}
	]
};
CreatureList["giant ice toad"] = {
	name : "Giant Ice Toad",
	source : ["TftYP", 235],
	size : 2, //Large
	type : "Monstrosity",
	subtype : "",
	alignment : "Unaligned",
	ac : 14,
	hp : 52,
	hd : [7, 10], //[#, die]
	speed : "30 ft",
	scores : [16, 13, 14, 8, 10, 6], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	damage_immunities : "cold",
	senses : "Darkvision 60 ft",
	passivePerception : 10,
	languages : "Ice Toad",
	challengeRating : "3",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Bite",
			ability : 1,
			damage : [2, 6, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "Target is grappled and restrained (escape DC 13); Can't use bite again until grapple ends"
		}
	],
	traits : [{
			name : "Amphibious",
			description : "The toad can breathe air and water"
		}, {
			name : "Cold Aura",
			description : "A creature that starts its turn within 10 feet of the toad takes 5 (1d10) cold damage."
		}, {
			name : "Standing Leap",
			description : "The toad's long jump is up to 20 ft and its high jump is up to 10 ft, with or without a running start."
		}
	],
	features : [{
			name : "Swallow",
			description : "The toad can make a bite attack against a Medium or smaller target it is grappling. If it hits, the target takes bite damage, is swallowed, and the grapple ends. The swallowed target is blinded and restrained, it has total cover against attacks and other effects outside the toad, and it takes 10 (3d6) acid damage and 11 (2d6) cold damage at the start of each of the toad's turns. The toad can have only one target swallowed at a time.\nIf the toad dies, a swallowed creature is no longer restrained by it and can escape from the corpse using 5 feet of movement, exiting prone."
		}
	],
	wildshapeString : "Darkvision 60 ft| Cold Aura: Any within 5 ft at start of their turn take 1d10 cold damage| Amphibious: breathe air and water| Standing Leap: long jump 20 ft and high jump 10 ft, regardless of start| Swallow: if bite attack hits Medium or smaller being grappling, it takes bite damageand is swallowed: blinded, restrained, total cover, takes 3d6 acid and 2d6 cold damage at the start of each of the toad's turns; Only 1 swallowed at a time."
};
CreatureList["giant lightning eel"] = {
	name : "Giant Lightning Eel",
	source : ["TftYP", 236],
	size : 2, //Large
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 13,
	hp : 42,
	hd : [5, 10], //[#, die]
	speed : "5 ft, swim 30 ft",
	scores : [11, 17, 16, 2, 12, 3], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	damage_resistances : "lightning",
	senses : "Blindsight 60 ft",
	passivePerception : 11,
	languages : "",
	challengeRating : "3",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
			name : "Bite",
			ability : 1,
			damage : [2, 6, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "Two bite attacks as an Attack action; +1d8 lightning damage on a hit"
		}, {
			name : "Lightning Jolt (Recharge 5-6)",
			ability : 3,
			damage : [3, 8, "lightning"], //[#, die, type] "" for die is allowed
			range : "Out/in 5/15 ft",
			dc : true,
			description : "Out water: 5 ft, 1 crea; In water: all in 15 ft; Con save: fail― stunned until eel's next turn end, success― half damage",
			modifiers : [-1, "", false], //[to hit, to damage, add ability to damage] "" means ignore
			tooltip : "One creature the eel touches within 5 feet of it outside water, or each creature within 15 feet of it in a body of water, must make a DC 12 Constitution saving throw. On failed save, a target takes 13 (3d8) lightning damage. If the target takes any of this damage, the target is stunned until the end of the eel's next turn. On a successful save, a target takes half as much damage and isn't stunned"
		}
	],
	traits : [{
			name : "Water Breathing",
			description : "The eel can breathe only underwater."
		}
	],
	actions : [{
			name : "Lightning Jolt (Recharge 5-6)",
			description : "See Attack. One creature the eel touches within 5 feet of it outside water, or each creature within 15 feet of it in a body of water, must make a DC 12 Constitution saving throw. On failed save, a target takes 13 (3d8) lightning damage. If the target takes any of this damage, the target is stunned until the end of the eel's next turn. On a successful save, a target takes half as much damage and isn't stunned"
		}
	]
};
CreatureList["giant subterranean lizard"] = {
	name : "Giant Subterranean Lizard",
	source : ["TftYP", 236],
	size : 1, //Huge
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 14,
	hp : 66,
	hd : [7, 12], //[#, die]
	speed : "30 ft, swim 50 ft",
	scores : [21, 9, 17, 2, 10, 7], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"stealth" : 3
	},
	senses : "",
	passivePerception : 10,
	languages : "",
	challengeRating : "4",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
			name : "Bite",
			ability : 1,
			damage : [2, 10, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "1 bite \u0026 1 tail attack as Attack action; Target grappled \u0026 restrained (escape DC 15); Can't use bite until grapple ends"
		}, {
			name : "Tail",
			ability : 1,
			damage : [2, 6, "bludgeoning"], //[#, die, type] "" for die is allowed
			range : "Melee (10 ft)",
			description : "1 bite \u0026 1 tail attack as Attack action; Target DC 15 Str save or knocked prone"
		}
	],
	traits : [{
			name : "Swallow",
			description : "The lizard can make one bite attack against a Medium or smaller target it is grappling. If the attack hits, the target takes bite damage, is swallowed, and the grapple ends. The swallowed target is blinded and restrained, it has total cover against attacks and other effects outside the lizard, and it takes 10 (3d6) acid damage at the start of each of the lizard's turns. The lizard can have only one target swallowed at a time.\nIf the lizard dies, a swallowed creature is no longer restrained by it and can escape from the corpse using 10 feet of movement, exiting prone."
		}
	],
	wildshapeString : "\u25C6 Swallow: If a bite attack hits a Small or smaller target that is currently being grappled by the lizard, the target is swallowed, ending the grapple. While swallowed, it is blinded, restrained, has total cover, and takes 3d4 acid damage at the start of each of the lizard's turns; The lizard can have only 1 swallowed at a time. If the lizard dies, the swallowed creature is no longer restrained and can escape using 10 ft movement."
};

// Magic Items
MagicItemsList["amulet of protection from turning"] = {
	name : "Amulet of Protection from Turning",
	source : ["TftYP", 228],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "D",
	description : "This silver and turquoise amulet has 3 charges, regain all at dawn. It gives me adv. on saves against effects that turn undead. If I fail a save against such an effect, I can expend 1 charge to succeed instead. It glows with a silvery blue light for a few seconds each time an effect that turns undead is used on me.",
	descriptionFull : "While you wear this amulet of silver and turquoise, you have advantage on saving throws against effects that turn undead.\n   If you fail a saving throw against such an effect, you can choose to succeed instead. You can do so three times, and expended uses recharge daily at dawn. Each time an effect that turns undead is used against you, the amulet glows with silvery blue light for a few seconds.",
	attunement : true,
	weight : 1,
	usages : 3,
	recovery : "dawn",
	savetxt : { adv_vs : ["turn undead"] }
}
MagicItemsList["balance of harmony"] = {
	name : "Balance of Harmony",
	source : ["TftYP", 228],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "D",
	description : "I can use the scale to cast Detect Evil and Good as a ritual by placing a gem of 100 gp or more or holy water on both pans. It then tips to the side it detected, good or evil, or fluctuates slightly if what it detected is neutral. After this, I can touch it to learn the rest of the information the spell normally conveys.",
	descriptionFull : "This scale bears celestial symbols on one pan and fiendish symbols on the other. You can use the scale to cast Detect Evil and Good as a ritual. Doing so requires you to place the scale on a solid surface, then sprinkle the pans with holy water or place a transparent gem worth 100 gp in each pan. The scale remains motionless if it detects nothing, tips to one side or the other for good (consecrated) or evil (desecrated), and fluctuates slightly if it detects a creature appropriate to the spell but neither good nor evil. By touching the scales after casting the ritual, you instantly learn any information the spell can normally convey, and then the effect ends.",
	weight : 1,
	spellcastingBonus : {
		name : "Only as ritual",
		spells : ["detect evil and good"],
		selection : ["detect evil and good"],
		firstCol : "(R)"
	},
	spellChanges : {
		"detect evil and good" : {
			time : "10 min",
			compMaterial : "The Balance of Harmony requires placing the scale on a solid surface and sprinkling the pans with holy water or placing a transparent gem worth 100 gp in each pan.",
			changes : "I can cast this spell only as a ritual, thus its casting time is 10 minutes longer."
		}
	}
}
MagicItemsList["bracelet of rock magic"] = {
	name : "Bracelet of Rock Magic",
	source : ["TftYP", 228],
	type : "wondrous item",
	rarity : "very rare",
	magicItemTable : "G",
	description : "This gold bracelet grants me immunity to being petrified. It has 16 charges to cast Flesh to Stone (DC 15). Once all charges are used, it turns to lead and loses its magic. If I use it to target a creature strongly related to stone, the target has adv. on its save. If it saves, Flesh to Stone is cast on me with disadv. on the save.",
	descriptionFull : "While you wear this gold bracelet, it grants you immunity to being petrified, and it allows you to cast Flesh to Stone (save DC 15) as an action. Once the spell has been cast three times, the bracelet can no longer cast it. Thereafter, you can cast Stone Shape as an action. After you have done this thirteen times, the bracelet loses its magic and turns from gold to lead.\n   " + toUni("Curse") + ". The bracelet's affinity with earth manifests as an unusual curse. Creatures of flesh that are strongly related to earth and stone, such as stone giants and dwarves, have advantage on the saving throw against Flesh to Stone cast from the bracelet. If such a creature's save is successful, the bracelet breaks your attunement to it and casts the spell on you. You make your saving throw with disadvantage, and on a failed save you are petrified instantly.",
	attunement : true,
	weight : 1,
	cursed : true,
	usages : 16,
	recovery : "Never",
	savetxt : { immune : ["petrified"] },
	fixedDC : 15,
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["flesh to stone"],
		selection : ["flesh to stone"],
		firstCol : 1
	}
}
MagicItemsList["eagle whistle"] = {
	name : "Eagle Whistle",
	source : ["TftYP", 228],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "Three times per dawn, I can blow this whistle, gaining a flying speed equal to twice my walking speed while I do so continuously. I can blow it for a number for rounds equal to 5 + five times my Constitution modifier (minimum of 1 round) or until I talk, hold my breath, start suffocating, or land.",
	descriptionFull : "While you blow an eagle whistle continuously, you can fly twice as fast as your walking speed. You can blow the whistle continuously for a number of rounds equal to 5 + five times your Constitution modifier (minimum of 1 round) or until you talk, hold your breath, or start suffocating. A use of the whistle also ends if you land. If you are aloft when you stop blowing the whistle, you fall. The whistle has three uses. It regains expended uses daily at dawn.",
	weight : 1,
	usages : 3,
	recovery : "dawn"
}
MagicItemsList["hell hound cloak"] = {
	name : "Hell Hound Cloak",
	source : ["TftYP", 228],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "H",
	description : "As an action, I can command this cloak to Polymorph me into a hell hound for 1 hour, or until I stop it as a bonus action. The 6th time I use it and every time after, I must make a DC 15 Cha save or be stuck in hell hound form until dispelled or I drop to 0 HP. If I remain in hell hound form for 6 hours, it becomes permanent.",
	descriptionFull : "This dark cloak is made of cured hell hound hide. As an action, you can command the cloak to transform you into a hell hound for up to 1 hour. The transformation otherwise functions as the Polymorph spell, but you can use a bonus action to revert to your normal form.\n   " + toUni("Curse") + ". This cloak is cursed with the essence of a hell hound, and becoming attuned to it extends the curse to you. Until the curse is broken with Remove Curse or similar magic, you are unwilling to part with the cloak, keeping it within reach at all times.\n   The sixth time you use the cloak, and each time thereafter, you must make a DC 15 Charisma saving throw. On a failed save, the transformation lasts until dispelled or until you drop to 0 hit points, and you can't willingly return to normal form. If you ever remain in hell hound form for 6 hours, the transformation becomes permanent and you lose your sense of self. All your statistics are then replaced by those of a hell hound. Thereafter, only Remove Curse or similar magic allows you to regain your identity and return to normal. If you remain in this permanent form for 6 days, only a Wish spell can reverse the transformation.",
	attunement : true,
	weight : 1,
	cursed : true
}
MagicItemsList["javelin of backbiting"] = {
	name : "Javelin of Backbiting",
	source : ["TftYP", 229],
	type : "weapon (javelin)",
	rarity : "very rare",
	magicItemTable : "G",
	description : "This javelin has +2 to hit and damage, +30 ft range, and deals +1d6 damage when thrown. After a throwing attack, it flies back to my hand immediately. While its curse lasts, I'm unwilling to part with it and have disadv. on attacks with other weapon. Also, on a roll of 1 to hit, I roll the attack again, but at myself with adv.",
	descriptionFull : "You gain a +2 bonus to attack and damage rolls made with this magic weapon. When you throw it, its normal and long ranges both increase by 30 feet. and it deals one extra die of damage on a hit. After you throw it and it hits or misses, it flies back to your hand immediately.\n   " + toUni("Curse") + ". This weapon is cursed, and becoming attuned to it extends the curse to you. Until the curse is broken with Remove Curse or similar magic, you are unwilling to part with the weapon, keeping it within reach at all times. In addition, you have disadvantage on attack rolls made with weapons other than this one.\n   Whenever you roll a 1 on an attack roll using this weapon, the weapon bends or flies to hit you in the back. Make a new attack roll with advantage against your own AC. If the result is a hit, you take damage as if you had attacked yourself with the spear.",
	attunement : true,
	weight : 2,
	cursed : true,
	weaponsAdd : ["Javelin of Backbiting"],
	weaponOptions : {
		baseWeapon : "javelin",
		regExpSearch : /^(?=.*javelin)(?=.*backbiting).*$/i,
		name : "Javelin of Backbiting",
		source : ["TftYP", 229],
		range : "Melee, 60/150 ft",
		description : "Thrown; +1d6 damage if thrown; Returning; On 1 to hit: attack myself with adv.",
		modifiers : [2,2]
	}
}
MagicItemsList["loadstone"] = {
	name : "Loadstone",
	nameAlt : "Lodestone",
	source : ["TftYP", 228],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "D",
	description : "The large gem worth 150 gp is cursed. Detect Magic doesn't detect it, but Identify does reveal its nature. If I take the Dash or Disengage action while it is on my person, its curse activates. While cursed, I am unwilling to part with it, my speed is reduced by 5 ft, and my maximum load and lift capacities are halved.",
	descriptionFull : "This stone is a large gem worth 150 gp.\n   " + toUni("Curse") + ". The stone is cursed, but its magical nature is hidden; Detect Magic doesn't detect it. An Identify spell reveals the stone's true nature. If you use the Dash or Disengage action while the stone is on your person, its curse activates. Until the curse is broken with Remove Curse or similar magic, your speed is reduced by 5 feet, and your maximum load and maximum lift capacities are halved. You also become unwilling to part with the stone.",
	weight : 1,
	cursed : true
}
MagicItemsList["mirror of the past"] = {
	name : "Mirror of the Past",
	source : ["TftYP", 228],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "D",
	description : "As an action once per dawn, I can gaze int this mirror while thinking of a specific object or creature. The mirror then shows me scenes from the target's past for 1 minute or less, instead of my reflection. Information conveyed is accurate, but it is random and cryptic, and presented in no particular order.",
	descriptionFull : "The holder of this platinum hand mirror can learn something about the history of a specific object or creature by taking an action to gaze into the mirror and think of the target. Instead of the holder's reflection, the mirror presents scenes from the target's past. Information conveyed is accurate, but it is random and cryptic, and presented in no particular order. Once it is activated, the mirror gives its information for 1 minute or less, then returns to normal. It can't be used again until the next dawn.",
	weight : 1,
	usages : 1,
	recovery : "dawn",
	action : [["action", ""]]
}
MagicItemsList["night caller"] = {
	name : "Night Caller",
	source : ["TftYP", 228],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "I can use this whistle to cast Animate Dead, if I blow it under the night sky or in darkness. Once used, it can't function for 7 days. It can affect targets through 10 ft of soft earth or similar, but they take 1 min to claw to the surface. Once per 24 hours, I can blow it to reassert control over 1 or 2 targ I animated with it.",
	descriptionFull : "This whistle is carved from transparent crystal, and it resembles a tiny dragon curled up like a snail. The name Night Caller is etched on the whistle in Dwarvish runes. If a character succeeds on a DC 20 Intelligence (Arcana or History) check, the character recalls lore that says the duergar made several such whistles for various groups in an age past.\n   If you blow the whistle in darkness or under the night sky, it allows you to cast the Animate Dead spell. The target can be affected through up to 10 feet of soft earth or similar material, and if it is, it takes 1 minute to claw its way to the surface to serve you. Once the whistle has animated an undead creature, it can't do so again until 7 days have passed.\n   Once every 24 hours, you can blow the whistle to reassert control over one or two creatures you animated with it.",
	weight : 1,
	usages : 1,
	recovery : "7 days",
	spellFirstColTitle : "Us",
	spellcastingBonus : {
		name : "Once per 7 days",
		spells : ["animate dead"],
		selection : ["animate dead"],
		firstCol : "checkbox"
	},
	spellChanges : {
		"animate dead" : {
			description : "In darkness, turn (buried) corpse into Skeleton/Zombie; control for 24h; bns a command within 60 ft",
			changes : "Night Caller can only be used in darkness or under the night sky. It can only create a single Skeleton or Zombie, but can animate a corpse buried below up to 10 feet of soft earth or similar material."
		}
	}
}
MagicItemsList["potion of mind control"] = {
	name : "Potion of Mind Control",
	source : ["TftYP", 229],
	type : "potion",
	magicItemTable : "E",
	description : "",
	descriptionFull : "When you drink a potion of mind control, you can cast a dominate spell (save DC 15) on a specific creature if you do so before the end of your next turn. If you don't, the potion is wasted.\n   A potion of mind control produces the effect of a Dominate Beast (beast), Dominate Person (humanoid), or Dominate Monster (monster) spell depending on its type. If the target's initial saving throw fails, the effect lasts for 1 hour, with no concentration required on your part. The charmed creature has disadvantage on new saving throws to break the effect during this time.",
	weight : 1,
	choices : ["Beast", "Humanoid", "Monster"],
	"beast" : {
		rarity : "rare",
		description : "Once as an action, I can drink this potion or administer it to another. The consumer of the potion can cast Dominate Beast before the end of my next turn. The spell save DC is 15 and it lasts for 1 hour, requiring no concentration. Once charmed, the target has disadvantage on new saves to break the effect."
	},
	"humanoid" : {
		rarity : "rare",
		description : "Once as an action, I can drink this potion or administer it to another. The consumer of the potion can cast Dominate Person before the end of my next turn. The spell save DC is 15 and it lasts for 1 hour, requiring no concentration. Once charmed, the target has disadvantage on new saves to break the effect."
	},
	"monster" : {
		rarity : "very rare",
		description : "Once as an action, I can drink this potion or administer it to another. The consumer of the potion can cast Dominate Monster before the end of my next turn. The spell save DC is 15 and it lasts for 1 hour, requiring no concentration. Once charmed, the target has disadvantage on new saves to break the effect."
	}
}
MagicItemsList["robe of summer"] = {
	name : "Robe of Summer",
	source : ["TftYP", 229],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "This elegant garment is made from fine cloth in hues of red, orange, and gold. While I wear the robe, I have resistance to cold damage. In addition, I am comfortable as if the temperature were that of a balmy day, so I suffer no ill effects from the weather's temperature extremes.",
	descriptionFull : "This elegant garment is made from fine cloth in hues of red, orange, and gold. While you wear the robe, you have resistance to cold damage. In addition, you are comfortable as if the temperature were that of a balmy day, so you suffer no ill effects from the weather's temperature extremes.",
	attunement : true,
	weight : 1,
	dmgres : ["Cold"]
}
MagicItemsList["shatterspike"] = {
	name : "Shatterspike",
	source : ["TftYP", 229],
	type : "weapon (longsword)",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "I have a +1 bonus to attack and damage rolls made with this magic longsword. If it hits an object, the hit is automatically a critical hit, and it can deal bludgeoning or slashing damage to the object (my choice). Further, damage from nonmagical sources can't harm the weapon.",
	descriptionFull : "You have a +1 bonus to attack and damage rolls made with this magic weapon. If it hits an object, the hit is automatically a critical hit, and it can deal bludgeoning or slashing damage to the object (your choice). Further, damage from nonmagical sources can't harm the weapon.",
	attunement : true,
	weight : 3,
	weaponsAdd : ["Shatterspike"],
	weaponOptions : {
		baseWeapon : "longsword",
		regExpSearch : /Shatterspike/i,
		name : "Shatterspike",
		source : ["TftYP", 229],
		description : "Versatile (1d10); Against objects: always critical hit, can choose to deal bludgeoning damage",
		modifiers : [1,1]
	}
}
MagicItemsList["spear of backbiting"] = {
	name : "Spear of Backbiting",
	source : ["TftYP", 229],
	type : "weapon (spear)",
	rarity : "very rare",
	magicItemTable : "G",
	description : "This spear has +2 to hit and damage, +30 ft range, and deals +1d6 damage when thrown. After a throwing attack, it flies back to my hand immediately. While its curse lasts, I'm unwilling to part with it and have disadv. on attacks with other weapon. Also, on a roll of 1 to hit, I roll the attack again, but at myself with adv.",
	descriptionFull : "You gain a +2 bonus to attack and damage rolls made with this magic weapon. When you throw it, its normal and long ranges both increase by 30 feet. and it deals one extra die of damage on a hit. After you throw it and it hits or misses, it flies back to your hand immediately.\n   " + toUni("Curse") + ". This weapon is cursed, and becoming attuned to it extends the curse to you. Until the curse is broken with Remove Curse or similar magic, you are unwilling to part with the weapon, keeping it within reach at all times. In addition, you have disadvantage on attack rolls made with weapons other than this one.\n   Whenever you roll a 1 on an attack roll using this weapon, the weapon bends or flies to hit you in the back. Make a new attack roll with advantage against your own AC. If the result is a hit, you take damage as if you had attacked yourself with the spear.",
	attunement : true,
	weight : 3,
	cursed : true,
	weaponsAdd : ["Spear of Backbiting"],
	weaponOptions : {
		baseWeapon : "spear",
		regExpSearch : /^(?=.*spear)(?=.*backbiting).*$/i,
		name : "Spear of Backbiting",
		source : ["TftYP", 229],
		range : "Melee, 50/90 ft",
		description : "Thrown, versatile (1d8); +1d6 damage if thrown; Returning; On 1 to hit: attack myself with adv.",
		modifiers : [2,2]
	}
}
MagicItemsList["stone of ill luck"] = {
	name : "Stone of Ill Luck",
	source : ["TftYP", 229],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "C",
	description : "Although this polished agate appears to be a stone of good luck to anyone who tries to identify it. While it is on my person, it gives me a +1 bonus and a -2 penalty (from the curse) to ability checks and saving throws (for a total of -1). Until the curse is broken, I am unwilling to part with the item.",
	descriptionFull : "This polished agate appears to be a stone of good luck to anyone who tries to Identify it, and it confers that item's property while on your person.\n   " + toUni("Curse") + ". This item is cursed. While it is on your person, you take a -2 penalty to ability checks and saving throws. Until the curse is discovered, the DM secretly applies this penalty, assuming you are adding the item's bonus. You are unwilling to part with the stone until the curse is broken with Remove Curse or similar magic.",
	attunement : true,
	weight : 1,
	cursed : true,
	addMod : [
		{ type : "save", field : "all", mod : -1, text : "I gain a +1 bonus and -2 penalty on all my saving throws." },
		{ type : "skill", field : "all", mod : -1, text : "I gain a +1 bonus and -2 penalty  on all my ability checks." },
		{ type : "skill", field : "Init", mod : -1, text : "I gain a +1 bonus and -2 penalty  on all my ability checks." }
	]
}
MagicItemsList["wand of entangle"] = {
	name : "Wand of Entangle",
	source : ["TftYP", 229],
	type : "wand",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "This wand has 7 charges, regaining 1d6+1 expended charges daily at dawn. If I use its last charge, I roll a d20. On a 1, it is destroyed. As an action, I can expend 1 charge to cast Entangle (save DC 13) from it.",
	descriptionFull : "This wand has 7 charges. While holding it, you can use an action to expend 1 of its charges to cast the Entangle spell (save DC 13) from it.\n   The wand regains 1d6+1 expended charges daily at dawn. If you expend the wand's last charge, roll a d20. On a 1, the wand crumbles into ashes and is destroyed.",
	attunement : true,
	weight : 1,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	usages : 7,
	recovery : "dawn",
	additional : "regains 1d6+1",
	fixedDC : 13,
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["entangle"],
		selection : ["entangle"],
		firstCol : 1
	}
}
MagicItemsList["waythe"] = {
	name : "Waythe",
	source : ["TftYP", 229],
	type : "weapon (greatsword)",
	rarity : "legendary",
	storyItemAL : true,
	description : "This greatsword adds +1 to hit and damage. Against giants, it deal +2d6 damage and they must make a DC 15 Str save or be knocked prone. It has 7 charges, regaining 1d6+1 at dawn. As an action, I can expend 1 charge to speak its command word to detect enemies within 60 ft. Waythe is sentient, see Notes page.",
	descriptionLong : "This greatsword adds a +1 bonus to attack and damage rolls made with it. Against giants, it deal 2d6 extra slashing damage and when a giant is hit with it, they must make a DC 15 Strength saving throw or be knocked prone. It has 7 charges, regaining 1d6+1 at dawn. As an action, I can expend 1 charge to speak its command, letting me know the direction of the nearest creature hostile to me within 60 ft, regardless of it being ethereal, invisible, disguised, or hidden. This lasts for 1 minute. Waythe is sentient and has a mind of its own, see Notes page.",
	descriptionFull : "Waythe is a unique greatsword most recently in the possession of a high-ranking cloud giant ambassador.\n   You gain a +1 bonus to attack and damage rolls made with this magic weapon. When you hit a creature of the giant type with it, the giant takes an extra 2d6 slashing damage, and it must succeed on a DC 15 Strength saving throw or fall prone.\n   The sword also functions as a wand of enemy detection. It regains all of its expended charges at dawn and isn't at risk of crumbling if its last charge is used.\n   " + toUni("Sentience") + ". Waythe is a sentient weapon of neutral good alignment, with an Intelligence of 12, a Wisdom of 2, and a Charisma of 14. It has hearing and darkvision out to a range of 120 feet.\n   The weapon can speak and understand Giant and Common, and it can communicate telepathically with its wielder.\n   " + toUni("Personality") + ". This sword believes in freedom and allowing others to live as they see fit. It is protective of its friends, and wants to be friends with a like-minded wielder. (It takes only 1 minute for a good-aligned character to gain attunement with the sword.) Waythe is courageous to the point of foolhardiness, however, and vocally urges bold action. It is likely to come into conflict with an evil or a timid wielder.",
	attunement : true,
	weight : 6,
	weaponsAdd : ["Waythe"],
	weaponOptions : {
		baseWeapon : "greatsword",
		regExpSearch : /waythe/i,
		name : "Waythe",
		source : ["TftYP", 229],
		description : "Heavy, two-handed; +2d6 damage vs. giants; Giants DC 15 Str save or fall prone",
		modifiers : [1,1]
	},
	usages : 7,
	recovery : "dawn",
	additional : "regains 1d6+1",
	action : [["action", ""]],
	toNotesPage : [{
		name : "Features",
		popupName : "Features of the Waythe",
		note : desc([
			"It takes only 1 minute for a good-aligned character to gain attunement with this sword.",
			"I gain a +1 bonus to attack and damage rolls made with this magic greatsword. When I hit a creature of the giant type with it, it deals an extra 2d6 slashing damage, and the giant must succeed on a DC 15 Strength saving throw or fall prone.",
			"Waythe has 7 charges and regains 1d6+1 expended charges daily at dawn. As an action while holding it, I can expend 1 charge to speak its command word. For the next minute, I know the direction of the nearest creature hostile to me within 60 ft, but not its distance from me. Waythe can sense the presence of hostile creatures that are ethereal, invisible, disguised, or hidden, as well as those in plain sight. The effect ends if I stop holding Waythe.",
			"Waythe is a sentient weapon of neutral good alignment, with an Intelligence of 12, a Wisdom of 2, and a Charisma of 14. It has hearing and darkvision out to a range of 120 feet, can speak and understand Giant and Common, and can communicate telepathically with its wielder.",
			"Waythe believes in freedom and allowing others to live as they see fit. It is protective of its friends, and wants to be friends with a like-minded wielder. Waythe is courageous to the point of foolhardiness, however, and vocally urges bold action. It is likely to come into conflict with an evil or a timid wielder."
		]) + "\n\n" + sentientItemConflictTxt
	}]
}
MagicItemsList["white dragonhide cape"] = { // worn by king Snurre
	name : "White Dragonhide Cape",
	source : ["TftYP", 193],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "I have resistance to cold damage while wearing this cape",
	descriptionFull : "This magic cape grants the wearer resistance to cold damage.",
	dmgres : ["Cold"]
}
MagicItemsList["spellcasting bolts"] = {
	name : "Spellcasting Bolts",
	source : ["TftYP", 209],
	type : "weapon (crossbow bolts)",
	rarity : "rare",
	magicItemTable : "B",
	description : "These magical crossbow bolts cast a spell on the target they are used on.",
	descriptionFull : "These magical crossbow bolts cast a spell on the target they are used on. The spell has a save DC of 15 and a duration of 1 minute.",
	choices : ["Bolt of Holding", "Bolt of Blinding", "Bolt of Vapors"],
	"bolt of holding" : {
		name : "Bolt of Holding",
		description : "This magic crossbow bolt casts Hold Person on the target hit with it, as well as up to two others within 30 ft of that target. The targets must succeed on a DC 15 Wisdom save or be paralyzed for 1 minute. At the end of each of their turns, they can make another Wisdom save to end the effect on themselves.",
		descriptionFull : "This magic bolt casts hold person on the target hit with it, as well as up to two other targets within 30 feet of that target. The spell has a spell save DC of 15 and a duration of 1 minute."
	},
	"bolt of blinding" : {
		name : "Bolt of Blinding",
		description : "This magic bolt casts Blindness/Deafness on the target hit with it, as well as up to two others within 30 ft of that target. The targets must make a DC 15 Con save or be blinded or deafened (my choice) for 1 minute. At the end of each of their turns, a target can make another Con save to end the effect on itself.",
		descriptionFull : "This magic bolt casts blindness/deafness to blind on a target hit with the bolt, as well as up to two other targets within 30 feet of that target. The spell has a spell save DC of 15 and a duration of 1 minute."
	},
	"bolt of vapors" : {
		name : "Bolt of Vapors",
		description : "This magic crossbow bolt casts Stinking Cloud centered on the point it hits, creating a 20-ft radius sphere of yellow, nauseating gas there for 1 minute. It heavily obscures and creatures fully in the cloud or starting their turn in it must make a DC 15 Con save against poison or spend their action that turn retching.",
		descriptionFull : "This magic bolt casts stinking cloud centered on the point it hits. The spell has a spell save DC of 15 and a duration of 1 minute."
	}
}
MagicItemsList["berserker battleaxe (tamoachan)"] = {
	name : "Berserker Battleaxe (Tamoachan)", // can't just be "Berserker Battleaxe" or the magic item "Berserker Axe" wouldn't work anymore
	source : ["TftYP", 68], // Tloques' battleaxe
	type : "weapon (battleaxe)",
	rarity : "very rare",
	magicItemTable : "H",
	description : "This axe gives +2 to hit and damage, +1 HP per level, and has 12 charges to cast spells, regaining 1d6+4 at dawn. I can't part with it, have disadv. with other weapons, and if I'm damaged by a hostile, I must make a DC 15 Wis save or go berserk: attack the closest creature with the axe until none remain within 60 ft.",
	descriptionLong : "This axe adds a +2 bonus to attack and damage rolls made with it. While attuned to it, my HP maximum increases by 1 for each level I have. It has scrolls of Passwall, Burning Hands, and Gust of Wind beneath the wrappings of its handle. As long as these remain there, it has 12 charges to cast these spells, regaining 1d6+4 at dawn. It is cursed, making it so that I can't part with it and have disadvantage on attack rolls made with other weapons. If I'm damaged by a hostile, I must make a DC 15 Wis save or go berserk, using my action each turn to attack the closest creature with the axe until none remain within 60 ft.",
	descriptionFull : "This battleaxe has a blade of bronze, and the haft is wound with snakeskin wrappings. You gain a +2 bonus to attack and damage rolls made with this magic weapon. In addition, while you are attuned to this weapon, your hit point maximum increases by 1 for each level you have attained.\n   Concealed beneath the wrappings around the handle is a parchment containing the spells passwall, burning hands, and gust of wind. When the attuned wielder uses an action to say the correct words of power, which are engraved in Olman on the axe blade, one of these spells can be cast.\n   The axe has 12 charges and regains 1d6+4 expended charges daily at dawn. Casting a spell from it takes a number of charges equal to the level at which the spell is cast (5th for passwall, 2nd for gust of wind, and 1st or higher for burning hands; spell save DC 15). If the parchment is removed from the axe, the axe loses the capability of casting these spells forever.\n   " + toUni("Curse") + ". This axe is cursed, and becoming attuned to it extends the curse to you. As long as you remain cursed, you are unwilling to part with the axe, keeping it within reach at all times. You also have disadvantage on attack rolls with weapons other than this one, unless no foe is within 60 feet of you that you can see or hear.\n   Whenever a hostile creature damages you while the axe is in your possession, you must succeed on a DC 15 Wisdom saving throw or go berserk. While berserk, you must use your action each round to attack the creature nearest to you with the axe. If you can make extra attacks as part of the Attack action, you use those extra attacks, moving to attack the next nearest creature after you fell your current target. If you have multiple possible targets, you attack one at random. You are berserk until you start your turn with no creatures within 60 feet of you that you can see or hear.",
	attunement : true,
	weight : 4,
	usages : 12,
	recovery : "dawn",
	additional : "regains 1d6+4",
	limfeaname : "Berserker Battleaxe",
	fixedDC : 15,
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1+ charges",
		spells : ["burning hands"],
		selection : ["burning hands"],
		firstCol : "1+"
	}, {
		name : "2 charges",
		spells : ["gust of wind"],
		selection : ["gust of wind"],
		firstCol : 2
	}, {
		name : "5 charges",
		spells : ["passwall"],
		selection : ["passwall"],
		firstCol : 5
	}],
	spellChanges : {
		"burning hands" : {
			description : "3d6 Fire dmg +1d6 per charge spend after the 1st; save halves; unattended flammable objects ignite",
			changes : "The spell level this is cast at depends on the amount of charges spend, 1 charge per spell slot level."
		}
	},
	calcChanges : {
		hp : function (totalHD) { return [totalHD]; }
	},
	weaponsAdd : ["Berserker Battleaxe"],
	weaponOptions : {
		baseWeapon : "battleaxe",
		regExpSearch : /^(?=.*berserker)(?=.*battleaxe).*$/i,
		name : "Berserker Battleaxe",
		source : ["TftYP", 68],
		description : "Versatile (1d10); Cursed",
		modifiers : [2,2]
	}
}
MagicItemsList["plantslayer longsword"] = {
	name : "Plantslayer Longsword",
	source : ["TftYP", 70], // from Stone Statue
	type : "weapon (longsword)",
	rarity : "rare",
	magicItemTable : "F",
	description : "This sword is made of laminated wood, inset with jagged teeth of obsidian. I gain a +1 bonus to attack and damage rolls made with this magic weapon. In addition, it deals an extra 2d6 damage to any creature of the plant type.",
	descriptionFull : "This sword is made of laminated wood, inset with jagged teeth of obsidian. You gain a +1 bonus to attack and damage rolls made with this magic weapon. In addition, it deals an extra 2d6 damage to any creature of the plant type.",
	weight : 3,
	weaponsAdd : ["Plantslayer Longsword"],
	weaponOptions : {
		baseWeapon : "longsword",
		regExpSearch : /^(?=.*plantslayer)(?=.*longsword).*$/i,
		name : "Plantslayer Longsword",
		source : ["TftYP", 70],
		description : "Versatile (1d10); +2d6 damage vs. plants"
	}
}
var iFileName = "pub_20170915_Tortle.js";
RequiredSheetVersion(13);
// This file adds the Tortle Race from the Tortle Package from DMs Guild to MPMB's Character Record Sheet

// Define the source
SourceList.TP={
	name : "Tortle Package",
	abbreviation : "TP",
	group : "Adventurers League",
	url : "https://www.dmsguild.com/product/221716/",
	date : "2017/09/15"
};

// The Tortle race
RaceList["tortle"] = {
	regExpSearch : /tortle/i,
	name : "Tortle",
	source : ["TP", 4],
	plural : "Tortles",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Aquan"],
	skills : ["Survival"],
	armorOptions : {
		regExpSearch : /^(?=.*tortle)(?=.*shell).*$/i,
		name : "Tortle's Shell",
		source : ["TP", 4],
		ac : 17,
		dex : -10
	},
	armorAdd : "Tortle's Shell",
	weaponOptions : {
		baseWeapon : "unarmed strike",
		regExpSearch : /^(?=.*tortle)(?=.*\bclaws?\b).*$/i,
		name : "Tortle's Claws",
		source : ["TP", 4],
		damage : [1, 4, "slashing"]
	},
	weaponsAdd : ["Tortle's Claws"],
	age : " reach adulthood by the age of 15 and live an average of 50 years",
	height : " stand between 5 and 6 feet tall",
	weight : " weigh around 450 lb",
	heightMetric : " stand between 1,5 and 1,8 metres tall",
	weightMetric : " weigh around 200 kg",
	scores : [2, 0, 0, 0, 1, 0],
	features : {
		"shell defense" : {
			name : "Shell Defense",
			minlevel : 1,
			action : ["action", ""]
		}
	},
	trait : "Tortle (+2 Strength, +1 Wisdom)\nClaws: I can use my claws to make unarmed strikes dealing 1d4 slashing damage.\nHold Breath: I can hold my breath for up to 1 hour at a time.\nNatural Armor: I have a base AC of 17, but I can't add my Dex to it or wear armour.\nShell Defense: As an action, I can withdraw into my shell and gain +4 AC and adv. on Str and Con saves, but I count as prone, have speed 0, have disadv. on Dex saves, and can't take reactions. The only action I can take is a bonus action to emerge from the shell."
};
var iFileName = "pub_20170919_ToA.js";
RequiredSheetVersion(12.999);
// This file adds the backgrounds and beasts from the Tomb of Annihilation adventure book to MPMB's Character Record Sheet

// Define the source
SourceList.ToA={
	name : "Tomb of Annihilation [backgrounds, beasts, items]",
	abbreviation : "ToA",
	group : "Adventure Books",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/tomb-annihilation",
	date : "2017/09/19"
};

// Backgrounds (with contributions by SoilentBrad and @lowbrr)
BackgroundList["anthropologist"] = {
	regExpSearch : /anthropologist/i,
	name : "Anthropologist",
	source : [["ToA", 191], ["ALbackground", 0]],
	skills : ["Insight", "Religion"],
	gold : 10,
	equipleft : [
		["Leather-bound diary", "", 5],
		["Ink, 1 ounce bottle of", 1, ""],
		["Ink pen (quill)", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Trinket of special significance", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Adept Linguist",
	trait : [
		"I prefer the company of those who aren't like me, including people of other races.",
		"I'm a stickler when it comes to observing proper etiquette and local customs.",
		"I would rather observe than meddle.",
		"By living among violent people, I have become desensitized to violence.",
		"I would risk life and limb to discover a new culture or unravel the secrets of a dead one.",
		"When I arrive at a new settlement for the first time, I must learn all its customs."
	],
	ideal : [
		["Discovery",
			"Discovery: I want to be the first person to discover a lost culture. (Any)"
		],
		["Distance",
			"Distance: One must not interfere with the affairs of another culture \u2015 even one in need of aid. (Lawful)"
		],
		["Knowledge",
			"Knowledge: By understanding other races and cultures, we learn to understand ourselves. (Any)"
		],
		["Power",
			"Power: Common people crave strong leadership, and I do my utmost to provide it. (Lawful)"
		],
		["Protection",
			"Protection: I must do everything possible to save a society facing extinction. (Good)"
		],
		["Indifferent",
			"Indifferent: Life is cruel. What's the point in saving people if they're going to die anyway? (Chaotic)"
		],
	],
	bond : [
		"My mentor gave me a journal filled with lore and wisdom. Losing it would devastate me.",
		"Having lived among the people of a primeval tribe or clan, I long to return and see how they are faring.",
		"Years ago, tragedy struck the members of an isolated society I befriended, and I will honor them.",
		"I want to learn more about a particular humanoid culture that fascinates me.",
		"I seek to avenge a clan, tribe, kingdom, or empire that was wiped out.",
		"I have a trinket that I believe is the key to finding a long-lost society."
	],
	flaw : [
		"Boats make me seasick.",
		"I talk to myself, and I don't make friends easily.",
		"I believe that I'm intellectually superior to people from other cultures and have much to teach them.",
		"I've picked up some unpleasant habits living among goblins, lizardfolk, or orcs.",
		"I complain about everything.",
		"I wear a tribal mask and never take it off."
	],
	extra : [
		"Select an Adopted Culture",
		"Aarakocra",
		"Dwarf",
		"Elf",
		"Goblin",
		"Halfling",
		"Human",
		"Lizardfolk",
		"Orc",
	],
	languageProfs : [2]
};
BackgroundList["archaeologist"] = {
	regExpSearch : /archa?eologist/i,
	name : "Archaeologist",
	source : [["ToA", 192], ["ALbackground", 0]],
	skills : ["History", "Survival"],
	gold : 25,
	equipleft : [
		["Map case with a map of a ruin/dungeon", "", 1],
		["Bullseye lantern", "", 2],
		["Miner's pick", "", 10],
		["Shovel", "", 5],
		["Two-person tent", "", 20]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Trinket recovered from a dig site", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Historical Knowledge",
	trait : [
		"I love a good puzzle or mystery.",
		"I'm a pack rat who never throws anything away.",
		"Fame is more important to me than money.",
		"I have no qualms about stealing from the dead.",
		"I'm happier in a dusty old tomb than I am in the centers of civilization.",
		"Traps don't make me nervous. Idiots who trigger traps make me nervous.",
		"I might fail, but I will never give up.",
		"You might think I'm a scholar, but I love a good brawl. These fists were made for punching."
	],
	ideal : [
		["Preservation",
			"Preservation: That artifact belongs in a museum. (Good)"
		],
		["Greed",
			"Greed: I won't risk my life for nothing. I expect some kind of payment. (Any)"
		],
		["Death Wish",
			"Death Wish: Nothing is more exhilarating than a narrow escape from the jaws of death. (Chaotic)"
		],
		["Dignity",
			"Dignity: The dead and their belongings deserve to be treated with respect. (Lawful)"
		],
		["Immortality",
			"Immortality: All my exploring is part of a plan to find the secret of everlasting life. (Any)"
		],
		["Danger",
			"Danger: With every great discovery comes grave danger. The two walk hand in hand. (Any)"
		]
	],
	bond : [
		"Ever since I was a child, I've heard stories about a lost city. I aim to find it, learn its secrets, and earn my place in the history books.",
		"I want to find my mentor, who disappeared on an expedition some time ago.",
		"I have a friendly rival. Only one of us can be the best, and I aim to prove it's me.",
		"I won't sell an art object or other treasure that has historical significance or is one of a kind.",
		"I'm secretly in love with the wealthy patron who sponsors my archaeological exploits.",
		"I hope to bring prestige to a library, a museum, or a university."
	],
	flaw : [
		"I have a secret fear of some common wild animal \u2015 and in my work, I see them everywhere.",
		"I can't leave a room without searching it for secret doors.",
		"When I'm not exploring dungeons or ruins, I get jittery and impatient.",
		"I have no time for friends or family. I spend every waking moment thinking about and preparing for my next expedition.",
		"When given the choice of going left or right, I always go left.",
		"I can't sleep except in total darkness."
	],
	extra : [
		"Select a Signature Item",
		"10-foot pole",
		"Crowbar",
		"Hat",
		"Hooded lantern",
		"Medallion",
		"Shovel",
		"Sledgehammer",
		"Whip"
	],
	toolProfs : [["Cartographer or navigator tools", 1]],
	languageProfs : [1]
};

// Background features (with contributions by SoilentBrad and @lowbrr)
BackgroundFeatureList["adept linguist"] = {
	description : "I can communicate with humanoids who don't speak any language I know. I must observe the humanoids interacting with one another for at least one day, after which I learn a handful of important words, expressions, and gestures \u2015 enough to communicate on a rudimentary level.",
	source : [["ToA", 191], ["ALbackground", 0]]
};
BackgroundFeatureList["historical knowledge"] = {
	description : "When I enter a ruin or dungeon, I can correctly ascertain its original purpose and determine its builders, whether those were dwarves, elves, humans, yuan-ti, or some other known race. In addition, I can determine the monetary value of art objects more than a century old.",
	source : [["ToA", 192], ["ALbackground", 0]]
};

// Weapon
WeaponsList["yklwa"] = {
	regExpSearch : /yklwa/i,
	name : "Yklwa",
	source : ["ToA", 32],
	list : "melee",
	ability : 1,
	type : "Simple",
	damage : [1, 8, "piercing"],
	range : "Melee, 10/30 ft",
	weight : 3,
	description : "Thrown",
	monkweapon : true,
	abilitytodamage : true
};

// Gear
GearList["rain catcher"] = {
	infoname : "Rain catcher [1 gp]",
	name : "Rain catcher",
	source : ["ToA", 32],
	amount : 1,
	weight : 5
};
GearList["insect repellent salve"] = {
	infoname : "Salve (vial) [5 sp]",
	name : "Insect Repellent Salve, applications of",
	source : ["ToA", 32],
	amount : 20,
	weight : "",
	type : "insect repellent"
};
GearList["insect repellent incense"] = {
	infoname : "Incense (block) [1 gp]",
	name : "Insect Repellent Incense, blocks of",
	source : ["ToA", 32],
	amount : 1,
	weight : "",
	type : "insect repellent"
};

// Creatures
CreatureList["brontosaurus"] = {
	name : "Brontosaurus",
	source : [["V", 139], ["ToA", 215]],
	size : 0, //Gargantuan
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 15,
	hp : 121,
	hd : [9, 20], //[#, die]
	speed : "30 ft",
	scores : [21, 9, 17, 2, 10, 7], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", 6, "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "",
	passivePerception : 10,
	languages : "",
	challengeRating : "5",
	proficiencyBonus : 3,
	attacksAction : 1,
	attacks : [{
			name : "Stomp",
			ability : 1,
			damage : [5, 8, "bludgeoning"], //[#, die, type] "" for die is allowed
			range : "Melee (20 ft)",
			description : "Target must succeed on a DC 14 Strength saving throw or be knocked prone"
		}, {
			name : "Tail",
			ability : 1,
			damage : [6, 8, "bludgeoning"], //[#, die, type] "" for die is allowed
			range : "Melee (20 ft)",
			description : ""
		}
	]
};
CreatureList["deinonychus"] = {
	name : "Deinonychus",
	source : [["V", 139], ["ToA", 217]],
	size : 3, //Medium
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 13,
	hp : 26,
	hd : [4, 8], //[#, die]
	speed : "40 ft",
	scores : [15, 15, 14, 4, 12, 6], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 3
	},
	senses : "",
	passivePerception : 13,
	languages : "",
	challengeRating : "1",
	proficiencyBonus : 2,
	attacksAction : 3,
	attacks : [{
			name : "Claw",
			ability : 1,
			damage : [1, 8, "slashing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "Two claw and one bite as one Attack action; If used after moving 20 ft straight in the same round, see Pounce trait"
		}, {
			name : "Bite",
			ability : 1,
			damage : [1, 8, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "Two claw and one bite as one Attack action (also, see Pounce trait)"
		}
	],
	traits : [{
			name : "Multiattack",
			description : "The deinonychus makes three attacks: two with its claws and one with its bite."
		}, {
			name : "Pounce",
			description : "If the deinonychus moves at least 20 ft straight toward a creature and then hits it with a claw attack on the same turn, that target must succeed on a DC 12 Strength saving throw or be knocked prone. If the target is prone, the deinonychus can make one bite attack against it as a bonus action."
		}
	]
};
CreatureList["dimetrodon"] = {
	name : "Dimetrodon",
	source : [["V", 139], ["ToA", 217]],
	size : 3, //Medium
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 12,
	hp : 19,
	hd : [3, 8], //[#, die]
	speed : "30 ft, swim 20 ft",
	scores : [14, 10, 15, 2, 10, 5], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 2
	},
	senses : "",
	passivePerception : 12,
	languages : "",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Bite",
			ability : 1,
			damage : [2, 6, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : ""
		}
	]
};
CreatureList["hadrosaurus"] = {
	name : "Hadrosaurus",
	source : [["V", 140], ["ToA", 224]],
	size : 2, //Large
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 11,
	hp : 19,
	hd : [3, 10], //[#, die]
	speed : "40 ft",
	scores : [15, 10, 13, 2, 10, 5], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 2
	},
	senses : "",
	passivePerception : 12,
	languages : "",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Tail",
			ability : 1,
			damage : [1, 10, "bludgeoning"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : ""
		}
	]
};
CreatureList["quetzalcoatlus"] = {
	name : "Quetzalcoatlus",
	source : [["V", 140], ["ToA", 230]],
	size : 1, //Huge
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 13,
	hp : 30,
	hd : [4, 12], //[#, die]
	speed : "10 ft, fly 80 ft",
	scores : [15, 13, 13, 2, 10, 5], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 2
	},
	senses : "",
	passivePerception : 12,
	languages : "",
	challengeRating : "2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Bite",
			ability : 1,
			damage : [3, 6, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (10 ft)",
			description : "If used after diving 30 ft towards a target, the attack deals 3d6 extra damage (Dive Attack)"
		}
	],
	traits : [{
			name : "Dive Attack",
			description : "If the quetzalcoatlus is flying and dives at least 30 ft toward a creature and then hits it with a bite attack, the attack deals an extra 10 (3d6) damage to the target."
		}, {
			name : "Flyby",
			description : "The quetzalcoatlus doesn't provoke opportunity attacks when it flies out of an enemy's reach."
		}
	]
};
CreatureList["stegosaurus"] = {
	name : "Stegosaurus",
	source : [["V", 140], ["ToA", 231]],
	size : 1, //Huge
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 13,
	hp : 76,
	hd : [8, 12], //[#, die]
	speed : "40 ft",
	scores : [20, 9, 17, 2, 11, 5], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	senses : "",
	passivePerception : 10,
	languages : "",
	challengeRating : "4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Bite",
			ability : 1,
			damage : [6, 6, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (10 ft)",
			description : ""
		}
	]
};
CreatureList["velociraptor"] = {
	name : "Velociraptor",
	source : [["V", 140], ["ToA", 235]],
	size : 5, //Tiny
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 13,
	hp : 10,
	hd : [3, 4], //[#, die]
	speed : "30 ft",
	scores : [6, 14, 13, 4, 12, 6], //[Str, Dex, Con, Int, Wis, Cha]
	saves : ["", "", "", "", "", ""], //[Str, Dex, Con, Int, Wis, Cha]
	skills : {
		"perception" : 3
	},
	senses : "",
	passivePerception : 13,
	languages : "",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
			name : "Bite",
			ability : 2,
			damage : [1, 6, "piercing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "One bite and one claw attack as an Attack action"
		}, {
			name : "Claw",
			ability : 2,
			damage : [1, 4, "slashing"], //[#, die, type] "" for die is allowed
			range : "Melee (5 ft)",
			description : "One bite and one claw attack as an Attack action"
		}
	],
	traits : [{
			name : "Pack Tactics",
			description : "The velociraptor has advantage on an attack roll against a creature if at least one of the velociraptor's allies is within 5 ft of the creature and the ally isn't incapacitated."
		}
	]
};
// The following creatures were transcribed with the help of SoilentBrand and @lowbrr
CreatureList["almiraj"] = {
	name : "Almiraj",
	source : ["ToA", 211],
	size : 4, //Small
	type : "Beast",
	subtype : "",
	companion : sheetVersion >= 13 ? "familiar_not_al" : "familiar",
	alignment : "Unaligned",
	ac : 13,
	hp : 3,
	hd : [1, 6],
	speed : "50 ft",
	scores : [2, 16, 10, 2, 14, 10],
	saves : ["", "", "", "", "", ""],
	skills : {
		"perception" : 4,
		"stealth" : 5,
	},
	senses : "Darkvision 30 ft; Adv. on Wis (Perception) checks using hearing/sight",
	passivePerception : 14,
	languages : "",
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Horn",
			ability : 2,
			damage : [1, 4, "piercing"],
			range : "Melee (5 ft)",
			description : ""
		}
	],
	traits : [{
			name : "Keen Senses",
			description : "The almiraj has advantage on Wisdom (Perception) checks that rely on hearing or sight."
		}
	],
};
CreatureList["flying monkey"] = {
	name : "Flying Monkey",
	source : ["ToA", 220],
	size : 4, //Small
	type : "Beast",
	subtype : "",
	companion : sheetVersion >= 13 ? "familiar_not_al" : "familiar",
	alignment : "Unaligned",
	ac : 12,
	hp : 3,
	hd : [1, 6],
	speed : "30 ft, climb 20 ft, fly 30 ft",
	scores : [8, 14, 11, 5, 12, 6],
	saves : ["", "", "", "", "", ""],
	senses : "",
	passivePerception : 11,
	languages : "",
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Bite",
			ability : 1,
			damage : [1, 4, "piercing"],
			range : "Melee (5 ft)",
			description : ""
		}
	],
	traits : [{
			name : "Pack Tactics",
			description : "The flying monkey has advantage on an attack roll against a creature if at least one of the monkey's allies is within 5 ft of the creature and the ally isn't incapacitated."
		}
	],
};
CreatureList["giant snapping turtle"] = {
	name : "Giant Snapping Turtle",
	source : ["ToA", 222],
	size : 2, //Large
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 17,
	hp : 75,
	hd : [10, 10],
	speed : "30 ft, swim 40 ft",
	scores : [19, 10, 14, 2, 12, 5],
	saves : ["", "", "", "", "", ""],
	senses : "Darkvision 60 ft",
	passivePerception : 11,
	languages : "",
	challengeRating : "3",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Bite",
			ability : 1,
			damage : [4, 6, "slashing"],
			range : "Melee (5 ft)",
			description : ""
		}
	],
	traits : [{
			name : "Amphibious",
			description : "The turtle can breathe air and water."
		}, {
			name : "Stable",
			description : "Whenever an effect knocks the turtle prone, it can make a DC 10 Constitution saving throw to avoid being knocked prone. A prone turtle is upside down. To stand up, it must succeed on a DC 10 Dexterity check on its turn and then use all its movement for that turn. While prone, the turtle's AC becomes 12."
		}
	]
};
CreatureList["jaculi"] = {
	name : "Jaculi",
	source : ["ToA", 225],
	size : 2, //Large
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 14,
	hp : 16,
	hd : [3, 10],
	speed : "30 ft, climb 20 ft",
	scores : [15, 14, 11, 2, 8, 3],
	saves : ["", "", "", "", "", ""],
	skills : {
		"athletics" : 4,
		"perception" : 1,
		"stealth" : 4
	},
	senses : "Blindsight 30 ft; Adv. on Wis (Perception) checks using smell",
	passivePerception : 11,
	languages : "",
	challengeRating : "1/2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Bite",
			ability : 1,
			damage : [2, 6, "piercing"],
			range : "Melee (5 ft)",
			description : "If used after at least 10 ft jump, adv. on to hit and extra 2d6 damage, see Spring trait"
		}
	],
	actions : [{
			name : "Spring",
			description : "The jaculi springs up to 30 feet in a straight line and makes a bite attack against a target within its reach. This attack has advantage if the jaculi springs at least 10 feet. If the attack hits, the bite deals an extra 7 (2d6) piercing damage."
		}
	],
	traits : [{
			name : "Camouflage",
			description : "The jaculi has advantage on Dexterity (Stealth) checks made to hide."
		}, {
			name : "Keen Smell",
			description : "The jaculi has advantage on Wisdom (Perception) checks that rely on smell."
		}
	],
	wildshapeString : "\u25C6 Senses: Blindsight 30 ft.\n\u25C6 Camouflage: advantage on Dexterity (Stealth) checks made to hide.\n\u25C6 Keen Smell: advantage on Wisdom (Perception) checks that rely on smell.\n\u25C6 Spring: 30 ft in a straight line and make a bite attack. Advantage on the attack roll if springing at least 10 ft. It deals an extra 7 (2d6) piercing damage on a hit."
};

// Magic Items
MagicItemsList["amulet of the black skull"] = {
	name : "Amulet of the Black Skull",
	source : ["ToA", 206],
	type : "wondrous item",
	rarity : "very rare",
	magicItemTable : "G",
	description : "The obsidian amulet has 6 charges, regaining 1d6 at dawn. As an action, I can expend a charge to teleport to a location within 100 ft that I'm familiar with. If I'm not undead, I must make a DC 16 Con save whenever I do so and if I fail, I'm transformed (see table on Notes page) as I arrive at the destination.",
	descriptionFull : "This amulet is carved from obsidian and shaped like a screaming humanoid skull, with ruby eyes and emeralds for teeth. It hangs from an iron chain necklace.\n   The amulet has 6 charges and regains 1d6 charges daily at dawn. While wearing the amulet, you can use an action to expend 1 of its charges to transport yourself and anything you are wearing or carrying to a location within 100 feet of you. The destination you choose doesn't need to be in your line of sight, but it must be familiar to you (in other words, a place you have seen or visited), and it must be on the same plane of existence as you. This effect isn't subject to the magic restrictions placed on the Tomb of the Nine Gods; thus, the amulet can be used to enter and exit the tomb.\n   If you aren't undead, you must make a DC 16 Constitution saving throw each time you use the amulet to teleport. On a failed saving throw, the black skull cackles as you are transformed in transit. The transformation takes effect as soon as you arrive at the destination, and is determined randomly by rolling percentile dice and consulting the Black Skull Transformation table.\n\n" + toUni("d100\tTransformation") + "\n01-20\tThe symbol of Acererak is burned into your flesh, a curse that can only be removed with a Remove Curse spell or similar magic. Until the curse ends, your hit points can't be restored by magic.\n21-35\tYou grow larger as if affected by an Enlarge/Reduce spell, except the effect lasts for 1 hour.\n36-50\tYou grow smaller as if affected by an Enlarge/Reduce spell, except the effect lasts for 1 hour.\n51-70\tYou arrive at the destination wearing nothing but the amulet of the black skull. Everything else that you were wearing or carrying appears in a random unoccupied space within 100 feet of you.\n71-95\tYou are paralyzed for 1 minute or until this effect is ended with a Lesser Restoration spell or similar magic.\n96-00\tYou become petrified. This effect can be ended only with a Greater Restoration spell or similar magic.",
	attunement : true,
	weight : 1,
	action : [["action", ""]],
	usages : 6,
	recovery : "dawn",
	additional : "regains 1d6",
	toNotesPage : [{
		name : "Transformation Table",
		popupName : "Amulet of the Black Skull Transformation Table",
		note : [
			"This amulet is carved from obsidian and shaped like a screaming humanoid skull, with ruby eyes and emeralds for teeth. It hangs from an iron chain necklace.",
			"If I'm not undead, I must make a DC 16 Constitution save each time I use the amulet to teleport. On a failure, the black skull cackles as I'm transformed in transit. The transformation is random (see table below) and takes effect as soon as I arrive at the destination.",
			"d100\tTRANSFORMATION",
			"01-20\tThe symbol of Acererak is burned into my flesh, a curse that can only be removed with a Remove Curse spell or similar magic. Until the curse ends, my hit points can't be restored by magic.",
			"21-35\tI grow larger as if affected by an Enlarge/Reduce spell, except the effect lasts for 1 hour.",
			"36-50\tI grow smaller as if affected by an Enlarge/Reduce spell, except the effect lasts for 1 hour.",
			"51-70\tI arrive at the destination wearing nothing but the amulet of the black skull. Everything else that I was wearing or carrying appears in a random unoccupied space within 100 ft.",
			"71-95\tI am paralyzed for 1 minute or until this effect is ended with a Lesser Restoration spell or similar magic.",
			"96-00\tI become petrified. This effect can be ended only with a Greater Restoration spell or similar magic."
		]
	}]
}
MagicItemsList["bookmark"] = {
	name : "Bookmark",
	source : ["ToA", 206],
	type : "weapon (dagger)",
	rarity : "legendary",
	notLegalAL : true,
	description : "This dagger adds +3 to hit and damage. As a bonus action while holding it, I can have it shed bright light in a 20-ft radius and dim light for another 20 ft, go dark, act as a compass, cast Dimension Door once per dawn, or cast Compulsion once per dawn, which effects only spiders of the beast type within 90 ft.",
	descriptionFull : "This +3 dagger belongs to Artus Cimber. While you have the dagger drawn, you can use a bonus action to activate one of the following properties:\n \u2022 Cause a blue gem set into the dagger's pommel to shed bright light in a 20-foot radius and dim light for an additional 20 feet, or make the gem go dark.\n \u2022 Turn the dagger into a compass that, while resting on your palm, points north.\n \u2022 Cast Dimension Door from the dagger. Once this property is used, it can't be used again until the next dawn.\n \u2022 Cast Compulsion (save DC 15) from the dagger. The range of the spell increases to 90 feet but it targets only spiders that are beasts. Once this property is used, it can't be used again until the next dawn.",
	attunement : true,
	weight : 1,
	action : [["bonus action", ""]],
	weaponsAdd : ["Bookmark"],
	weaponOptions : {
		baseWeapon : "dagger",
		regExpSearch : /bookmark/i,
		name : "Bookmark",
		source : ["ToA", 206],
		modifiers : [3, 3]
	},
	extraLimitedFeatures : [{
		name : "Compulsion (Bookmark)",
		usages : 1,
		recovery : "dawn"
	}, {
		name : "Dimension Door (Bookmark)",
		usages : 1,
		recovery : "dawn"
	}],
	fixedDC : 15,
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["compulsion", "dimension door"],
		selection : ["compulsion", "dimension door"],
		firstCol : "oncelr",
		times : 2
	},
	spellChanges : {
		"compulsion" : {
			time : "1 bns",
			range : "90 ft",
			description : "Any spiders that hear me save or I can, as bns, have it move fully in a direction; save again after move",
			changes : "Using Bookmark, I can cast this as a bonus action with a range of 90 ft, but it can only target spiders with the beast type."
		}
	}
}
MagicItemsList["ghost lantern"] = {
	name : "Ghost Lantern",
	source : ["ToA", 206],
	type : "wondrous item",
	rarity : "legendary",
	magicItemTable : "C",
	description : "As a bonus action, I can command the spirit in the lantern to shed bright light in 30-ft radius and dim light for another 30 ft. I can order the spirit to act as my Mage Hand. If I fall unconscious within 10 ft of the lantern, the spirit stabilizes me. Casting Dispel Evil and Good on it releases the spirit and makes it nonmagical.",
	descriptionFull : "A restless spirit is trapped inside this lantern. While holding the lantern, you can command the spirit as a bonus action to shed bright light in a 30-foot radius and dim light for an additional 30 feet.\n   While holding the lantern, you can use an action to order the spirit to leave the lantern and duplicate the effect of the Mage Hand spell. The spirit returns to the lantern when the spell ends.\n   If you fall unconscious within 10 feet of the lantern, the spirit emerges from it, magically stabilizes you with a touch, and then quickly returns to the lantern.\n   The spirit is bound to the lantern and can't be harmed, turned, or raised from the dead.\n   Casting a Dispel Evil and Good spell on the lantern releases the spirit to the afterlife and renders the lantern nonmagical.",
	attunement : true,
	weight : 1,
	action : [["bonus action", ""]],
	spellcastingBonus : {
		name : "At will",
		spells : ["mage hand"],
		selection : ["mage hand"],
		firstCol : "atwill"
	}
}
MagicItemsList["mask of the beast"] = {
	name : "Mask of the Beast",
	source : ["ToA", 207],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "C",
	description : "This wooden mask is shaped in the likeness of a beast's visage and has 3 charges. While wearing the mask I can expend 1 charge and use the mask to cast the Animal Friendship spell as an action. The mask regains all expended charges at dawn.",
	descriptionFull : "This wooden mask is shaped in the likeness of a beast's visage and has 3 charges. While wearing the mask you can expend 1 charge and use the mask to cast the Animal Friendship spell as an action. The mask regains all expended charges at dawn.",
	weight : 1,
	usages : 3,
	recovery : "dawn",
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["animal friendship"],
		selection : ["animal friendship"],
		firstCol : 1
	}
}
MagicItemsList["scorpion armor"] = {
	name : "Scorpion Armor",
	source : ["ToA", 208],
	type : "armor (plate)",
	rarity : "rare",
	magicItemTable : "I",
	description : "This suit of plate armor fashioned from giant scorpion chitin doesn't impose disadv. on stealth or saves against extreme heat. It gives me +5 bonus on initiative while I'm not incapacitated. Whenever I don or doff it, I take 10d10+45 poison damage, DC 15 Con save halves. Only a Wish can remove this curse.",
	descriptionFull : "This suit of plate armor is fashioned from giant scorpion chitin. While wearing this armor, you gain the following benefits:\n \u2022 The armor improves your combat readiness, granting you a +5 bonus to initiative as long as you aren't incapacitated.\n \u2022 The armor doesn't impose disadvantage on your Dexterity (Stealth) checks.\n \u2022 The armor doesn't impose disadvantage on saving throws made to resist the effects of extreme heat (see chapter 5 of the Dungeon Master's Guide).\n\n" + toUni("Curse") + ". This armor is cursed. Whenever you don or doff it, you must make a DC 15 Constitution saving throw, taking 100 (10d10+45) poison damage on a failed save, or half as much damage on a successful one. Only a Wish spell can remove the armor's curse.",
	attunement : true,
	weight : 65,
	cursed : true,
	addMod : [{ type : "skill", field : "Init", mod : 5, text : "I gain a +5 bonus on my initiative rolls." }],
	armorAdd : "Scorpion Armor",
	armorOptions : {
		regExpSearch : /^(?=.*scorpion)(?=.*armor).*$/i,
		name : "Scorpion Armor",
		source : ["ToA", 208],
		type : "heavy",
		ac : 18,
		stealthdis : false,
		weight : 65,
		strReq : 15
	}
}
var iFileName = "pub_20171121_XGtE.js";
RequiredSheetVersion(13);
// This file adds the backgrounds and beasts from Xanathar's Guide to Everything to MPMB's Character Record Sheet

// Define the source
SourceList.X={
	name : "Xanathar's Guide to Everything",
	abbreviation : "XGtE",
	group : "Primary Sources",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/xanathars-guide-everything",
	date : "2017/11/21"
};

// Add 3 subclasses for the Barbarian
AddSubClass("barbarian", "ancestral guardian-xgte", {
	regExpSearch : /^(?=.*ancestral)(?=.*guardian).*$/i,
	subname : "Path of the Ancestral Guardian",
	source : ["X", 9],
	fullname : "Ancestral Guardian",
	features : {
		"subclassfeature3" : {
			name : "Ancestral Protectors",
			source : ["X", 10],
			minlevel : 3,
			description : desc([
				"While raging, the first creature I hit with an attack on my turn becomes distracted",
				"While distracted, it has disadvantage on attack rolls that don't target me",
				"In addition, everybody but me counts as having resistance to all of the target's attacks",
				"This lasts until the start of my next turn, or until my rage ends"
			])
		},
		"subclassfeature6" : {
			name : "Spirit Shield",
			source : ["X", 10],
			minlevel : 6,
			description : desc([
				"As a reaction while raging when an ally I see within 30 ft is damaged, I can reduce it",
				"My guardian spirits reduce the damage by an amount equal to the roll of the dice"
			]),
			additional : levels.map(function (n) { return n < 6 ? "" : (n < 10 ? 2 : n < 14 ? 3 : 4) + "d6 damage reduced"; }),
			action : ["reaction", " (in Rage)"]
		},
		"subclassfeature10" : {
			name : "Consult the Spirits",
			source : ["X", 10],
			minlevel : 10,
			description : desc([
				"I can cast either Clairvoyance or Augury, without a spell slot or material components",
				"Augury consults ancestral spirits; Clairvoyance summons an invisible ancestral spirit",
				"Wisdom is my spellcasting ability for these spells"
			]),
			spellcastingAbility : 5,
			spellcastingBonus : [{
				name : "Consult the Spirits",
				spells : ["augury"],
				selection : ["augury"],
				firstCol : 'oncesr'
			}, {
				name : "Consult the Spirits",
				spells : ["clairvoyance"],
				selection : ["clairvoyance"],
				firstCol : 'oncesr'
			}],
			usages : 1,
			recovery : "short rest",
			spellChanges : {
				"augury" : {
					components : "V,S",
					compMaterial : "",
					description : "Omen about specific course of action I plan to take in the next 30 min",
					changes : "My casting of Augury is a practice of consulting my ancestral spirits, thus requiring no material components."
				},
				"clairvoyance" : {
					components : "V,S",
					compMaterial : "",
					changes : "My casting of Clairvoyance is a practice of consulting my an ancestral spirit of mine, thus requiring no material components."
				}
			}
		},
		"subclassfeature14" : {
			name : "Vengeful Ancestors",
			source : ["X", 10],
			minlevel : 14,
			description : "\n   " + "When using Spirit Shield, the attacker takes the reduced amount as force damage"
		}
	}
});
AddSubClass("barbarian", "storm herald-xgte", {
	regExpSearch : /^(?=.*storm)(?=.*herald).*$/i,
	subname : "Path of the Storm Herald",
	source : ["X", 10],
	fullname : "Storm Herald",
	abilitySave : 3,
	features : {
		"subclassfeature3" : {
			name : "Storm Aura",
			source : ["X", 10],
			minlevel : 3,
			description : desc([
				"While raging, I emanate a 10-ft radius aura, but not through total cover",
				"The aura's features activate when I enter my rage or as a bonus action while raging",
				"Use the \"Choose Feature\" button above to select the type of aura"
			]),
			choices : ["Desert", "Sea", "Tundra"],
			action : ["bonus action", " (reactivate)"],
			"desert" : {
				name : "Storm Aura: Desert",
				description : desc([
					"While raging, I emanate a 10-ft radius aura, but not through total cover",
					"The aura's features activate when I enter my rage or as a bonus action while raging",
					"Whenever I active my aura, anybody in my aura other than me takes fire damage"
				]),
				additional : levels.map(function (n) { return n < 3 ? "" : (n < 5 ? 2 : n < 10 ? 3 : n < 15 ? 4 : n < 20 ? 5 : 6) + " fire damage"; })
			},
			"sea" : {
				name : "Storm Aura: Sea",
				description : desc([
					"While raging, I emanate a 10-ft radius aura, but not through total cover",
					"The aura's features activate when I enter my rage or as a bonus action while raging",
					"Whenever I active my aura, I can choose one creature in my aura other than me",
					"It takes lightning damage, or half as much on a successful Dexterity saving throw"
				]),
				additional : levels.map(function (n) { return n < 3 ? "" : (n < 10 ? 1 : n < 15 ? 2 : n < 20 ? 3 : 4) + "d6 lightning damage"; })
			},
			"tundra" : {
				name : "Storm Aura: Tundra",
				description : desc([
					"While raging, I emanate a 10-ft radius aura, but not through total cover",
					"The aura's features activate when I enter my rage or as a bonus action while raging",
					"Whenever I active my aura, all creatures of my choice in my aura gain temporary HP"
				]),
				additional : levels.map(function (n) { return n < 3 ? "" : (n < 5 ? 2 : n < 10 ? 3 : n < 15 ? 4 : n < 20 ? 5 : 6) + " temporary hit points"; })
			},
			choiceDependencies : [{
				feature : "subclassfeature6"
			}, {
				feature : "subclassfeature10"
			}, {
				feature : "subclassfeature14"
			}]
		},
		"subclassfeature6" : {
			name : "Storm Soul",
			source : ["X", 10],
			minlevel : 6,
			description : "\n   " + "Use the \"Choose Feature\" button above to select the effect",
			choices : ["desert", "sea", "tundra"],
			choicesNotInMenu : true,
			"desert" : {
				name : "Storm Soul: Desert",
				description : desc([
					"I have resistance to fire damage and don't suffer the effects of extreme heat",
					"As an action, I can set fire to an unattended flammable object I touch"
				]),
				action : ["action", " (ignite)"],
				dmgres : ["Fire"],
				savetxt : { immune : ["effects of extreme heat"] }
			},
			"sea" : {
				name : "Storm Soul: Sea",
				description : desc([
					"I can breathe underwater and I have 30 ft swim speed",
					"In addition, I have resistance to lightning damage"
				]),
				dmgres : ["Lightning"],
				speed : { swim : { spd : 30, enc : 20 } }
			},
			"tundra" : {
				name : "Storm Soul: Tundra",
				description : desc([
					"I have resistance to cold damage and don't suffer the effects of extreme cold",
					"As an action, I can turn a 5-ft cube of water to ice, which melts after 1 minute",
					"This action fails if there are any creatures within the cube of water"
				]),
				action : ["action", " (freeze)"],
				dmgres : ["Cold"],
				savetxt : { immune : ["effects of extreme cold"] }
			}
		},
		"subclassfeature10" : {
			name : "Shielding Storm",
			source : ["X", 10],
			minlevel : 10,
			description : "\n   " + "In rage, creatures of my choice within my Storm Aura also gain Storm Soul resistance",
			choices : ["desert", "sea", "tundra"],
			choicesNotInMenu : true,
			"desert" : {
				name : "Shielding Storm: Desert",
				description : "\n   " + "While raging, creatures of my choice within my Storm Aura also gain resistance to fire"
			},
			"sea" : {
				name : "Shielding Storm: Sea",
				description : "\n   " + "In rage, creatures of my choice within my Storm Aura also gain resistance to lightning"
			},
			"tundra" : {
				name : "Shielding Storm: Tundra",
				description : "\n   " + "While raging, creatures of my choice within my Storm Aura also gain resistance to cold"
			}
		},
		"subclassfeature14" : {
			name : "Raging Storm",
			source : ["X", 11],
			minlevel : 14,
			description : "\n   " + "Use the \"Choose Feature\" button above to select the effect",
			choices : ["desert", "sea", "tundra"],
			choicesNotInMenu : true,
			"desert" : {
				name : "Raging Storm: Desert",
				description : desc([
					"As a reaction when hit by a creature in my Storm Aura, I can have it make a Dex save",
					"On a failed save, the attacker takes fire damage equal to half my barbarian level"
				]),
				action : ["reaction", " (if hit)"],
				additional : levels.map(function (n) { return n < 14 ? "" : Math.floor(n/2) + " fire damage"; })
			},
			"sea" : {
				name : "Raging Storm: Sea",
				description : desc([
					"As a reaction when I hit a creature in my Storm Aura, I can have it make a Str save",
					"On a failed save, the creature is knocked prone, as if struck by a wave"
				]),
				action : ["reaction", " (with attack)"]
			},
			"tundra" : {
				name : "Raging Storm: Tundra",
				description : desc([
					"Whenever I activate my Storm Aura, I can choose a creature in my aura that I can see",
					"It must make a Str save or have its speed reduced to 0 until the start of my next turn"
				])
			}
		}
	}
});
AddSubClass("barbarian", "zealot-xgte", {
	regExpSearch : /zealot/i,
	subname : "Path of the Zealot",
	source : ["X", 11],
	fullname : "Zealot",
	features : {
		"subclassfeature3" : {
			name : "Divine Fury",
			source : ["X", 11],
			minlevel : 3,
			description : desc([
				"While raging, the first creature I hit with a weapon attack in my turn gets extra damage",
				"This is necrotic or radiant damage equal to 1d6 + half my barbarian level",
				"Choose a damage type using the \"Choose Feature\" button above"
			]),
			additional : levels.map(function (n) { return n < 3 ? "" : "+1d6+" + Math.floor(n/2) + " damage"; }),
			choices : ["Necrotic Damage", "Radiant Damage"],
			"necrotic damage" : {
				name : "Divine Fury",
				description : desc([
					"While raging, the first creature I hit with a weapon attack in my turn gets extra damage",
					"It takes an extra 1d6 + half my barbarian level worth of necrotic damage"
				]),
				additional : levels.map(function (n) { return n < 3 ? "" : "+1d6+" + Math.floor(n/2) + " necrotic damage"; })
			},
			"radiant damage" : {
				name : "Divine Fury",
				description : desc([
					"While raging, the first creature I hit with a weapon attack in my turn gets extra damage",
					"It takes an extra 1d6 + half my barbarian level worth of radiant damage"
				]),
				additional : levels.map(function (n) { return n < 3 ? "" : "+1d6+" + Math.floor(n/2) + " radiant damage"; })
			},
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (!v.isSpell && classes.known.barbarian && classes.known.barbarian.level > 2 && (/\brage\b/i).test(v.WeaponText)) {
							var theDMG = GetFeatureChoice('class', 'barbarian', 'subclassfeature3');
							if (!theDMG) return;
							fields.Description += (fields.Description ? '; ' : '') + '+1d6+' + Math.floor(classes.known.barbarian.level / 2) + ' ' + GetFeatureChoice('class', 'barbarian', 'subclassfeature3') + ' on first hit each turn';
						};
					},
					"If I include the word 'Rage' in a melee weapon's name, it will show in its description that its first hit does extra damage."
				]
			}
		},
		"subclassfeature3.1" : {
			name : "Warrior of the Gods",
			source : ["X", 11],
			minlevel : 3,
			description : "\n   " + "Spells restoring me to life (not undeath or anything else) don't require material comp."
		},
		"subclassfeature6" : {
			name : "Fanatical Focus",
			source : ["X", 11],
			minlevel : 6,
			description : desc([
				"When I fail a saving throw while raging, I can reroll it and must use the new roll",
				"I can use this ability only once per rage"
			]),
			usages : 1,
			recovery : "rage"
		},
		"subclassfeature10" : {
			name : "Zealous Presence",
			source : ["X", 11],
			minlevel : 10,
			description : desc([
				"As a bonus action, I choose up to 10 creatures within 60 ft that can hear my battle cry",
				"These creatures gain adv. on attacks and saves until the start of my next turn"
			]),
			usages : 1,
			recovery : "long rest",
			action : ["bonus action", ""]
		},
		"subclassfeature14" : {
			name : "Rage Beyond Death",
			source : ["X", 11],
			minlevel : 14,
			description : desc([
				"While raging, having 0 hit points doesn't knock me unconscious",
				"I still must make death saves, and I suffer the normal effects of taking damage",
				"I only die due to failed death saves if my rage ends while I'm at 0 HP"
			])
		}
	}
});

// Add 3 subclasses for the Bard
AddSubClass("bard", "college of glamour-xgte", {
	regExpSearch : /^(?=.*(college|bard|minstrel|troubadour|jongleur))(?=.*glamour).*$/i,
	subname : "College of Glamour",
	source : ["X", 14],
	features : {
		"subclassfeature3" : {
			name : "Mantle of Inspiration",
			source : ["X", 14],
			minlevel : 3,
			description : desc([
				"As a bonus action, I expend one Bardic Inspiration die to aid those within 60 ft of me",
				"My Cha mod (min 1) of creatures that I can see and can see me gain temporary HP",
				"They can immediately use a reaction to move their speed, without opportunity attacks"
			]),
			additional : levels.map(function (n) { return n < 3 ? "" : "1 inspiration die; " + (n < 5 ? 5 : n < 10 ? 8 : n < 15 ? 11 : 14) + " temp HP"; }),
			action : ["bonus action", ""]
		},
		"subclassfeature3.1" : {
			name : "Enthralling Performance",
			source : ["X", 14],
			minlevel : 3,
			recovery : "short rest",
			usages : 1,
			description : desc([
				"By performing for at least 1 minute, I can charm humanoids within 60 ft of me",
				"After the performance, my Cha mod (min 1) number of targets must make a Wis save",
				"On a fail, a target is charmed for 1 hour; If success, it doesn't knows I tried to charm it",
				"While charmed, the target idolizes me, hinders those opposing me, and avoids violence",
				"This lasts until a target takes damage, I attack it, or if it sees me attacking its allies"
			])
		},
		"subclassfeature6" : {
			name : "Mantle of Majesty",
			source : ["X", 14],
			minlevel : 6,
			recovery : "long rest",
			usages : 1,
			action : ["bonus action", ""],
			description : desc([
				"As a bonus action, I appear unearthly beautiful while I concentrate, up to 1 minute",
				"At the same time, and as a bonus action during, I can cast Command without a spell slot",
				"Creatures charmed by me automatically fail their saves against these Command spells"
			]),
			spellcastingBonus : [{
				name : "Mantle of Majesty",
				spells : ["command"],
				selection : ["command"],
				firstCol : 'oncelr'
			}],
			spellChanges : {
				"command" : {
					time : "1 bns",
					description : "1 crea save or follow one word command, e.g. approach, drop, flee, halt",
					changes : "Using my Mantle of Majesty class feature, I can cast Command as a bonus action once per long rest without using a spell slot, thus only affect a single target."
				}
			}
		},
		"subclassfeature14" : {
			name : "Unbreakable Majesty",
			source : ["X", 14],
			minlevel : 14,
			recovery : "short rest",
			usages : 1,
			action : ["bonus action", ""],
			description : desc([
				"As a bonus action, I gain a magically majestic presence for 1 min or until incapacitated",
				"During this, the first time a creature attacks me each turn they must make a Cha save",
				"If failed, it can't attack me this turn and must choose another target or lose its attack",
				"If successful, it can attack, but has disadv. on all saves against my spells on my next turn"
			])
		}
	}
});
AddSubClass("bard", "college of swords-xgte", {
	regExpSearch : /^(?=.*(college|bard|minstrel|troubadour|jongleur))(?=.*\bswords?\b).*$/i,
	subname : "College of Swords",
	source : ["X", 15],
	attacks : [1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
	features : {
		"subclassfeature3" : {
			name : "Bonus Proficiencies",
			source : ["X", 15],
			minlevel : 3,
			description : desc([
				"I gain proficiency with medium armor and scimitars",
				"My bardic spellcasting focus can be any simple or martial weapon I'm proficient with"
			]),
			armorProfs : [false, true, false, false],
			weaponProfs : [false, false, ["scimitar"]]
		},
		"subclassfeature3.1" : {
			name : "Fighting Style",
			source : ["X", 15],
			minlevel : 3,
			description : "\n   " + "Select a Fighting Style for the college of swords using the \"Choose Feature\" button above",
			choices : ["Dueling", "Two-Weapon Fighting"],
			"dueling" : FightingStyles.dueling,
			"two-weapon fighting" : FightingStyles.two_weapon
		},
		"subclassfeature3.2" : {
			name : "Blade Flourish",
			source : ["X", 15],
			minlevel : 3,
			description : desc([
				"When I take the Attack action on my turn, I gain bonus speed and special attack options",
				"I gain +10 ft to my walking speed until the end of the current turn",
				"Once per turn when I hit with a weapon attack, I can expend a Bardic Inspiration die",
				"The roll of that die is added to the weapon's damage, in addition to one of the following:",
				"\u2022 Defensive Flourish: the result is also added to my AC until the start of my next turn",
				"\u2022 Slashing Flourish: the extra damage is also dealt to any of my choosing in 5 ft of me",
				"\u2022 Mobile Flourish: the target is also pushed 5 plus the die result in feet away from me",
				"  As a reaction after this push, I can move my speed to a space within 5 ft of the target"
			])
		},
		"subclassfeature14" : {
			name : "Master Flourish",
			source : ["X", 16],
			minlevel : 14,
			description : "\n   " + "When I do a Blade Flourish, I can use a d6 instead of expending a Bardic Inspiration die"
		}
	}
});
AddSubClass("bard", "college of whispers-xgte", {
	regExpSearch : /^(?=.*(college|bard|minstrel|troubadour|jongleur))(?=.*whispers).*$/i,
	subname : "College of Whispers",
	source : ["X", 16],
	features : {
		"subclassfeature3" : {
			name : "Psychic Blades",
			source : ["X", 16],
			minlevel : 3,
			description : desc([
				"When I hit a creature with a weapon attack, I can expend one use of Bardic Inspiration",
				"If so, the attack does extra psychic damage; I can do so only once per round, on my turn"
			]),
			additional : levels.map(function (n) { return n < 3 ? "" : "1 Bardic Inspiration for +" + (n < 5 ? 2 : n < 10 ? 3 : n < 15 ? 5 : 8) + "d6 damage"; })
		},
		"subclassfeature3.1" : {
			name : "Words of Terror",
			source : ["X", 16],
			minlevel : 3,
			recovery : "short rest",
			usages : 1,
			description : desc([
				"By speaking privately with a humanoid for at least 1 minute, I can try to inspire terror",
				"After the talk, it must make a Wis save or be frightened of me or someone of my choice",
				"If the save is successful, the target doesn't know I tried to frighten it",
				"This lasts for 1 hour, or until it sees its allies or itself being attacked or damaged"
			])
		},
		"subclassfeature6" : {
			name : "Mantle of Whispers",
			source : ["X", 16],
			minlevel : 6,
			recovery : "short rest",
			usages : 1,
			action : ["reaction", ""],
			description : desc([
				"As a reaction when a humanoid dies within 30 ft of me, I can capture its shadow",
				"As an action, I can use it to make me look just like the dead person did while it was alive",
				"While disguised, I know general information about it and its memories, but not its secrets",
				"Others can see through the disguise with a Wis (Insight) check vs. my Cha (Deception) +5",
				"A shadow lasts until used or next long rest; The disguise ends as a bonus action or 1 hour"
			]),
			action : [['action', 'Shadow Disguise (start)'], ['bonus action', 'Shadow Disguise (end)']]
		},
		"subclassfeature14" : {
			name : "Shadow Lore",
			source : ["X", 16],
			minlevel : 14,
			recovery : "long rest",
			usages : 1,
			action : ["action", ""],
			description : desc([
				"As an action, I whisper to a creature within 30 ft that can hear and understand me",
				"Only the target can hear me; It must make a Wis save or be charmed by me for 8 hours",
				"If failed, it thinks I know its most mortifying secret, otherwise it only hears mumbling",
				"While charmed, the target obeys my commands, but won't fight or risk its life for me",
				"This lasts for 8 hours, or until I or my allies attack it, damage it, or have it make a save"
				//"When the effect ends, the target has no idea why it was so afraid of me"
			])
		}
	}
});

// Add 2 subclasses for the Cleric
AddSubClass("cleric", "forge domain-xgte", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*(forge|forgery|blacksmith)).*$/i,
	subname : "Forge Domain",
	source : ["X", 18],
	spellcastingExtra : ["identify", "searing smite", "heat metal", "magic weapon", "elemental weapon", "protection from energy", "fabricate", "wall of fire", "animate objects", "creation"],
	features : {
		"subclassfeature1" : {
			name : "Bonus Proficiency",
			source : ["X", 19],
			minlevel : 1,
			description : "\n   " + "I gain proficiency with heavy armor and smith's tools",
			armorProfs : [false, false, true, false],
			toolProfs : ["Smith's tools"]
		},
		"subclassfeature1.1" : {
			name : "Blessing of the Forge",
			source : ["X", 19],
			minlevel : 1,
			action : ["action", ""],
			usages : 1,
			recovery : "long rest",
			description : desc([
				"At the end of a long rest, I can imbue magic into a nonmagical weapon or armor",
				"It becomes magical: +1 AC if armor, or +1 to attack and damage rolls if a weapon",
				"This lasts until the end of my next long rest or until I die"
			])
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Artisan's Blessing",
			source : ["X", 19],
			minlevel : 2,
			description : desc([
				"With an hour-long ritual, I can craft a nonmagical item that is at least part metal",
				"Including: suit of armor, simple or martial weapon, set of tools, 10 pieces of ammunition",
				"The creation can be worth up to 100 gp, and I must expend metals of equal value to it",
				"The metals irretrievably coalesce into the new item, forming even nonmetal parts of it",
				"The item can be an exact duplicate of a nonmagical item if I possess the original",
				"The item comes into existence at the end of the hour in an unoccupied space within 5 ft"
			])
		},
		"subclassfeature6" : {
			name : "Soul of the Forge",
			source : ["X", 19],
			minlevel : 6,
			description : "\n   " + "I gain resistance to fire damage and +1 to AC while wearing medium or heavy armor",
			dmgres : ["Fire"],
			extraAC : {
				mod : 1,
				text : "I gain a +1 bonus to AC while wearing Medium or Heavy armor.",
				stopeval : function (v) { return !v.mediumArmor && !v.heavyArmor; }
			}
		},
		"subclassfeature8" : {
			name : "Divine Strike",
			source : ["X", 19],
			minlevel : 8,
			description : "\n   " + "Once per turn, when I hit a creature with a weapon attack, I can do extra damage",
			additional : levels.map(function (n) {
				if (n < 8) return "";
				return "+" + (n < 14 ? 1 : 2) + "d8 fire damage";
			}),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (classes.known.cleric && classes.known.cleric.level > 7 && !v.isSpell) {
							fields.Description += (fields.Description ? '; ' : '') + 'Once per turn +' + (classes.known.cleric.level < 14 ? 1 : 2) + 'd8 fire damage';
						}
					},
					"Once per turn, I can have one of my weapon attacks that hit do extra fire damage."
				]
			}
		},
		"subclassfeature17" : {
			name : "Saint of Forge and Fire",
			source : ["X", 19],
			minlevel : 17,
			description : desc([
				"I gain immunity to fire damage",
				"When wearing heavy armor, I'm resistant to nonmagical bludg./piercing/slashing damage"
			]),
			savetxt : { immune : ["fire"] },
			dmgres : [["Bludgeoning", "Bludg. (nonmagical)"], ["Piercing", "Pierc. (nonmagical)"], ["Slashing", "Slash. (nonmagical)"]]
		}
	}
});
AddSubClass("cleric", "grave domain-xgte", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*(grave)).*$/i,
	subname : "Grave Domain",
	source : ["X", 19],
	spellcastingExtra : ["bane", "false life", "gentle repose", "ray of enfeeblement", "revivify", "vampiric touch", "blight", "death ward", "antilife shell", "raise dead"],
	features : {
		"subclassfeature1" : {
			name : "Circle of Mortality",
			source : ["X", 20],
			minlevel : 1,
			action : ["bonus action", ""],
			description : desc([
				"Spells I cast to heal a living creature at 0 HP have their dice count as their max result",
				"I learn Spare the Dying, which I can cast as a bonus action with a range of 30 ft"
			]),
			spellcastingBonus : {
				name : "Circle of Mortality",
				spells : ["spare the dying"],
				selection : ["spare the dying"],
				firstCol : 'atwill'
			},
			spellChanges : {
				"spare the dying" : {
					time : "1 bns",
					range : "Touch",
					changes : "I can cast spare the dying as a bonus action instead of an action, and it has a range of 30 ft instead of touch."
				}
			}
		},
		"subclassfeature1.1" : {
			name : "Eyes of the Grave",
			source : ["X", 20],
			minlevel : 1,
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest",
			description : desc([
				"As an action, I sense undead within 60 ft that aren't protected from divination magic",
				"Until the end of my next turn, I sense the location of any undead not behind total cover"
			])
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Path to the Grave",
			source : ["X", 20],
			minlevel : 2,
			action : ["action", ""],
			description : desc([
				"As an action, I can curse a creature within 30 ft until the end of my next turn",
				"It is vulnerable to all the damage from the next attack by me or my allies that hits it"
			])
		},
		"subclassfeature6" : {
			name : "Sentinel at Death's Door",
			source : ["X", 20],
			minlevel : 6,
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest",
			action : ["reaction", ""],
			description : "\n   " + "As a reaction, I turn a critical hit to me or an ally I see within 30 ft to a normal hit"
		},
		"subclassfeature8" : {
			name : "Potent Spellcasting",
			source : ["X", 20],
			minlevel : 8,
			description : "\n   " + "I add my Wisdom modifier to the damage I deal with my cleric cantrips",
			calcChanges : {
				atkCalc : [
					function (fields, v, output) {
						if (classes.known.cleric && classes.known.cleric.level > 7 && v.thisWeapon[3] && v.thisWeapon[4].indexOf('cleric') !== -1 && SpellsList[v.thisWeapon[3]].level === 0) {
							output.extraDmg += What('Wis Mod');
						};
					},
					"My cleric cantrips get my Wisdom modifier added to their damage."
				],
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (spName != "cleric" || !What("Wis Mod") || Number(What("Wis Mod")) <= 0 || spellObj.psionic || spellObj.level !== 0) return;
						if (spellKey == "shillelagh") {
							spellObj.description = spellObj.description.replace("1d8", "1d8+" + What("Wis Mod"));
							return true;
						}
						return genericSpellDmgEdit(spellKey, spellObj, "\\w+\\.?", "Wis", true);
					},
					"My cleric cantrips get my Wisdom modifier added to their damage."
				]
			}
		},
		"subclassfeature17" : {
			name : "Keeper of Souls",
			source : ["X", 20],
			minlevel : 17,
			description : desc([
				"Once per round, if I'm not incapacitated, I can manipulate the energy of the dying",
				"When an enemy I can see dies within 60 ft of me, I or an ally within 60 ft regain HP",
				"The HP regained is equal to the enemy's number of Hit Dice"
			])
		}
	}
});

// Add 2 subclasses for the Druid
AddSubClass("druid", "circle of dreams-xgte", {
	regExpSearch : /^(?=.*(druid|shaman))(?=.*\bdreams\b).*$/i,
	subname : "Circle of Dreams",
	source : ["X", 22],
	features : {
		"subclassfeature2" : {
			name : "Balm of the Summer Court",
			source : ["X", 22],
			minlevel : 2,
			description : desc([
				"I have a pool of fey energy represented by a number of d6s equal to my druid level",
				"As a bonus action, I can spend dice to heal an ally within 120 ft of me that I can see",
				"I can spend up to half my druid level worth of dice from the pool at once",
				"The ally heals an amount equal to the total rolled and gains 1 temp HP per die spent"
			]),
			usages : levels.map(function (n) { return n < 2 ? "" : n + "d6 per "; }),
			recovery : "long rest",
			action : ["bonus action", ""]
		},
		"subclassfeature6" : {
			name : "Hearth of Moonlight and Shadow",
			source : ["X", 22],
			minlevel : 6,
			description : desc([
				"At the start of a rest, I can create a 30-ft radius invisible magical sphere",
				"The sphere extends from a point in space I touch, but doesn't extend through total cover",
				"Within this area, my allies and I gain +5 on Wis (Perception) and Dex (Stealth) checks",
				"Also, any light from open flames that are in the sphere is invisible from outside the area",
				"This effect lasts until the end of the rest or when I leave the sphere"
			])
		},
		"subclassfeature10" : {
			name : "Hidden Paths",
			source : ["X", 22],
			minlevel : 10,
			description : desc([
				"As a bonus action, I can teleport myself up to 60 ft to a spot I can see",
				"As an action, I can teleport a willing ally I touch up to 30 ft to a spot I can see"
			]),
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest",
			action : [["bonus action", ""], ['action', ' (on ally)']]
		},
		"subclassfeature14" : {
			name : "Walker in Dreams",
			source : ["X", 23],
			minlevel : 14,
			usages : 1,
			recovery : "long rest",
			description : desc([
				"When I finish a short rest, I can cast either Dream, Scrying, or Teleportation Circle",
				"This doesn't require a spell slot or material components; Dream uses me as the messenger",
				"Teleportation Circle connects to the last place I finished a long rest, if on the same plane"
			]),
			spellcastingBonus : [{
				name : "Walker in Dreams",
				spells : ["dream"],
				selection : ["dream"],
				firstCol : 'oncelr'
			}, {
				name : "Walker in Dreams",
				spells : ["scrying"],
				selection : ["scrying"],
				firstCol : 'oncelr'
			}, {
				name : "Walker in Dreams",
				spells : ["teleportation circle"],
				selection : ["teleportation circle"],
				firstCol : 'oncelr'
			}],
			spellChanges : {
				"dream" : {
					components : "V,S",
					compMaterial : "",
					changes : "Using Walker in Dreams, I can cast either Dream, Scrying, or Teleportation Circle once per long rest without requiring material components."
				},
				"scrying" : {
					components : "V,S",
					compMaterial : "",
					description : "1 crea save or sensor follows it around; or create sensor in familiar location; see book",
					changes : "Using Walker in Dreams, I can cast either Dream, Scrying, or Teleportation Circle once per long rest without requiring material components."
				},
				"teleportation circle" : {
					components : "V",
					compMaterial : "",
					description : "Create a circle to teleport to the place where I finished my last long rest, if on the same plane; see book",
					changes : "Using Walker in Dreams, I can cast either Dream, Scrying, or Teleportation Circle once per long rest without requiring material components.\n \u2022 The teleportation circle brings me back to the place where I finished my last long rest."
				}
			}
		}
	}
});
AddSubClass("druid", "circle of the shepherd-xgte", {
	regExpSearch : /^(?=.*(druid|shaman))(?=.*shepherd).*$/i,
	subname : "Circle of the Shepherd",
	source : ["X", 23],
	features : {
		"subclassfeature2" : {
			name : "Speech of the Woods",
			source : ["X", 23],
			minlevel : 2,
			description : desc([
				"I can talk with beasts, they understand me and I them, to the limit of their intelligence",
				"This doesn't automatically make me friends with all beasts; Additionally, I learn Sylvan"
			]),
			languageProfs : ["Sylvan"]
		},
		"subclassfeature2.1" : {
			name : "Spirit Totem",
			source : ["X", 23],
			minlevel : 2,
			description : desc([
				"As a bonus action, I can summon, or move, a spirit to a point I can see within 60 ft",
				"It is a spectral form of a Bear, Hawk, or Unicorn (my choice), with a 30-ft radius aura",
				"It is incorporeal, immobile, doesn't counts as a creature or object, and persists for 1 min",
				"The spirit persists for 1 minute or until I'm incapacitated",
				"\u2022 Bear: my allies and I, if in the aura, immediately gain 5 + my druid level in temp HP",
				"  While in the aura, my allies and I gain advantage on Strength checks and saves",
				"\u2022 Hawk: As a reaction, I can grant advantage on an attack vs. a target in the aura",
				"  While in the aura, my allies and I gain advantage on Wisdom (Perception) checks",
				"\u2022 Unicorn: my allies and I gain advantage on ability checks to detect targets in the aura",
				"  When I cast a healing spell with a spell slot, allies in the aura heal my druid level in HP"
			]),
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", ""]
		},
		"subclassfeature6" : {
			name : "Mighty Summoner",
			source : ["X", 24],
			minlevel : 6,
			description : "\n   " + "Beasts or Fey I summon with spells get +2 HP per HD and their attacks count as magical",
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						switch (spellKey) {
							case "conjure animals" :
							case "conjure fey" :
								spellObj.description += "; each +2 HP/HD, magical natural attacks";
								return true;
							case "conjure woodland beings" :
								spellObj.description = spellObj.description.replace(/fey.*/, "fey; obeys commands if its align. agrees; breaks free if break conc.; +2 HP/HD, magic atks");
								return true;
						}
					},
					"When I use a spell that summons beast or fey creatures, those summons have +2 HP per HD and their attacks count as magical."
				]
			}
		},
		"subclassfeature10" : {
			name : "Guardian Spirit",
			source : ["X", 24],
			minlevel : 10,
			description : "\n   " + "When a Beast or Fey that I summoned ends its turn in my Spirit Totem aura, it heals",
			additional : levels.map(function (n) { return n < 10 ? "" : "heals " + Math.floor(n / 2) + " HP"; })
		},
		"subclassfeature14" : {
			name : "Faithful Summons",
			source : ["X", 24],
			minlevel : 14,
			description : desc([
				"When I am reduced to 0 HP or incapacitated against my will, I can cast Conjure Animals",
				"This is done as if using a 9th-level spell slot to summon 4 beast of my choice up to CR 2",
				"They appear within 20 ft of me, last 1 hour, and protect me from harm and attack foes"
			]),
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Faithful Summons",
				spells : ["conjure animals"],
				selection : ["conjure animals"],
				firstCol : "oncelr"
			},
			spellChanges : {
				"conjure animals" : {
					nameShort : "Conjure Animals (level 9)",
					range : "20 ft",
					duration : "1 h",
					description : "Summon 4 CR 2 beasts; protect me from harm and attack foes",
					changes : "Using my Faithful Summons class feature when I'm reduced to 0 HP, I can cast Conjure Animals as if using a 9th-level spell slot. This then summons 4 beast of my choice up to CR 2 within 20 ft of me without needing concentration."
				}
			}
		}
	}
});

// Add 3 subclasses for the Fighter
AddSubClass("fighter", "arcane archer-xgte", {
	regExpSearch : /^(?=.*arcane)(?=.*archer).*$/i,
	subname : "Arcane Archer",
	source : ["X", 28],
	fullname : "Arcane Archer",
	abilitySave : 4,
	features : {
		"subclassfeature3" : {
			name : "Arcane Archer's Lore",
			source : ["X", 28],
			minlevel : 3,
			description : desc([
				"I gain proficiency with either the Arcana or Nature skill",
				"I also learn either the Prestidigitation or the Druidcraft cantrip"
			]),
			skillstxt : "Arcana or Nature",
			spellcastingBonus : {
				name : "Arcane Archer's Lore",
				spells : ["druidcraft", "prestidigitation"]
			},
		},
		"subclassfeature3.1" : {
			name : "Arcane Shot",
			source : ["X", 28],
			minlevel : 3,
			description : desc([
				"I can unleash magical effects when I fire an arrow from a short- or longbow",
				"I can use this once per turn as part of the Attack action, after an attack hits",
				"I know a number of Arcane Shot Options and learn additional at certain levels",
				"Use the \"Choose Feature\" button above to add Arcane Shots Options to the third page"
			]),
			usages : 2,
			recovery : "short rest",
			additional : levels.map( function(n) { return n < 3 ? "" : (n < 7 ? 2 : n < 10 ? 3 : n < 15 ? 4 : n < 18 ? 5 : 6) + " options known"; }),
			extraname : "Arcane Shot Option",
			extrachoices : ["Banishing Arrow [Abjuration]", "Beguiling Arrow [Enchantment]", "Bursting Arrow [Evocation]", "Enfeebling Arrow [Necromancy]", "Grasping Arrow [Conjuration]", "Piercing Arrow [Transmutation]", "Seeking Arrow [Divination]", "Shadow Arrow [Illusion]"],
			extraTimes : levels.map(function (n) {
				return n < 3 ? 0 : n < 7 ? 2 : n < 10 ? 3 : n < 15 ? 4 : n < 18 ? 5 : 6;
			}),
			"banishing arrow [abjuration]" : {
				name : "Banishing Arrow [Abjuration]",
				source : ["X", 29],
				description : desc([
					"The target makes a Cha save or is banished to the Feywild until the end of its next turn",
					"While banished, its speed is 0 and is incapacitated; It re-appearing in the same spot",
					"When I reach 18th level, this Arcane Shot Option also does an extra 2d6 force damage"
				]),
				additional : levels.map( function(n) { return n < 18 ? "" : "+2d6 force damage"; })
			},
			"beguiling arrow [enchantment]" : {
				name : "Beguiling Arrow [Enchantment]",
				source : ["X", 29],
				description : desc([
					"The target takes extra psychic damage and must succeed on a Wisdom save",
					"If failed, it is charmed by one of my allies within 30 ft of it that I choose",
					"This lasts until my next turn starts or until the chosen ally attacks the target in any way"
				]),
				additional : levels.map( function(n) { return n < 3 ? "" : "+" + (n < 18 ? 2 : 4) + "d6 damage"; })
			},
			"bursting arrow [evocation]" : {
				name : "Bursting Arrow [Evocation]",
				source : ["X", 29],
				description : "\n   " + "The target, in addition to the shot, and all creatures within 10 ft of it take damage",
				additional : levels.map( function(n) { return n < 3 ? "" : "+" + (n < 18 ? 2 : 4) + "d6 force damage"; })
			},
			"enfeebling arrow [necromancy]" : {
				name : "Enfeebling Arrow [Necromancy]",
				source : ["X", 29],
				description : desc([
					"The target takes extra necrotic damage and must make a Constitution save",
					"If failed, the damage of the target's attacks are halved until the start of my next turn"
				]),
				additional : levels.map( function(n) { return n < 3 ? "" : "+" + (n < 18 ? 2 : 4) + "d6 necrotic damage"; })
			},
			"grasping arrow [conjuration]" : {
				name : "Grasping Arrow [Conjuration]",
				source : ["X", 29],
				description : desc([
					"The target takes extra poison damage as brambles wrap around it for 1 minute",
					"The brambles give it -10 ft speed and do it slashing damage every round it moves",
					"These can be removed by it or another as an action with Strength (Athletics) vs. my DC"
				]),
				additional : levels.map( function(n) { return n < 3 ? "" : (n < 18 ? 2 : 4) + "d6 poison/slash. damage"; })
			},
			"piercing arrow [transmutation]" : {
				name : "Piercing Arrow [Transmutation]",
				source : ["X", 29],
				description : desc([
					"With this I don't roll for the attack, but shoot the arrow in a 30-ft long, 1-ft wide line",
					"It passes through objects, ignoring cover, but all creatures in the area take damage",
					"The damage is the same as a normal hit from my attack, plus extra piercing damage",
					"A creature can make a Dexterity save to reduce the damage by half"
				]),
				additional : levels.map( function(n) { return n < 3 ? "" : "+" + (n < 18 ? 1 : 2) + "d6 piercing damage"; })
			},
			"seeking arrow [divination]" : {
				name : "Seeking Arrow [Divination]",
				source : ["X", 30],
				description : desc([
					"With this I don't roll for the attack, but I choose a target I have seen in the last minute",
					"The seeking arrow moves around corners, obstacles, and ignores cover to hit the target",
					"It is hit if it is within the weapon's range and there is a path for the arrow to get to it",
					"The target takes the full damage of the attack plus extra force damage",
					"It can make a Dexterity save to reduce the damage by half; If failed, I know its location"
				]),
				additional : levels.map( function(n) { return n < 3 ? "" : "+" + (n < 18 ? 1 : 2) + "d6 force damage"; })
			},
			"shadow arrow [illusion]" : {
				name : "Shadow Arrow [Illusion]",
				source : ["X", 30],
				description : desc([
					"The target takes extra psychic damage and must succeed on a Wisdom save",
					"If failed, the target can't see anything beyond 5 ft until the end of my next turn"
				]),
				additional : levels.map( function(n) { return n < 3 ? "" : "+" + (n < 18 ? 2 : 4) + "d6 psyhic damage"; })
			}
		},
		"subclassfeature7" : {
			name : "Magic Arrow",
			source : ["X", 28],
			minlevel : 7,
			description : "\n   " + "Whenever I fire a nonmagical arrow from a short- or longbow, I can make it magical"
		},
		"subclassfeature7.1" : {
			name : "Curving Shot",
			source : ["X", 28],
			minlevel : 7,
			description : desc([
				"Once per turn when I miss with a magic arrow, I can use a bonus action to redirect it",
				"I reroll the attack against a different target within 60 ft of the original target"
			]),
			action : ["bonus action", ""]
		},
		"subclassfeature15" : {
			name : "Ever-Ready Shot",
			source : ["X", 28],
			minlevel : 15,
			description : "\n   " + "I regain one use of Arcane Shot if I have no more remaining when I roll initiative"
		}
	}
});
AddSubClass("fighter", "cavalier-xgte", {
	regExpSearch : /cavalier/i,
	subname : "Cavalier",
	source : ["X", 30],
	fullname : "Cavalier",
	abilitySave : 1,
	features : {
		"subclassfeature3" : {
			name : "Bonus Proficiency",
			source : ["X", 30],
			minlevel : 3,
			description : desc([
				"I gain proficiency with Animal Handling, History, Insight, Performance, or Persuasion",
				"Alternatively, I learn one language; Use the \"Choose Feature\" button above for this"
			]),
			choices : ["Language proficiency", "Skill proficiency: Animal Handling, History, Insight, Performance, or Persuasion"],
			"language proficiency" : {
				name : "Bonus Proficiency",
				description : "\n   " + "I learn one language of my choice",
				languageProfs : [1]
			},
			"skill proficiency: animal handling, history, insight, performance, or persuasion" : {
				name : "Bonus Proficiency",
				description : "\n   " + "I gain proficiency with Animal Handling, History, Insight, Performance, or Persuasion",
				skillstxt : "Choose one from: Animal Handling, History, Insight, Performance, or Persuasion"
			}
		},
		"subclassfeature3.1" : {
			name : "Born in the Saddle",
			source : ["X", 30],
			minlevel : 3,
			description : desc([
				"I have advantage on saves to avoid falling off my mount, and land on my feet if I fail",
				"Mounting or dismounting a creature costs me only 5 ft of movement instead of half"
			]),
			savetxt : { adv_vs : ["falling off my mount"] }
		},
		"subclassfeature3.2" : {
			name : "Unwavering Mark",
			source : ["X", 30],
			minlevel : 3,
			description : desc([
				"If I hit a creature with a melee weapon attack, I mark it until the end of my next turn",
				"While it is within 5 ft of me, a marked target has disadv. on attacks not directed at me",
				"If it damages anybody but me, I can make a special melee attack vs. it in my next turn",
				"This takes a bonus action, but has adv. and adds half my fighter level to the damage",
				"A mark ends early if I'm incapacitated, die, or somebody else marks the target"
			]),
			usages : "Strength modifier per ",
			usagescalc : "event.value = Math.max(1, What('Str Mod'));",
			recovery : "long rest",
			additional : levels.map(function (n) {
				return n < 3 ? "" : "+" + Math.floor(n/2) + " damage";
			}),
			calcChanges : {
				atkCalc : [
					function (fields, v, output) {
						if (v.isMeleeWeapon && classes.known.fighter && classes.known.fighter.level > 2 && (/\b(unwavering.?mark|marked)\b/i).test(v.WeaponText)) {
							output.extraDmg += Math.floor(classes.known.fighter.level / 2);
						};
					},
					"If I include the words 'Unwavering Mark' or 'Marked' in the name or description of a melee weapon, it gets half my fighter level added to its Damage."
				]
			}
		},
		"subclassfeature7" : {
			name : "Warding Maneuver",
			source : ["X", 30],
			minlevel : 7,
			description : desc([
				"As a reaction when I or a creature within 5 ft is hit, I can try to fend off the strike",
				"I add 1d8 to the target's AC; If the attack still hits, the target has resistance against it",
				"I can only do this while wielding a melee weapon or a shield"
			]),
			usages : "Constitution modifier per ",
			usagescalc : "event.value = Math.max(1, What('Con Mod'));",
			recovery : "long rest",
			action : ["reaction", ""],
		},
		"subclassfeature10" : {
			name : "Hold the Line",
			source : ["X", 30],
			minlevel : 10,
			description : desc([
				"Creatures provoke opportunity attacks when moving 5 ft or more while within my reach",
				"If I hit an opportunity attack, the target's speed is reduced to 0 until the end of the turn"
			])
		},
		"subclassfeature15" : {
			name : "Ferocious Charger",
			source : ["X", 31],
			minlevel : 15,
			description : desc([
				"If I hit a creature after moving 10 ft in a straight line, it must make a Strength save",
				"If failed, the target is knocked prone; I can do this only once per turn"
			])
		},
		"subclassfeature18" : {
			name : "Vigilant Defender",
			source : ["X", 31],
			minlevel : 18,
			description : desc([
				"I can make opportunity attacks without using my reaction",
				"I can do this only once on every creature's turn, except on my own turn",
				"I can't do this on the same turn that I use my normal reaction"
			])
		}
	}
});
AddSubClass("fighter", "samurai-xgte", {
	regExpSearch : /samurai/i,
	subname : "Samurai",
	source : ["X", 31],
	fullname : "Samurai",
	features : {
		"subclassfeature3" : {
			name : "Bonus Proficiency",
			source : ["X", 31],
			minlevel : 3,
			description : desc([
				"I gain proficiency with History, Insight, Performance, or Persuasion",
				"Alternatively, I learn one language; Use the \"Choose Feature\" button above for this"
			]),
			choices : ["Language proficiency", "Skill proficiency: History, Insight, Performance, or Persuasion"],
			"language proficiency" : {
				name : "Bonus Proficiency",
				description : "\n   " + "I learn one language of my choice",
				languageProfs : [1]
			},
			"skill proficiency: history, insight, performance, or persuasion" : {
				name : "Bonus Proficiency",
				description : "\n   " + "I gain proficiency with History, Insight, Performance, or Persuasion",
				skillstxt : "Choose one from: History, Insight, Performance, or Persuasion"
			}
		},
		"subclassfeature3.1" : {
			name : "Fighting Spirit",
			source : ["X", 31],
			minlevel : 3,
			description : desc([
				"As a bonus action, I can give myself advantage on weapon attacks and temporary HP",
				"This advantage on weapon attack rolls lasts until the end of my current turn"
			]),
			recovery : "long rest",
			usages : 3,
			additional : levels.map(function (n) { return n < 3 ? "" : (n < 10 ? 5 : n < 15 ? 10 : 15) + " temporary HP"; }),
			action : ["bonus action", ""]
		},
		"subclassfeature7" : {
			name : "Elegant Courtier",
			source : ["X", 31],
			minlevel : 7,
			description : desc([
				"I can add my Wisdom modifier to any Charisma (Persuasion) checks I make",
				"I gain proficiency with Wis saves, or if I'm already proficient, either Int or Cha saves"
			]),
			saves : ["Wis"],
			addMod : { type : "skill", field : "Pers", mod : "Wis", text : "I can add my Wisdom modifier to any Charisma (Persuasion) checks I make." }
		},
		"subclassfeature10" : {
			name : "Tireless Spirit",
			source : ["X", 31],
			minlevel : 10,
			description : "\n   " + "I regain one use of Fighting Spirit if I have no more remaining when I roll initiative"
		},
		"subclassfeature15" : {
			name : "Rapid Strike",
			source : ["X", 31],
			minlevel : 15,
			description : desc([
				"With the Attack action, I can forgo advantage on one attack to make one extra attack",
				"This extra attack is part of the same action; I can do this only once per turn"
			])
		},
		"subclassfeature18" : {
			name : "Strength Before Death",
			source : ["X", 31],
			minlevel : 18,
			description : desc([
				"If I'm reduced to 0 HP but not killed outright, I can delay falling unconscious",
				"I then immediately take a bonus turn, interrupting the current turn",
				"While I'm at 0 HP, I suffer damage normally and die if I have 3 failed death saves",
				"If I'm still at 0 HP at the end of this bonus turn, I fall unconscious"
			]),
			recovery : "long rest",
			usages : 1
		}
	}
});

// Add 3 subclasses for the Monk
AddSubClass("monk", "way of the drunken master-xgte", {
	regExpSearch : /^((?=.*drunken)(?=.*master))|((?=.*drunk)((?=.*(monk|monastic))|((?=.*martial)(?=.*(artist|arts)))|((?=.*spiritual)(?=.*warrior)))).*$/i,
	subname : "Way of the Drunken Master",
	source : ["X", 33],
	fullname : "Drunken Master",
	features : {
		"subclassfeature3" : {
			name : "Bonus Proficiencies",
			source : ["X", 34],
			minlevel : 3,
			description : "\n   " + "I gain proficiency with the Performance skill and brewer's supplies",
			skills : ["Performance"],
			toolProfs : ["Brewer's supplies"]
		},
		"subclassfeature3.1" : {
			name : "Drunken Technique",
			source : ["X", 34],
			minlevel : 3,
			description : "\n   " + "When using Flurry of Blows, I gain the benefits of a Disengage and +10 ft speed this turn"
		},
		"subclassfeature6" : {
			name : "Tipsy Sway",
			source : ["X", 34],
			minlevel : 6,
			description : "\n   " + "1 ki point: as a reaction if missed in melee, attacker instead hits other I see within 5 ft",
			additional : "Standing up from prone costs only 5 ft",
			action : ["reaction", ""]
		},
		"subclassfeature11" : {
			name : "Drunkard's Luck",
			source : ["X", 34],
			minlevel : 11,
			description : "\n   " + "By spending 2 ki points, I can remove disadv. from an ability check, attack roll, or save",
			additional : "2 ki points"
		},
		"subclassfeature17" : {
			name : "Intoxicated Frenzy",
			source : ["X", 34],
			minlevel : 17,
			description : "\n   " + "I can make 3 extra attacks with Flurry of Blows if each is used on a different target"
		}
	}
});
// Create the Kensei and its weapon options last, so we benefit of all possible weapons that were added
RunFunctionAtEnd(function () {
	var theKenseiSubclassName = AddSubClass("monk", "way of the kensei-xgte", {
		regExpSearch : /kensei/i,
		subname : "Way of the Kensei",
		source : ["X", 34],
		fullname : "Kensei",
		features : {
			"subclassfeature3" : {
				name : "Path of the Kensei",
				source : ["X", 34],
				minlevel : 3,
				description : desc([
					"I gain proficiency with either calligrapher's supplies or painter's supplies",
					"Some weapons, that don't have the heavy or special property, are kensei weapons for me",
					"At least one ranged and one melee weapon, more at higher levels (longbow does qualify)",
					"With these: proficient, count as a monk weapons, special bonuses depending on type held:",
					"\u2022 Melee: if I do unarmed strike during an Attack action, +2 AC until my next turn starts",
					"\u2022 Ranged: as a bonus action, ranged weapon attacks deal +1d4 damage in current turn"
				]),
				action: ["bonus action", " (with ranged)"],
				additional : levels.map( function(n) { return n < 3 ? "" : (n < 6 ? 2 : n < 11 ? 3 : n < 17 ? 4 : 5) + " kensei weapons"; }),
				toolProfs : ["calligrapher's or painter's supplies"],
				extraname : "Kensei Weapon",
				extrachoices : [], // add these dynamically, see below
				extraTimes : levels.map( function(n) { return n < 3 ? 0 : n < 6 ? 2 : n < 11 ? 3 : n < 17 ? 4 : 5; }),
				calcChanges : {
					atkAdd : [
						function (fields, v) {
							if (!classes.known.monk || classes.known.monk.level < 2 || v.isSpell) return;
							var theKenseiWeapons = GetFeatureChoice("class", "monk", "subclassfeature3", true);
							if (theKenseiWeapons.indexOf(v.baseWeaponName) != -1 || ((/kensei/i).test(v.WeaponText) && (!(/heavy|special/i).test(fields.Description) || v.baseWeaponName === 'longbow'))) {
								var aMonkDie = function (n) { return n < 5 ? 4 : n < 11 ? 6 : n < 17 ? 8 : 10; }(classes.known.monk.level);
								try {
									var curDie = eval(fields.Damage_Die.replace('d', '*'));
								} catch (e) {
									var curDie = 'x';
								};
								if (isNaN(curDie) || curDie < aMonkDie) {
									fields.Damage_Die = '1d' + aMonkDie;
								};
								if (v.theWea.ability === 1) {
									fields.Mod = v.StrDex;
								};
								if (v.isRangedWeapon) {
									fields.Description += (fields.Description ? '; ' : '') + 'As bonus action with Attack action, +1d4 damage';
								};
								fields.Proficiency = true;
							};
						},
						"For the weapons that I select using the \"Choose Feature\" button on the second page or when I include the word 'Kensei' in the name of a weapon that doesn't have the Heavy or Special attribute, or that is a longbow, that weapon gains the same benefits as any other 'Monk Weapon'.\nIn addition, with ranged 'Kensei Weapons', I can take a bonus action to have that hit, and any other hit after that as part of the same action, do +1d4 damage."
					]
				}
			},
			"ki-empowered strikes" : {
				name : "One with the Blade",
				source : ["X", 34],
				minlevel : 6,
				description : "\n   " + "My unarmed strikes and kensei weapon attacks count as magical",
				calcChanges : {
					atkAdd : [
						function (fields, v) {
							if (v.isSpell || v.thisWeapon[1] || v.theWea.isMagicWeapon || (/counts as( a)? magical/i).test(fields.Description)) return;
							var theKenseiWeapons = GetFeatureChoice("class", "monk", "subclassfeature3", true);
							if (v.baseWeaponName == "unarmed strike" || theKenseiWeapons.indexOf(v.baseWeaponName) || ((/kensei/i).test(v.WeaponText) && !v.isSpell && (!(/heavy|special/i).test(fields.Description) || v.baseWeaponName == 'longbow'))) {
								fields.Description += (fields.Description ? '; ' : '') + 'Counts as magical';
							};
						},
						"My unarmed strikes and any Kensei Weapons count as magical for overcoming resistances and immunities."
					]
				},
				extraname : "Way of the Kensei 6",
				"deft strike" : {
					name : "Deft Strike",
					source : ["X", 35],
					description : "\n   " + "Once per turn when I hit with a kensei weapon, I can do a martial arts die extra damage",
					additional : "1 ki point"
				},
				"sharpen the blade" : {
					name : "Sharpen the Blade",
					source : ["X", 35],
					description : desc([
						"As a bonus action, I can grant my kensei weapon a bonus to attack and damage rolls",
						"This bonus is equal to the number of ki points I spend and doesn't stack with magic",
						"This lasts for 1 minute or until I use this feature again"
					]),
					additional : "1 to 3 ki points",
					action : ["bonus action", ""]
				},
				autoSelectExtrachoices : [{
					extrachoice : "deft strike"
				}, {
					extrachoice : "sharpen the blade",
					minlevel : 11,
					extraname : "Way of the Kensei 11"
				}]
			},
			"subclassfeature17" : {
				name : "Unerring Accuracy",
				source : ["X", 35],
				minlevel : 17,
				description : "\n   " + "Once per turn, if I miss a monk weapon attack on my turn, I can reroll the attack roll"
			}
		}
	});
	var itsFea = ClassSubList[theKenseiSubclassName].features.subclassfeature3;
	for (var weapon in WeaponsList) {
		var aWea = WeaponsList[weapon];
		// skip attacks that are not simple or martial weapons, that have the heavy or special property, are magic weapons, or those that are spells or cantrips
		if (weapon !== "longbow" && (aWea.isMagicWeapon || !(/simple|martial/i).test(aWea.type) || (/heavy|special/i).test(aWea.description) || (/spell|cantrip/i).test(aWea.list))) continue;
		itsFea.extrachoices.push(aWea.name);
		itsFea[aWea.name.toLowerCase()] = {
			name : aWea.name,
			description : "",
			source : aWea.source,
			weaponProfs : [false, false, [weapon]],
			weaponsAdd : [aWea.name],
			prereqeval : 'testSource("' + weapon + '", WeaponsList["' + weapon + '"], "weapExcl") ? "skip" : true;'
		}
	}
});
if (!ClassSubList["monk-way of the sun soul"] && (!SourceList.S || SourceList.S.abbreviation.toLowerCase() !== "scag")) {
	// the Way of the Sun Soul subclass is identical to the one in SCAG, so only add if it that one doesn't exist yet
	AddSubClass("monk", "way of the sun soul", {
		regExpSearch : /^(?=.*\bsun)(?=.*\b(soul|spirit))((?=.*(warrior|monk|monastic))|(((?=.*martial)(?=.*(artist|arts)))|((?=.*spiritual)(?=.*warrior)))).*$/i,
		subname : "Way of the Sun Soul",
		source : [["S", 131], ["X", 35]],
		features : {
			"subclassfeature3" : {
				name : "Radiant Sun Bolt",
				source : [["S", 131], ["X", 35]],
				minlevel : 3,
				additional : "1 ki point for 2 extra attacks",
				description : desc([
					"I gain a ranged spell attack that I can use as an attack in the Attack action",
					"If I do this and spend 1 ki point, I can make 2 of these attacks as a bonus action"
				]),
				action : ["bonus action", " (2\u00D7 with Attack action)"],
				weaponOptions : {
					regExpSearch : /^(?=.*radiant)(?=.*(sun|light))(?=.*bolt).*$/i,
					name : "Radiant Sun Bolt",
					source : [["S", 131], ["X", 35]],
					ability : 2,
					type : "Spell",
					damage : [1, 4, "radiant"],
					range : "30 ft",
					description : "If used in an Attack action, spend 1 ki point to use it twice as a bonus action",
					monkweapon : true,
					abilitytodamage : true
				},
				weaponsAdd : ['Radiant Sun Bolt'],
				extraname : "Way of the Sun Soul 6",
				"searing arc strike" : {
					name : "Searing Arc Strike",
					source : [["S", 131], ["X", 35]],
					description : desc([
						"After taking the Attack action, I can cast Burning Hands as a bonus action [PHB 220]",
						"For every additional ki point I spend, Burning hands is cast at 1 higher spell level",
						"The maximum total ki points I can spend for this (including the 2) is half my Monk level"
					]),
					additional : levels.map(function (n) {
						if (n < 3) return "";
						var xtrKi = Math.max(0,Math.floor(n/2) - 2);
						return "2 ki points + max " + xtrKi + " ki point" + (xtrKi == 1 ? "" : "s");
					}),
					action : ["bonus action", " (after Attack action)"],
					spellcastingBonus : {
						name : "Searing Arc Strike",
						spells : ["burning hands"],
						selection : ["burning hands"],
						firstCol : 2
					},
					spellFirstColTitle : "Ki",
					spellChanges : {
						"burning hands" : {
							time : "1 bns",
							description : "3d6+1d6/extra Ki Fire dmg; save halves; unattended flammable objects ignite (ki max 1/2 monk lvl)",
							changes : "After I use the Attack action, I can cast Burning Hands as a bonus action by spending 2 ki points. I can even spend additional ki points to increase its spell level. The total amount of ki points I can spend on it is half my monk level."
						}
					}
				},
				autoSelectExtrachoices : [{
					extrachoice : "searing arc strike",
					minlevel : 6
				}]
			},
			"subclassfeature11" : {
				name : "Searing Sunburst",
				source : [["S", 131], ["X", 35]],
				minlevel : 11,
				description : desc([
					"As an action, anyone in a 20-ft radius light on a point within 150 ft makes a Con save",
					"If failed and not behind opaque total cover, take 2d6 (+ 2d6/ki point) radiant damage"
				]),
				action : ["action", ""],
				additional : "0 ki points + max 3 ki points"
			},
			"subclassfeature17" : {
				name : "Sun Shield",
				source : [["S", 131], ["X", 35]],
				minlevel : 17,
				description : desc([
					"As a reaction, when I'm hit by a melee attack, I can deal 5 + Wis mod radiant damage",
					"I can only do this while my light aura is on; I can turn it on/off as a bonus action"
				]),
				action : [["bonus action", " (start/stop)"], ["reaction", " (hit in melee)"]],
				additional : "30-ft rad bright + 30-ft dim light"
			}
		}
	});
};

// Add 2 subclasses for the Paladin
AddSubClass("paladin", "oath of conquest-xgte", {
	regExpSearch : /^((?=.*(knight tyrant|iron mongers))|((?=.*(conquest|tyranny|tyrant))(((?=.*paladin)|((?=.*(exalted|sacred|holy|divine))(?=.*(knight|fighter|warrior|warlord|trooper))))))).*$/i,
	subname : "Oath of Conquest",
	source : ["X", 37],
	features : {
		"subclassfeature3" : {
			name : "Channel Divinity: Conquering Presence",
			source : ["X", 38],
			minlevel : 3,
			description : desc([
				"As an action, all creatures of my choice within a 30-ft radius must make a Wisdom save",
				"If failed, a target is frightened for 1 minute; It can save again at the end of each turn"
			]),
			action : ["action", ""],
			spellcastingExtra : ["armor of agathys", "command", "hold person", "spiritual weapon", "bestow curse", "fear", "dominate beast", "stoneskin", "cloudkill", "dominate person"]
		},
		"subclassfeature3.1" : {
			name : "Channel Divinity: Guided Strike",
			source : ["X", 38],
			minlevel : 3,
			description : "\n   " + "When I make an attack roll, I can add a +10 bonus to the roll after seeing the d20 roll"
		},
		"subclassfeature7" : {
			name : "Aura of Conquest",
			source : ["X", 38],
			minlevel : 7,
			description : desc([
				"Creatures that are frightened of me have their speed reduced to 0 while in my aura",
				"They also take psychic damage whenever they start theirs turn within my aura"
			]),
			additional : levels.map(function (n) {
				if (n < 7) return "";
				return (n < 18 ? 10 : 30) + "-foot aura; " + Math.floor(n / 2) + " psychic damage";
			})
		},
		"subclassfeature15" : {
			name : "Scornful Rebuke",
			source : ["X", 38],
			minlevel : 15,
			description : desc([
				"Whenever I'm hit with an attack while I'm not incapacitated, the attacker takes damage",
				"This is psychic damage equal to my Charisma modifier (minimum of 1)"
			])
		},
		"subclassfeature20" : {
			name : "Invincible Conqueror",
			source : ["X", 38],
			minlevel : 20,
			description : desc([
				"As an action, I can gain the following benefits for 1 minute:",
				" - I have resistance to all damage",
				" - I can make an additional attack as part of my Attack action",
				" - My melee weapons score critical hits on a roll of 19 or 20"
			]),
			recovery : "long rest",
			usages : 1,
			action : ["action", ""]
		}
	}
});
AddSubClass("paladin", "oath of redemption-xgte", {
	regExpSearch : /^((?=.*redeemer)|((?=.*redemption)(((?=.*paladin)|((?=.*(exalted|sacred|holy|divine))(?=.*(knight|fighter|warrior|warlord|trooper))))))).*$/i,
	subname : "Oath of Redemption",
	source : ["X", 38],
	features : {
		"subclassfeature3" : {
			name : "Channel Divinity: Emissary of Peace",
			source : ["X", 39],
			minlevel : 3,
			description : "\n   " + "As a bonus action, I grant myself +5 on Charisma (Persuasion) checks for 10 minutes",
			action : ["bonus action", ""],
			spellcastingExtra : ["sanctuary", "sleep", "calm emotions", "hold person", "counterspell", "hypnotic pattern", "otiluke's resilient sphere", "stoneskin", "hold monster", "wall of force"]
		},
		"subclassfeature3.1" : {
			name : "Channel Divinity: Rebuke the Violent",
			source : ["X", 39],
			minlevel : 3,
			description : desc([
				"As a reaction after a creature within 30 ft attacks and damages another, I can rebuke it",
				"It takes the same damage as it dealt but as radiant damage, with a Wis save to halve it"
			]),
			action : ["reaction", ""]
		},
		"subclassfeature7" : {
			name : "Aura of the Guardian",
			source : ["X", 39],
			minlevel : 7,
			description : desc([
				"As a reaction when an ally within my aura takes damage, I instead take the damage",
				"This damage can't be reduced in any way; Other effects might still apply to my ally"
			]),
			additional : levels.map(function (n) { return n < 7 ? "" : (n < 18 ? 10 : 30) + "-foot aura"; }),
			action : ["reaction", ""]
		},
		"subclassfeature15" : {
			name : "Protective Spirit",
			source : ["X", 39],
			minlevel : 15,
			description : "\n   " + "At the end of my turn when I'm below half HP and not incapacitated, I regain HP",
			additional : levels.map(function (n) { return n < 15 ? "" : "1d6+" + Math.floor(n/2) + " HP"; })
		},
		"subclassfeature20" : {
			name : "Emissary of Redemption",
			source : ["X", 39],
			minlevel : 20,
			description : desc([
				"When taking damage from a creature, I take only half and it takes the other half",
				"This stops working on any that I attack or force to make a save, until I have a long rest"
			]),
			dmgres : ["All from creatures"]
		}
	}
});

// Add 3 subclasses for the Ranger
AddSubClass("ranger", "gloom stalker-xgte", {
	regExpSearch : /^(?=.*gloom)(?=.*stalker).*$/i,
	subname : "Gloom Stalker",
	source : ["X", 41],
	fullname : "Gloom Stalker",
	features : {
		"subclassfeature3" : {
			name : "Dread Ambusher",
			source : ["X", 42],
			minlevel : 3,
			description : desc([
				"I can add my Wisdom modifier to my initiative rolls",
				"In the first turn of combat I get +10 ft speed and an extra attack with the Attack action",
				"If I take the Attack action and that extra attack hits, it does +1d8 damage"
			]),
			addMod : { type : "skill", field : "Init", mod : "Wis", text : "I can add my Wisdom modifier to my initiative rolls." }
		},
		"subclassfeature3.1" : {
			name : "Gloom Stalker Magic",
			source : ["X", 42],
			minlevel : 3,
			description : desc([
				"I add a spell to my known spells at level 3, 5, 9, 13, and 17",
				"These count as ranger spells, but do not count against the number of spells I can know"
			]),
			spellcastingExtra : ["disguise self", "rope trick", "fear", "greater invisibility", "seeming"].concat(new Array(95)).concat("AddToKnown")
		},
		"subclassfeature3.2" : {
			name : "Umbral Sight",
			source : ["X", 42],
			minlevel : 3,
			description : desc([
				"I gain 60 ft darkvision, or add 30 ft to darkvision if I already had it because of my race",
				"When I'm in darkness, others gain no benefit from darkvision to detect me"
			]),
			vision : [["Darkvision", "fixed 60"], ["Darkvision", "+30"]]
		},
		"subclassfeature7" : {
			name : "Iron Mind",
			source : ["X", 42],
			minlevel : 7,
			description : "\n   " + "I gain proficiency with Wis saves, or if I'm already proficient, either Int or Cha saves",
			saves : ["Wis"]
		},
		"subclassfeature11" : {
			name : "Stalker's Flurry",
			source : ["X", 42],
			minlevel : 11,
			description : "\n   " + "Once on each of my turns when I miss a weapon attack, I can make an extra attack"
		},
		"subclassfeature15" : {
			name : "Shadowy Dodge",
			source : ["X", 42],
			minlevel : 15,
			description : "\n   " + "As a reaction when I'm attacked without adv., I can impose disadv. on the attack roll",
			action : ["reaction", " (when attacked)"]
		}
	}
});
AddSubClass("ranger", "horizon walker-xgte", {
	regExpSearch : /^(?=.*horizon)(?=.*walker).*$/i,
	subname : "Horizon Walker",
	source : ["X", 42],
	fullname : "Horizon Walker",
	attacks : [1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2],
	features : {
		"subclassfeature3" : {
			name : "Detect Portal",
			source : ["X", 42],
			minlevel : 3,
			description : "\n   " + "As an action, I sense the distance and direction to the closest planar portal within 1 mile",
			usages : 1,
			recovery : "short rest",
			action : ["action", ""]
		},
		"subclassfeature3.1" : {
			name : "Horizon Walker Magic",
			source : ["X", 42],
			minlevel : 3,
			description : desc([
				"I add a spell to my known spells at level 3, 5, 9, 13, and 17",
				"These count as ranger spells, but do not count against the number of spells I can know"
			]),
			spellcastingExtra : ["protection from evil and good", "misty step", "haste", "banishment", "teleportation circle"].concat(new Array(95)).concat("AddToKnown")
		},
		"subclassfeature3.2" : {
			name : "Planar Warrior",
			source : ["X", 42],
			minlevel : 3,
			description : desc([
				"As a bonus action, I choose one creature that I can see within 30 ft of me",
				"All damage from my first weapon attack that hits it on this turn becomes force damage",
				"In addition, that first hit does extra damage"
			]),
			additional : levels.map(function (n) { return n < 3 ? "" : "+" + (n < 11 ? 1 : 2) + "d8 force damage"; }),
			action : ["bonus action", ""]
		},
		"subclassfeature7" : {
			name : "Ethereal Step",
			source : ["X", 43],
			minlevel : 7,
			description : "\n   " + "As a bonus action, I can cast the Etherealness spell, which lasts until the end of my turn",
			usages : 1,
			recovery : "short rest",
			spellcastingBonus : {
				name : "Ethereal Step",
				spells : ["etherealness"],
				selection : ["etherealness"],
				firstCol : 'oncesr'
			},
			spellChanges : {
				"etherealness" : {
					time : "1 bns",
					duration : "1 rnd",
					description : "I go to Ethereal Plane; move there, but able to perceive 60 ft into the normal plane",
					changes : "Using my Ethereal Step class feature I can cast Etherealness as a bonus action once per short rest, but it only affects myself and lasts until the end of my turn."
				}
			}
		},
		"subclassfeature11" : {
			name : "Distant Strike",
			source : ["X", 43],
			minlevel : 11,
			description : desc([
				"With the Attack action, I can teleport 10 ft before each attack, to a place I can see",
				"If I attack two different creatures with this action, I get an extra attack against a third"
			])
		},
		"subclassfeature15" : {
			name : "Spectral Defense",
			source : ["X", 43],
			minlevel : 15,
			description : "\n   " + "As a reaction when an attack damages me, I can give myself resistance vs. that attack",
			action : ["reaction", ""]
		}
	}
});
AddSubClass("ranger", "monster slayer-xgte", {
	regExpSearch : /^(?=.*monster)(?=.*slayer).*$/i,
	subname : "Monster Slayer",
	source : ["X", 43],
	fullname : "Monster Slayer",
	features : {
		"subclassfeature3" : {
			name : "Hunter's Sense",
			source : ["X", 43],
			minlevel : 3,
			description : desc([
				"As an action, I learn vulnerabilities/immunities/resistances of a target I see within 60 ft",
				"If it is protected from divination magic, I sense it has none of these"
			]),
			action : ["action", ""],
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest"
		},
		"subclassfeature3.1" : {
			name : "Monster Slayer Magic",
			source : ["X", 43],
			minlevel : 3,
			description : "\n   " + "I get bonus spells known, which do not count against the number of spells I can know",
			spellcastingExtra : ["protection from evil and good", "zone of truth", "magic circle", "banishment", "hold monster"].concat(new Array(95)).concat("AddToKnown")
		},
		"subclassfeature3.2" : {
			name : "Slayer's Prey",
			source : ["X", 43],
			minlevel : 3,
			description : desc([
				"As a bonus action, I designate a creature I see within 60 ft; This lasts until I do this again",
				"My first hit to the target with a weapon attack on each of my turns does +1d6 damage"
			]),
			action : ["bonus action", ""]
		},
		"subclassfeature7" : {
			name : "Supernatural Defense",
			source : ["X", 43],
			minlevel : 7,
			description : desc([
				"I add 1d6 to saving throws the current target of my Slayer's Prey forces me to make",
				"In addition, I also add 1d6 to checks to escape that target's grapple"
			])
		},
		"subclassfeature11" : {
			name : "Magic-User's Nemesis",
			source : ["X", 43],
			minlevel : 11,
			description : desc([
				"As a reaction when I see someone within 60 ft casting a spell or teleporting, I can foil it",
				"The target must make a Wisdom save or have its spell or teleport fail and be wasted"
			]),
			action : ["reaction", ""],
			usages : 1,
			recovery : "short rest"
		},
		"subclassfeature15" : {
			name : "Slayer's Counter",
			source : ["X", 43],
			minlevel : 15,
			description : desc([
				"As a reaction when the target of my Slayer's Prey has me make a save, I can attack it",
				"I can make one weapon attack; If this hits, I automatically succeed on the saving throw"
			]),
			action : ["reaction", ""]
		}
	}
});

// Add 4 subclasses for the Rogue
AddSubClass("rogue", "inquisitive-xgte", {
	regExpSearch : /^(?=.*(rogue|miscreant))(?=.*inquisitive).*$/i,
	subname : "Inquisitive",
	source : ["X", 45],
	features : {
		"subclassfeature3" : {
			name : "Ear for Deceit",
			source : ["X", 45],
			minlevel : 3,
			description : "\n   " + "For Wis (Insight) to sense if another is lying, I can treat a die roll of 7 or lower as an 8"
		},
		"subclassfeature3.1" : {
			name : "Eye for Detail",
			source : ["X", 46],
			minlevel : 3,
			description : desc([
				"As a bonus action, I can do either of the following:",
				"\u2022 Make a Wisdom (Perception) check to spot a hidden creature or object",
				"\u2022 Make an Intelligence (Investigation) check to uncover or decipher clues"
			]),
			action : ["bonus action", ""]
		},
		"subclassfeature3.2" : {
			name : "Insightful Fighting",
			source : ["X", 46],
			minlevel : 3,
			description : desc([
				"As a bonus action, I can decipher the tactics of another I can see that's not incapacitated",
				"I have to make a Wisdom (Insight) check vs. the target's Charisma (Deception) check",
				"If I succeed, I can use my sneak attack on it even if I don't have adv. (but not if disadv.)",
				"This benefit lasts for 1 minute or until I successfully use Insightful Fighting again"
			]),
			action : ["bonus action", ""]
		},
		"subclassfeature9" : {
			name : "Steady Eye",
			source : ["X", 46],
			minlevel : 9,
			description : desc([
				"I'm more perceptive when I don't move more than half my speed in the same turn",
				"If so, I gain adv. on Wis (Perception) and Int (Investigation) checks during that turn"
			])
		},
		"subclassfeature13" : {
			name : "Unerring Eye",
			source : ["X", 46],
			minlevel : 13,
			description : desc([
				"As an action, I can sense magical deceptions within 30 feet of me, but not what it does",
				"I learn the presence of illusions, shapechanged creatures, or magic designed to deceive"
			]),
			action : ["action", ""],
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest"
		},
		"subclassfeature17" : {
			name : "Eye for Weakness",
			source : ["X", 46],
			minlevel : 17,
			description : "\n   " + "While my Insightful Fighting is active, I add 3d6 to sneak attacks against that target"
		}
	}
});
if (!ClassSubList["rogue-mastermind"] && (!SourceList.S || SourceList.S.abbreviation.toLowerCase() !== "scag")) {
	// the Mastermind subclass is identical to the one in SCAG, so only add if it that one doesn't exist yet
	AddSubClass("rogue", "mastermind", {
		regExpSearch : /^(?!.*(barbarian|bard|cleric|druid|fighter|monk|paladin|ranger|sorcerer|warlock|wizard))(?=.*(mastermind|strategist)).*$/i,
		subname : "Mastermind",
		fullname : "Mastermind",
		source : [["S", 135], ["X", 46]],
		features : {
			"subclassfeature3" : {
				name : "Master of Intrigue",
				source : [["S", 135], ["X", 46]],
				minlevel : 3,
				description : desc([
					"I gain proficiency with disguise kits, forgery kits, one gaming set, and two languages",
					"I can mimic speech patterns and accents if I've heard them for at least 1 minute"
				]),
				languageProfs : [2],
				toolProfs : ["Disguise kit", "Forgery kit", ["Gaming set", 1]]
			},
			"subclassfeature3.1" : {
				name : "Master of Tactics",
				source : [["S", 135], ["X", 46]],
				minlevel : 3,
				description : desc([
					"I can use the Help action as a bonus action",
					"This even works if the ally attacks a target within 30 ft of me that can see or hear me"
				]),
				action : ["bonus action", ""]
			},
			"subclassfeature9" : {
				name : "Insightful Manipulator",
				source : [["S", 135], ["X", 46]],
				minlevel : 9,
				description : desc([
					"By spending 1 minute observing/interacting outside of combat I can learn capabilities",
					"The DM tells me if the target is my equal, superior, or inferior in regard to two things:",
					" - Intelligence score    - Wisdom score    - Charisma score    - Class levels (if any)"
				])
			},
			"subclassfeature13" : {
				name : "Misdirection",
				source : [["S", 135], ["X", 46]],
				minlevel : 13,
				description : desc([
					"As a reaction, I can redirect an attack meant for me to a creature within 5 ft of me",
					"This only works if the creature is providing me with cover against the attack"
				]),
				action : ["reaction", ""]
			},
			"subclassfeature17" : {
				name : "Soul of Deceit",
				source : [["S", 135], ["X", 46]],
				minlevel : 17,
				description : desc([
					"My thoughts can't be read by telepathy or similar means; I can project false thoughts",
					"For that, I must pass a Cha (Deception) vs. Wis (Insight) check to fool the mind reader",
					"Magic always determines I'm truthful; I can't be magically compelled to tell the truth"
				])
			}
		}
	});
};
AddSubClass("rogue", "scout-xgte", {
	regExpSearch : /scout/i,
	subname : "Scout",
	source : ["X", 47],
	features : {
		"subclassfeature3" : {
			name : "Skirmisher",
			source : ["X", 47],
			minlevel : 3,
			description : "\n   " + "As a reaction when a hostile ends its turn within 5 ft of me, I can move half my speed",
			action : ["reaction", ""]
		},
		"subclassfeature3.1" : {
			name : "Survivalist",
			source : ["X", 47],
			minlevel : 3,
			description : "\n   " + "I gain proficiency and expertise with the Nature and Survival skills",
			skills : [['Nature', 'full'], ['Survival', 'full']]
		},
		"subclassfeature9" : {
			name : "Superior Mobility",
			source : ["X", 47],
			minlevel : 9,
			description : "\n   " + "I gain +10 ft to my walking speed (and swimming/climbing speed, if applicable)",
			speed : {
				walk : { spd : "+10", enc : "+10" },
				climb : { spd : "_10", enc : "_10" },
				swim : { spd : "_10", enc : "_10" }
			}
		},
		"subclassfeature13" : {
			name : "Ambush Master",
			source : ["X", 47],
			minlevel : 13,
			description : desc([
				"I gain advantage on Initiative rolls",
				"The first creature I hit in the first round of combat becomes an easy target",
				"Until the start of my next turn, all attacks against the target have advantage"
			]),
			advantages : [["Initiative", true]]
		},
		"subclassfeature17" : {
			name : "Sudden Strike",
			source : ["X", 47],
			minlevel : 17,
			description : desc([
				"With the Attack action, I can make one additional attack as a bonus action",
				"This attack can benefit from my Sneak Attack even if I already used it this turn",
				"However, I still can't use Sneak Attack on a single target more than once per turn"
			]),
			action : ["bonus action", " (with Attack action)"]
		}
	}
});
if (!ClassSubList["rogue-swashbuckler"] && (!SourceList.S || SourceList.S.abbreviation.toLowerCase() !== "scag")) {
	// the Swashbuckler subclass is identical to the one in SCAG, so only add if it that one doesn't exist yet
	AddSubClass("rogue", "swashbuckler", {
		regExpSearch : /^(?!.*(barbarian|bard|cleric|druid|fighter|monk|paladin|ranger|sorcerer|warlock|wizard))(?=.*swashbuckl).*$/i,
		subname : "Swashbuckler",
		fullname : "Swashbuckler",
		source : [["S", 135], ["X", 47]],
		features : {
			"subclassfeature3" : {
				name : "Fancy Footwork",
				source : [["S", 135], ["X", 47]],
				minlevel : 3,
				description : desc([
					"Enemies I make a melee attack against in my turn can't use opportunity attacks on me",
					"This lasts until the end of my current turn"
				])
			},
			"subclassfeature3.1" : {
				name : "Rakish Audacity",
				source : [["S", 136], ["X", 47]],
				minlevel : 3,
				description : desc([
					"I don't need advantage to sneak attack if my target is the only one within 5 ft of me",
					"I still can't sneak attack if I have disadv.; I add my Charisma modifier to initiative rolls"
				]),
				addMod : { type : "skill", field : "Init", mod : "Cha", text : "I can add my Charisma modifier to initiative rolls." }
			},
			"subclassfeature9" : {
				name : "Panache",
				source : [["S", 136], ["X", 47]],
				minlevel : 9,
				description : desc([
					"As an action, I can beguile a creature that hears and understands me, for 1 minute",
					"It must succeed a Wis (Insight) check opposed by my Cha (Persuasion) or be affected as:",
					"\u2022 A hostile target gains disadv. on attacks and can't do opportunity attacks vs. not-me",
					"  This effect ends if an ally attacks or casts a spell vs. it, or if it and I are 60 ft apart",
					"\u2022 Targets that are not hostile are charmed and regard me as a friendly acquaintance",
					"  This effect ends if me or an ally do anything harmful to it"
				]),
				action : ["action", ""]
			},
			"subclassfeature13" : {
				name : "Elegant Maneuver",
				source : [["S", 136], ["X", 47]],
				minlevel : 13,
				description : "\n   " + "As a bonus action, I can gain adv. on my next Dex (Acrobatics) or Str (Athletics) check",
				action : ["bonus action", ""]
			},
			"subclassfeature17" : {
				name : "Master Duelist",
				source : [["S", 136], ["X", 47]],
				minlevel : 17,
				description : "\n   " + "Once per short rest, when I miss with an attack roll, I can roll again with advantage",
				recovery : "short rest",
				usages : 1
			}
		}
	});
};

// Add 3 subclasses for the Sorcerer
AddSubClass("sorcerer", "divine soul-xgte", { // this code includes contributions by SoilentBrad
	regExpSearch : /^(?=.*divine)(?=.*soul).*$/i,
	subname : "Divine Soul",
	source : ["X", 50],
	fullname : "Divine Soul",
	spellcastingList : {
		"class" : ["cleric", "sorcerer"]
	},
	features : {
		"subclassfeature1" : {
			name : "Divine Magic",
			source : ["X", 50],
			minlevel : 1,
			description : desc([
				"When I select my 1st level or higher spells, I can also pick spells from the cleric spell list",
				"These cleric spells count as sorcerer spells for me",
				"I also learn a spell based on my affinity, use the \"Choose Feature\" button above for this"
			]),
			choices : ["Good", "Evil", "Law", "Chaos", "Neutrality"],
			"good" : {
				name : "Divine Magic: Good",
				description : desc([
					"When I select my 1st level or higher spells, I can also pick spells from the cleric spell list",
					"I also learn Cure Wounds, which doesn't count against my number of spells known",
					"These count as sorcerer spells for me; I can only replace the bonus spell with a cleric spell"
				]),
				spellcastingBonus : {
					name : "Divine Magic (Good)",
					"class" : "cleric",
					level : [1,9],
					selection : ["cure wounds"]
				},
				dependentChoices : "eagle"
			},
			"evil" : {
				name : "Divine Magic: Evil",
				description : desc([
					"When I select my 1st level or higher spells, I can also pick spells from the cleric spell list",
					"I also learn Inflict Wounds, which doesn't count against my number of spells known",
					"These count as sorcerer spells for me; I can only replace the bonus spell with a cleric spell"
				]),
				spellcastingBonus : {
					name : "Divine Magic (Evil)",
					"class" : "cleric",
					level : [1,9],
					selection : ["inflict wounds"]
				},
				dependentChoices : "bat"
			},
			"law" : {
				name : "Divine Magic: Law",
				description : desc([
					"When I select my 1st level or higher spells, I can also pick spells from the cleric spell list",
					"I also learn Bless, which doesn't count against my number of spells known",
					"These count as sorcerer spells for me; I can only replace the bonus spell with a cleric spell"
				]),
				spellcastingBonus : {
					name : "Divine Magic (Law)",
					"class" : "cleric",
					level : [1,9],
					selection : ["bless"]
				},
				dependentChoices : "eagle"
			},
			"chaos" : {
				name : "Divine Magic: Chaos",
				description : desc([
					"When I select my 1st level or higher spells, I can also pick spells from the cleric spell list",
					"I also learn Bane, which doesn't count against my number of spells known",
					"These count as sorcerer spells for me; I can only replace the bonus spell with a cleric spell"
				]),
				spellcastingBonus : {
					name : "Divine Magic (Chaos)",
					"class" : "cleric",
					level : [1,9],
					selection : ["bane"]
				},
				dependentChoices : "bat"
			},
			"neutrality" : {
				name : "Divine Magic: Neutrality",
				description : desc([
					"When I select my 1st level or higher spells, I can also pick spells from the cleric spell list",
					"I learn Protection from Evil \u00D7 Good; It doesn't count against my number of spells known",
					"These count as sorcerer spells for me; I can only replace the bonus spell with a cleric spell"
				]),
				spellcastingBonus : {
					name : "Divine Magic (Neutrality)",
					"class" : "cleric",
					level : [1,9],
					selection : ["protection from evil and good"]
				},
				dependentChoices : "dragonfly"
			},
			choiceDependencies : [{
				feature : "subclassfeature14",
				choiceAttribute : true
			}]
		},
		"subclassfeature1.2" : {
			name : "Favored by the Gods",
			source : ["X", 50],
			minlevel : 1,
			description : "\n   " + "If I fail a saving throw or miss with an attack roll, I can add 2d4 to the total",
			recovery : "short rest",
			usages : 1
		},
		"subclassfeature6" : {
			name : "Empowered Healing",
			source : ["X", 50],
			minlevel : 6,
			description : desc([
				"Once per turn, when I or an ally in 5 ft roll dice to healing with a spell, I can reroll dice",
				"By spending 1 sorcery point; I can reroll any number of those dice for that spell once"
			]),
			additional : "1 sorcery point"
		},
		"subclassfeature14" : {
			name : "Otherworldy Wings",
			source : ["X", 50],
			minlevel : 14,
			description : desc([
				"As a bonus action, I can manifest a pair of spectral wings that give me 30 ft fly speed",
				"These wings last until I become incapacitated or I dismiss them as a bonus action"
			]),
			choices : ["eagle", "bat", "dragonfly"],
			choicesNotInMenu : true,
			"eagle" : {
				name : "Otherworldy Wings",
				description : desc([
					"As a bonus action, I manifest a pair of spectral eagle wings, giving me 30 ft fly speed",
					"These wings last until I become incapacitated or I dismiss them as a bonus action"
				])
			},
			"bat" : {
				name : "Otherworldy Wings",
				description : desc([
					"As a bonus action, I manifest a pair of spectral bat wings, giving me 30 ft fly speed",
					"These wings last until I become incapacitated or I dismiss them as a bonus action"
				])
			},
			"dragonfly" : {
				name : "Otherworldy Wings",
				description : desc([
					"As a bonus action, I create a pair of spectral dragonfly wings, giving me 30 ft fly speed",
					"These wings last until I become incapacitated or I dismiss them as a bonus action"
				])
			},
			action : ["bonus action", ""],
			speed : { fly : { spd : 30, enc : 20 } }
		},
		"subclassfeature18" : {
			name : "Unearthly Recovery",
			source : ["X", 50],
			minlevel : 18,
			description : desc([
				"As a bonus action when I have less than half of my max HP remaining, I can heal myself",
				"I regain a number of HP equal to half my hit point maximum"
			]),
			action : ["bonus action", ""],
			recovery : "long rest",
			usages : 1
		}
	}
});
AddSubClass("sorcerer", "shadow magic-xgte", {
	regExpSearch : /^(?=.*(sorcerer|witch))(?=.*shadow).*$/i,
	subname : "Shadow Magic",
	source : ["X", 50],
	fullname : "Shadow Sorcerer",
	features : {
		"subclassfeature1" : {
			name : "Eyes of the Dark",
			source : ["X", 51],
			minlevel : 1,
			description : "\n   " + "I gain 120 ft darkvision",
			vision : [["Darkvision", 120]]
		},
		"subclassfeature1.1" : {
			name : "Strength of the Grave",
			source : ["X", 51],
			minlevel : 1,
			description : desc([
				"When damage reduces me to 0 HP, that isn't radiant damage or a critical hit,",
				"I can make a Charisma save (DC 5 + damage taken) to drop to 1 HP instead"
			]),
			usages : 1,
			recovery : "long rest"
		},
		"subclassfeature3" : {
			name : "Darkness",
			source : ["X", 51],
			minlevel : 3,
			description : desc([
				"I learn Darkness, which doesn't count against my number of spells known",
				"I can also cast it by spending 2 sorcery points and then I can see through it normally"
			]),
			additional : "2 sorcery points",
			action : ["action", " (2 sorcery points)"],
			spellcastingBonus : {
				name : "Eyes of the Dark",
				spells : ["darkness"],
				selection : ["darkness"]
			}
		},
		"subclassfeature6" : {
			name : "Hound of Ill Omen",
			source : ["X", 51],
			minlevel : 6,
			description : desc([
				"As a bonus action, I summon a hound within 30 ft of a creature I see within 120 ft",
				"The hound has all the stats of a dire wolf with the following exceptions:",
				"\u2022 It is medium size and counts as a monstrosity not a beast",
				"\u2022 It start with a number of temporary hit points equal to half my sorcerer level",
				"\u2022 At the start of its turn, it automatically knows where the (hidden) target is",
				"\u2022 It can only move towards and make (opportunity) attack against the target",
				"\u2022 It can move through other creatures and objects as if they were difficult terrain",
				"\u2022 It takes 5 force damage if it ends its turn inside an object",
				"The target has disadvantage on saves vs. my spells while the hound is within 5 ft of it",
				"It disappears if reduced to 0 HP, if the target is reduced to 0 HP, or after 5 minutes"
			]),
			additional : levels.map(function (n) { return n < 6 ? "" : "3 sorcery points; " + Math.floor(n/2) + " temporary HP"; }),
			action : ["bonus action", " (3 sorcery points)"]
		},
		"subclassfeature14" : {
			name : "Shadow Walk",
			source : ["X", 51],
			minlevel : 14,
			description : desc([
				"As a bonus action when I'm in dim light or darkness, I can teleport up to 120 ft",
				"The destination has to be unoccupied, within line of sight, and in dim light or darkness"
			]),
			action : ["bonus action", ""]
		},
		"subclassfeature18" : {
			name : "Umbral Form",
			source : ["X", 51],
			minlevel : 18,
			additional : "6 sorcery points",
			description : desc([
				"As a bonus action, I transform into a shadow form for 1 minute",
				"While transformed, I have resistance to all damage except force and radiant damage",
				"Also, I can move through other creatures and objects as if they were difficult terrain",
				"I take 5 force damage if I end my turn inside an object",
				"This ends early if I end it as a bonus action, I die, or I'm incapacitated"
			]),
			action : ["bonus action", " (6 sorcery points)"]
		}
	}
});
if (!ClassSubList["sorcerer-storm sorcery"] && (!SourceList.S || SourceList.S.abbreviation.toLowerCase() !== "scag")) {
	// the Storm Sorcery subclass is identical to the one in SCAG, so only add if it that one doesn't exist yet
	AddSubClass("sorcerer", "storm sorcery", {
		regExpSearch : /^(?=.*(sorcerer|witch))((?=.*(storm|tempest|hurricane))|((?=.*air)(?=.*element))).*$/i,
		subname : "Storm Sorcery",
		fullname : "Storm Sorcerer",
		source : [["S", 137], ["X", 51]],
		features : {
			"subclassfeature1" : {
				name : "Wind Speaker",
				source : [["S", 137], ["X", 52]],
				minlevel : 1,
				description : "\n   " + "I can speak, read, and write Primordial (and its dialects Aquan, Auran, Ignan, Terran)",
				languageProfs : ["Primordial"]
			},
			"subclassfeature1.1" : {
				name : "Tempestuous Magic",
				source : [["S", 137], ["X", 52]],
				minlevel : 1,
				description : desc([
					"As a bonus action, before or after casting a 1st-level or higher spell, I can fly 10 ft",
					"This movement doesn't provoke opportunity attacks as whirling gust of air surround me"
				]),
				action : ["bonus action", " (with casting)"]
			},
			"subclassfeature6" : {
				name : "Heart of the Storm",
				source : [["S", 137], ["X", 52]],
				minlevel : 6,
				description : desc([
					"I have resistance to lightning and thunder damage",
					"When I start casting a 1st-level or higher spell that deals lightning or thunder damage,",
					"I deal lightning or thunder damage to a creature within 10 ft of me that I can see"
				]),
				additional : levels.map(function (n) { return n < 6 ? "" : Math.floor(n/2) + " damage"; }),
				dmgres : ["Lightning", "Thunder"]
			},
			"subclassfeature6.1" : {
				name : "Storm Guide",
				source : [["S", 137], ["X", 52]],
				minlevel : 6,
				description : desc([
					"As an action, I can stop rain around me in 20-ft radius; bonus action for it to resume",
					"As a bonus action, I can choose the direction of wind around me in a 100-ft radius",
					"This lasts until the end of my next turn and doesn't alter the wind's speed"
				]),
				action : ["bonus action", ""]
			},
			"subclassfeature14" : {
				name : "Storm's Fury",
				source : [["S", 137], ["X", 52]],
				minlevel : 14,
				description : desc([
					"As a reaction when hit by a melee attack, I can deal lightning damage to the attacker",
					"The attacker must also make a Strength save or be pushed up to 20 ft away from me"
				]),
				action : ["reaction", ""],
				additional : levels.map(function (n) { return n < 14 ? "" : n + " lightning damage"; })
			},
			"subclassfeature18" : {
				name : "Wind Soul",
				source : [["S", 137], ["X", 52]],
				minlevel : 18,
				description : desc([
					"I have immunity to lightning and thunder damage and gain magical 60 ft fly speed",
					"As an action, I reduce my fly speed to 30 ft and give allies 30 ft fly speed for 1 hour",
					"I can do this once per short rest for up to 3 + my Charisma modifier allies within 30 ft"
				]),
				action : ["action", ""],
				savetxt : { immune : ["lightning", "thunder"] },
				speed : { fly : { spd : "fixed 60", enc : "fixed 60" } },
				usages : 1,
				recovery : "short rest"
			}
		}
	});
};

// Add 2 subclasses for the Warlock
AddSubClass("warlock", "the celestial-xgte", {
	regExpSearch : /^(?=.*warlock)(?=.*celestial).*$/i,
	subname : "the Celestial",
	source : ["X", 54],
	spellcastingExtra : ["cure wounds", "guiding bolt", "flaming sphere", "lesser restoration", "daylight", "revivify", "guardian of faith", "wall of fire", "flame strike", "greater restoration"],
	features : {
		"subclassfeature1" : {
			name : "Bonus Cantrips",
			source : ["X", 54],
			minlevel : 1,
			description : "\n   " + "I learn the Light and Sacred Flame cantrips, not counting for the number I can know",
			spellcastingBonus : [{
				name : "Bonus Cantrips",
				spells : ["light"],
				selection : ["light"]
			}, {
				name : "Bonus Cantrips",
				spells : ["sacred flame"],
				selection : ["sacred flame"]
			}]
		},
		"subclassfeature1.1" : {
			name : "Healing Light",
			source : ["X", 54],
			minlevel : 1,
			description : desc([
				"As a bonus action, I can heal a creature I can see within 60 ft by expending dice",
				"I can expend up to my Charisma modifier (min 1) of dice from my pool at a time",
				"The target heals HP equal to the roll of the dice; I regain all expended dice on a long rest"
			]),
			usages : levels.map(function (n) { return (n + 1) + "d6 per "; }),
			usagescalc : "event.value = !classes.known.warlock ? '' : (1 + classes.known.warlock.level) + 'd6';",
			recovery : "long rest",
			action : ["bonus action", ""]
		},
		"subclassfeature6" : {
			name : "Radiant Soul",
			source : ["X", 55],
			minlevel : 6,
			description : desc([
				"I add my Cha modifier once to the fire or radiant damage of cantrips and spells I cast",
				"This bonus only applies to one target; Also, I have resistance to radiant damage"
			]),
			dmgres : ["Radiant"],
			calcChanges : {
				atkCalc : [
					function (fields, v, output) {
						if (v.isSpell && (/fire|radiant/i).test(fields.Damage_Type)) {
							output.extraDmg += What('Cha Mod');
						};
					},
					"Cantrips and spells that fire or radiant damage get my Charisma modifier added to their damage to one target."
				],
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "fire|radiant", "Cha");
					},
					"Cantrips and spells that fire or radiant damage get my Charisma modifier added to their damage to one target."
				]
			}
		},
		"subclassfeature10" : {
			name : "Celestial Resilience",
			source : ["X", 55],
			minlevel : 10,
			description : desc([
				"When I finish a short or long rest, I and up to five allies gain temporary hit points",
				"I get my warlock level + Cha mod, while my allies get half my warlock level + Cha mod"
			]),
			additional : levels.map(function (n) { return n < 10 ? "" : "Me: " + n + "+Cha mod; Allies: " + Math.floor(n / 2) + "+Cha mod"; })
		},
		"subclassfeature14" : {
			name : "Searing Vengeance",
			source : ["X", 55],
			minlevel : 14,
			description : desc([
				"At the start of my turn when I would make a death save, I can instead spring back up",
				"I recover HP equal to half my current HP maximum, and can then stand up if I choose",
				"When I do, creatures of my choice within 30 ft take 2d8 + Cha mod in radiant damage",
				"Damaged creatures are blinded until the end of my current turn"
			]),
			usages : 1,
			recovery : "long rest"
		}
	}
});
AddSubClass("warlock", "the hexblade-xgte", { // this code includes contributions by SoilentBrad
	regExpSearch : /^(?=.*hexblade)(?=.*warlock).*$/i,
	subname : "the Hexblade",
	source : ["X", 55],
	spellcastingExtra : ["shield", "wrathful smite", "blur", "branding smite", "blink", "elemental weapon", "phantasmal killer", "staggering smite", "banishing smite", "cone of cold"],
	features : {
		"subclassfeature1" : {
			name : "Hexblade's Curse",
			source : ["X", 55],
			minlevel : 1,
			description : desc([
				"As a bonus action, I can curse a creature I can see within 30 ft of me for 1 minute",
				"\u2022 I add my proficiency bonus to damage rolls against the cursed target",
				"\u2022 My attack rolls against the curse target score a critical hit on a roll of 19 and 20",
				"\u2022 If the target dies while cursed, I regain HP equal to my warlock level + Cha mod",
				"The curse ends after 1 minute, when the target dies, I die, or I'm incapacitated"
			]),
			recovery : "short rest",
			usages : 1,
			action : ["bonus action", ""],
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (!v.isDC && (/curse/i).test(v.WeaponText) && !v.CritChance) {
							v.CritChance = 19;
							fields.Description += (fields.Description ? '; ' : '') + 'Crit on 19-20';
						}
					},
					"If I include the word 'Curse' in the name of a weapon, the automation will treat the attack as being against a target of the Hexblade's Curse: adding my proficiency bonus to the damage and adding the increased chance of a critical hit to the description."
				],
				atkCalc : [
					function (fields, v, output) {
						if ((/curse/i).test(v.WeaponText)) output.extraDmg += output.prof;
					}, ""]
			}
		},
		"subclassfeature1.1" : {
			name : "Hex Warrior",
			source : ["X", 55],
			minlevel : 1,
			description : desc([
				"I gain proficiency with medium armor, shields, and martial weapons",
				"When I finish a long rest, I can imbue one weapon I touch with my will",
				"Until my next long rest, I can use it with Charisma instead of Strength or Dexterity",
				"I have to be proficient with the weapon and it can't have the two-handed property",
				"This benefit also works with every weapon from Pact of the Blade, with no restriction"
			]),
			armorProfs : [false, true, false, true],
			weaponProfs : [false, true],
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						var hasPactWeapon = GetFeatureChoice('class', 'warlock', 'pact boon') == 'pact of the blade';
						if (What('Cha Mod') > What(AbilityScores.abbreviations[fields.Mod - 1] + ' Mod') && (v.pactWeapon || v.theWea.pactWeapon || (hasPactWeapon && (/\bpact\b/i).test(v.WeaponText)) || (/^(?=.*hexblade)(?!.*\b(2|two).?hand(ed)?s?\b).*$/i).test(v.WeaponText))) {
							fields.Mod = 6;
						};
					},
					"If I include the word 'Hexblade' in the name of a weapon that is not two-handed, it gets treated as the weapon I imbued to use Charisma instead of Strength or Dexterity, if my Charisma modifier is higher than the ability it would otherwise use. Alternatively, if I have the Pact of the Blade feature, this will also work if I include 'Pact' in the name of a weapon, regardless if it has the two-handed property."
				]
			}
		},
		"subclassfeature6" : {
			name : "Accursed Specter",
			source : ["X", 56],
			minlevel : 6,
			description : desc([
				"When I slay a humanoid, I can curse its soul and have it rise as a specter from its corpse",
				"It has the stats of a specter (MM 279) with temporary HP equal to half my warlock level",
				"It rolls initiative and has its own turns, obeying my verbal commands",
				"It gains a bonus to attack rolls equal to my Charisma modifier (min +0)",
				"The specter remains until the end of my next long rest, at which point it vanishes"
			]),
			additional : levels.map( function(n) { return n < 6 ? "" : Math.floor(n/2) + " temp HP"; }),
			usages : 1,
			recovery : "long rest",
			eval : function() {
				var AScompA = isTemplVis('AScomp') ? What('Template.extras.AScomp').split(',') : false;
				var prefix = false;
				if (AScompA) {
					for (var a = 1; a < AScompA.length; a++) {
						if (!What(AScompA[a] + 'Comp.Race')) {
							prefix = AScompA[a];
							break;
						}
					}
				}
				if (!prefix) prefix = DoTemplate('AScomp', 'Add');
				Value(prefix + 'Comp.Race', 'Specter');
				var theType = tDoc.getField(prefix + 'Comp.Type');
				theType.readonly = true;
				theType.value = 'Accursed';
				for (var a = 1; a <= 3; a++) {
					AddToModFld(prefix + 'BlueText.Comp.Use.Attack.' + a + '.To Hit Bonus', "oCha", false, "Accursed Specter", "The accursed specter adds the warlock's Charisma modifier (oCha) to the to hit bonus of its attacks.");
				}
				Value(prefix + 'Cnote.Left', "Accursed Specter (the Hexblade, XGtE 56)" + desc([
					"When I slay a humanoid, I can curse its soul and have it rise as a specter from its corpse",
					"It has its own turns and obeys my commands until my next long rest, when it vanishes",
					"It uses the stats of a specter with the following bonuses:",
					"\u2022 The accursed specter adds my Charisma modifier to its attack rolls",
					"\u2022 It gains temporary hit points equal to half my warlock level when created"
				]));
				tDoc.getField(prefix + 'Comp.Use.HP.Temp').setAction('Calculate', 'event.value = classes.known.warlock && classes.known.warlock.level ? Math.floor(classes.known.warlock.level / 2) : event.value;');
				AddTooltip(prefix + 'Comp.Use.HP.Temp', "The accursed specter gains half my warlock level as temporary HP when created.");
				var changeMsg = "The Accursed Specter has been added to the companion page at page number " + (tDoc.getField(prefix + 'Comp.Race').page + 1);
				CurrentUpdates.types.push("notes");
				if (!CurrentUpdates.notesChanges) {
					CurrentUpdates.notesChanges = [changeMsg];
				} else {
					CurrentUpdates.notesChanges.push(changeMsg);
				}
			},
			removeeval : function() {
				var AScompA = isTemplVis('AScomp') ? What('Template.extras.AScomp').split(',') : false;
				if (AScompA) {
					for (var a = 1; a < AScompA.length; a++) {
						if (What(AScompA[a] + 'Comp.Type') == 'Accursed' && tDoc.getField(AScompA[a] + 'Comp.Type').readonly) {
							DoTemplate("AScomp", "Remove", AScompA[a]);
							return;
						}
					}
				}
			}
		},
		"subclassfeature10" : {
			name : "Armor of Hexes",
			source : ["X", 56],
			minlevel : 10,
			description : desc([
				"As a reaction when a Hexblade's Curse recipient hits me with an attack, I can roll a d6",
				"On a result of 4 or higher, the attacks misses me instead, regardless of its d20 roll"
			])
		},
		"subclassfeature14" : {
			name : "Master of Hexes",
			source : ["X", 56],
			minlevel : 14,
			description : desc([
				"When the target of my Hexblade's Curse dies, I can curse another I can see within 30 ft",
				"I can't do this while incapacitated and I don't regain HP from the death of the previous"
			])
		}
	}
});

// Add Warlock Invocations
AddWarlockInvocation("Aspect of the Moon (prereq: Pact of the Tome)", {
	name : "Aspect of the Moon",
	description : "\n   " + "I don't need sleep nor can be forced to by any means; I can rest while doing light activity",
	source : [["X", 56], ["UA:RCO", 5]],
	prereqeval : function(v) { return GetFeatureChoice('class', 'warlock', 'pact boon') == 'pact of the tome'; },
	savetxt : { text : ["Nothing can force me to sleep"] }
});
AddWarlockInvocation("Cloak of Flies (prereq: level 5 warlock)", {
	name : "Cloak of Flies",
	description : desc([
		"As a bonus action, I can surround myself with a 5-ft radius magical aura of buzzing flies",
		"It lasts until I'm incapacitated or dismiss it as a bonus action; Total cover block the aura",
		"The aura grants me adv. on Cha (Intimidation), but disadv. on all other Cha checks",
		"Creatures starting their turn in the aura take my Cha mod (min 0) in poison damage"
	]),
	source : [["X", 56], ["UA:RCO", 5]],
	prereqeval : function(v) { return classes.known.warlock.level >= 5; },
	recovery : "short rest",
	usages : 1,
	action : ["bonus action", " (start/stop)"]
});
AddWarlockInvocation("Eldritch Smite (prereq: level 5 warlock, Pact of the Blade)", {
	name : "Eldritch Smite",
	description : desc([
		"Once per turn when I hit a creature with my pact weapon, I can empower the strike",
		"By expending a warlock spell slot, the creature takes extra damage and is knocked prone",
		"It takes 1d8 force damage and another 1d8 force damage per level of the spell slot",
		"The target is only knocked prone if it is Huge or smaller"
	]),
	source : ["X", 56],
	prereqeval : function(v) { return classes.known.warlock.level >= 5 && GetFeatureChoice('class', 'warlock', 'pact boon') == 'pact of the blade'; }
});
AddWarlockInvocation("Ghostly Gaze (prereq: level 7 warlock)", {
	name : "Ghostly Gaze",
	description : desc([
		"As an action, I can gain darkvision, and the ability to see through solid objects, out to 30 ft",
		"Objects appear ghostly to me; This lasts up to 1 minute, while I'm concentrating on this"
	]),
	source : ["X", 56],
	prereqeval : function(v) { return classes.known.warlock.level >= 7; },
	recovery : "short rest",
	usages : 1,
	action : ["action", ""]
});
AddWarlockInvocation("Gift of the Depths (prereq: level 5 warlock)", {
	name : "Gift of the Depths",
	description : desc([
		"I can breathe underwater and I have a swim speed equal to my walking speed",
		"Once per long rest, I can cast Water Breathing without using a spell slot (PHB 287)"
	]),
	source : [["X", 57], ["UA:RCO", 6]],
	spellcastingBonus : {
		name : "Gift of the Depths",
		spells : ["water breathing"],
		selection : ["water breathing"],
		firstCol : 'oncelr'
	},
	prereqeval : function(v) { return classes.known.warlock.level >= 5; },
	speed : { swim : { spd : "walk", enc : "walk" } }
});
AddWarlockInvocation("Gift of the Ever-Living Ones (prereq: Pact of the Chain)", {
	name : "Gift of the Ever-Living Ones",
	description : "\n   " + "When I regain HP while my familiar is within 100 ft, I regain the max the dice can roll",
	source : [["X", 57], ["UA:RCO", 6]],
	prereqeval : function(v) { return GetFeatureChoice('class', 'warlock', 'pact boon') == 'pact of the chain'; }
});
AddWarlockInvocation("Grasp of Hadar (prereq: Eldritch Blast cantrip)", {
	name : "Grasp of Hadar",
	description : "\n   " + "When my Eldritch Blast hits a creature once or more, I can move it 10 ft closer to me",
	source : [["X", 57], ["UA:RCO", 6]],
	prereqeval : function(v) { return v.hasEldritchBlast; },
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.baseWeaponName == 'eldritch blast') fields.Description += '; Target moved 10 ft to me';
			},
			"When I hit a creature with my Eldritch Blast cantrip once or more times in a turn, I can move it in a straight line 10 ft closer to me."
		]
	}
});
AddWarlockInvocation("Improved Pact Weapon (prereq: Pact of the Blade)", {
	name : "Improved Pact Weapon",
	description : desc([
		"I can use any pact weapon I create as my spellcasting focus for warlock spells",
		"Any pact weapon I create has a +1 magic weapon, if it isn't already a magic weapon",
		"I can now also conjure a shortbow, longbow, or light or heavy crossbow as my pact weapon"
	]),
	source : ["X", 57],
	prereqeval : function(v) { return GetFeatureChoice('class', 'warlock', 'pact boon') == 'pact of the blade'; },
	calcChanges : {
		atkCalc : [
			function (fields, v, output) {
				if ((/^(shortbow|longbow|light crossbow|heavy crossbow)$/).test(v.baseWeaponName) && (/\bpact\b/i).test(v.WeaponText)) {
					v.pactWeapon = true;
				}
				if (!v.theWea.isMagicWeapon && !v.thisWeapon[1] && v.pactWeapon) {
					v.pactMag = v.pactMag !== undefined ? 1 - v.pactMag : 1;
					output.magic += v.pactMag;
				};
			},
			"If I include the word 'Pact' in a the name of a melee weapon, shortbow, longbow, light crossbow, or heavy crossbow, it will be treated as my Pact Weapon.\n \u2022 If it doesn't already include a magical bonus in its name, the calculation will add +1 to its To Hit and Damage."
		],
		atkAdd : [
			function (fields, v) {
				if ((/^(shortbow|longbow|light crossbow|heavy crossbow)$/).test(v.baseWeaponName) && (/\bpact\b/i).test(v.WeaponText)) {
					v.pactWeapon = true;
					fields.Proficiency = true;
					if (!v.thisWeapon[1] && !v.theWea.isMagicWeapon && !(/counts as( a)? magical/i).test(fields.Description)) fields.Description += (fields.Description ? '; ' : '') + 'Counts as magical';
				};
			}, ""]
	}
});
AddWarlockInvocation("Lance of Lethargy (prereq: Eldritch Blast cantrip)", {
	name : "Lance of Lethargy",
	description : desc([
		"Once per turn when my Eldritch Blast hits a creature, I can reduce its speed by 10 ft",
		"This speed reduction lasts until the end of my next turn"
	]),
	source : ["X", 57],
	prereqeval : function(v) { return v.hasEldritchBlast; },
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.baseWeaponName == 'eldritch blast') fields.Description += '; 1 target -10 ft speed';
			},
			"Once on each of my turns when I hit a creature with my Eldritch Blast cantrip, I can reduce its speed by 10 ft until the end of my next turn."
		]
	}
});
AddWarlockInvocation("Maddening Hex (prereq: level 5 warlock, Hex spell or warlock feature that curses)", {
	name : "Maddening Hex",
	description : desc([
		"As a bonus action, I cause pain around a target hexed by me within 30 ft that I can see",
		"It and any within 5 ft of it that I can see take my Cha mod (min 1) in psychic damage",
		"The Hex spell and any of my warlock features that curse are considered a hex for this"
	]),
	source : ["X", 57],
	prereqeval : function(v) { return classes.known.warlock.level >= 5 && (isSpellUsed('hex', true) || (/hexblade/).test(classes.known.warlock.subclass)); },
	action : ["bonus action", ""]
});
AddWarlockInvocation("Relentless Hex (prereq: level 7 warlock, Hex spell or warlock feature that curses)", {
	name : "Relentless Hex",
	description : desc([
		"As a bonus action, I can teleport to a target hexed by me within 30 ft that I can see",
		"I teleport up to 30 ft to an unoccupied space that I can see within 5 ft of the target"
	]),
	source : ["X", 57],
	prereqeval : function(v) { return classes.known.warlock.level >= 7 && (isSpellUsed('hex', true) || (/hexblade/).test(classes.known.warlock.subclass)); },
	action : ["bonus action", ""]
});
AddWarlockInvocation("Shroud of Shadow (prereq: level 15 warlock)", {
	name : "Shroud of Shadow",
	description : "\n   " + "I can cast Invisibility at will, without using spell slots (PHB 254)",
	source : [["X", 57], ["UA:RCO", 6]],
	spellcastingBonus : {
		name : "Shroud of Shadow",
		spells : ["invisibility"],
		selection : ["invisibility"],
		firstCol : 'atwill'
	},
	prereqeval : function(v) { return classes.known.warlock.level >= 15; },
	spellChanges : {
		"invisibility" : {
			description : "1 crea invisible; attacking/casting makes the crea visible; anything worn/carried also invisible",
			changes : "With the Shroud of Shadow invocation I can cast Invisibility at will, but when I do so I am unable to cast it using a higher level spell slot."
		}
	}
});
AddWarlockInvocation("Tomb of Levistus (prereq: level 5 warlock)", {
	name : "Tomb of Levistus",
	description : desc([
		"As a reaction when I take damage, I can entomb myself in ice until the end of my turn",
		"During, I get 10 temp. HP per warlock level, which I use to absorb the triggering damage",
		"After, till the ice is gone, I also get vulnerability to fire, 0 speed, and am incapacitated"
	]),
	source : [["X", 57], ["UA:RCO", 6]],
	prereqeval : function(v) { return classes.known.warlock.level >= 5; },
	recovery : "short rest",
	usages : 1,
	action : ["reaction", ""],
	additional : levels.map( function(n) { return (n * 10) + " temp HP"; })
});
AddWarlockInvocation("Trickster's Escape (prereq: level 7 warlock)", {
	name : "Trickster's Escape",
	description : "\n   " + "Once per long rest, I can cast Freedom of Movement on myself without using a spell slot",
	source : [["X", 57], ["UA:RCO", 7]],
	spellcastingBonus : {
		name : "Trickster's Escape",
		spells : ["freedom of movement"],
		selection : ["freedom of movement"],
		firstCol : 'oncelr'
	},
	prereqeval : function(v) { return classes.known.warlock.level >= 7; },
	spellChanges : {
		"freedom of movement" : {
			range : "Self",
			description : "Magic can't reduce my speed, paralyze or restrain me; I can use 5 ft to escape nonmagical restrains",
			changes : "With the Trickster's Escape invocation I can cast Freedom of Movement, but only on myself."
		}
	}
});

// Add 1 subclass for the Wizard
AddSubClass("wizard", "war magic-xgte", {
	regExpSearch : /^(?=.*war)(?=.*(wizard|magic|mage)).*$/i,
	subname : "War Magic",
	source : ["X", 59],
	fullname : "War Mage",
	features : {
		"subclassfeature2" : { //has to be identical to a feature named in the ClassList
			name : "Arcane Deflection",
			source : ["X", 59],
			minlevel : 2,
			description : desc([
				"As a reaction when I'm hit by an attack, I can gain +2 to my AC against that attack",
				"As a reaction when I fail a save, I can gain +4 bonus to that saving throw",
				"After I do either, I can't cast spells other than cantrips until the end of my next turn"
			]),
			action : ["reaction", ""]
		},
		"subclassfeature2.1" : {
			name : "Tactical Wit",
			source : ["X", 60],
			minlevel : 2,
			description : "\n   " + "I gain a bonus to my initiative rolls equal to my Intelligence modifier",
			addMod : { type : "skill", field : "Init", mod : "Int", text : "I can add my Intelligence modifier to initiative rolls." }
		},
		"subclassfeature6" : {
			name : "Power Surge",
			source : ["X", 60],
			minlevel : 6,
			description : desc([
				"I have a pool of stored power surges that I can use to empower my damaging spells",
				"I gain a power surge whenever I successfully end a spell with Dispel Magic or Counterspell",
				"This pool can store a number of power surges equal to my Intelligence modifier (min 1)",
				"It resets to 1 power surge after a long rest or when I have 0 surges left after a short rest",
				"When I deal damage with a wizard spell, I can spend a power surge to do extra damage",
				"One target takes half my wizard level in force damage; I can do this only once per turn"
			]),
			usages : "Resets to 1 after ",
			usagescalc : "event.value = !event.value || event.value == 'Resets to 1 after ' ? 1 : event.value;",
			recovery : "long rest",
			additional : levels.map( function(n) { return n < 6 ? "" : "+" + Math.floor(n/2) + " force damage"; })
		},
		"subclassfeature10" : {
			name : "Durable Magic",
			source : ["X", 60],
			minlevel : 10,
			description : "\n   " + "While I'm maintaining concentration on a spell, I gain +2 to AC and all saving throws"
		},
		"subclassfeature14" : {
			name : "Deflecting Shroud",
			source : ["X", 60],
			minlevel : 14,
			description : desc([
				"When I use my Arcane Deflection feature, magical energy arcs from me to creatures",
				"Up to 3 targets I can see within 60 ft of me take half my wizard level in force damage"
			]),
			additional : levels.map( function(n) { return n < 14 ? "" : Math.floor(n/2) + " force damage"; })
		}
	}
});

// Add feats
FeatsList["bountiful luck-xgte"] = {
	name : "Bountiful Luck",
	source : ["X", 73],
	prerequisite : "Being a Halfling",
	prereqeval : function(v) { return CurrentRace.known.indexOf('halfling') !== -1; },
	descriptionFull : "Your people have extraordinary luck, which you have learned to mystically lend to your companions when you see them falter. You're not sure how you do it; you just wish it, and it happens. Surely a sign of fortune's favor!\n   When an ally you can see within 30 feet of you rolls a 1 on the d20 for an attack roll, an ability check, or a saving throw, you can use your reaction to let the ally reroll the die. The ally must use the new roll\n   When you use this ability, you can't use your Lucky racial trait before the end of your next turn.",
	description : "When an ally I can see within 30 ft of me rolls a 1 on an attack roll, an ability check, or a saving throw, I can use my reaction to let the ally reroll the die. The ally must use the new roll. When I use this, I can't use my racial Lucky trait until the end of my next turn.",
	action : ["reaction", ""]
};
FeatsList["dragon fear-xgte"] = {
	name : "Dragon Fear",
	source : ["X", 74],
	prerequisite : "Being a Dragonborn",
	prereqeval : function(v) { return CurrentRace.known.indexOf('dragonborn') !== -1; },
	descriptionFull : "When angered, you radiate menace. You gain the following benefits:\n \u2022 Increase your Strength, Constitution, or Charisma score by 1, to a maximum of 20.\n \u2022 Instead of exhaling destructive energy, you can expend a use of your Breath Weapon trait to roar, forcing each creature of your choice within 30 feet of you to make a Wisdom saving throw (DC 8 + your proficiency bonus + your Charisma modifier). A target automatically succeeds on the save if it can't hear or see you. On a failed save, a target becomes frightened of you for 1 minute. If the frightened target takes any damage, it can repeat the saving throw, ending the effect on itself on a success.",
	calculate : "event.value = 'I can use my Breath Weapon to roar instead. Chosen creatures within 30 ft that see and hear me must make a DC ' + (8 + Number(What('Proficiency Bonus')) + Number(What('Cha Mod'))) + ' Wis save (8 + prof. bonus + Cha mod) or be frightened of me for 1 min. A target can repeat the save whenever it takes damage. [+1 Str, Con, or Cha]';",
	scorestxt : "+1 Strength, Constitution, or Charisma",
	action : [['action', 'Breath Weapon or Dragon Fear', 'Breath Weapon']]
};
FeatsList["dragon hide-xgte"] = {
	name : "Dragon Hide",
	source : ["X", 74],
	prerequisite : "Being a Dragonborn",
	prereqeval : function(v) { return CurrentRace.known.indexOf('dragonborn') !== -1; },
	descriptionFull : "You manifest scales and claws reminiscent of your draconic ancestors. You gain the following benefits:\n \u2022 Increase your Strength, Constitution, or Charisma score by 1, to a maximum of 20.\n \u2022 Your scales harden. While you aren't wearing armor, you can calculate your AC as 13 + your Dexterity modifier. You can use a shield and still gain this benefit.\n \u2022 You grow retractable claws from the tips of your fingers. Extending or retracting the claws requires no action. The claws are natural weapons, which you can use to make unarmed strikes. If you hit with them, you deal slashing damage equal to 1d4 + your Strength modifier, instead of the normal bludgeoning damage for an unarmed strike.",
	description : "I gain retractable claws that I can retract or extend, requiring no action. While extended, my unarmed strikes deal 1d4 slashing damage. My scales harden, giving me an AC of 13 + Dexterity modifier + shield when I'm not wearing armor. [+1 Str, Con, or Cha]",
	scorestxt : "+1 Strength, Constitution, or Charisma",
	weaponOptions : {
		baseWeapon : "unarmed strike",
		regExpSearch : /^(?=.*(retractable|dragon))(?=.*claw).*$/i,
		name : "Retractable Claws",
		source : ["X", 74],
		damage : [1, 4, "slashing"]
	},
	weaponsAdd : ['Retractable Claws'],
	armorOptions : {
		regExpSearch : /^(?=.*(dragon|draconic|scaly))(?=.*(hide|skin|scales|resilience)).*$/i,
		name : "Dragon Hide",
		source : ["X", 74],
		ac : 13
	},
	armorAdd : "Dragon Hide"
};
FeatsList["drow high magic-xgte"] = {
	name : "Drow High Magic",
	source : ["X", 74],
	prerequisite : "Being a Drow (Dark Elf)",
	prereqeval : function(v) { return CurrentRace.known.indexOf('dark elf') !== -1; },
	descriptionFull : "You learn more of the magic typical of dark elves. You learn the Detect Magic spell and can cast it at will, without expending a spell slot. You also learn Levitate and Dispel Magic, each of which you can cast once without expending a spell slot. You regain the ability to cast those two spells in this way when you finish a long rest. Charisma is your spellcasting ability for all three spells.",
	description : "I can cast Detect Magic at will, without expending a spell slot. I can also cast Levitate and Dispel Magic without expending a spell slot, but each only once per long rest. Charisma is my spellcasting ability for these three spells.",
	spellcastingBonus : [{
		name : "At will",
		spellcastingAbility : 6,
		spells : ["detect magic"],
		selection : ["detect magic"],
		firstCol : 'atwill'
	}, {
		name : "Once per long rest",
		spells : ["levitate"],
		selection : ["levitate"],
		firstCol : 'oncelr'
	}, {
		name : "Once per long rest",
		spells : ["dispel magic"],
		selection : ["dispel magic"],
		firstCol : 'oncelr'
	}]
};
FeatsList["dwarven fortitude-xgte"] = {
	name : "Dwarven Fortitude",
	source : ["X", 74],
	prerequisite : "Being a Dwarf",
	prereqeval : function(v) { return CurrentRace.known.indexOf('dwarf') !== -1; },
	descriptionFull : "You have the blood of dwarf heroes flowing through your veins. You gain the following benefits:\n \u2022 Increase your Constitution score by 1, to a maximum of 20.\n \u2022 Whenever you take the Dodge action in combat, you can spend one Hit Die to heal yourself. Roll the die, add your Constitution modifier, and regain a number of hit points equal to the total (minimum of 1).",
	description : "Whenever I take the Dodge action in combat, I can spend one Hit Die to heal myself. I roll the die, add my Constitution modifier, and regain a number of hit points equal to the total (minimum of 1). [+1 Constitution]",
	scores : [0, 0, 1, 0, 0, 0]
};
FeatsList["elven accuracy-xgte"] = {
	name : "Elven Accuracy",
	source : ["X", 74],
	prerequisite : "Being an Elf or a Half-Elf",
	prereqeval : function(v) { return (/elf|eladrin|avariel|grugach|shadar-kai/i).test(CurrentRace.known); },
	descriptionFull : "The accuracy of elves is legendary, especially that of elf archers and spellcasters. You have uncanny aim with attacks that rely on precision rather than brute force. You gain the following benefits:\n \u2022 Increase your Dexterity, Intelligence, Wisdom, or Charisma score by 1, to a maximum of 20.\n \u2022 Whenever you have advantage on an attack roll using Dexterity, Intelligence, Wisdom, or Charisma, you can reroll one of the dice once.",
	description : "Whenever I have advantage on an attack roll that uses Dexterity, Intelligence, Wisdom, or Charisma, I can reroll one of the dice once. [+1 Dexterity, Intelligence, Wisdom, or Charisma]",
	scorestxt : "+1 Dexterity, Intelligence, Wisdom, or Charisma"
};
FeatsList["fade away-xgte"] = {
	name : "Fade Away",
	source : ["X", 74],
	prerequisite : "Being a Gnome",
	prereqeval : function(v) { return CurrentRace.known.indexOf('gnome') !== -1; },
	descriptionFull : "Your people are clever, with a knack for illusion magic. You have learned a magical trick for fading away when you suffer harm. You gain the following benefits:\n \u2022 Increase your Dexterity or Intelligence score by 1, to a maximum of 20.\n \u2022 Immediately after you take damage, you can use a reaction to magically become invisible until the end of your next turn or until you attack, deal damage, or force someone to make a saving throw. Once you use this ability, you can't do so again until you finish a short or long rest.",
	description : "As a reaction when I take damage, I can magically become invisible until the end of my next turn or until I attack, deal damage, or force someone to make a saving throw. Once I do this, I can't do so again until I finish a short rest. [+1 Dexterity or Intelligence]",
	scorestxt : "+1 Dexterity or Intelligence",
	action : ["reaction", ""],
	usages : 1,
	recovery : "short rest"
};
FeatsList["fey teleportation-xgte"] = { // this code includes contributions by SoilentBrad
	name : "Fey Teleportation",
	source : ["X", 74],
	prerequisite : "Being a High Elf",
	prereqeval : function(v) { return CurrentRace.known.indexOf('high elf') !== -1; },
	descriptionFull : "Your study of high elven lore has unlocked fey power that few other elves possess, except your eladrin cousins. Drawing on your fey ancestry, you can momentarily stride through the Feywild to shorten your path from one place to another. You gain the following benefits:\n \u2022 Increase your Intelligence or Charisma score by 1, to a maximum of 20.\n \u2022 You learn to speak, read, and write Sylvan.\n \u2022 You learn the Misty Step spell and can cast it once without expending a spell slot. You regain the ability to cast it in this way when you finish a short or long rest. Intelligence is your spellcasting ability for this spell.",
	description : "I can cast Misty Step without using a spell slot. I can do so once per short rest. Intelligence is my spellcasting ability for this spell. I also learn to speak, read, and write Sylvan. [+1 Intelligence or Charisma]",
	scorestxt : "+1 Intelligence or Charisma",
	spellcastingBonus : {
		name : "Once per short rest",
		spellcastingAbility : 4,
		spells : ["misty step"],
		selection : ["misty step"],
		firstCol : 'oncesr'
	},
	languageProfs : ["Sylvan"],
	usages : 1,
	recovery : "short rest"
};
FeatsList["flames of phlegethos-xgte"] = {
	name : "Flames of Phlegethos",
	source : ["X", 74],
	prerequisite : "Being a Tiefling",
	prereqeval : function(v) { return CurrentRace.known.indexOf('tiefling') !== -1; },
	descriptionFull : "You learn to call on hellfire to serve your commands. You gain the following benefits:\n \u2022 Increase your Intelligence or Charisma score by 1, to a maximum of 20.\n \u2022 When you roll fire damage for a spell you cast, you can reroll any roll of 1 on the fire damage dice, but you must use the new roll, even if it is another 1.\n \u2022 Whenever you cast a spell that deals fire damage, you can cause flames to wreathe you until the end of your next turn. The flames don't harm you or your possessions, and they shed bright light out to 30 feet and dim light for an additional 30 feet. While the flames are present, any creature within 5 feet of you that hits you with a melee attack takes 1d4 fire damage.",
	description : "When I cast a fire damage spell, I can reroll any 1 on fire damage dice once. I then sheathe myself in flame until my next turn ends. These shed bright light in 30 ft, dim light in 30 ft and cause any within 5 ft that hit me in melee to take 1d4 fire damage. [+1 Int or Cha]",
	scorestxt : "+1 Intelligence or Charisma"	
};
FeatsList["infernal constitution-xgte"] = {
	name : "Infernal Constitution",
	source : ["X", 75],
	prerequisite : "Being a Tiefling",
	prereqeval : function(v) { return CurrentRace.known.indexOf('tiefling') !== -1; },
	descriptionFull : "Fiendish blood runs strong in you, unlocking a resilience akin to that possessed by some fiends. You gain the following benefits:\n \u2022 Increase your Constitution score by 1, to a maximum of 20.\n \u2022 You have resistance to cold and poison damage.\n \u2022 You have advantage on saving throws against being poisoned.",
	description : "I have resistance to cold and poison damage and I have advantage on saving throws against being poisoned.\n[+1 Constitution]",
	scores : [0, 0, 1, 0, 0, 0],
	dmgres : ["Cold", "Poison"],
	savetxt : { adv_vs : ["poison"] }
};
FeatsList["orcish fury-xgte"] = {
	name : "Orcish Fury",
	source : ["X", 75],
	prerequisite : "Being a Half-Orc",
	prereqeval : function(v) { return (/^(?=.*half)(?=.*orc).*$/i).test(CurrentRace.known); },
	descriptionFull : "Your fury burns tirelessly. You gain the following benefits:\n \u2022 Increase your Strength or Constitution score by 1, to a maximum of 20.\n \u2022 When you hit with an attack using a simple or martial weapon, you can roll one of the weapon's damage dice an additional time and add it as extra damage of the weapon's damage type. Once you use this ability, you can't use it again until you finish a short or long rest.\n \u2022 Immediately after you use your Relentless Endurance trait, you can use your reaction to make one weapon attack.",
	description : "Once per short rest, I can roll an extra damage die for an attack with a simple or martial weapon. In addition, Immediately after I use my Relentless Endurance trait, I can use my reaction to make one weapon attack. [+1 Strength or Constitution]",
	scorestxt : "+1 Strength or Constitution",
	action : ["reaction", " (after Relentless Endurance)"],
	usages : 1,
	recovery : "short rest",
	additional : "extra damage"
};
FeatsList["prodigy-xgte"] = {
	name : "Prodigy",
	source : ["X", 75],
	prerequisite : "Being a Half-Elf, Half-Orc, or Human",
	prereqeval : function(v) { return (/human|^(?=.*half)(?=.*(elf|orc)).*$/i).test(CurrentRace.known); },
	descriptionFull : "You have a knack for learning new things. You gain the following benefits:\n \u2022 You gain one skill proficiency of your choice, one tool proficiency of your choice, and fluency in one language of your choice.\n \u2022 Choose one skill in which you have proficiency. You gain expertise with that skill, which means your proficiency bonus is doubled for any ability check you make with it. The skill you choose must be one that isn't already benefiting from a feature, such as Expertise, that doubles your proficiency bonus.",
	description : "I gain proficiency with one skill of my choice and expertise with it, or expertise with another skill of my choice that I'm already proficient with. I also gain proficiency with one tool of my choice and fluency in one language of my choice.",
	skillstxt : "Proficiency with any one skill and Expertise with any one skill that you are already proficient with",
	languageProfs : [1],
	toolProfs : [["Any tool", 1]]
};
FeatsList["second chance-xgte"] = {
	name : "Second Chance",
	source : ["X", 75],
	prerequisite : "Being a Halfling",
	prereqeval : function(v) { return CurrentRace.known.indexOf('halfling') !== -1; },
	descriptionFull : "Fortune favors you when someone tries to strike you. You gain the following benefits:\n \u2022 Increase your Dexterity, Constitution, or Charisma score by 1, to a maximum of 20.\n \u2022 When a creature you can see hits you with an attack roll, you can use your reaction to force that creature to reroll. Once you use this ability, you can't use it again until you roll initiative at the start of combat or until you finish a short or long rest.",
	description : "When a creature I can see hits me with an attack roll, I can use my reaction to force that creature to reroll. Once I use this ability, I can't do so again until I roll initiative at the start of combat or I finish a short rest. [+1 Dexterity, Constitution, or Charisma]",
	scorestxt : "+1 Dexterity, Constitution, or Charisma",
	action : ["reaction", ""],
	usages : 1,
	recovery : "Combat"
};
FeatsList["squat nimbleness-xgte"] = {
	name : "Squat Nimbleness",
	source : ["X", 75],
	prerequisite : "Being a Dwarf or a small race",
	prereqeval : function(v) { return (/dwarf/i).test(CurrentRace.known) || tDoc.getField('Size Category').currentValueIndices === 4; },
	descriptionFull : "You are uncommonly nimble for your race. You gain the following benefits:\n \u2022 Increase your Strength or Dexterity score by 1, to a maximum of 20.\n \u2022 Increase your walking speed by 5 feet.\n \u2022 You gain proficiency in the Acrobatics or Athletics skill (your choice).\n \u2022 You have advantage on any Strength (Athletics) or Dexterity (Acrobatics) check you make to escape from being grappled.",
	description : "My walking speed increases by 5 ft. I gain proficiency in either the Acrobatics or the Athletics skill. I have advantage on Dexterity (Acrobatics) and Strength (Athletics) checks I make to escape from being grappled. [+1 Strength or Dexterity]",
	scorestxt : "+1 Strength or Dexterity",
	skillstxt : "Acrobatics or Athletics",
	speed : { walk : {spd : "+5", enc : "+5" } }
};
FeatsList["wood elf magic-xgte"] = {
	name : "Wood Elf Magic",
	source : ["X", 75],
	prerequisite : "Being a Wood Elf",
	prereqeval : function(v) { return CurrentRace.known.indexOf('wood elf') !== -1; },
	descriptionFull : "You learn the magic of the primeval woods, which are revered and protected by your people. You learn one druid cantrip of your choice. You also learn the Longstrider and Pass Without Trace spells, each of which you can cast once without expending a spell slot. You regain the ability to cast these two spells in this way when you finish a long rest. Wisdom is your spellcasting ability for all three spells.",
	description : "I learn a druid cantrip. In addition, I can cast Longstrider and Pass Without Trace, without expending a spell slot, but each only once per long rest. Wisdom is my spellcasting ability for these three spells.",
	spellcastingBonus : [{
		name : "Druid Cantrip",
		spellcastingAbility : 5,
		"class" : "druid",
		level : [0, 0],
		firstCol : 'atwill'
	}, {
		name : "Once per long rest",
		spells : ["longstrider"],
		selection : ["longstrider"],
		firstCol : 'oncelr'
	}, {
		name : "Once per long rest",
		spells : ["pass without trace"],
		selection : ["pass without trace"],
		firstCol : 'oncelr'
	}]
};

// Add spells, first those taken from the Elemental Evil Player's Companion, if not already present
if (!SourceList.E || !(/Elemental.*Evil.*Player.*Companion/i).test(SourceList.E.name)) {
	SpellsList["abi-dalzim's horrid wilting"] = {
		name : "Abi-Dalzim's Horrid Wilting",
		nameShort : "Abi-D's Horrid Wilting",
		nameAlt : "Horrid Wilting",
		classes : ["sorcerer", "wizard"],
		source : [["X", 150], ["E", 15]],
		level : 8,
		school : "Necro",
		time : "1 a",
		range : "150 ft",
		components : "V,S,M",
		compMaterial : "A bit of sponge",
		duration : "Instantaneous",
		save : "Con",
		description : "30-ft cube all crea 12d8 Necrotic dmg; save halves; plants/water elem. dis. const/undead immune",
		descriptionFull : "You draw the moisture from every creature in a 30-foot cube centered on a point you choose within range. Each creature in that area must make a Constitution saving throw. Constructs and undead aren't affected, and plants and water elementals make this saving throw with disadvantage. A creature takes 12d8 necrotic damage on a failed save, or half as much damage on a successful one." + "\n   " + "Nonmagical plants in the area that aren't creatures, such as trees and shrubs, wither and die instantly."
	};
	SpellsList["absorb elements"] = {
		name : "Absorb Elements",
		classes : ["druid", "ranger", "sorcerer", "wizard"],
		source : [["X", 150], ["E", 15]],
		level : 1,
		school : "Abjur",
		time : "1 rea",
		range : "Self",
		components : "S",
		duration : "1 rnd",
		description : "Acid, Cold, Fire, Lightning, or Thunder resistance vs. 1 atk; first melee hit next rnd +1d6+1d6/SL dmg",
		descriptionFull : "The spell captures some of the incoming energy, lessening its effect on you and storing it for your next melee attack. You have resistance to the triggering damage type until the start of your next turn. Also, the first time you hit with a melee attack on your next turn, the target takes an extra 1d6 damage of the triggering type, and the spell ends." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the extra damage increases by 1d6 for each slot level above 1st."
	};
	SpellsList["aganazzar's scorcher"] = {
		name : "Aganazzar's Scorcher",
		nameAlt : "Scorch", //as per the Spell Compandium's (DnD 3.5e) alternative name
		classes : ["sorcerer", "wizard"],
		source : [["X", 150], ["E", 15]],
		level : 2,
		school : "Evoc",
		time : "1 a",
		range : "30-ft line",
		components : "V,S,M",
		compMaterial : "A red dragon's scale",
		duration : "Instantaneous",
		save : "Dex",
		description : "30-ft long 5-ft wide line all creatures 3d8+1d8/SL Fire dmg; save halves",
		descriptionFull : "A line of roaring flame 30 feet long and 5 feet wide emanates from you in a direction you choose. Each creature in the line must make a Dexterity saving throw. A creature takes 3d8 fire damage on a failed save, or half as much damage on a successful one." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d8 for each slot level above 2nd."
	};
	SpellsList["beast bond"] = {
		name : "Beast Bond",
		classes : ["druid", "ranger"],
		source : [["X", 150], ["E", 15]],
		level : 1,
		school : "Div",
		time : "1 a",
		range : "Touch",
		components : "V,S,M",
		compMaterial : "A bit of fur wrapped in a cloth",
		duration : "Conc, 10 min",
		description : "Telepathic link with 1 beast Int<4 while in line of sight; beast has adv. on attacks vs. crea I can see",
		descriptionFull : "You establish a telepathic link with one beast you touch that is friendly to you or charmed by you. The spell fails if the beast's Intelligence is 4 or higher. Until the spell ends, the link is active while you and the beast are within line of sight of each other. Through the link, the beast can understand your telepathic messages to it, and it can telepathically communicate simple emotions and concepts back to you. While the link is active, the beast gains advantage on attack rolls against any creature within 5 feet of you that you can see."
	};
	SpellsList["bones of the earth"] = {
		name : "Bones of the Earth",
		classes : ["druid"],
		source : [["X", 150], ["E", 15]],
		level : 6,
		school : "Trans",
		time : "1 a",
		range : "120 ft",
		components : "V,S",
		duration : "Instantaneous",
		save : "Dex",
		description : "6+2/SL 2.5-ft rad ground burst up 30-ft, \u2265 Med. creas save or lifted, 6d6 bludg. dmg if ceiling; see B",
		descriptionFull : "You cause up to six pillars of stone to burst from places on the ground that you can see within range. Each pillar is a cylinder that has a diameter of 5 feet and a height of up to 30 feet. The ground where a pillar appears must be wide enough for its diameter, and you can target the ground under a creature if that creature is Medium or smaller. Each pillar has AC 5 and 30 hit points. When reduced to 0 hit points, a pillar crumbles into rubble, which creates an area of difficult terrain with a 10-foot radius that lasts until the rubble is cleared. Each 5-foot-diameter portion of the area requires at least 1 minute to clear by hand." + "\n   " + "If a pillar is created under a creature, that creature must succeed on a Dexterity saving throw or be lifted by the pillar. A creature can choose to fail the save." + "\n   " + "If a pillar is prevented from reaching its full height because of a ceiling or other obstacle, a creature on the pillar takes 6d6 bludgeoning damage and is restrained, pinched between the pillar and the obstacle. The restrained creature can use an action to make a Strength or Dexterity check (the creature's choice) against the spell's save DC. On a success, the creature is no longer restrained and must either move off the pillar or fall off it." + AtHigherLevels + "When you cast this spell using a spell slot of 7th level or higher, you can create."
	};
	SpellsList["catapult"] = {
		name : "Catapult",
		classes : ["sorcerer", "wizard"],
		source : [["X", 150], ["E", 15]],
		level : 1,
		school : "Trans",
		time : "1 a",
		range : "60 ft",
		components : "S",
		duration : "Instantaneous",
		save : "Dex",
		description : "Send 5+5/SL lb unattended object in 90 ft straight line; if hits crea, save or 3d8+1d8/SL Bludg. dmg",
		descriptionFull : "Choose one object weighing 1 to 5 pounds within range that isn't being worn or carried. The object flies in a straight line up to 90 feet in a direction you choose before falling to the ground, stopping early if it impacts against a solid surface. If the object would strike a creature, that creature must make a Dexterity saving throw. On a failed save, the object strikes the target and stops moving. When the object strikes something, the object and what it strikes each take 3d8 bludgeoning damage." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the maximum weight of objects that you can target with this spell increases by 5 pounds, and the damage."
	};
	SpellsList["control flames"] = {
		name : "Control Flames",
		classes : ["druid", "sorcerer", "wizard"],
		source : [["X", 152], ["E", 16]],
		level : 0,
		school : "Trans",
		time : "1 a",
		range : "60 ft",
		components : "S",
		duration : "Instant. or 1 h",
		description : "Nonmagical flame up to 5 cu ft; instant: expand/extinguish, 1h: brighten/dim/color/create shapes",
		descriptionFull : "You choose nonmagical flame that you can see within range and that fits within a 5-foot cube. You affect it in one of the following ways." + "\n \u2022 " + "You instantaneously expand the flame 5 feet in one direction, provided that wood or other fuel is present in the new location." + "\n \u2022 " + "You instantaneously extinguish the flames within the cube." + "\n \u2022 " + "You double or halve the area of bright light and dim light cast by the flame, change its color, or both. The change lasts for 1 hour." + "\n \u2022 " + "You cause simple shapes-such as the vague form of a creature, an inanimate object, or a location-to appear within the flames and animate as you like. The shapes last for 1 hour." + "\n   " + "If you cast this spell multiple times, you can have up to three of its non-instantaneous effects active at a time, and you can dismiss such an effect as an action."
	};
	SpellsList["control winds"] = {
		name : "Control Winds",
		classes : ["druid", "sorcerer", "wizard"],
		source : [["X", 152], ["E", 16], ["UA:D", 8]],
		level : 5,
		school : "Trans",
		time : "1 a",
		range : "300 ft",
		components : "V,S",
		duration : "Conc, 1 h",
		description : "100-ft cube of air either gusts, downdraft, or updraft; affects flying/jump/ranged; 1 a change; see B",
		descriptionFull : "You take control of the air in a 100-foot cube that you can see within range. Choose one of the following effects when you cast the spell. The effect lasts for the spell's duration, unless you use your action on a later turn to switch to a different effect. You can also use your action to temporarily halt the effect or to restart one you've halted." + "\n   " + toUni("Gusts") + ": A wind picks up within the cube, continually blowing in a horizontal direction you designate. You choose the intensity of the wind: calm, moderate, or strong. If the wind is moderate or strong, ranged weapon attacks that enter or leave the cube or pass through it have disadvantage on their attack rolls. If the wind is strong, any creature moving against the wind must spend 1 extra foot of movement for each foot moved." + "\n   " + toUni("Downdraft") + ": You cause a sustained blast of strong wind to blow downward from the top of the cube. Ranged weapon attacks that pass through the cube or that are made against targets within it have disadvantage on their attack rolls. A creature must make a Strength saving throw if it flies into the cube for the first time on a turn or starts its turn there flying. On a failed save, the creature is knocked prone." + "\n   " + toUni("Updraft") + ": You cause a sustained updraft within the cube, rising upward from the cube's bottom side. Creatures that end a fall within the cube take only half damage from the fall. When a creature in the cube makes a vertical jump, the creature can jump up to 10 feet higher than normal."
	};
	SpellsList["create bonfire"] = {
		name : "Create Bonfire",
		classes : ["druid", "sorcerer", "warlock", "wizard"],
		source : [["X", 152], ["E", 16]],
		level : 0,
		school : "Conj",
		time : "1 a",
		range : "60 ft",
		components : "V,S",
		duration : "Conc, 1 min",
		save : "Dex",
		description : "5-ft cube all crea at casting or entering save or 1d8 Fire dmg; ignites flammable; +1d8 at CL 5/11/17",
		descriptionCantripDie : "5-ft cube all crea at casting or entering save or `CD`d8 Fire dmg; ignites flammable",
		descriptionFull : "You create a bonfire on ground that you can see within range. Until the spell ends, the magic bonfire fills a 5-foot cube. Any creature in the bonfire's space when you cast the spell must succeed on a Dexterity saving throw or take 1d8 fire damage. A creature must also make the saving throw when it moves into the bonfire's space for the first time on a turn or ends its turn there." + "\n   " + "The bonfire ignites flammable objects in its area that aren't being worn or carried." + "\n   " + "The spell's damage increases by 1d8 when you reach 5th level (2d8), 11th level (3d8), and 17th level (4d8)."
	};
	SpellsList["dust devil"] = {
		name : "Dust Devil",
		classes : ["druid", "sorcerer", "wizard"],
		source : [["X", 154], ["E", 17]],
		level : 2,
		school : "Conj",
		time : "1 a",
		range : "60 ft",
		components : "V,S,M",
		compMaterial : "A pinch of dust",
		duration : "Conc, 1 min",
		save : "Str",
		description : "5-ft cube; all in 5-ft 1d8+1d8/SL Bludg. dmg and pushed 10 ft away; save halves, no push; see book",
		descriptionFull : "Choose an unoccupied 5-foot cube of air that you can see within range. An elemental force that resembles a dust devil appears in the cube and lasts for the spell's duration." + "\n   " + "Any creature that ends its turn within 5 feet of the dust devil must make a Strength saving throw. On a failed save, the creature takes 1d8 bludgeoning damage and is pushed 10 feet away from the dust devil. On a successful save, the creature takes half as much damage and isn't pushed." + "\n   " + "As a bonus action, you can move the dust devil up to 30 feet in any direction. If the dust devil moves over sand, dust, loose dirt, or light gravel, it sucks up the material and forms a 10-foot-radius cloud of debris around itself that lasts until the start of your next turn. The cloud heavily obscures its area." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d8 for each slot level above 2nd."
	};
	SpellsList["earthbind"] = {
		name : "Earthbind",
		classes : ["druid", "sorcerer", "warlock", "wizard"],
		source : [["X", 154], ["E", 17]],
		level : 2,
		school : "Trans",
		time : "1 a",
		range : "300 ft",
		components : "V",
		duration : "Conc, 1 min",
		save : "Str",
		description : "1 creatures save or fly speed is reduced to 0; airborne creatures safely descend at 60 ft per round",
		descriptionFull : "Choose one creature you can see within range. Yellow strips of magical energy loop around the creature. The target must succeed on a Strength saving throw, or its flying speed (if any) is reduced to 0 feet for the spell's duration. An airborne creature affected by this spell safely descends at 60 feet per round until it reaches the ground or the spell ends."
	};
	SpellsList["earth tremor"] = {
		name : "Earth Tremor",
		classes : ["bard", "druid", "sorcerer", "wizard"],
		source : [["X", 155], ["E", 17]],
		level : 1,
		school : "Evoc",
		time : "1 a",
		range : "10 ft",
		components : "V,S",
		duration : "Instantaneous",
		save : "Dex",
		description : "All crea in range except me save or 1d6+1d6/SL Bludgeoning dmg and prone; loose ground is dif. ter.",
		descriptionFull : "You cause a tremor in the ground within range. Each creature other than you in that area must make a Dexterity saving throw. On a failed save, a creature takes 1d6 bludgeoning damage and is knocked prone. If the ground in that area is loose earth or stone, it becomes difficult terrain until cleared, with each 5-foot-diameter portion requiring at least 1 minute to clear by hand." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the damage increases by 1d6 for each slot level above 1st."
	};
	SpellsList["elemental bane"] = {
		name : "Elemental Bane",
		classes : ["druid", "warlock", "wizard"],
		source : [["X", 155], ["E", 17]],
		level : 4,
		school : "Trans",
		time : "1 a",
		range : "90 ft",
		components : "V,S",
		duration : "Conc, 1 min",
		save : "Con",
		description : "1+1/SL crea, each max 30 ft apart, save or 1 energy: lose resist. to it & +2d6 to first dmg with it/turn",
		descriptionFull : "Choose one creature you can see within range, and choose one of the following damage types - acid, cold, fire, lightning, or thunder. The target must succeed on a Constitution saving throw or be affected by the spell for its duration. The first time each turn the affected target takes damage of the chosen type, the target takes an extra 2d6 damage of that type. Moreover, the target loses any resistance to that damage type until the spell ends." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, you can target one additional creature for each slot level above 4th. The creatures must be within 30 feet of each other when you target them."
	};
	SpellsList["erupting earth"] = {
		name : "Erupting Earth",
		classes : ["druid", "sorcerer", "wizard"],
		source : [["X", 155], ["E", 17]],
		level : 3,
		school : "Trans",
		time : "1 a",
		range : "120 ft",
		components : "V,S,M",
		compMaterial : "A piece of obsidian",
		duration : "Instantaneous",
		save : "Dex",
		description : "20-ft cube all crea 3d12+1d12/SL Bludgeoning dmg; save halves; area becomes difficult terrain",
		descriptionFull : "Choose a point you can see on the ground within range. A fountain of churned earth and stone erupts in a 20-foot cube centered on that point. Each creature in that area must make a Dexterity saving throw. A creature takes 3d12 bludgeoning damage on a failed save, or half as much damage on a successful one. Additionally, the ground in that area becomes difficult terrain until cleared. Each 5-foot-square portion of the area requires at least 1 minute to clear by hand." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the damage increases by 1d12 for each slot level above 3rd."
	};
	SpellsList["flame arrows"] = {
		name : "Flame Arrows",
		classes : ["druid", "ranger", "sorcerer", "wizard"],
		source : [["X", 156], ["E", 18]],
		level : 3,
		school : "Trans",
		time : "1 a",
		range : "Touch",
		components : "V,S",
		duration : "Conc, 1 h",
		description : "12+2/SL ammunition drawn from touched quiver do +1d6 Fire damage on a successful hit",
		descriptionFull : "You touch a quiver containing arrows or bolts. When a target is hit by a ranged weapon attack using a piece of ammunition drawn from the quiver, the target takes an extra 1d6 fire damage. The spell's magic ends on the piece of ammunition when it hits or misses, and the spell ends when twelve pieces of ammunition have been drawn from the quiver." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the number of pieces of ammunition you can affect with this spell increases by two for each slot level above 3rd."
	};
	SpellsList["frostbite"] = {
		name : "Frostbite",
		classes : ["druid", "sorcerer", "warlock", "wizard"],
		source : [["X", 156], ["E", 18]],
		level : 0,
		school : "Evoc",
		time : "1 a",
		range : "60 ft",
		components : "V,S",
		duration : "Instantaneous",
		save : "Con",
		description : "1 crea save or 1d6 Cold dmg and dis. on next weapon attack roll; +1d6 at CL 5, 11, and 17",
		descriptionCantripDie : "1 crea save or `CD`d6 Cold dmg and dis. on next weapon attack roll",
		descriptionFull : "You cause numbing frost to form on one creature that you can see within range. The target must make a Constitution saving throw. On a failed save, the target takes 1d6 cold damage, and it has disadvantage on the next weapon attack roll it makes before the end of its next turn." + "\n   " + "The spell's damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6)."
	};
	SpellsList["gust"] = {
		name : "Gust",
		classes : ["druid", "sorcerer", "wizard"],
		source : [["WGtE", 107], ["X", 157], ["E", 19], ["UA:D", 6]],
		level : 0,
		school : "Trans",
		time : "1 a",
		range : "30 ft",
		components : "V,S",
		duration : "Instantaneous",
		save : "Str",
		description : "Med. or smaller crea save or push 5 ft; or push unattended 5 lb obj 10 ft; or harmless sensory effect",
		descriptionFull : "You seize the air and compel it to create one of the following effects at a point you can see within range." + "\n " + "\u2022 One Medium or smaller creature that you choose must succeed on a Strength saving throw or be pushed up to 5 feet away from you." + "\n " + "\u2022 You create a small blast of air capable of moving one object that is neither held nor carried and that weighs no more than 5 pounds. The object is pushed up to 10 feet away from you. It isn't pushed with enough force to cause damage." + "\n " + "\u2022 You create a harmless sensory affect using air, such as causing leaves to rustle, wind to slam shutters shut, or your clothing to ripple in a breeze."
	};
	SpellsList["ice knife"] = {
		name : "Ice Knife",
		classes : ["druid", "sorcerer", "wizard"],
		source : [["X", 157], ["E", 19]],
		level : 1,
		school : "Conj",
		time : "1 a",
		range : "60 ft",
		components : "S,M",
		compMaterial : "A drop of water or piece of ice",
		duration : "Instantaneous",
		save : "Dex",
		description : "Ranged atk for 1d10 Piercing dmg; hit/miss 5-ft rad on target all crea save or 2d6+1d6/SL Cold dmg",
		descriptionFull : "You create a shard of ice and fling it at one creature within range. Make a ranged spell attack against the target. On a hit, the target takes 1d10 piercing damage. Hit or miss, the shard then explodes. The target and each creature within 5 feet of it must succeed on a Dexterity saving throw or take 2d6 cold damage." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the cold damage increases by 1d6 for each slot level above 1st."
	};
	SpellsList["immolation"] = {
		name : "Immolation",
		classes : ["sorcerer", "wizard"],
		source : [["X", 158], ["E", 19]],
		level : 5,
		school : "Evoc",
		time : "1 a",
		range : "90 ft",
		components : "V",
		duration : "Conc, 1 min",
		save : "Dex",
		description : "1 crea save or 8d6 Fire dmg and burns for 4d6 Fire dmg/rnd; save each rnd to end; half dmg on save",
		descriptionFull : "Flames wreathe one creature you can see within range. The target must make a Dexterity saving throw. It takes 8d6 fire damage on a failed save, or half as much damage on a successful one. On a failed save, the target also burns for the spell's duration. The burning target sheds bright light in a 30-foot radius and dim light for an additional 30 feet. At the end of each of its turns, the target repeats the saving throw. It takes 4d6 fire damage on a failed save, and the spell ends on a successful one. These magical flames can't be extinguished by nonmagical means." + "\n   " + "If damage from this spell kills a target, the target is turned to ash."
	};
	SpellsList["investiture of flame"] = {
		name : "Investiture of Flame",
		classes : ["druid", "sorcerer", "warlock", "wizard"],
		source : [["X", 159], ["E", 19]],
		level : 6,
		school : "Trans",
		time : "1 a",
		range : "Self",
		components : "V,S",
		duration : "Conc, 10 min",
		save : "Dex",
		description : "Fire immune; Cold res.; 1d10 Fire dmg in 5 ft; 1 a 15-ft long 5-ft wide all crea 4d8 Fire dmg, save half",
		descriptionFull : "Flames race across your body, shedding bright light in a 30-foot radius and dim light for an additional 30 feet for the spell's duration. The flames don't harm you. Until the spell ends, you gain the following benefits." + "\n " + "\u2022 You are immune to fire damage and have resistance to cold damage." + "\n " + "\u2022 Any creature that moves within 5 feet of you for the first time on a turn or ends its turn there takes 1d10 fire damage." + "\n " + "\u2022 You can use your action to create a line of fire 15 feet long and 5 feet wide extending from you in a direction you choose. Each creature in the line must make a Dexterity saving throw. A creature takes 4d8 fire damage on a failed save, or half as much damage on a successful one."
	};
	SpellsList["investiture of ice"] = {
		name : "Investiture of Ice",
		classes : ["druid", "sorcerer", "warlock", "wizard"],
		source : [["X", 159], ["E", 19]],
		level : 6,
		school : "Trans",
		time : "1 a",
		range : "Self",
		components : "V,S",
		duration : "Conc, 10 min",
		save : "Con",
		description : "Cold immune; Fire resist; 10-ft rad dif. ter.; 1 a 15-ft cone all crea 4d6 Cold dmg, half speed, save half",
		descriptionFull : "Until the spell ends, ice rimes your body, and you gain the following benefits." + "\n " + "\u2022 You are immune to cold damage and have resistance to fire damage." + "\n " + "\u2022 You can move across difficult terrain created by ice or snow without spending extra movement." + "\n " + "\u2022 The ground in a 10-foot radius around you is icy and is difficult terrain for creatures other than you. The radius moves with you." + "\n " + "\u2022 You can use your action to create a 15-foot cone of freezing wind extending from your outstretched hand in a direction you choose. Each creature in the cone must make a Constitution saving throw. A creature takes 4d6 cold damage on a failed save, or half as much damage on a successful one. A creature that fails its save against this effect has its speed halved until the start of your next turn."
	};
	SpellsList["investiture of stone"] = {
		name : "Investiture of Stone",
		classes : ["druid", "sorcerer", "warlock", "wizard"],
		source : [["X", 159], ["E", 19]],
		level : 6,
		school : "Trans",
		time : "1 a",
		range : "Self",
		components : "V,S",
		duration : "Conc, 10 min",
		save : "Dex",
		description : "Nonmagical Bludg/Pierc/Slash resist.; 1 a 15-ft rad all crea save or prone; move through earth/stone",
		descriptionFull : "Until the spell ends, bits of rock spread across your body, and you gain the following benefits:" + "\n \u2022 " + "You have resistance to bludgeoning, piercing, and slashing damage from nonmagical attacks." + "\n \u2022 " + "You can use your action to create a small earthquake on the ground in a 15-foot radius centered on you. Other creatures on that ground must succeed on a Dexterity saving throw or be knocked prone." + "\n \u2022 " + "You can move across difficult terrain made of earth or stone without spending extra movement. You can move through solid earth or stone as if it was air and without destabilizing it, but you can't end your movement there. If you do so, you are ejected to the nearest unoccupied space, this spell ends, and you are stunned until the end of your next turn."
	};
	SpellsList["investiture of wind"] = {
		name : "Investiture of Wind",
		classes : ["druid", "sorcerer", "warlock", "wizard"],
		source : [["X", 160], ["E", 20]],
		level : 6,
		school : "Trans",
		time : "1 a",
		range : "Self",
		components : "V,S",
		duration : "Conc, 10 min",
		save : "Con",
		description : "Rngd wea atks dis. vs. me; fly 60 ft; 1 a 15-ft cube in 60 ft all 2d10 Bludg. dmg, push 10 ft, save half",
		descriptionFull : "Until the spell ends, wind whirls around you, and you gain the following benefits." + "\n " + "\u2022 Ranged weapon attacks made against you have disadvantage on the attack roll." + "\n " + "\u2022 You gain a flying speed of 60 feet. If you are still flying when the spell ends, you fall, unless you can somehow prevent it." + "\n " + "\u2022 You can use your action to create a 15-foot cube of swirling wind centered on a point you can see within 60 feet of you. Each creature in that area must make a Constitution saving throw. A creature takes 2d10 bludgeoning damage on a failed save, or half as much damage on a successful one. If a Large or smaller creature fails the save, that creature is also pushed up to 10 feet away from the center of the cube."
	};
	SpellsList["maelstrom"] = {
		name : "Maelstrom",
		classes : ["druid"],
		source : [["X", 160], ["E", 20]],
		level : 5,
		school : "Evoc",
		time : "1 a",
		range : "120 ft",
		components : "V,S,M",
		compMaterial : "Paper or leaf in the shape of a funnel",
		duration : "Conc, 1 min",
		save : "Str",
		description : "5-ft deep 30-ft rad dif. ter.; all crea starting turn in save or 6d6 Bludg. dmg and pulled 10 ft to center",
		descriptionFull : "A mass of 5-foot-deep water appears and swirls in a 30-foot radius centered on a point you can see within range. The point must be on ground or in a body of water. Until the spell ends, that area is difficult terrain, and any creature that starts its turn there must succeed on a Strength saving throw or take 6d6 bludgeoning damage and be pulled 10 feet toward the center."
	};
	SpellsList["magic stone"] = {
		name : "Magic Stone",
		classes : ["druid", "warlock"],
		source : [["X", 160], ["E", 20]],
		level : 0,
		school : "Trans",
		time : "1 bns",
		range : "Touch",
		components : "V,S",
		duration : "1 min",
		description : "Imbue 3 pebbles for spell attacks, thrown 60 ft or with sling, do 1d6+spellcasting mod Bludg. dmg",
		descriptionFull : "You touch one to three pebbles and imbue them with magic. You or someone else can make a ranged spell attack with one of the pebbles by throwing it or hurling it with a sling. If thrown, it has a range of 60 feet. If someone else attacks with the pebble, that attacker adds your spellcasting ability modifier, not the attacker's, to the attack roll. On a hit, the target takes bludgeoning damage equal to 1d6 + your spellcasting ability modifier. Hit or miss, the spell then ends on the stone." + "\n   " + "If you cast this spell again, the spell ends early on any pebbles still affected by it."
	};
	SpellsList["maximilian's earthen grasp"] = {
		name : "Maximilian's Earthen Grasp",
		nameShort : "Max's Earthen Grasp",
		nameAlt : "Earthen Grasp",
		classes : ["sorcerer", "wizard"],
		source : [["X", 161], ["E", 20]],
		level : 2,
		school : "Trans",
		time : "1 a",
		range : "30 ft",
		components : "V,S,M",
		compMaterial : "A miniature hand sculpted from clay",
		duration : "Conc, 1 min",
		save : "Str",
		description : "Medium hand atks 1 crea: save or 2d6 Bludg. dmg \u0026 restrained; 1 a hand moves/atks, releases; see B",
		descriptionFull : "You choose a 5-foot-square unoccupied space on the ground that you can see within range. A Medium hand made from compacted soil rises there and reaches for one creature you can see within 5 feet of it. The target must make a Strength saving throw. On a failed save, the target takes 2d6 bludgeoning damage and is restrained for the spell's duration." + "\n   " + "As an action, you can cause the hand to crush the restrained target, which must make a Strength saving throw. The target takes 2d6 bludgeoning damage on a failed save, or half as much damage on a successful one." + "\n   " + "To break out, the restrained target can use its action to make a Strength check against your spell save DC. On a success, the target escapes and is no longer restrained by the hand." + "\n   " + "As an action, you can cause the hand to reach for a different creature or to move to a different unoccupied space within range. The hand releases a restrained target if you do either."
	};
	SpellsList["melf's minute meteors"] = {
		name : "Melf's Minute Meteors",
		nameAlt : "Minute Meteors",
		classes : ["sorcerer", "wizard"],
		source : [["X", 161], ["E", 20]],
		level : 3,
		school : "Evoc",
		time : "1 a",
		range : "Self",
		components : "V,S,M",
		compMaterial : "Niter, sulfur, and pine tar formed into a bead",
		duration : "Conc, 10 min",
		save : "Dex",
		description : "6+2/SL meteors; at casting/bns a send up to two 120 ft for 5-ft rad all crea 2d6 Fire dmg; save half",
		descriptionFull : "You create six tiny meteors in your space. They float in the air and orbit you for the spell's duration. When you cast the spell-and as a bonus action on each of your turns thereafter-you can expend one or two of the meteors, sending them streaking toward a point or points you choose within 120 feet of you. Once a meteor reaches its destination or impacts against a solid surface, the meteor explodes. Each creature within 5 feet of the point where the meteor explodes must make a Dexterity saving throw. A creature takes 2d6 fire damage on a failed save, or half as much damage on a successful one." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the number of meteors created increases by two for each slot level above 3rd."
	};
	SpellsList["mold earth"] = {
		name : "Mold Earth",
		classes : ["druid", "sorcerer", "wizard"],
		source : [["X", 162], ["E", 21]],
		level : 0,
		school : "Trans",
		time : "1 a",
		range : "30 ft",
		components : "S",
		duration : "Instant. or 1 h",
		description : "5 cu ft earth; instant.: excavate; 1h: change to difficult or normal terrain, or change shape and color",
		descriptionFull : "You choose a portion of dirt or stone that you can see within range and that fits within a 5-foot cube. You manipulate it in one of the following ways." + "\n " + "\u2022 If you target an area of loose earth, you can instantaneously excavate it, move it along the ground, and deposit it up to 5 feet away. This movement doesn't have enough force to cause damage." + "\n " + "\u2022 You cause shapes, colors, or both to appear on the dirt or stone, spelling out words, creating images, or shaping patterns. The changes last for 1 hour." + "\n " + "\u2022 If the dirt or stone you target is on the ground, you cause it to become difficult terrain. Alternatively, you can cause the ground to become normal terrain if it is already difficult terrain. This change lasts for 1 hour." + "\n\n" + "If you cast this spell multiple times, you can have no more than two of its non-instantaneous effects active at a time, and you can dismiss such an effect as an action."
	};
	SpellsList["primordial ward"] = {
		name : "Primordial Ward",
		classes : ["druid"],
		source : [["X", 163], ["E", 21]],
		level : 6,
		school : "Abjur",
		time : "1 a",
		range : "Self",
		components : "V,S",
		duration : "Conc, 1 min",
		description : "Acid, Cold, Fire, Lightning, and Thunder resistance; use rea to gain 1 immunity for 1 rnd, spell ends",
		descriptionFull : "You have resistance to acid, cold, fire, lightning, and thunder damage for the spell's duration." + "\n   " + "When you take damage of one of those types, you can use your reaction to gain immunity to that type of damage, including against the triggering damage. If you do so, the resistances end, and you have the immunity until the end of your next turn, at which time the spell ends."
	};
	SpellsList["pyrotechnics"] = {
		name : "Pyrotechnics",
		classes : ["bard", "sorcerer", "wizard"],
		source : [["X", 163], ["E", 21]],
		level : 2,
		school : "Trans",
		time : "1 a",
		range : "60 ft",
		components : "V,S",
		duration : "Instantaneous",
		save : "Con",
		description : "5 cu ft nonma. flame extinguish, or 10-ft rad all crea save or blind 1 rnd, or 20-ft rad hvy obsc. 1 min",
		descriptionFull : "Choose an area of nonmagical flame that you can see and that fits within a 5-foot cube within range. You can extinguish the fire in that area, and you create either fireworks or smoke when you do so." + "\n   " + toUni("Fireworks") + ": The target explodes with a dazzling display of colors. Each creature within 10 feet of the target must succeed on a Constitution saving throw or become blinded until the end of your next turn." + "\n   " + toUni("Smoke") + ": Thick black smoke spreads out from the target in a 20-foot radius, moving around corners. The area of the smoke is heavily obscured. The smoke persists for 1 minute or until a strong wind disperses it."
	};
	SpellsList["shape water"] = {
		name : "Shape Water",
		classes : ["druid", "sorcerer", "wizard"],
		source : [["X", 164], ["E", 21]],
		level : 0,
		school : "Trans",
		time : "1 a",
		range : "30 ft",
		components : "S",
		duration : "Instant. or 1 h",
		description : "5 cu ft water; instant: move/change flow; 1h: simple shapes/change color or opacity/freeze",
		descriptionFull : "You choose an area of water that you can see within range and that fits within a 5-foot cube. You manipulate it in one of the following ways." + "\n " + "\u2022 You instantaneously move or otherwise change the flow of the water as you direct, up to 5 feet in any direction. This movement doesn't have enough force to cause damage." + "\n " + "\u2022 You cause the water to form into simple shapes and animate at your direction. This change lasts for 1 hour." + "\n " + "\u2022 You change the water's color or opacity. The water must be changed in the same way throughout. This change lasts for 1 hour." + "\n " + "\u2022 You freeze the water, provided that there are no creatures in it. The water unfreezes in 1 hour." + "\n\n" + "If you cast this spell multiple times, you can have no more than two of its non-instantaneous effects active at a time, and you can dismiss such an effect as an action."
	};
	SpellsList["skywrite"] = {
		name : "Skywrite",
		classes : ["bard", "druid", "wizard"],
		source : [["X", 165], ["E", 22]],
		ritual : true,
		level : 2,
		school : "Trans",
		time : "1 a",
		range : "Sight",
		components : "V,S",
		duration : "Conc, 1 h",
		description : "Write up to 10 words with clouds in a part of the sky I can see; strong wind can diperse the clouds",
		descriptionFull : "You cause up to ten words to form in a part of the sky you can see. The words appear to be made of cloud and remain in place for the spell's duration. The words dissipate when the spell ends. A strong wind can disperse the clouds and end the spell early."
	};
	SpellsList["snilloc's snowball swarm"] = {
		name : "Snilloc's Snowball Swarm",
		nameAlt : "Snowball Swarm",
		classes : ["sorcerer", "wizard"],
		source : [["X", 165], ["E", 22]],
		level : 2,
		school : "Evoc",
		time : "1 a",
		range : "90 ft",
		components : "V,S,M",
		compMaterial : "A piece of ice or a small white rock chip",
		duration : "Instantaneous",
		save : "Dex",
		description : "5-ft radius all creatures 3d6+1d6/SL Cold damage; save halves",
		descriptionFull : "A flurry of magic snowballs erupts from a point you choose within range. Each creature in a 5-foot-radius sphere centered on that point must make a Dexterity saving throw. A creature takes 3d6 cold damage on a failed save, or half as much damage on a successful one." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d6 for each slot level above 2nd."
	};
	SpellsList["storm sphere"] = {
		name : "Storm Sphere",
		classes : ["sorcerer", "wizard"],
		source : [["X", 166], ["E", 22]],
		level : 4,
		school : "Evoc",
		time : "1 a",
		range : "150 ft",
		components : "V,S",
		duration : "Conc, 1 min",
		save : "Str",
		description : "20-ft rad dif. ter.; all crea now/end turn save 2d6 bludg.; bns 60 ft spell atk 4d6 lightn. dmg; +1d6/SL",
		descriptionFull : "A 20-foot-radius sphere of whirling air springs into existence centered on a point you choose within range. The sphere remains for the spell's duration. Each creature in the sphere when it appears or that ends its turn there must succeed on a Strength saving throw or take 2d6 bludgeoning damage. The sphere's space is difficult terrain." + "\n   " + "Until the spell ends, you can use a bonus action on each of your turns to cause a bolt of lightning to leap from the center of the sphere toward one creature you choose within 60 feet of the center. Make a ranged spell attack. You have advantage on the attack roll if the target is in the sphere. On a hit, the target takes 4d6 lightning damage." + "\n   " + "Creatures within 30 feet of the sphere have disadvantage on Wisdom (Perception) checks made to listen." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, the damage increases for each of its effects by 1d6 for each slot level above 4th."
	};
	SpellsList["thunderclap"] = {
		name : "Thunderclap",
		classes : ["bard", "druid", "sorcerer", "warlock", "wizard"],
		source : [["X", 168], ["E", 22]],
		level : 0,
		school : "Evoc",
		time : "1 a",
		range : "5 ft",
		components : "S",
		duration : "Instantaneous",
		save : "Con",
		description : "100-ft rad audible; all crea but me in area save or 1d6 Thunder dmg; +1d6 at CL 5, 11, and 17",
		descriptionCantripDie : "100-ft rad audible; all crea but me in area save or `CD`d6 Thunder dmg",
		descriptionFull : "You create a burst of thunderous sound that can be heard up to 100 feet away. Each creature within range, other than you, must succeed on a Constitution saving throw or take 1d6 thunder damage." + "\n   " + "The spell's damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6)."
	};
	SpellsList["tidal wave"] = {
		name : "Tidal Wave",
		classes : ["druid", "sorcerer", "wizard"],
		source : [["X", 168], ["E", 22]],
		level : 3,
		school : "Conj",
		time : "1 a",
		range : "120 ft",
		components : "V,S,M",
		compMaterial : "A drop of water",
		duration : "Instantaneous",
		save : "Dex",
		description : "30-ft x 10-ft, 10-ft high all crea 4d8 Bludg. dmg and prone; save halves not prone; extinguish flames",
		descriptionFull : "You conjure up a wave of water that crashes down on an area within range. The area can be up to 30 feet long, up to 10 feet wide, and up to 10 feet tall. Each creature in that area must make a Dexterity saving throw. On a failed save, a creature takes 4d8 bludgeoning damage and is knocked prone. On a successful save, a creature takes half as much damage and isn't knocked prone. The water then spreads out across the ground in all directions, extinguishing unprotected flames in its area and within 30 feet of it, and then it vanishes."
	};
	SpellsList["transmute rock"] = {
		name : "Transmute Rock",
		classes : ["druid", "wizard"],
		source : [["X", 169], ["E", 22]],
		level : 5,
		school : "Trans",
		time : "1 a",
		range : "120 ft",
		components : "V,S,M",
		compMaterial : "Clay and water",
		duration : "Until dispelled",
		description : "40 cu ft stone to mud or mud to stone; mud and stone restrains; mud from ceiling falls; see book",
		descriptionFull : "You choose an area of stone or mud that you can see that fits within a 40-foot cube and is within range, and choose one of the following effects." + "\n   " + toUni("Transmute Rock to Mud") + ": Nonmagical rock of any sort in the area becomes an equal volume of thick, flowing mud that remains for the spell's duration." + "\n   " + "The ground in the spell's area becomes muddy enough that creatures can sink into it. Each foot that a creature moves through the mud costs 4 feet of movement, and any creature on the ground when you cast the spell must make a Strength saving throw. A creature must also make the saving throw when it moves into the area for the first time on a turn or ends its turn there. On a failed save, a creature sinks into the mud and is restrained, though it can use an action to end the restrained condition on itself by pulling itself free of the mud." + "\n   " + "If you cast the spell on a ceiling, the mud falls. Any creature under the mud when it falls must make a Dexterity saving throw. A creature takes 4d8 bludgeoning damage on a failed save, or half as much damage on a successful one." + "\n   " + toUni("Transmute Mud to Rock") + ": Nonmagical mud or quicksand in the area no more than 10 feet deep transforms into soft stone for the spell's duration. Any creature in the mud when it transforms must make a Dexterity saving throw. On a successful save, a creature is shunted safely to the surface in an unoccupied space. On a failed save, a creature becomes restrained by the rock. A restrained creature, or another creature within reach, can use an action to try to break the rock by succeeding on a DC 20 Strength check or by dealing damage to it. The rock has AC 15 and 25 hit points, and it is immune to poison and psychic damage."
	};
	SpellsList["vitriolic sphere"] = {
		name : "Vitriolic Sphere",
		classes : ["sorcerer", "wizard"],
		source : [["X", 170], ["E", 23]],
		level : 4,
		school : "Evoc",
		time : "1 a",
		range : "150 ft",
		components : "V,S,M",
		compMaterial : "A drop of giant slug bile",
		duration : "Instantaneous",
		save : "Dex",
		description : "20-ft rad all crea 10d4+2d4/SL now and 5d4 Acid dmg at end next turn; save half \u0026 no dmg next rnd",
		descriptionFull : "You point at a location within range, and a glowing, 1-foot-diameter ball of emerald acid streaks there and explodes in a 20-foot-radius sphere. Each creature in that area must make a Dexterity saving throw. On a failed save, a creature takes 10d4 acid damage and another 5d4 acid damage at the end of its next turn. On a successful save, a creature takes half the initial damage and no damage at the end of its next turn." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, the initial damage increases by 2d4 for each slot level above 4th."
	};
	SpellsList["wall of sand"] = {
		name : "Wall of Sand",
		classes : ["wizard"],
		source : [["X", 170], ["E", 23]],
		level : 3,
		school : "Evoc",
		time : "1 a",
		range : "90 ft",
		components : "V,S,M",
		compMaterial : "A handful of sand",
		duration : "Conc, 10 min",
		description : "30\u00D710\u00D710ft (l\u00D7w\u00D7h) wall on the ground; blocks line of sight; blinded while inside; 1/3 move",
		descriptionMetric : "9\u00D73\u00D73m (l\u00D7w\u00D7h) wall on the ground; blocks line of sight; blinded while inside; 1/3 move",
		descriptionFull : "You conjure up a wall of swirling sand on the ground at a point you can see within range. You can make the wall up to 30 feet long, 10 feet high, and 10 feet thick, and it vanishes when the spell ends. It blocks line of sight but not movement. A creature is blinded while in the wall's space and must spend 3 feet of movement for every 1 foot it moves there."
	};
	SpellsList["wall of water"] = {
		name : "Wall of Water",
		classes : ["druid", "sorcerer", "wizard"],
		source : [["X", 170], ["E", 23]],
		level : 3,
		school : "Evoc",
		time : "1 a",
		range : "60 ft",
		components : "V,S,M",
		compMaterial : "A drop of water",
		duration : "Conc, 10 min",
		description : "30\u00D71\u00D710ft (l\u00D7w\u00D7h) or 20-ft rad 20-ft high; dif. ter.; range wea dis.; Fire dmg half; Cold dmg freezes",
		descriptionMetric : "9\u00D70,3\u00D73m (l\u00D7w\u00D7h) or 6-m rad 6-m high; dif. ter.; ranged wea dis.; Fire dmg half; Cold dmg freezes",
		descriptionFull : "You conjure up a wall of water on the ground at a point you can see within range. You can make the wall up to 30 feet long, 10 feet high, and 1 foot thick, or you can make a ringed wall up to 20 feet in diameter, 20 feet high, and 1 foot thick. The wall vanishes when the spell ends. The wall's space is difficult terrain." + "\n   " + "Any ranged weapon attack that enters the wall's space has disadvantage on the attack roll, and fire damage is halved if the fire effect passes through the wall to reach its target. Spells that deal cold damage that pass through the wall cause the area of the wall they pass through to freeze solid (at least a 5-foot square section is frozen). Each 5-foot-square frozen section has AC 5 and 15 hit points. Reducing a frozen section to 0 hit points destroys it. When a section is destroyed, the wall's water doesn't fill it."
	};
	SpellsList["warding wind"] = {
		name : "Warding Wind",
		classes : ["bard", "druid", "sorcerer", "wizard"],
		source : [["X", 170], ["E", 23]],
		level : 2,
		school : "Evoc",
		time : "1 a",
		range : "10-ft rad",
		components : "V",
		duration : "Conc, 10 min",
		description : "Strong (20 mph) wind in area deafens/extinguishes unprotected flames/dif. ter./ranged wea have dis",
		descriptionFull : "A strong wind (20 miles per hour) blows around you in a 10-foot radius and moves with you, remaining centered on you. The wind lasts for the spell's duration." + "\n   " + "The wind has the following effects." + "\n " + "\u2022 It deafens you and other creatures in its area." + "\n " + "\u2022 It extinguishes unprotected flames in its area that are torch-sized or smaller." + "\n " + "\u2022 The area is difficult terrain for creatures other than you." + "\n " + "\u2022 The attack rolls of ranged weapon attacks have disadvantage if they pass in or out of the wind." + "\n " + "\u2022 It hedges out vapor, gas, and fog that can be dispersed by strong wind."
	};
	SpellsList["watery sphere"] = {
		name : "Watery Sphere",
		classes : ["druid", "sorcerer", "wizard"],
		source : [["X", 170], ["E", 23]],
		level : 4,
		school : "Conj",
		time : "1 a",
		range : "90 ft",
		components : "V,S,M",
		compMaterial : "A droplet of water",
		duration : "Conc, 1 min",
		save : "Str",
		description : "5-ft rad all crea < Huge save or restrained; on save ejected; save each rnd; 1 a move sphere 30 ft",
		descriptionFull : "You conjure up a sphere of water with a 5-foot radius at a point you can see within range. The sphere can hover but no more than 10 feet off the ground. The sphere remains for the spell's duration." + "\n   " + "Any creature in the sphere's space must make a Strength saving throw. On a successful save, a creature is ejected from that space to the nearest unoccupied space of the creature's choice outside the sphere. A Huge or larger creature succeeds on the saving throw automatically, and a Large or smaller creature can choose to fail it. On a failed save, a creature is restrained by the sphere and is engulfed by the water. At the end of each of its turns, a restrained target can repeat the saving throw, ending the effect on itself on a success." + "\n   " + "The sphere can restrain as many as four Medium or smaller creatures or one Large creature. If the sphere restrains a creature that causes it to exceed this capacity, a random creature that was already restrained by the sphere falls out of it and lands prone in a space within 5 feet of it." + "\n   " + "As an action, you can move the sphere up to 30 feet in a straight line. If it moves over a pit, a cliff, or other drop-off, it safely descends until it is hovering 10 feet above the ground. Any creature restrained by the sphere moves with it. You can ram the sphere into creatures, forcing them to make the saving throw." + "\n   " + "When the spell ends, the sphere falls to the ground and extinguishes all normal flames within 30 feet of it. Any creature restrained by the sphere is knocked prone in the space where it falls. The water then vanishes."
	};
	SpellsList["whirlwind"] = {
		name : "Whirlwind",
		classes : ["druid", "sorcerer", "wizard"],
		source : [["X", 171], ["E", 24]],
		level : 7,
		school : "Evoc",
		time : "1 a",
		range : "300 ft",
		components : "V,M",
		compMaterial : "A piece of straw",
		duration : "Conc, 1 min",
		save : "Dex",
		description : "10-ft rad 30-ft high all crea 10d6 Bludg. dmg; save halves; restrains; 1 a move 30 ft; see book",
		descriptionFull : "A whirlwind howls down to a point that you can see on the ground within range. The whirlwind is a 10-foot-radius, 30-foot-high cylinder centered on that point. Until the spell ends, you can use your action to move the whirlwind up to 30 feet in any direction along the ground. The whirlwind sucks up any Medium or smaller objects that aren't secured to anything and that aren't worn or carried by anyone." + "\n   " + "A creature must make a Dexterity saving throw the first time on a turn that it enters the whirlwind or that the whirlwind enters its space, including when the whirlwind first appears. A creature takes 10d6 bludgeoning damage on a failed save, or half as much damage on a successful one. In addition, a Large or smaller creature that fails the save must succeed on a Strength saving throw or become restrained in the whirlwind until the spell ends. When a creature starts its turn restrained by the whirlwind, the creature is pulled 5 feet higher inside it, unless the creature is at the top. A restrained creature moves with the whirlwind and falls when the spell ends, unless the creature has some means to stay aloft." + "\n   " + "A restrained creature can use an action to make a Strength or Dexterity check against your spell save DC. If successful, the creature is no longer restrained by the whirlwind and is hurled 3d6 \u00D7 10 feet away from it in a random direction."
	};
};
// Then add the new spells from XGtE (contains contributions by SoilentBrad)
SpellsList["catnap"] = {
	name : "Catnap",
	classes : ["bard", "sorcerer", "wizard"],
	source : ["X", 151],
	level : 3,
	school : "Ench",
	time : "1 a",
	range : "30 ft",
	components : "S,M",
	compMaterial : "A pinch of sand",
	duration : "10 min",
	description : "3+1/SL willing crea unconscious for 10 min to gain benefits of short rest; Ends if dmg or 1 a to wake",
	descriptionFull : "You make a calming gesture, and up to three willing creatures of your choice that you can see within range fall unconscious for the spell's duration. The spell ends on a target early if it takes damage or someone uses an action to shake or slap it awake. If a target remains unconscious for the full duration, that target gains the benefit of a short rest, and it can't be affected by this spell again until it finishes a long rest." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, you can target one additional willing creature for each slot level above 3rd."
};
SpellsList["cause fear-xgte"] = {
	name : "Cause Fear",
	classes : ["warlock", "wizard"],
	source : ["X", 151],
	level : 1,
	school : "Necro",
	time : "1 a",
	range : "60 ft",
	components : "V",
	duration : "Conc, 1 min",
	save : "Wis",
	description : "1+1/SL crea (not construct/undead), each max 30 ft apart, save or frightened; save end of each turn",
	descriptionFull : "You awaken the sense of mortality in one creature you can see within range. A construct or an undead is immune to this effect. The target must succeed on a Wisdom saving throw or become frightened of you until the spell ends. The frightened target can repeat the saving throw at the end of each of its turns, ending the effect on itself on a success." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, you can target one additional creature for each slot level above 1st. The creatures must be within 30 feet of each other when you target them."
};
SpellsList["ceremony-xgte"] = {
	name : "Ceremony",
	classes : ["cleric", "paladin"],
	source : ["X", 151],
	ritual : true,
	level : 1,
	school : "Abjur",
	time : "1 h",
	range : "Touch",
	components : "V,S,M\u2020",
	compMaterial : "25 gp worth of powdered silver, which the spell consumes",
	duration : "Instantaneous",
	description : "Perform religious ceremony on target(s) within 10 ft throughout the casting; see book (25gp cons.)",
	descriptionFull : "You perform a special religious ceremony that is infused with magic. When you cast the spell, choose one of the following rites, the target of which must be within 10 feet of you throughout the casting." + "\n   " + toUni("Atonement") + ": You touch one willing creature whose alignment has changed, and you make a DC 20 Wisdom (Insight) check. On a successful check, you restore the target to its original alignment." + "\n   " + toUni("Bless Water") + ": You touch one vial of water and cause it to become holy water." + "\n   " + toUni("Coming of Age") + ": You touch one humanoid who is a young adult. For the next 24 hours, whenever the target makes an ability check, it can roll a d4 and add the number rolled to the ability check. A creature can benefit from this rite only once." + "\n   " + toUni("Dedication") + ": You touch one humanoid who wishes to be dedicated to your god's service. For the next 24 hours, whenever the target makes a saving throw, it can roll a d4 and add the number rolled to the save. A creature can benefit from this rite only once." + "\n   " + toUni("Funeral Rite") + ": You touch one corpse, and for the next 7 days, the target can't become undead by any means short of a wish spell." + "\n   " + toUni("Wedding") + ": You touch adult humanoids willing to be bonded together in marriage. For the next 7 days, each target gains a +2 bonus to AC while they are within 30 feet of each other. A creature can benefit from this rite again only if widowed."
};
SpellsList["chaos bolt-xgte"] = {
	name : "Chaos Bolt",
	classes : ["sorcerer"],
	source : [["X", 151], ["G", 67]],
	level : 1,
	school : "Evoc",
	time : "1 a",
	range : "120 ft",
	components : "V,S",
	duration : "Instantaneous",
	description : "Spell atk 2d8+1d6+1d6/SL dmg, d8s set dmg type, see B; double on d8s: new atk vs. crea in 30 ft",
	descriptionFull : "You hurl an undulating, warbling mass of chaotic energy at one creature in range. Make a ranged spell attack against the target. On a hit, the target takes 2d8 + 1d6 damage. Choose one of the d8s. The number rolled on that die determines the attack's damage type, as shown below." + "\n\n" + toUni("d8") + "\t" + toUni("Damage Type") + "\n  1\tAcid" + "\n  2\tCold" + "\n  3\tFire" + "\n  4\tForce" + "\n  5\tLightning" + "\n  6\tPoison" + "\n  7\tPsychic" + "\n  8\tThunder" + "\n\n   " + "If you roll the same number on both d8s, the chaotic energy leaps from the target to a different creature of your choice within 30 feet of it. Make a new attack roll against the new target, and make a new damage roll, which could cause the chaotic energy to leap again." + "\n   " + "A creature can be targeted only once by each casting of this spell." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, each target takes 1d6 extra damage of the type rolled for each slot level above 1st."
};
SpellsList["charm monster"] = {
	name : "Charm Monster",
	classes : ["bard", "druid", "sorcerer", "warlock", "wizard"],
	source : ["X", 151],
	level : 4,
	school : "Ench",
	time : "1 a",
	range : "30 ft",
	components : "V,S",
	duration : "1 h",
	save : "Wis",
	description : "1+1/SL creatures, each max 30 ft apart, save or charmed; adv. on save if me/ally is fighting it",
	descriptionFull : "You attempt to charm a creature you can see within range. It must make a Wisdom saving throw, and it does so with advantage if you or your companions are fighting it. If it fails the saving throw, it is charmed by you until the spell ends or until you or your companions do anything harmful to it. The charmed creature is friendly to you. When the spell ends, the creature knows it was charmed by you." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, you can target one additional creature for each slot level above 4th. The creatures must be within 30 feet of each other when you target them."
};
SpellsList["create homunculus"] = {
	name : "Create Homunculus",
	classes : ["wizard"],
	source : ["X", 152],
	level : 6,
	school : "Trans",
	time : "1 h",
	range : "Touch",
	components : "V,S,M\u0192",
	compMaterial : "Clay, ash, and mandrake root, all of which the spell consumes, and a jewel-encrusted dagger worth at least 1,000 gp", 
	duration : "Instantaneous",
	description : "I take 2d4 piercing dmg to create a homunculus as my faithful companion; see book (1000gp)",
	descriptionFull : "While speaking an intricate incantation, you cut yourself with a jewel-encrusted dagger, taking 2d4 piercing damage that can't be reduced in any way. You then drip your blood on the spell's other components and touch them, transforming them into a special construct called a homunculus." + "\n   " + "The statistics of the homunculus are in the Monster Manual. It is your faithful companion, and it dies if you die. Whenever you finish a long rest, you can spend up to half your Hit Dice if the homunculus is on the same plane of existence as you. When you do so, roll each die and add your Constitution modifier to it. Your hit point maximum is reduced by the total, and the homunculus's hit point maximum and current hit points are both increased by it. This process can reduce you to no lower than 1 hit point, and the change to your and the homunculus's hit points ends when you finish your next long rest. The reduction to your hit point maximum can't be removed by any means before then, except by the homunculus's death." + "\n   " + "You can have only one homunculus at a time. If you cast this spell while your homunculus lives, the spell fails."
};
SpellsList["crown of stars"] = {
	name : "Crown of Stars",
	classes : ["sorcerer", "warlock", "wizard"],
	source : ["X", 152],
	level : 7,
	school : "Evoc",
	time : "1 a",
	range : "Self",
	components : "V,S",
	duration : "1 h",
	description : "7+2/SL motes shed 30-ft light; bonus action to fire one as 120 ft ranged atk for 4d12 Radiant dmg",
	descriptionFull : "Seven star-like motes of light appear and orbit your head until the spell ends. You can use a bonus action to send one of the motes streaking toward one creature or object within 120 feet of you. When you do so, make a ranged spell attack. On a hit, the target takes 4d12 radiant damage. Whether you hit or miss, the mote is expended. The spell ends early if you expend the last mote." + "\n   " + "If you have four or more motes remaining, they shed bright light in a 30-foot radius and dim light for an additional 30 feet. If you have one to three motes remaining, they shed dim light in a 30-foot radius." + AtHigherLevels + "When you cast this spell using a spell slot of 8th level or higher, the number of motes created increases by two for each slot level above 7th."
};
SpellsList["danse macabre"] = {
	name : "Danse Macabre",
	classes : ["warlock", "wizard"],
	source : ["X", 153],
	level : 5,
	school : "Necro",
	time : "1 a",
	range : "60 ft",
	components : "V,S",
	duration : "Conc, 1 h",
	description : "5+2/SL small/medium corpses as zombie/skeleton; spellc. mod to atk/dmg; bns a command in 60 ft",
	descriptionFull : "Threads of dark power leap from your fingers to pierce up to five Small or Medium corpses you can see within range. Each corpse immediately stands up and becomes undead. You decide whether it is a zombie or a skeleton (the statistics for zombies and skeletons are in the Monster Manual), and it gains a bonus to its attack and damage rolls equal to your spellcasting ability modifier." + "\n   " + "You can use a bonus action to mentally command the creatures you make with this spell, issuing the same command to all of them. To receive the command, a creature must be within 60 feet of you. You decide what action the creatures will take and where they will move during their next turn, or you can issue a general command, such as to guard a chamber or passageway against your foes. If you issue no commands, the creatures do nothing except defend themselves against hostile creatures. Once given an order, the creatures continue to follow it until their task is complete." + "\n   " + "The creatures are under your control until the spell ends, after which they become inanimate once more" + AtHigherLevels + "When you cast this spell using a spell slot of 6th level or higher, you animate up to two additional corpses for each slot level above 5th."
};
SpellsList["dawn"] = {
	name : "Dawn",
	classes : ["cleric", "wizard"],
	source : ["X", 153],
	level : 5,
	school : "Evoc",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M\u0192",
	compMaterial : "A sunburst pendant worth at least 100 gp", 
	duration : "Conc, 1 min",
	save : "Con",
	description : "30-ft rad 40-ft high all crea 4d10 Radiant dmg at cast/end turn; bns a move it 60 ft (100gp)",
	descriptionFull : "The light of dawn shines down on a location you specify within range. Until the spell ends, a 30-foot-radius, 40-foot-high cylinder of bright light glimmers there. This light is sunlight." + "\n   " + "When the cylinder appears, each creature in it must make a Constitution saving throw, taking 4d10 radiant damage on a failed save, or half as much damage on a successful one. A creature must also make this saving throw whenever it ends its turn in the cylinder." + "\n   " + "If you're within 60 feet of the cylinder, you can move it up to 60 feet as a bonus action on your turn."
};
SpellsList["dragon's breath"] = {
	name : "Dragon's Breath",
	classes : ["sorcerer", "wizard"],
	source : ["X", 154],
	level : 2,
	school : "Trans",
	time : "1 bns",
	range : "Touch",
	components : "V,S,M",
	compMaterial : "A hot pepper",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "1 willing crea: 1 act to breathe 15-ft cone 3d6+1d6/SL Acid/Cold/Fire/Light./Poison dmg; save half",
	descriptionFull : "You touch one willing creature and imbue it with the power to spew magical energy from its mouth, provided it has one. Choose acid, cold, fire, lightning, or poison. Until the spell ends, the creature can use an action to exhale energy of the chosen type in a 15-foot cone. Each creature in that area must make a Dexterity saving throw, taking 3d6 damage of the chosen type on a failed save, or half as much damage on a successful one." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d6 for each slot level above 2nd."
};
SpellsList["druid grove"] = {
	name : "Druid Grove",
	classes : ["druid"],
	source : ["X", 154],
	level : 6,
	school : "Abjur",
	time : "10 min",
	range : "Touch",
	components : "V,S,M\u2020",
	compMaterial : "Mistletoe, which the spell consumes, that was harvested with a golden sickle under the light of a full moon",
	duration : "24 h",
	description : "Protect 30-ft to 90-ft cube outdoors or underground; see book for effects",
	descriptionFull : "You invoke the spirits of nature to protect an area outdoors or underground. The area can be as small as a 30-foot cube or as large as a 90-foot cube. Buildings and other structures are excluded from the affected area. If you cast this spell in the same area every day for a year, the spell lasts until dispelled." + "\n   " + "The spell creates the following effects within the area. When you cast this spell, you can specify creatures as friends who are immune to the effects. You can also specify a password that, when spoken aloud, makes the speaker immune to these effects." + "\n   " + "The entire warded area radiates magic. A dispel magic cast on the area, if successful, removes only one of the following effects, not the entire area. That spell's caster chooses which effect to end. Only when all its effects are gone is this spell dispelled." + "\n   " + toUni("Solid Fog") + ": You can fill any number of 5-foot squares on the ground with thick fog, making them heavily obscured. The fog reaches 10 feet high. In addition, every foot of movement through the fog costs 2 extra feet. To a creature immune to this effect, the fog obscures nothing and looks like soft mist, with motes of green light floating in the air." + "\n   " + toUni("Grasping Undergrowth") + ": You can fill any number of 5-foot squares on the ground that aren't filled with fog with grasping weeds and vines, as if they were affected by an entangle spell. To a creature immune to this effect, the weeds and vines feel soft and reshape themselves to serve as temporary seats or beds." + "\n   " + toUni("Grove Guardians") + ": You can animate up to four trees in the area, causing them to uproot themselves from the ground. These trees have the same statistics as an awakened tree, which appears in the Monster Manual, except they can't speak, and their bark is covered with druidic symbols. If any creature not immune to this effect enters the warded area, the grove guardians fight until they have driven off or slain the intruders. The grove guardians also obey your spoken commands (no action required by you) that you issue while in the area. If you don't give them commands and no intruders are present, the grove guardians do nothing. The grove guardians can't leave the warded area. When the spell ends, the magic animating them disappears, and the trees take root again if possible." + "\n   " + toUni("Additional Spell Effects") + ": You can place your choice of one of the following magical effects within the warded area:" + "\n \u2022 " + "A constant gust of wind in two locations of your choice" + "\n \u2022 " + "Spike growth in one location of your choice" + "\n \u2022 " + "Wind wall in two locations of your choice" + "\n   " + "To a creature immune to this effect, the winds are a fragrant, gentle breeze, and the area of spike growth is harmless."
};
SpellsList["enemies abound"] = {
	name : "Enemies Abound",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : ["X", 155],
	level : 3,
	school : "Ench",
	time : "1 a",
	range : "120 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	save : "Int",
	description : "1 crea save or regard all creatures it can see as enemies, random targeting; save when damaged to end",
	descriptionFull : "You reach into the mind of one creature you can see and force it to make an Intelligence saving throw. A creature automatically succeeds if it is immune to being frightened. On a failed save, the target loses the ability to distinguish friend from foe, regarding all creatures it can see as enemies until the spell ends. Each time the target takes damage, it can repeat the saving throw, ending the effect on itself on a success." + "\n   " + "Whenever the affected creature chooses another creature as a target, it must choose the target at random from among the creatures it can see within range of the attack, spell, or other ability it's using. If an enemy provokes an opportunity attack from the affected creature, the creature must make that attack if it is able to."
};
SpellsList["enervation"] = {
	name : "Enervation",
	classes : ["sorcerer", "warlock", "wizard"],
	source : ["X", 155],
	level : 5,
	school : "Necro",
	time : "1 a",
	range : "60 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	save : "Dex",
	description : "1 crea 4d8+1d8/SL Necro dmg, action to repeat, I heal half; on save 2d8+1d8/SL dmg once; see book",
	descriptionFull : "A tendril of inky darkness reaches out from you, touching a creature you can see within range to drain life from it. The target must make a Dexterity saving throw. On a successful save, the target takes 2d8 necrotic damage, and the spell ends. On a failed save, the target takes 4d8 necrotic damage, and until the spell ends, you can use your action on each of your turns to automatically deal 4d8 necrotic damage to the target. The spell ends if you use your action to do anything else, if the target is ever outside the spell's range, or if the target has total cover from you." + "\n   " + "Whenever the spell deals damage to a target, you regain hit points equal to half the amount of necrotic damage the target takes." + AtHigherLevels + "When you cast this spell using a spell slot of 6th level or higher, the damage increases by 1d8 for each slot level above 5th."
};
SpellsList["far step"] = {
	name : "Far Step",
	classes : ["sorcerer", "warlock", "wizard"],
	source : ["X", 155],
	level : 5,
	school : "Conj",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	description : "At casting and as bonus action for duration, I can teleport 60 ft to a space I can see",
	descriptionFull : "You teleport up to 60 feet to an unoccupied space you can see. On each of your turns before the spell ends, you can use a bonus action to teleport in this way again."
};
SpellsList["find greater steed"] = {
	name : "Find Greater Steed",
		classes : ["paladin"],
		source : ["X", 156],
		level : 4,
		school : "Conj",
		time : "10 min",
		range : "30 ft",
		components : "V,S",
		duration : "Instantaneous",
		description : "Gain the services of a steed; can communicate with it telepathically; can share spells with it; see book",
		descriptionFull : "You summon a spirit that assumes the form of a loyal, majestic mount. Appearing in an unoccupied space within range, the spirit takes on a form you choose: a griffon, a pegasus, a peryton, a dire wolf, a rhinoceros, or a saber-toothed tiger. The creature has the statistics provided in the Monster Manual for the chosen form, though it is a celestial, a fey, or a fiend (your choice) instead of its normal creature type. Additionally, if it has an Intelligence score of 5 or lower, its Intelligence becomes 6, and it gains the ability to understand one language of your choice that you speak." + "\n   " + "You control the mount in combat. While the mount is within 1 mile of you, you can communicate with it telepathically. While mounted on it, you can make any spell you cast that targets only you also target the mount." + "\n   " + "The mount disappears temporarily when it drops to 0 hit points or when you dismiss it as an action. Casting this spell again re-summons the bonded mount, with all its hit points restored and any conditions removed." + "\n   " + "You can't have more than one mount bonded by this spell or find steed at the same time. As an action, you can release a mount from its bond, causing it to disappear permanently." + "\n   " + "Whenever the mount disappears, it leaves behind any objects it was wearing or carrying."
};
SpellsList["guardian of nature"] = {
	name : "Guardian of Nature",
	classes : ["druid", "ranger"],
	source : ["X", 157],
	level : 4,
	school : "Trans",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	description : "I transform into a Primal Beast (offensive bonuses) or a Great Tree (defensive bonuses); see book",
	descriptionFull : "A nature spirit answers your call and transforms you into a powerful guardian. The transformation lasts until the spell ends. You choose one of the following forms to assume: Primal Beast or Great Tree." + "\n\n" + toUni("Primal Beast") + ": Bestial fur covers your body, your facial features become feral, and you gain the following benefits:" + "\n \u2022 " + "Your walking speed increases by 10 feet." + "\n \u2022 " + "You gain darkvision with a range of 120 feet." + "\n \u2022 " + "You make Strength-based attack rolls with advantage." + "\n \u2022 " + "Your melee weapon attacks deal an extra 1d6 force damage on a hit." + "\n\n" + toUni("Great Tree") + ": Your skin appears barky, leaves sprout from your hair, and you gain the following benefits:" + "\n \u2022 " + "You gain 10 temporary hit points." + "\n \u2022 " + "You make Constitution saving throws with advantage." + "\n \u2022 " + "You make Dexterity- and Wisdom-based attack rolls with advantage." + "\n \u2022 " + "While you are on the ground, the ground within 15 feet of you is difficult terrain for your enemies."
};
SpellsList["healing spirit"] = {
	name : "Healing Spirit",
	classes : ["druid", "ranger"],
	source : ["X", 157],
	level : 2,
	school : "Conj",
	time : "1 bns",
	range : "60 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	description : "5-ft cube any living crea I can see starts/enters heals 1d6+1d6/SL HP; 1 bns move it 30 ft",
	descriptionFull : "You call forth a nature spirit to soothe the wounded. The intangible spirit appears in a space that is a 5-foot cube you can see within range. The spirit looks like a transparent beast or fey (your choice)." + "\n   " + "Until the spell ends, whenever you or a creature you can see moves into the spirit's space for the first time on a turn or starts its turn there, you can cause the spirit to restore 1d6 hit points to that creature (no action required). The spirit can't heal constructs or undead." + "\n   " + "As a bonus action on your turn, you can move the spirit up to 30 feet to a space you can see." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the healing increases by 1d6 for each slot level above 2nd."
};
SpellsList["holy weapon"] = { 
	name : "Holy Weapon",
	classes : ["cleric", "paladin"],
	source : ["X", 157],
	level : 5,
	school : "Evoc",
	time : "1 bns",
	range : "Touch",
	components : "V,S",
	duration : "Conc, 1 h",
	save : "Con",
	description : "Wea +2d8 Radiant dmg; bns a end spell, 30-ft rad all crea 4d8 Radiant dmg, blind; save half, no blind",
	descriptionFull : "You imbue a weapon you touch with holy power. Until the spell ends, the weapon emits bright light in a 30-foot radius and dim light for an additional 30 feet. In addition, weapon attacks made with it deal an extra 2d8 radiant damage on a hit. If the weapon isn't already a magic weapon, it becomes one for the duration." + "\n   " + "As a bonus action on your turn, you can dismiss this spell and cause the weapon to emit a burst of radiance. Each creature of your choice that you can see within 30 feet of you must make a Constitution saving throw. On a failed save, a creature takes 4d8 radiant damage, and it is blinded for 1 minute. On a successful save, a creature takes half as much damage and isn't blinded. At the end of each of its turns, a blinded creature can make a Constitution saving throw, ending the effect on itself on a success."
};
SpellsList["illusory dragon"] = {
	name : "Illusory Dragon",
	classes : ["wizard"],
	source : ["X", 157],
	level : 8,
	school : "Illus",
	time : "1 a",
	range : "120 ft",
	components : "S",
	duration : "Conc, 1 min",
	save : "W/I",
	description : "Huge shadowy dragon; see: Wis save or fright.; bns a move 60 ft \u0026 breath wea 7d6 dmg; Int save half",
	descriptionFull : "By gathering threads of shadow material from the Shadowfell, you create a Huge shadowy dragon in an unoccupied space that you can see within range. The illusion lasts for the spell's duration and occupies its space, as if it were a creature." + "\n   " + "When the illusion appears, any of your enemies that can see it must succeed on a Wisdom saving throw or become frightened of it for 1 minute. If a frightened creature ends its turn in a location where it doesn't have line of sight to the illusion, it can repeat the saving throw, ending the effect on itself on a success." + "\n   " + "As a bonus action on your turn, you can move the illusion up to 60 feet. At any point during its movement, you can cause it to exhale a blast of energy in a 60-foot cone originating from its space. When you create the dragon, choose a damage type: acid, cold, fire, lightning, necrotic, or poison. Each creature in the cone must make an Intelligence saving throw, taking 7d6 damage of the chosen damage type on a failed save, or half as much damage on a successful one." + "\n   " + "The illusion is tangible because of the shadow stuff used to create it, but attacks miss it automatically, it succeeds on all saving throws, and it is immune to all damage and conditions. A creature that uses an action to examine the dragon can determine that it is an illusion by succeeding on an Intelligence (Investigation) check against your spell save DC. If a creature discerns the illusion for what it is, the creature can see through it and has advantage on saving throws against its breath."
};
SpellsList["infernal calling"] = {
	name : "Infernal Calling",
	classes : ["warlock", "wizard"],
	source : ["X", 158],
	level : 5,
	school : "Conj",
	time : "1 min",
	range : "90 ft",
	components : "V,S,M\u0192",
	compMaterial : "A ruby worth at least 999 gp",
	duration : "Conc, 1 h",
	description : "Summon 1 devil of CR 6+1/SL; hostile to all, obeys my command if to its liking or Cha check; see B",
	descriptionFull : "Uttering a dark incantation, you summon a devil from the Nine Hells. You choose the devil's type, which must be one of challenge rating 6 or lower, such as a barbed devil or a bearded devil. The devil appears in an unoccupied space that you can see within range. The devil disappears when it drops to 0 hit points or when the spell ends." + "\n   " + "The devil is unfriendly toward you and your companions. Roll initiative for the devil, which has its own turns. It is under the Dungeon Master's control and acts according to its nature on each of its turns, which might result in its attacking you if it thinks it can prevail, or trying to tempt you to undertake an evil act in exchange for limited service. The DM has the creature's statistics." + "\n   " + "On each of your turns, you can try to issue a verbal command to the devil (no action required by you). It obeys the command if the likely outcome is in accordance with its desires, especially if the result would draw you toward evil. Otherwise, you must make a Charisma (Deception, Intimidation, or Persuasion) check contested by its Wisdom (Insight) check. You make the check with advantage if you say the devil's true name. If your check fails, the devil becomes immune to your verbal commands for the duration of the spell, though it can still carry out your commands if it chooses. If your check succeeds, the devil carries out your command \u2014 such as “attack my enemies,” “explore the room ahead,” or “bear this message to the queen” \u2014 until it completes the activity, at which point it returns to you to report having done so." + "\n   " + "If your concentration ends before the spell reaches its full duration, the devil doesn't disappear if it has become immune to your verbal commands. Instead, it acts in whatever manner it chooses for 3d6 minutes, and then it disappears." + "\n   " + "If you possess an individual devil's talisman, you can summon that devil if it is of the appropriate challenge rating plus 1, and it obeys all your commands, with no Charisma checks required." + AtHigherLevels + "When you cast this spell using a spell slot of 6th level or higher, the challenge rating increases by 1 for each slot level above 5th."
};
SpellsList["infestation-xgte"] = {
	name : "Infestation",
	classes : ["druid", "sorcerer", "warlock", "wizard"],
	source : ["X", 158],
	level : 0,
	school : "Conj",
	time : "1 a",
	range : "30 ft",
	components : "V,S,M",
	compMaterial : "A living flea",
	duration : "Instantaneous",
	save : "Con",
	description : "1 crea save or 1d6 Poison dmg and moved 5 ft in random direction; +1d6 at CL 5, 11, and 17",
	descriptionFull : "You cause a cloud of mites, fleas, and other parasites to appear momentarily on one creature you can see within range. The target must succeed on a Constitution saving throw, or it takes 1d6 poison damage and moves 5 feet in a random direction if it can move and its speed is at least 5 feet. Roll a d4 for the direction:" + "\n\n" + toUni("d4") + "\t" + toUni("Direction") + "\n  1\tNorth" + "\n  2\tSouth" + "\n  3\tEast" + "\n  4\tWest" + "\n\n   " + "This movement doesn't provoke opportunity attacks, and if the direction rolled is blocked, the target doesn't move." + "\n   " + "The spell's damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6)."
};
SpellsList["invulnerability"] = {
	name : "Invulnerability",
	classes : ["wizard"],
	source : ["X", 160],
	level : 9,
	school : "Abjur",
	time : "1 a",
	range : "Self",
	components : "V,S,M\u2020",
	compMaterial : "A small piece of adamantine worth at least 500 gp, which the spell consumes",
	duration : "Conc, 10 min",
	description : "Immune to all damage until the spell ends (500gp cons.)",
	descriptionFull : "You are immune to all damage until the spell ends."
};
SpellsList["life transference"] = {
	name : "Life Transference",
	classes : ["cleric", "wizard"],
	source : ["X", 160],
	level : 3,
	school : "Necro",
	time : "1 a",
	range : "30 ft",
	components : "V,S",
	duration : "Instantaneous",
	description : "I take 4d8+1d8/SL Necrotic dmg, and 1 crea in range I can see heals twice that in HP",
	descriptionFull : "You sacrifice some of your health to mend another creature's injuries. You take 4d8 necrotic damage, and one creature of your choice that you can see within range regains a number of hit points equal to twice the necrotic damage you take." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the damage increases by 1d8 for each slot level above 3rd."
};
SpellsList["maddening darkness"] = {
	name : "Maddening Darkness",
	classes : ["warlock", "wizard"],
	source : ["X", 160],
	level : 8,
	school : "Evoc",
	time : "1 a",
	range : "150 ft",
	components : "V,M",
	compMaterial : "A drop of pitch mixed with a drop of mercury",
	duration : "Conc, 10 min",
	save : "Wis",
	description : "60-ft rad darkness; darkvision, no light works; Crea starting turn in 8d8 Psychic dmg, save halves",
	descriptionFull : "Magical darkness spreads from a point you choose within range to fill a 60-foot-radius sphere until the spell ends. The darkness spreads around corners. A creature with darkvision can't see through this darkness. Nonmagical light, as well as light created by spells of 8th level or lower, can't illuminate the area." + "\n   " + "Shrieks, gibbering, and mad laughter can be heard within the sphere. Whenever a creature starts its turn in the sphere, it must make a Wisdom saving throw, taking 8d8 psychic damage on a failed save, or half as much damage on a successful one."
};
SpellsList["mass polymorph"] = {
	name : "Mass Polymorph",
	classes : ["bard", "sorcerer", "wizard"],
	source : ["X", 160],
	level : 9,
	school : "Trans",
	time : "1 a",
	range : "120 ft",
	components : "V,S,M",
	compMaterial : "A caterpillar cocoon",
	duration : "Conc, 1 h",
	save : "Wis",
	description : "10 crea save or take chosen beast form of CR \u2264 its CR or half its char. level; can only act as beast; see B",
	descriptionFull : "You transform up to ten creatures of your choice that you can see within range. An unwilling target must succeed on a Wisdom saving throw to resist the transformation. An unwilling shapechanger automatically succeeds on the save." + "\n   " + "Each target assumes a beast form of your choice, and you can choose the same form or different ones for each target. The new form can be any beast you have seen whose challenge rating is equal to or less than the target's (or half the target's level, if the target doesn't have a challenge rating). The target's game statistics, including mental ability scores, are replaced by the statistics of the chosen beast, but the target retains its hit points, alignment, and personality." + "\n   " + "Each target gains a number of temporary hit points equal to the hit points of its new form. These temporary hit points can't be replaced by temporary hit points from another source. A target reverts to its normal form when it has no more temporary hit points or it dies. If the spell ends before then, the creature loses all its temporary hit points and reverts to its normal form." + "\n   " + "The creature is limited in the actions it can perform by the nature of its new form. It can't speak, cast spells, or do anything else that requires hands or speech." + "\n   " + "The target's gear melds into the new form. The target can't activate, use, wield, or otherwise benefit from any of its equipment."
};
SpellsList["mental prison"] = {
	name : "Mental Prison",
	classes : ["sorcerer", "warlock", "wizard"],
	source : ["X", 161],
	level : 6,
	school : "Illus",
	time : "1 a",
	range : "60 ft",
	components : "S",
	duration : "Conc, 1 min",
	save : "Int",
	description : "1 crea 5d10 Psychic dmg; save or restrained, blind, deaf, and takes 10d10 dmg if moved; charm effect",
	descriptionFull : "You attempt to bind a creature within an illusory cell that only it perceives. One creature you can see within range must make an Intelligence saving throw. The target succeeds automatically if it is immune to being charmed. On a successful save, the target takes 5d10 psychic damage, and the spell ends. On a failed save, the target takes 5d10 psychic damage, and you make the area immediately around the target's space appear dangerous to it in some way. You might cause the target to perceive itself as being surrounded by fire, floating razors, or hideous maws filled with dripping teeth. Whatever form the illusion takes, the target can't see or hear anything beyond it and is restrained for the spell's duration. If the target is moved out of the illusion, makes a melee attack through it, or reaches any part of its body through it, the target takes 10d10 psychic damage, and the spell ends."
};
SpellsList["mighty fortress"] = {
	name : "Mighty Fortress",
	classes : ["wizard"],
	source : ["X", 161],
	level : 8,
	school : "Conj",
	time : "1 min",
	range : "1 mile",
	components : "V,S,M\u2020",
	compMaterial : "A diamond worth at least 500 gp, which the spell consumes",
	duration : "Instantaneous",
	description : "Create a stone fortress 120 ft on a side for 7 days; see book for effects (500gp cons.)",
	descriptionFull : "A fortress of stone erupts from a square area of ground of your choice that you can see within range. The area is 120 feet on each side, and it must not have any buildings or other structures on it. Any creatures in the area are harmlessly lifted up as the fortress rises." + "\n   " + "The fortress has four turrets with square bases, each one 20 feet on a side and 30 feet tall, with one turret on each corner. The turrets are connected to each other by stone walls that are each 80 feet long, creating an enclosed area. Each wall is 1 foot thick and is composed of panels that are 10 feet wide and 20 feet tall. Each panel is contiguous with two other panels or one other panel and a turret. You can place up to four stone doors in the fortress's outer wall." + "\n   " + "A small keep stands inside the enclosed area. The keep has a square base that is 50 feet on each side, and it has three floors with 10-foot-high ceilings. Each of the floors can be divided into as many rooms as you like, provided each room is at least 5 feet on each side. The floors of the keep are connected by stone staircases, its walls are 6 inches thick, and interior rooms can have stone doors or open archways as you choose. The keep is furnished and decorated however you like, and it contains sufficient food to serve a nine-course banquet for up to 100 people each day. Furnishings, food, and other objects created by this spell crumble to dust if removed from the fortress." + "\n   " + "A staff of one hundred invisible servants obeys any command given to them by creatures you designate when you cast the spell. Each servant functions as if created by the unseen servant spell." + "\n   " + "The walls, turrets, and keep are all made of stone that can be damaged. Each 10-foot-by-10-foot section of stone has AC 15 and 30 hit points per inch of thickness. It is immune to poison and psychic damage. Reducing a section of stone to 0 hit points destroys it and might cause connected sections to buckle and collapse at the DM's discretion." + "\n   " + "After 7 days or when you cast this spell somewhere else, the fortress harmlessly crumbles and sinks back into the ground, leaving any creatures that were inside it safely on the ground." + "\n   " + "Casting this spell on the same spot once every 7 days for a year makes the fortress permanent."
};
SpellsList["mind spike"] = { // +1d8 at higher levels errata (https://twitter.com/JeremyECrawford/status/930603935391293440)
	name : "Mind Spike",
	classes : ["sorcerer", "warlock", "wizard"],
	source : ["X", 162],
	level : 2,
	school : "Div",
	time : "1 a",
	range : "60 ft",
	components : "S",
	duration : "Conc, 1 h",
	save : "Wis",
	description : "1 crea 3d8+1d8/SL Psychic dmg, know its location, can't be invis for me; save half, no other benefits",
	descriptionFull : "You reach into the mind of one creature you can see within range. The target must make a Wisdom saving throw, taking 3d8 psychic damage on a failed save, or half as much damage on a successful one. On a failed save, you also always know the target's location until the spell ends, but only while the two of you are on the same plane of existence. While you have this knowledge, the target can't become hidden from you, and if it's invisible, it gains no benefit from that condition against you." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, the damage increases by 1d8 for each slot level above 2nd."
};
SpellsList["negative energy flood"] = {
	name : "Negative Energy Flood",
	classes : ["warlock", "wizard"],
	source : ["X", 163],
	level : 5,
	school : "Necro",
	time : "1 a",
	range : "60 ft",
	components : "V,M",
	compMaterial : "A broken bone and a square of black silk",
	duration : "Instantaneous",
	save : "Con",
	description : "1 crea: living 5d12 Necrotic dmg, save halves, rises as zombie if killed; undead 5d12/2 temp HP",
	descriptionFull : "You send ribbons of negative energy at one creature you can see within range. Unless the target is undead, it must make a Constitution saving throw, taking 5d12 necrotic damage on a failed save, or half as much damage on a successful one. A target killed by this damage rises up as a zombie at the start of your next turn. The zombie pursues whatever creature it can see that is closest to it. Statistics for the zombie are in the Monster Manual." + "\n   " + "If you target an undead with this spell, the target doesn't make a saving throw. Instead, roll 5d12. The target gains half the total as temporary hit points."
};
SpellsList["power word pain"] = {
	name : "Power Word Pain",
	classes : ["sorcerer", "warlock", "wizard"],
	source : ["X", 163],
	level : 7,
	school : "Ench",
	time : "1 a",
	range : "60 ft",
	components : "V",
	duration : "Instantaneous",
	description : "1 crea with 100 HP or less disadv. atk/check/save, conc. save to cast; save/rnd to end; charm effect",
	descriptionFull : "You speak a word of power that causes waves of intense pain to assail one creature you can see within range. If the target has 100 hit points or fewer, it is subject to crippling pain. Otherwise, the spell has no effect on it. A target is also unaffected if it is immune to being charmed." + "\n   " + "While the target is affected by crippling pain, any speed it has can be no higher than 10 feet. The target also has disadvantage on attack rolls, ability checks, and saving throws, other than Constitution saving throws. Finally, if the target tries to cast a spell, it must first succeed on a Constitution saving throw, or the casting fails and the spell is wasted." + "\n   " + "A target suffering this pain can make a Constitution saving throw at the end of each of its turns. On a successful save, the pain ends."
};
SpellsList["primal savagery-xgte"] = { 
	name : "Primal Savagery",
	classes : ["druid"],
	source : ["X", 163],
	level : 0,
	school : "Trans",
	time : "1 a",
	range : "Self",
	components : "S",
	duration : "Instantaneous",
	description : "Melee spell attack, 5 ft range, for 1d10 Acid dmg; +1d10 at CL 5, 11, and 17",
	descriptionCantripDie : "Melee spell attack, 5 ft range, for `CD`d10 Acid dmg",
	descriptionFull : "You channel primal magic to cause your teeth or fingernails to sharpen, ready to deliver a corrosive attack. Make a melee spell attack against one creature within 5 feet of you. On a hit, the target takes 1d10 acid damage. After you make the attack, your teeth or fingernails return to normal." + "\n   " + "The spell's damage increases by 1d10 when you reach 5th level (2d10), 11th level (3d10), and 17th level (4d10)."
};
SpellsList["psychic scream"] = {
	name : "Psychic Scream",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : ["X", 163],
	level : 9,
	school : "Ench",
	time : "1 a",
	range : "90 ft",
	components : "S",
	duration : "Instantaneous",
	save : "Int",
	description : "10 crea Int>2 save or 14d6 Psychic dmg and stunned; save halves, no stun; end of turn save to stop",
	descriptionFull : "You unleash the power of your mind to blast the intellect of up to ten creatures of your choice that you can see within range. Creatures that have an Intelligence score of 2 or lower are unaffected." + "\n   " + "Each target must make an Intelligence saving throw. On a failed save, a target takes 14d6 psychic damage and is stunned. On a successful save, a target takes half as much damage and isn't stunned. If a target is killed by this damage, its head explodes, assuming it has one." + "\n   " + "A stunned target can make an Intelligence saving throw at the end of each of its turns. On a successful save, the stunning effect ends."
};
SpellsList["scatter"] = {
	name : "Scatter",
	classes : ["sorcerer", "warlock", "wizard"],
	source : ["X", 164],
	level : 6,
	school : "Conj",
	time : "1 a",
	range : "30 ft",
	components : "V",
	duration : "Instantaneous",
	save : "Wis",
	description : "Up to 5 creatures in range, save or teleported 120 ft to a different space I can see on the ground",
	descriptionFull : "The air quivers around up to five creatures of your choice that you can see within range. An unwilling creature must succeed on a Wisdom saving throw to resist this spell. You teleport each affected target to an unoccupied space that you can see within 120 feet of you. That space must be on the ground or on a floor."
};
SpellsList["shadow blade"] = {
	name : "Shadow Blade",
	classes : ["sorcerer", "warlock", "wizard"],
	source : ["X", 164],
	level : 2,
	school : "Illus",
	time : "1 bns",
	range : "Self",
	components : "V,S",
	duration : "Conc, 1 min",
	description : "Sword 2d8 Psychic dmg, finesse, light, thrown (20/60ft), adv. if target in dim/dark; +1d8 at SL3/5/7",
	descriptionMetric : "Sword: 2d8 Psychic dmg, finesse, light, thrown (6/18m), adv. if target in dim/dark; +1d8 at SL3/5/7",
	descriptionFull : "You weave together threads of shadow to create a sword of solidified gloom in your hand. This magic sword lasts until the spell ends. It counts as a simple melee weapon with which you are proficient. It deals 2d8 psychic damage on a hit and has the finesse, light, and thrown properties (range 20/60). In addition, when you use the sword to attack a target that is in dim light or darkness, you make the attack roll with advantage." + "\n   " + "If you drop the weapon or throw it, it dissipates at the end of the turn. Thereafter, while the spell persists, you can use a bonus action to cause the sword to reappear in your hand." + AtHigherLevels + "When you cast this spell using a 3rd- or 4th-level spell slot, the damage increases to 3d8. When you cast it using a 5th- or 6th-level spell slot, the damage increases to 4d8. When you cast it using a spell slot of 7th level or higher, the damage increases to 5d8."
};
SpellsList["shadow of moil"] = {
	name : "Shadow of Moil",
	classes : ["warlock"],
	source : ["X", 164],
	level : 4,
	school : "Necro",
	time : "1 a",
	range : "Self",
	components : "V,S,M\u0192",
	compMaterial : "An undead eyeball encased in a gem worth at least 150 gp",
	duration : "Conc, 1 min",
	description : "Me: heavy obs., resist Radiant dmg; 10-ft rad: 1 step darker, hit vs. me take 2d8 Necro dmg (150gp)",
	descriptionFull : "Flame-like shadows wreathe your body until the spell ends, causing you to become heavily obscured to others. The shadows turn dim light within 10 feet of you into darkness, and bright light in the same area to dim light." + "\n   " + "Until the spell ends, you have resistance to radiant damage. In addition, whenever a creature within 10 feet of you hits you with an attack, the shadows lash out at that creature, dealing it 2d8 necrotic damage."
};
SpellsList["sickening radiance"] = {
	name : "Sickening Radiance",
	classes : ["sorcerer", "warlock", "wizard"],
	source : ["X", 164],
	level : 4,
	school : "Evoc",
	time : "1 a",
	range : "120 ft",
	components : "V,S",
	duration : "Conc, 10 min",
	save : "Con",
	description : "30-ft rad; all enter/start turn: save or 4d10 Radiant dmg, 1 level of exhaustion, and emit 5-ft rad light",
	descriptionFull : "Dim, greenish light spreads within a 30-foot-radius sphere centered on a point you choose within range. The light spreads around corners, and it lasts until the spell ends." + "\n   " + "When a creature moves into the spell's area for the first time on a turn or starts its turn there, that creature must succeed on a Constitution saving throw or take 4d10 radiant damage, and it suffers one level of exhaustion and emits a dim, greenish light in a 5-foot radius. This light makes it impossible for the creature to benefit from being invisible. The light and any levels of exhaustion caused by this spell go away when the spell ends."
};
SpellsList["skill empowerment"] = {
	name : "Skill Empowerment",
	classes : ["bard", "sorcerer", "wizard"],
	source : ["X", 165],
	level : 5,
	school : "Trans",
	time : "1 a",
	range : "Touch",
	components : "V,S",
	duration : "Conc, 1 h",
	description : "1 willing creature gains expertise in one skill of my choice that it is proficient with for the duration",
	descriptionFull : "Your magic deepens a creature's understanding of its own talent. You touch one willing creature and give it expertise in one skill of your choice; until the spell ends, the creature doubles its proficiency bonus for ability checks it makes that use the chosen skill." + "\n   " + "You must choose a skill in which the target is proficient and that isn't already benefiting from an effect, such as Expertise, that doubles its proficiency bonus."
};
SpellsList["snare-xgte"] = {
	name : "Snare",
	classes : ["druid", "ranger", "wizard"],
	source : ["X", 165],
	level : 1,
	school : "Abjur",
	time : "1 min",
	range : "Touch",
	components : "V,S,M\u2020",
	compMaterial : "25 feet of rope, which is consumed by the spell",
	duration : "8 h, till trigger",
	save : "Dex",
	description : "5-ft rad trap; Investigation vs spell DC to see; save or restrained 3 ft in the air; save each rnd (5sp)",
	descriptionFull : "As you cast this spell, you use the rope to create a circle with a 5-foot radius on the ground or the floor. When you finish casting, the rope disappears and the circle becomes a magic trap." + "\n   " + "This trap is nearly invisible, requiring a successful Intelligence (Investigation) check against your spell save DC to be discerned." + "\n   " + "The trap triggers when a Small, Medium, or Large creature moves onto the ground or the floor in the spell's radius. That creature must succeed on a Dexterity saving throw or be magically hoisted into the air, leaving it hanging upside down 3 feet above the ground or the floor. The creature is restrained there until the spell ends." + "\n   " + "A restrained creature can make a Dexterity saving throw at the end of each of its turns, ending the effect on itself on a success. Alternatively, the creature or someone else who can reach it can use an action to make an Intelligence (Arcana) check against your spell save DC. On a success, the restrained effect ends." + "\n   " + "After the trap is triggered, the spell ends when no creature is restrained by it."
};
SpellsList["soul cage"] = {
	name : "Soul Cage",
	classes : ["warlock", "wizard"],
	source : ["X", 165],
	level : 6,
	school : "Necro",
	time : "1 rea",
	range : "60 ft",
	components : "V,S,M\u0192",
	compMaterial : "A tiny silver cage worth 100 gp",
	duration : "8 h",
	description : "As a reaction when humanoid in range dies, I capture their soul in a tiny cage; see book (100gp)",
	descriptionFull : "This spell snatches the soul of a humanoid as it dies and traps it inside the tiny cage you use for the material component. A stolen soul remains inside the cage until the spell ends or until you destroy the cage, which ends the spell. While you have a soul inside the cage, you can exploit it in any of the ways described below. You can use a trapped soul up to six times. Once you exploit a soul for the sixth time, it is released, and the spell ends. While a soul is trapped, the dead humanoid it came from can't be revived." + "\n   " + toUni("Steal Life") + ": You can use a bonus action to drain vigor from the soul and regain 2d8 hit points." + "\n   " + toUni("Query Soul") + ": You ask the soul a question (no action required) and receive a brief telepathic answer, which you can understand regardless of the language used. The soul knows only what it knew in life, but it must answer you truthfully and to the best of its ability. The answer is no more than a sentence or two and might be cryptic." + "\n   " + toUni("Borrow Experience") + ": You can use a bonus action to bolster yourself with the soul's life experience, making your next attack roll, ability check, or saving throw with advantage. If you don't use this benefit before the start of your next turn, it is lost." + "\n   " + toUni("Eyes of the Dead") + ": You can use an action to name a place the humanoid saw in life, which creates an invisible sensor somewhere in that place if it is on the plane of existence you're currently on. The sensor remains for as long as you concentrate, up to 10 minutes (as if you were concentrating on a spell). You receive visual and auditory information from the sensor as if you were in its space using your senses" + "\n   " + "A creature that can see the sensor (such as one using see invisibility or truesight) sees a translucent image of the tormented humanoid whose soul you caged."
};
SpellsList["steel wind strike"] = {
	name : "Steel Wind Strike",
	classes : ["ranger", "wizard"],
	source : ["X", 166],
	level : 5,
	school : "Conj",
	time : "1 a",
	range : "30 ft",
	components : "S,M\u0192",
	compMaterial : "A melee weapon worth at least 1 sp",
	duration : "Instantaneous",
	description : "Melee spell attack vs. 5 crea in range; 6d10 Force dmg on hit; after, I teleport next to one target",
	descriptionFull : "You flourish the weapon used in the casting and then vanish to strike like the wind. Choose up to five creatures you can see within range. Make a melee spell attack against each target. On a hit, a target takes 6d10 force damage." + "\n   " + "You can then teleport to an unoccupied space you can see within 5 feet of one of the targets you hit or missed."
};
SpellsList["summon greater demon"] = {
	name : "Summon Greater Demon",
	classes : ["warlock", "wizard"],
	source : ["X", 166],
	level : 4,
	school : "Conj",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M",
	compMaterial : "A vial of blood from a humanoid killed within the past 24 hours",
	duration : "Conc, 1 h",
	save : "Cha",
	description : "Summon 1 demon of CR 5+1/SL that obeys me; end of each of its turn, save to break free; see book",
	descriptionFull : "You utter foul words, summoning one demon from the chaos of the Abyss. You choose the demon's type, which must be one of challenge rating 5 or lower, such as a shadow demon or a barlgura. The demon appears in an unoccupied space you can see within range, and the demon disappears when it drops to 0 hit points or when the spell ends." + "\n   " + "Roll initiative for the demon, which has its own turns. When you summon it and on each of your turns thereafter, you can issue a verbal command to it (requiring no action on your part), telling it what it must do on its next turn. If you issue no command, it spends its turn attacking any creature within reach that has attacked it." + "\n   " + "At the end of each of the demon's turns, it makes a Charisma saving throw. The demon has disadvantage on this saving throw if you say its true name. On a failed save, the demon continues to obey you. On a successful save, your control of the demon ends for the rest of the duration, and the demon spends its turns pursuing and attacking the nearest non-demons to the best of its ability. If you stop concentrating on the spell before it reaches its full duration, an uncontrolled demon doesn't disappear for 1d6 rounds if it still has hit points." + "\n   " + "As part of casting the spell, you can form a circle on the ground with the blood used as a material component. The circle is large enough to encompass your space. While the spell lasts, the summoned demon can't cross the circle or harm it, and it can't target anyone within it. Using the material component in this manner consumes it when the spell ends." + AtHigherLevels + "When you cast this spell using a spell slot of 5th level or higher, the challenge rating increases by 1 for each slot level above 4th."
};
SpellsList["summon lesser demons"] = {
	name : "Summon Lesser Demons",
	classes : ["warlock", "wizard"],
	source : ["X", 167],
	level : 3,
	school : "Conj",
	time : "1 a",
	range : "60 ft",
	components : "V,S,M",
	compMaterial : "A vial of blood from a humanoid killed within the past 24 hours",
	duration : "Conc, 1 h",
	description : "Summon up to 8 (16 at SL6, 24 at SL8) CR \u22641 1 demons, DM choice; attack nearest non-demons",
	descriptionFull : "You utter foul words, summoning demons from the chaos of the Abyss. Roll on the following table to determine what appears." + "\n\n " + toUni("d6") + "\t" + toUni("Demons Summoned") + "\n  1-2\tTwo demons of challenge rating 1 or lower" + "\n  3-4\tFour demons of challenge rating 1/2 or lower" + "\n  5-6\tEight demons of challenge rating 1/4 or lower" + "\n\n   " + "The DM chooses the demons, such as manes or dretches, and you choose the unoccupied spaces you can see within range where they appear. A summoned demon disappears when it drops to 0 hit points or when the spell ends." + "\n   " + "The demons are hostile to all creatures, including you. Roll initiative for the summoned demons as a group, which has its own turns. The demons pursue and attack the nearest non-demons to the best of their ability." + "\n   " + "As part of casting the spell, you can form a circle on the ground with the blood used as a material component. The circle is large enough to encompass your space. While the spell lasts, the summoned demons can't cross the circle or harm it, and they can't target anyone within it. Using the material component in this manner consumes it when the spell ends." + AtHigherLevels + "When you cast this spell using a spell slot of 6th or 7th level, you summon twice as many demons. If you cast it using a spell slot of 8th or 9th level, you summon three times as many demons."
};
SpellsList["synaptic static"] = {
	name : "Synaptic Static",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : ["X", 167],
	level : 5,
	school : "Ench",
	time : "1 a",
	range : "120 ft",
	components : "V,S",
	duration : "Instant, 1 min",
	save : "Int",
	description : "20-ft rad all crea Int>2 save or 8d6 Psychic dmg, -1d6 on atks/check/conc. save; save half, no -1d6",
	descriptionFull : "You choose a point within range and cause psychic energy to explode there. Each creature in a 20-foot-radius sphere centered on that point must make an Intelligence saving throw. A creature with an Intelligence score of 2 or lower can't be affected by this spell. A target takes 8d6 psychic damage on a failed save, or half as much damage on a successful one." + "\n   " + "After a failed save, a target has muddled thoughts for 1 minute. During that time, it rolls a d6 and subtracts the number rolled from all its attack rolls and ability checks, as well as its Constitution saving throws to maintain concentration. The target can make an Intelligence saving throw at the end of each of its turns, ending the effect on itself on a success."
};
SpellsList["temple of the gods"] = {
	name : "Temple of the Gods",
	classes : ["cleric"],
	source : ["X", 167],
	level : 7,
	school : "Conj",
	time : "1 h",
	range : "120 ft",
	components : "V,S,M\u0192",
	compMaterial : "A holy symbol worth at least 5 gp",
	duration : "24 h",
	description : "Create a temple 120 ft on a side to the deity of a holy symbol used; see book for effects",
	descriptionFull : "You cause a temple to shimmer into existence on ground you can see within range. The temple must fit within an unoccupied cube of space, up to 120 feet on each side. The temple remains until the spell ends. It is dedicated to whatever god, pantheon, or philosophy is represented by the holy symbol used in the casting." + "\n   " + "You make all decisions about the temple's appearance. The interior is enclosed by a floor, walls, and a roof, with one door granting access to the interior and as many windows as you wish. Only you and any creatures you designate when you cast the spell can open or close the door." + "\n   " + "The temple's interior is an open space with an idol or altar at one end. You decide whether the temple is illuminated and whether that illumination is bright light or dim light. The smell of burning incense fills the air within, and the temperature is mild." + "\n   " + "The temple opposes types of creatures you choose when you cast this spell. Choose one or more of the following: celestials, elementals, fey, fiends, or undead. If a creature of the chosen type attempts to enter the temple, that creature must make a Charisma saving throw. On a failed save, it can't enter the temple for 24 hours. Even if the creature can enter the temple, the magic there hinders it; whenever it makes an attack roll, an ability check, or a saving throw inside the temple, it must roll a d4 and subtract the number rolled from the d20 roll." + "\n   " + "In addition, the sensors created by divination spells can't appear inside the temple, and creatures within can't be targeted by divination spells." + "\n   " + "Finally, whenever any creature in the temple regains hit points from a spell of 1st level or higher, the creature regains additional hit points equal to your Wisdom modifier (minimum 1 hit point)." + "\n   " + "The temple is made from opaque magical force that extends into the Ethereal Plane, thus blocking ethereal travel into the temple's interior. Nothing can physically pass through the temple's exterior. It can't be dispelled by dispel magic, and antimagic field has no effect on it. A disintegrate spell destroys the temple instantly." + "\n   " + "Casting this spell on the same spot once every 7 days for a year makes this effect permanent."
};
SpellsList["tenser's transformation"] = {
	name : "Tenser's Transformation",
	classes : ["wizard"],
	source : ["X", 168],
	level : 6,
	school : "Trans",
	time : "1 a",
	range : "Self",
	components : "V,S,M",
	compMaterial : "A few hairs from a bull",
	duration : "Conc, 10 min",
	description : "50 temp HP; prof Str/Con save, all wea/arm; extra atk; adv., +1d12 Force dmg on wea atks; no spellc.",
	descriptionFull : "You endow yourself with endurance and martial prowess fueled by magic. Until the spell ends, you can't cast spells, and you gain the following benefits:" + "\n \u2022 " + "You gain 50 temporary hit points. If any of these remain when the spell ends, they are lost." + "\n \u2022 " + "You have advantage on attack rolls that you make with simple and martial weapons." + "\n \u2022 " + "When you hit a target with a weapon attack, that target takes an extra 2d12 force damage." + "\n \u2022 " + "You have proficiency with all armor, shields, simple weapons, and martial weapons." + "\n \u2022 " + "You have proficiency in Strength and Constitution saving throws." + "\n \u2022 " + "You can attack twice, instead of once, when you take the Attack action on your turn. You ignore this benefit if you already have a feature, like Extra Attack, that gives you extra attacks." + "\n   " + "Immediately after the spell ends, you must succeed on a DC 15 Constitution saving throw or suffer one level of exhaustion."
};
SpellsList["thunder step"] = {
	name : "Thunder Step",
	classes : ["sorcerer", "warlock", "wizard"],
	source : ["X", 168],
	level : 3,
	school : "Conj",
	time : "1 a",
	range : "90 ft",
	components : "V",
	duration : "Instantaneous",
	save : "Con",
	description : "Me + willing crea teleport 90 ft; all crea in 10 ft of left spot 3d10+1d10/SL Thunder dmg; save half",
	descriptionFull : "You teleport yourself to an unoccupied space you can see within range. Immediately after you disappear, a thunderous boom sounds, and each creature within 10 feet of the space you left must make a Constitution saving throw, taking 3d10 thunder damage on a failed save, or half as much damage on a successful one. The thunder can be heard from up to 300 feet away." + "\n   " + "You can bring along objects as long as their weight doesn't exceed what you can carry. You can also teleport one willing creature of your size or smaller who is carrying gear up to its carrying capacity. The creature must be within 5 feet of you when you cast this spell, and there must be an unoccupied space within 5 feet of your destination space for the creature to appear in; otherwise, the creature is left behind." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the damage increases by 1d10 for each slot level above 3rd."
};
SpellsList["tiny servant"] = {
	name : "Tiny Servant",
	classes : ["wizard"],
	source : ["X", 168],
	level : 3,
	school : "Trans",
	time : "1 min",
	range : "Touch",
	components : "V,S",
	duration : "8 h",
	description : "Animate 1+2/SL Tiny, nonmagical, unattended obj as tiny servants; bns a to command telepathically",
	descriptionFull : "You touch one Tiny, nonmagical object that isn't attached to another object or a surface and isn't being carried by another creature. The target animates and sprouts little arms and legs, becoming a creature under your control until the spell ends or the creature drops to 0 hit points. See the Tiny Servant stat block for its statistics." + "\n   " + "As a bonus action, you can mentally command the creature if it is within 120 feet of you. (If you control multiple creatures with this spell, you can command any or all of them at the same time, issuing the same command to each one.) You decide what action the creature will take and where it will move during its next turn, or you can issue a simple, general command, such as to fetch a key, stand watch, or stack some books. If you issue no commands, the servant does nothing other than defend itself against hostile creatures. Once given an order, the servant continues to follow that order until its task is complete." + "\n   " + "When the creature drops to 0 hit points, it reverts to its original form, and any remaining damage carries over to that form." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, you can animate two additional objects for each slot level above 3rd."
};
SpellsList["toll the dead"] = {
	name : "Toll the Dead",
	classes : ["cleric", "warlock", "wizard"],
	source : [["X", 169], ["UA:SS", 4]],
	level : 0,
	school : "Necro",
	time : "1 a",
	range : "60 ft",
	components : "V,S",
	duration : "Instantaneous",
	save : "Wis",
	description : "1 crea save or 1d12 Necrotic damage (only 1d8 if at full HP); +1d12/1d8 at CL 5, 11, and 17",
	descriptionCantripDie : "1 crea save or `CD`d12 Necrotic damage (only `CD`d8 if at full hp)",
	descriptionFull : "You point at one creature you can see within range, and the sound of a dolorous bell fills the air around it for a moment. The target must succeed on a Wisdom saving throw or take 1d8 necrotic damage. If the target is missing any of its hit points, it instead takes 1d12 necrotic damage." + "\n   " + "The spell's damage increases by one die when you reach 5th level (2d8 or 2d12), 11th level (3d8 or 3d12), and 17th level (4d8 or 4d12)."
};
SpellsList["wall of light"] = {
	name : "Wall of Light",
	classes : ["sorcerer", "warlock", "wizard"],
	source : ["X", 170],
	level : 5,
	school : "Evoc",
	time : "1 a",
	range : "120 ft",
	components : "V,S,M",
	compMaterial : "A hand mirror",
	duration : "Conc, 10 min",
	save : "Con",
	description : "60\u00D75\u00D710ft (l\u00D7w\u00D7h) 4d8+1d8/SL Radiant dmg & blind; save half, not blind; 1 a rngd spell atk; see B",
	descriptionMetric : "18\u00D71,5\u00D73m (l\u00D7w\u00D7h) 4d8+1d8/SL Radiant dmg & blind; save half, not blind; 1 a rngd spell atk; see B",
	descriptionFull : "A shimmering wall of bright light appears at a point you choose within range. The wall appears in any orientation you choose: horizontally, vertically, or diagonally. It can be free floating, or it can rest on a solid surface. The wall can be up to 60 feet long, 10 feet high, and 5 feet thick. The wall blocks line of sight, but creatures and objects can pass through it. It emits bright light out to 120 feet and dim light for an additional 120 feet." + "\n   " + "When the wall appears, each creature in its area must make a Constitution saving throw. On a failed save, a creature takes 4d8 radiant damage, and it is blinded for 1 minute. On a successful save, it takes half as much damage and isn't blinded. A blinded creature can make a Constitution saving throw at the end of each of its turns, ending the effect on itself on a success." + "\n   " + "A creature that ends its turn in the wall's area takes 4d8 radiant damage." + "\n   " + "Until the spell ends, you can use an action to launch a beam of radiance from the wall at one creature you can see within 60 feet of it. Make a ranged spell attack. On a hit, the target takes 4d8 radiant damage. Whether you hit or miss, reduce the length of the wall by 10 feet. If the wall's length drops to 0 feet, the spell ends." + AtHigherLevels + "When you cast this spell using a spell slot of 6th level or higher, the damage increases by 1d8 for each slot level above 5th."
};
SpellsList["word of radiance"] = {
	name : "Word of Radiance",
	classes : ["cleric"],
	source : ["X", 171],
	level : 0,
	school : "Evoc",
	time : "1 a",
	range : "5 ft",
	components : "V,M",
	compMaterial : "A holy symbol",
	duration : "Instantaneous",
	save : "Con",
	description : "Any crea within range save or 1d6 Radiant damage; +1d6 at CL 5, 11, and 17",
	descriptionCantripDie : "Any crea within range save or `CD`d6 Radiant damage",
	descriptionFull : "You utter a divine word, and burning radiance erupts from you. Each creature of your choice that you can see within range must succeed on a Constitution saving throw or take 1d6 radiant damage." + "\n   " + "The spell's damage increases by 1d6 when you reach 5th level (2d6), 11th level (3d6), and 17th level (4d6)."
};
SpellsList["wrath of nature"] = {
	name : "Wrath of Nature",
	classes : ["druid", "ranger"],
	source : ["X", 171],
	level : 5,
	school : "Evoc",
	time : "1 a",
	range : "120 ft",
	components : "V,S",
	duration : "Conc, 1 min",
	description : "60-ft cu dif. ter., tree: Dex or 4d6 Slash. dmg, root: Str or restr., rock: rngd atk 3d8 Bludg. dmg; see B ",
	descriptionFull : "You call out to the spirits of nature to rouse them against your enemies. Choose a point you can see within range. The spirits cause trees, rocks, and grasses in a 60-foot cube centered on that point to become animated until the spell ends." + "\n   " + toUni("Grasses and Undergrowth") + ": Any area of ground in the cube that is covered by grass or undergrowth is difficult terrain for your enemies." + "\n   " + toUni("Trees") + ": At the start of each of your turns, each of your enemies within 10 feet of any tree in the cube must succeed on a Dexterity saving throw or take 4d6 slashing damage from whipping branches." + "\n   " + toUni("Roots and Vines") + ": At the end of each of your turns, one creature of your choice that is on the ground in the cube must succeed on a Strength saving throw or become restrained until the spell ends. A restrained creature can use an action to make a Strength (Athletics) check against your spell save DC, ending the effect on itself on a success." + "\n   " + toUni("Rocks") + ": As a bonus action on your turn, you can cause a loose rock in the cube to launch at a creature you can see in the cube. Make a ranged spell attack against the target. On a hit, the target takes 3d8 nonmagical bludgeoning damage, and it must succeed on a Strength saving throw or fall prone."
};
SpellsList["zephyr strike-xgte"] = { 
	name : "Zephyr Strike",
	classes : ["ranger"],
	source : ["X", 171],
	level : 1,
	school : "Trans",
	time : "1 bns",
	range : "Self",
	components : "V",
	duration : "Conc, 1 min",
	description : "Moving doesn't provoke opportunity atks; once: adv. on wea atk, +1d8 Force dmg, +30 ft spd for turn",
	descriptionFull : "You move like the wind. Until the spell ends, your movement doesn't provoke opportunity attacks." + "\n   " + "Once before the spell ends, you can give yourself advantage on one weapon attack roll on your turn. That attack deals an extra 1d8 force damage on a hit. Whether you hit or miss, your walking speed increases by 30 feet until the end of that turn."
};

// Add weapons (attack cantrips)
WeaponsList["create bonfire"] = {
	regExpSearch : /^(?=.*create)(?=.*bonfire).*$/i,
	name : "Create Bonfire",
	source : [["X", 152], ["E", 16]],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["C", 8, "fire"],
	range : "60 ft",
	description : "5-ft cube; Dex save at casting or when moved into, success - no damage; Conc, 1 min (XGtE 152)",
	abilitytodamage : false,
	dc : true
};
WeaponsList["frostbite"] = {
	regExpSearch : /frostbite/i,
	name : "Frostbite",
	source : [["X", 156], ["E", 18]],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["C", 6, "cold"],
	range : "60 ft",
	description : "Con save, success - no damage, fail - also disadv. on next weapon attack roll in next turn; 1 creature (XGtE 156)",
	abilitytodamage : false,
	dc : true
};
WeaponsList["infestation-xgte"] = {
	regExpSearch : /infestation/i,
	name : "Infestation",
	source : ["X", 158],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["C", 6, "poison"],
	range : "30 ft",
	description : "Con save, success - no damage, fail - target also moved 5 ft in random direction (XGtE 158)",
	abilitytodamage : false,
	dc : true
};
WeaponsList["magic stone"] = {
	regExpSearch : /^(?=.*magic)(?=.*stone).*$/i,
	name : "Magic Stone",
	source : [["X", 160], ["E", 20]],
	list : "spell",
	ability : 5,
	type : "Cantrip",
	damage : [1, 6, "bludgeoning"],
	range : "60/120 ft",
	description : "Produces 3 stones that each can be thrown (60 ft) or hurled with a sling (120 ft) as a spell attack (XGtE 160)",
	abilitytodamage : true
};
WeaponsList["primal savagery-xgte"] = {
	regExpSearch : /^(?=.*primal)(?=.*savagery).*$/i,
	name : "Primal Savagery",
	source : ["X", 169],
	list : "spell",
	ability : 5,
	type : "Cantrip",
	damage : ["C", 10, "acid"],
	range : "Melee (5 ft)",
	description : "(XGtE 163)",
	abilitytodamage : false
};
WeaponsList["thunderclap"] = {
	regExpSearch : /thunderclap/i,
	name : "Thunderclap",
	source : [["X", 168], ["E", 22]],
	list : "spell",
	ability : 6,
	type : "Cantrip",
	damage : ["C", 6, "thunder"],
	range : "5-ft radius",
	description : "Con save, success - no damage; all creatures in area; audible in 100 ft (XGtE 168)",
	abilitytodamage : false,
	dc : true
};
WeaponsList["toll the dead"] = {
	regExpSearch : /^(?=.*toll)(?=.*the)(?=.*dead).*$/i,
	name : "Toll the Dead",
	source : [["X", 169], ["UA:SS", 4]],
	list : "spell",
	ability : 5,
	type : "Cantrip",
	damage : ["C", 12, "necrotic"],
	range : "60 ft",
	description : "Wis save, success - no damage; If target is at full HP, d8 instead of d12 damage (XGtE 169)",
	abilitytodamage : false,
	dc : true
};
WeaponsList["word of radiance"] = {
	regExpSearch : /^(?=.*word)(?=.*radiance).*$/i,
	name : "Word of Radiance",
	source : ["X", 171],
	list : "spell",
	ability : 5,
	type : "Cantrip",
	damage : ["C", 6, "radiant"],
	range : "5-ft radius",
	description : "Con save, success - no damage; Only chosen creatures I can see are affected (XGtE 171)",
	abilitytodamage : false,
	dc : true
};

// Add creatures
CreatureList["hound of ill omen"] = { // Stats for the Sorcerer (Shadow Magic) feature
	name : "Hound of Ill Omen",
	source : ["X", 51],
	size : 3,
	type : "Monstrosity",
	subtype : "",
	alignment : "Unaligned",
	ac : 14,
	hp : 37,
	hd : [5, 10],
	speed : "50 ft",
	scores : [17, 15, 15, 3, 12, 7],
	saves : ["", "", "", "", "", ""],
	skills : {
		"perception" : 3,
		"stealth" : 4
	},
	senses : "Adv. on Wis (Perception) checks using hearing/smell;\nAt the start of each turn, knows where the target is",
	passivePerception : 13,
	languages : "",
	challengeRating : "1",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
			name : "Bite",
			ability : 1,
			damage : [2, 6, "piercing"],
			range : "Melee (5 ft)",
			description : "Target must succeed on a DC 13 Strength saving throw or be knocked prone"
		}
	],
	traits : [{
			name : "Keen Hearing and Smell",
			description : "The hound has advantage on Wisdom (Perception) checks that rely on hearing or smell."
		}, {
			name : "Pack Tactics",
			description : "The hound has advantage on an attack roll against a creature if at least one of the hound's allies is within 5 ft of the creature and the ally isn't incapacitated."
		}
	],
	features : [{
			name : "Actions",
			description : "The hound can only move towards its targets and make attacks or opportunity attacks against its target."
		}, {
			name : "Temporary Hit Points",
			description : "When the hound is summoned, it gains temporary HP equal to half my sorcerer level."
		}, {
			name : "Shadowy Form",
			description : "The hound can move through other creatures and objects as if they were difficult terrain. It takes 5 force damage if it ends its turn inside an object."
		}, {
			name : "Sign of Ill Omen",
			description : "While the hound is within 5 ft of its target, that target has disadvantage on saving throws versus my spells."
		}
	]
};
CreatureList["tiny servant"] = { // Stats for the Tiny Servant spell (contains contributions by SoilentBrad)
	name : "Tiny Servant",
	source : ["X", 169],
	size : 5,
	type : "Construct",
	subtype : "",
	alignment : "Unaligned",
	ac : 15,
	hp : 10,
	hd : [4, 4],
	speed : "30 ft, climb 30 ft",
	scores : [4, 16, 10, 2, 10, 1],
	saves : ["", "", "", "", "", ""],
	damage_immunities : "poison, psychic",
	condition_immunities : "blinded, charmed, deafened, exhaustion, frightened, paralyzed, petrified, poisoned",
	senses : "Blindsight 60 ft (blind beyond this radius)",
	passivePerception : 10,
	languages : "",
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Slam",
		ability : 2,
		damage : [1, 4, "bludgeoning"],
		range : "Melee (5 ft)",
		description : ""
	}]
};

// Magic Items
MagicItemsList["adamantine ammunition"] = {
	name : "Adamantine Ammunition",
	source : ["X", 78],
	type : "weapon (any ammunition)",
	rarity : "unknown",
	description : "Whenever a ammunition made or coated with adamantine hits an object, the hit is a critical hit. The adamantine version of ten pieces of ammunition costs 500 gp more than the normal version, whether the ammunition is made of the metal or coated with it.",
	descriptionFull : "Ammunition made of or coated with adamantine is unusually effective when used to break objects. Whenever a piece of adamantine ammunition hits an object, the hit is a critical hit.\n   The adamantine version of ten pieces of ammunition costs 500 gp more than the normal version, whether the ammunition is made of the metal or coated with it.",
	allowDuplicates : true,
	chooseGear : {
		type : "ammo",
		prefixOrSuffix : "brackets",
		itemName1stPage : ["suffix", "Adamantine"],
		descriptionChange : ["replace", "ammunition"],
		excludeCheck : function (inObjKey, inObj) {
			return (/vials|flasks/i).test(inObj.icon);
		}
	}
}
MagicItemsList["adamantine weapon"] = {
	name : "Adamantine Weapon",
	source : ["X", 78],
	type : "weapon (any melee)",
	rarity : "unknown",
	description : "Whenever a weapon made or coated with adamantine hits an object, the hit is a critical hit. The adamantine version of a melee weapon costs 500 gp more than the normal version, whether the weapon is made of the metal or coated with it.",
	descriptionFull : "Melee weapons made of or coated with adamantine are unusually effective when used to break objects. Whenever an adamantine weapon hits an object, the hit is a critical hit.\n   The adamantine version of a melee weapon costs 500 gp more than the normal version, whether the weapon is made of the metal or coated with it.",
	allowDuplicates : true,
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "brackets",
		itemName1stPage : ["suffix", "Adamantine"],
		descriptionChange : ["replace", "weapon"],
		excludeCheck : function (inObjKey, inObj) {
			return inObj.list != "melee";
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.theWea.list == "melee" && (/adamantine/i).test(v.WeaponText)) {
					fields.Description += (fields.Description ? '; ' : '') + 'Always critical hits on objects';
				}
			},
			'If I include the word "Adamantine" in a the name of a melee weapon, it will be treated as the magic item Adamantine Weapon. Whenever it hits an object, it automatically scores a critical hit.'
		]
	}
}
MagicItemsList["armor of gleaming"] = {
	name : "Armor of Gleaming",
	nameTest : "of Gleaming",
	source : ["X", 136],
	type : "armor (medium, or heavy)",
	rarity : "common",
	description : "This armor never gets dirty.",
	descriptionFull : "This armor never gets dirty.",
	allowDuplicates : true,
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "prefix",
		descriptionChange : ["prefix", "armor"],
		excludeCheck : function (inObjKey, inObj) {
			return !(/medium|heavy/i).test(inObj.type);
		}
	}
}
MagicItemsList["bead of nourishment"] = {
	name : "Bead of Nourishment",
	source : ["X", 136],
	type : "wondrous item",
	rarity : "common",
	description : "Once I can eat this spongy, flavorless, gelatinous bead. It dissolves on my tongue and provides as much nourishment as 1 day of rations.",
	descriptionFull : "This spongy, flavorless, gelatinous bead dissolves on your tongue and provides as much nourishment as 1 day of rations."
}
MagicItemsList["bead of refreshment"] = {
	name : "Bead of Refreshment",
	source : ["X", 136],
	type : "wondrous item",
	rarity : "common",
	description : "Once I can drop this spongy, flavorless, gelatinous bead in liquid. It dissolves in the liquid and transforms up to a pint of it into fresh, cold drinking water. The bead has no effect on magical liquids or harmful substances such as poison.",
	descriptionFull : "This spongy, flavorless, gelatinous bead dissolves in liquid, transforming up to a pint of the liquid into fresh, cold drinking water. The bead has no effect on magical liquids or harmful substances such as poison."
}
MagicItemsList["boots of false tracks"] = {
	name : "Boots of False Tracks",
	source : ["X", 136],
	type : "wondrous item",
	rarity : "common",
	description : "Only humanoids can wear these boots. While wearing the boots, I can choose to have them leave tracks like those of another kind of humanoid of my size.",
	descriptionFull : "Only humanoids can wear these boots. While wearing the boots, you can choose to have them leave tracks like those of another kind of humanoid of your size."
}
MagicItemsList["candle of the deep"] = {
	name : "Candle of the Deep",
	source : ["X", 136],
	type : "wondrous item",
	rarity : "common",
	description : "The flame of this candle is not extinguished when immersed in water. It gives off light and heat like a normal candle.",
	descriptionFull : "The flame of this candle is not extinguished when immersed in water. It gives off light and heat like a normal candle."
}
MagicItemsList["cast-off armor"] = {
	name : "Cast-Off Armor",
	nameTest : "Cast-Off",
	source : ["X", 136],
	type : "armor (light, medium, or heavy)",
	rarity : "common",
	description : "As an action, I can doff this armor.",
	descriptionFull : "You can doff this armor as an action.",
	attunement : true,
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "suffix",
		descriptionChange : ["prefix", "armor"]
	},
	action : [["action", ""]]
}
MagicItemsList["charlatan's die"] = {
	name : "Charlatan's Die",
	source : ["X", 136],
	type : "wondrous item",
	rarity : "common",
	description : "Whenever I roll this six-sided die, I can control which number it rolls.",
	descriptionFull : "Whenever you roll this six-sided die, you can control which number it rolls.",
	attunement : true
}
MagicItemsList["cloak of billowing"] = {
	name : "Cloak of Billowing",
	source : ["X", 136],
	type : "wondrous item",
	rarity : "common",
	description : "As a bonus action while wearing this cloak, I can make it billow dramatically.",
	descriptionFull : "While wearing this cloak, you can use a bonus action to make it billow dramatically.",
	action : [["bonus action", ""]]
}
MagicItemsList["cloak of many fashions"] = {
	name : "Cloak of Many Fashions",
	source : ["X", 136],
	type : "wondrous item",
	rarity : "common",
	description : "As a bonus action while wearing this cloak, I can change its style, color, and apparent qualities. The cloak's weight doesn't change. Regardless of its appearance, the cloak can't be anything but a cloak. Although it can duplicate the appearance of other magic cloaks, it doesn't gain their magical properties.",
	descriptionFull : "While wearing this cloak, you can use a bonus action to change the style, color, and apparent quality of the garment. The cloak's weight doesn't change. Regardless of its appearance, the cloak can't be anything but a cloak. Although it can duplicate the appearance of other magic cloaks, it doesn't gain their magical properties.",
	action : [["bonus action", ""]]
}
MagicItemsList["clockwork amulet"] = {
	name : "Clockwork Amulet",
	source : ["X", 137],
	type : "wondrous item",
	rarity : "common",
	description : "Once per dawn when I make an attack roll while wearing this copper amulet, I can forgo rolling the d20 to get a 10 on the die. The amulet contains tiny interlocking gears powered by magic from Mechanus, a plane of clockwork predictability. When I hold it up to my ear, I can hear faint ticking and whirring noises.",
	descriptionFull : "This copper amulet contains tiny interlocking gears and is powered by magic from Mechanus, a plane of clockwork predictability. A creature that puts an ear to the amulet can hear faint ticking and whirring noises coming from within.\n   When you make an attack roll while wearing the amulet, you can forgo rolling the d20 to get a 10 on the die. Once used. this property can't be used again until the next dawn.",
	usages : 1,
	recovery : "dawn"
}
MagicItemsList["clothes of mending"] = {
	name : "Clothes of Mending",
	source : ["X", 137],
	type : "wondrous item",
	rarity : "common",
	description : "This elegant outfit of traveler's clothes magically mends itself to counteract daily wear and tear. Pieces of the outfit that are destroyed can't be repaired in this way.",
	descriptionFull : "This elegant outfit of traveler's clothes magically mends itself to counteract daily wear and tear. Pieces of the outfit that are destroyed can't be repaired in this way.",
	weight : 4
}
MagicItemsList["dark shard amulet"] = {
	name : "Dark Shard Amulet",
	source : ["X", 137],
	type : "wondrous item",
	rarity : "common",
	description : "I can use this amulet of extraplanar material from the realm of my warlock patron as a spellcasting focus for my warlock spells. Once per long rest, I can use it to cast a warlock cantrip that I don't know. To do so, I must make a DC 10 Intelligence (Arcana) check, wasting the attempt as well as my action if I fail.",
	descriptionFull : "This amulet is fashioned from a single shard of resilient extraplanar material originating from the realm of your warlock patron. While you are wearing it, you gain the following benefits:\n \u2022 You can use the amulet as a spellcasting focus for your warlock spells.\n \u2022 You can try to cast a cantrip that you don't know. The cantrip must be on the warlock spell list, and you must make a DC 10 Intelligence (Arcana) check. If the check succeeds, you cast the spell. If the check fails, so does the spell, and the action used to cast the spell is wasted. In either case, you can't use this property again until you finish a long rest.",
	attunement : true,
	prerequisite : "Requires attunement by a warlock",
	prereqeval : function (v) { return classes.known.warlock ? true : false; },
	usages : 1,
	recovery : "long rest",
	eval : function () {
		CurrentSpells['dark shard amulet'] = {
			name : 'Dark Shard Amulet (item)',
			ability : "class",
			list : { 'class' : 'warlock', level : [0, 0] },
			known : { cantrips : 0, spells : 'list' },
			bonus : {},
			typeList : 4,
			refType : "item"
		};
		SetStringifieds('spells'); CurrentUpdates.types.push('spells');
	},
	removeeval : function () {
		delete CurrentSpells['dark shard amulet'];
		SetStringifieds('spells'); CurrentUpdates.types.push('spells');
	}
}
MagicItemsList["dread helm"] = {
	name : "Dread Helm",
	source : ["X", 137],
	type : "wondrous item",
	rarity : "common",
	description : "This fearsome steel helm makes my eyes glow red while I wear it.",
	descriptionFull : "This fearsome steel helm makes your eyes glow red while you wear it.",
	weight : 1
}
MagicItemsList["ear horn of hearing"] = {
	name : "Ear Horn of Hearing",
	source : ["X", 137],
	type : "wondrous item",
	rarity : "common",
	description : "While held up to my ear, this horn suppresses the effects of the deafened condition on me, allowing me to hear normally.",
	descriptionFull : "While held up to your ear, this horn suppresses the effects of the deafened condition on you, allowing you to hear normally.",
	savetxt : { immune : ["deafened"] },
	weight : 1
}
MagicItemsList["enduring spellbook"] = {
	name : "Enduring Spellbook",
	source : ["X", 137],
	type : "wondrous item",
	rarity : "common",
	description : "This spellbook, along with anything written on its pages, can't be damaged by fire or immersion in water. In addition, the spellbook doesn't deteriorate with age.",
	descriptionFull : "This spellbook, along with anything written on its pages, can't be damaged by fire or immersion in water. In addition, the spellbook doesn't deteriorate with age.",
	weight : 5
}
MagicItemsList["ersatz eye"] = {
	name : "Ersatz Eye",
	source : ["X", 137],
	type : "wondrous item",
	rarity : "common",
	description : "This artificial eye replaces a real one that was lost or removed. While the ersatz eye is embedded in my eye socket, it can't be removed by anyone other than me, and I can see through the tiny orb as though it were a normal eye.",
	descriptionFull : "This artificial eye replaces a real one that was lost or removed. While the ersatz eye is embedded in your eye socket, it can't be removed by anyone other than you, and you can see through the tiny orb as though it were a normal eye.",
	attunement : true
}
MagicItemsList["hat of vermin"] = {
	name : "Hat of Vermin",
	source : ["X", 137],
	type : "wondrous item",
	rarity : "common",
	description : "This hat has 3 charges, regaining all at dawn. As an action while holding it, I can expend 1 charge and speak a command word to have one bat, frog, or rat appear in the hat. The creature acts as and ordinary member of its kind and disappears after 1 hour or when it has 0 HP. It is not under my control.",
	descriptionFull : "This hat has 3 charges. While holding the hat, you can use an action to expend 1 of its charges and speak a command word that summons your choice of a bat, a frog, or a rat. The summoned creature magically appears in the hat and tries to get away from you as quickly as possible. The creature is neither friendly nor hostile, and it isn't under your control. It behaves as an ordinary creature of its kind and disappears after 1 hour or when it drops to 0 hit points. The hat regains all expended charges daily at dawn.",
	action : [["action", ""]],
	usages : 3,
	recovery : "dawn"
}
MagicItemsList["hat of wizardry"] = {
	name : "Hat of Wizardry",
	source : ["X", 137],
	type : "wondrous item",
	rarity : "common",
	description : "I can use this antiquated, cone-shaped hat adorned with gold crescent moons and stars as a spellcasting focus for my wizard spells. Once per long rest, I can use it to cast a wizard cantrip that I don't know. To do so, I must make a DC 10 Intelligence (Arcana) check, wasting the attempt as well as my action if I fail.",
	descriptionFull : "This antiquated, cone-shaped hat is adorned with gold crescent moons and stars. While you are wearing it, you gain the following benefits:\n \u2022 You can use the hat as a spellcasting focus for your wizard spells.\n \u2022 You can try to cast a cantrip that you don't know. The cantrip must be on the wizard spell list, and you must make a DC 10 Intelligence (Arcana) check. If the check succeeds, you cast the spell. If the check fails, so does the spell, and the action used to cast the spell is wasted. In either case, you can't use this property again until you finish a long rest.",
	attunement : true,
	prerequisite : "Requires attunement by a wizard",
	prereqeval : function (v) { return classes.known.wizard ? true : false; },
	usages : 1,
	recovery : "long rest",
	eval : function () {
		CurrentSpells['hat of wizardry'] = {
			name : 'Hat of Wizardry (item)',
			ability : "class",
			list : { 'class' : 'wizard', level : [0, 0] },
			known : { cantrips : 0, spells : 'list' },
			bonus : {},
			typeList : 4,
			refType : "item"
		};
		SetStringifieds('spells'); CurrentUpdates.types.push('spells');
	},
	removeeval : function () {
		delete CurrentSpells['hat of wizardry'];
		SetStringifieds('spells'); CurrentUpdates.types.push('spells');
	}
}
MagicItemsList["heward's handy spice pouch"] = {
	name : "Heward's Handy Spice Pouch",
	source : ["X", 137],
	type : "wondrous item",
	rarity : "common",
	description : "This apparent empty belt pouch has 10 charges, regaining 1d6+4 expended charges at dawn. As an action while holding it, I can speak the name of any nonmagical food seasoning (e.g. salt, pepper, or saffron), and remove a pinch of the desired seasoning from the pouch. A pinch is enough to season a single meal.",
	descriptionFull : "This belt pouch appears empty and has 10 charges. While holding the pouch, you can use an action to expend 1 of its charges, speak the name of any nonmagical food seasoning (such as salt, pepper, saffron, or cilantro), and remove a pinch of the desired seasoning from the pouch. A pinch is enough to season a single meal. The pouch regains 1d6+4 expended charges daily at dawn.",
	weight : 1,
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4"
}
MagicItemsList["horn of silent alarm"] = {
	name : "Horn of Silent Alarm",
	source : ["X", 137],
	type : "wondrous item",
	rarity : "common",
	description : "This horn has 4 charges, regaining 1d4 expended charges daily at dawn. As an action, I can expend 1 charge and blow it, have only one creature within 600 ft of my choice hear the horns blare, provided it isn't deafened. No other creature hears sound coming from the horn.",
	descriptionFull : "This horn has 4 charges. When you use an action to blow it, one creature of your choice can hear the horns blare, provided the creature is within 600 feet of the horn and not deafened. No other creature hears sound coming from the horn. The horn regains 1d4 expended charges daily at dawn.",
	weight : 2,
	usages : 4,
	recovery : "dawn",
	additional : "regains 1d4",
	action : [["action", ""]]
}
MagicItemsList["instrument of illusions"] = { // contains contributions by AelarTheElFRogue
	name : "Instrument of Illusions",
	source : ["X", 137],
	type : "Instrument",
	rarity : "common",
	description : "While I am playing this musical instrument, I can create harmless, illusory visual effects within a 5-ft-radius (15-ft for bards) sphere centered on the instrument. The magical effects have neither substance nor sound, and they are obviously illusory. The effects end when I stop playing.",
	descriptionFull : "While you are playing this musical instrument, you can create harmless, illusory visual effects within a 5-foot-radius sphere centered on the instrument. If you are a bard, the radius increases to 15 feet. Sample visual effects include luminous musical notes, a spectral dancer, butterflies, and gently falling snow. The magical effects have neither substance nor sound, and they are obviously illusory. The effects end when you stop playing.",
	attunement : true,
	weight : 3, // same as instrument of the bards
	choices : ["Bard (15-ft radius)", "Not a Bard (5-ft radius)"],
	selfChoosing : function () {
		return classes.known.bard ? "bard (15-ft radius)" : "not a bard (5-ft radius)";
	},
	"bard (15-ft radius)" : {
		name : "Instrument\u200A of Illusions",
		description : "While I am playing this musical instrument, I can create harmless, illusory visual effects within a 5-ft-radius sphere centered on the instrument. The magical effects have neither substance nor sound, and they are obviously illusory. The effects end when I stop playing."
	},
	"not a bard (5-ft radius)" : {
		name : "Instrument\u200A\u200A of Illusions",
		description : "While I am playing this musical instrument, I can create harmless, illusory visual effects within a 15-ft-radius sphere centered on the instrument. The magical effects have neither substance nor sound, and they are obviously illusory. The effects end when I stop playing."
	}
}
MagicItemsList["instrument of scribing"] = { // contains contributions by AelarTheElFRogue
	name : "Instrument of Scribing",
	source : ["X", 138],
	type : "Instrument",
	rarity : "common",
	description : "While I am playing this musical instrument, I can create harmless, illusory visual effects within a 5-ft-radius (15-ft for bards) sphere centered on the instrument. The magical effects have neither substance nor sound, and they are obviously illusory. The effects end when I stop playing.",
	descriptionFull : "This musical instrument has 3 charges. While you are playing it, you can use an action to expend 1 charge from the instrument and write a magical message on a nonmagical object or surface that you can see within 30 feet of you. The message can be up to six words long and is written in a language you know. If you are a bard, you can scribe an additional seven words and choose to make the message glow faintly, allowing it to be seen in nonmagical darkness. Casting Dispel Magic on the message erases it. Otherwise, the message fades away after 24 hours.\n   The instrument regains all expended charges daily at dawn.",
	attunement : true,
	weight : 3, // same as instrument of the bards
	choices : ["Bard (15-ft radius)", "Not a Bard (5-ft radius)"],
	selfChoosing : function () {
		return classes.known.bard ? "bard (15-ft radius)" : "not a bard (5-ft radius)";
	},
	"bard (15-ft radius)" : {
		name : "Instrument\u200A of Scribing",
		description : "While I am playing this musical instrument, I can create harmless, illusory visual effects within a 5-ft-radius sphere centered on the instrument. The magical effects have neither substance nor sound, and they are obviously illusory. The effects end when I stop playing."
	},
	"not a bard (5-ft radius)" : {
		name : "Instrument\u200A\u200A of Scribing",
		description : "While I am playing this musical instrument, I can create harmless, illusory visual effects within a 15-ft-radius sphere centered on the instrument. The magical effects have neither substance nor sound, and they are obviously illusory. The effects end when I stop playing."
	}
}
MagicItemsList["lock of trickery"] = {
	name : "Lock of Trickery",
	source : ["X", 138],
	type : "wondrous item",
	rarity : "common",
	description : "This lock appears to be an ordinary lock and comes with a single key. The tumblers in this lock magically adjust to thwart burglars. Without the key, a creature proficient with thieves' tools can pick this lock with a successful DC 15 Dexterity check, but has disadvantage on that check.",
	descriptionFull : "This lock appears to be an ordinary lock and comes with a single key. The tumblers in this lock magically adjust to thwart burglars. Dexterity checks made to pick the lock have disadvantage. Thus, without the key, a creature proficient with thieves' tools can pick this lock with a successful DC 15 Dexterity check, but has disadvantage on that check.",
	weight : 1
}
MagicItemsList["moon-touched sword"] = {
	name : "Moon-Touched Sword",
	nameTest : "Moon-Touched",
	source : ["X", 138],
	type : "weapon (any sword)",
	rarity : "common",
	description : "In darkness, the unsheathed blade of this sword sheds moonlight, creating bright light in a 15-ft radius and dim light for an additional 15 ft.",
	descriptionFull : "In darkness, the unsheathed blade of this sword sheds moonlight, creating bright light in a 15-foot radius and dim light for an additional 15 feet.",
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "sword"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /sword|scimitar|rapier/i;
			return !(testRegex).test(inObjKey) && (!inObj.baseWeapon || !(testRegex).test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/moon.touched/i).test(v.WeaponText)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
				}
			},
			'If I include the words "Moon-Touched" in the name of a sword, it will be treated as the magic weapon Moon-Touched Sword.'
		]
	}
}
MagicItemsList["mystery key"] = {
	name : "Mystery Key",
	source : ["X", 138],
	type : "wondrous item",
	rarity : "common",
	description : "A question mark is worked into the head of this key. The key has a 5% chance of unlocking any lock into which it's inserted. Once it unlocks something, the key disappears.",
	descriptionFull : "A question mark is worked into the head of this key. The key has a 5% chance of unlocking any lock into which it's inserted. Once it unlocks something, the key disappears."
}
MagicItemsList["orb of direction"] = {
	name : "Orb of Direction",
	source : ["X", 138],
	type : "wondrous item",
	rarity : "common",
	description : "As an action while holding this orb, I can determine which way is north. This property functions only on the Material Plane.",
	descriptionFull : "While holding this orb, you can use an action to determine which way is north. This property functions only on the Material Plane.",
	weight : 3,
	action : [["action", ""]]
}
MagicItemsList["orb of time"] = {
	name : "Orb of Time",
	source : ["X", 138],
	type : "wondrous item",
	rarity : "common",
	description : "As an action while holding this orb, I can determine whether it is morning, afternoon, evening, or nighttime outside. This property functions only on the Material Plane.",
	descriptionFull : "While holding this orb, you can use an action to determine whether it is morning, afternoon, evening, or nighttime outside. This property functions only on the Material Plane.",
	weight : 3,
	action : [["action", ""]]
}
MagicItemsList["perfume of bewitching"] = {
	name : "Perfume of Bewitching",
	source : ["X", 138],
	type : "wondrous item",
	rarity : "common",
	description : "Once as an action, I can apply the perfume in this tiny vial to myself and its effect lasts 1 hour. For the duration, I have advantage on all Charisma checks directed at humanoids of challenge rating 1 or lower. Those subjected to the perfume's effect are not aware that they've been influenced by magic.",
	descriptionFull : "This tiny vial contains magic perfume, enough for one use. You can use an action to apply the perfume to yourself, and its effect lasts 1 hour. For the duration, you have advantage on all Charisma checks directed at humanoids of challenge rating 1 or lower. Those subjected to the perfume's effect are not aware that they've been influenced by magic."
}
MagicItemsList["pipe of smoke monsters"] = {
	name : "Pipe of Smoke Monsters",
	source : ["X", 138],
	type : "wondrous item",
	rarity : "common",
	description : "As an action while smoking this pipe, I can exhale a puff of smoke that takes the form of a single creature, such as a dragon, a flumph, or a froghemoth. The form must be small enough to fit in a 1-ft cube and loses its shape after a few seconds, becoming an ordinary puff of smoke.",
	descriptionFull : "While smoking this pipe, you can use an action to exhale a puff of smoke that takes the form of a single creature, such as a dragon, a flumph, or a froghemoth. The form must be small enough to fit in a 1-foot cube and loses its shape after a few seconds, becoming an ordinary puff of smoke."
}
MagicItemsList["pole of angling"] = {
	name : "Pole of Angling",
	source : ["X", 138],
	type : "wondrous item",
	rarity : "common",
	description : "While holding this 10 ft pole, I can speak a command word and transform it into a fishing pole with a hook, a line, and a reel. Speaking the command word again changes the fishing pole back into a normal 10 ft pole.",
	descriptionFull : "While holding this 10-foot pole, you can speak a command word and transform it into a fishing pole with a hook, a line, and a reel. Speaking the command word again changes the fishing pole back into a normal 10-foot pole.",
	weight : 7
}
MagicItemsList["pole of collapsing"] = {
	name : "Pole of Collapsing",
	source : ["X", 138],
	type : "wondrous item",
	rarity : "common",
	description : "As an action while holding this 10 ft pole, I can speak a command word to have it collapse into a 1-ft-long rod. The poles weight doesn't change. As an action while holding the rod, I can speak a different command word to have it elongate back to a pole, but only as long as the surrounding space allows.",
	descriptionFull : "While holding this 10-foot pole, you can use an action to speak a command word and cause it to collapse into a 1-foot-long rod, for ease of storage. The poles weight doesn't change. You can use an action to speak a different command word and cause the rod to revert to a pole; however, the rod will elongate only as far as the surrounding space allows.",
	weight : 7,
	action : [["action", ""]]
}
MagicItemsList["pot of awakening"] = {
	name : "Pot of Awakening",
	source : ["X", 138],
	type : "wondrous item",
	rarity : "common",
	description : "If I plant an ordinary shrub in this 10 lb clay pot and let it grow for 30 days, the shrub magically transforms into an awakened shrub at the end of that time. When the shrub awakens, its roots break the pot, destroying it. The awakened shrub is friendly toward me. Absent commands from me, it does nothing.",
	descriptionFull : "If you plant an ordinary shrub in this 10-pound clay pot and let it grow for 30 days, the shrub magically transforms into an awakened shrub at the end of that time. When the shrub awakens, its roots break the pot, destroying it.\n   The awakened shrub is friendly toward you. Absent commands from you, it does nothing.",
	weight : 10
}
MagicItemsList["rope of mending"] = {
	name : "Rope of Mending",
	source : ["X", 138],
	type : "wondrous item",
	rarity : "common",
	description : "I can cut this 50-foot coil of hempen rope into any number of smaller pieces, and then use an action to speak a command word and cause the pieces to knit back together. The pieces must be in contact with each other and not otherwise in use. A rope of mending is forever shortened if a section of it is lost.",
	descriptionFull : "You can cut this 50-foot coil of hempen rope into any number of smaller pieces, and then use an action to speak a command word and cause the pieces to knit back together. The pieces must be in contact with each other and not otherwise in use. A rope of mending is forever shortened if a section of it is lost or destroyed.",
	action : [["action", ""]],
	weight : 10
}
MagicItemsList["ruby of the war mage"] = {
	name : "Ruby of the War Mage",
	source : ["X", 138],
	type : "wondrous item",
	rarity : "common",
	description : "By pressing this 1-inch-diameter ruby etched with eldritch runes to a simple or martial weapon for 10 minutes, it attaches itself to the weapon. I can then use that weapon as a spellcasting focus. Once attached, it can't be removed unless my attunement ends, I detach it as an action, or the weapon is destroyed.",
	descriptionFull : "Etched with eldritch runes, this 1-inch-diameter ruby allows you to use a simple or martial weapon as a spellcasting focus for your spells. For this property to work, you must attach the ruby to the weapon by pressing the ruby against it for at least 10 minutes. Thereafter, the ruby can't be removed unless you detach it as an action or the weapon is destroyed. Not even an Antimagic Field causes it to fall off. The ruby does fall off the weapon if your attunement to the ruby ends.",
	attunement : true,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; }
}
MagicItemsList["shield of expression"] = {
	name : "Shield of Expression",
	source : ["X", 139],
	type : "shield",
	rarity : "common",
	description : "The front of this shield is shaped in the likeness of a face. As a bonus action while bearing the shield, I can have the shield alter the expression of the face.",
	descriptionFull : "The front of this shield is shaped in the likeness of a face. While bearing the shield, you can use a bonus action to alter the faces expression.",
	weight : 6,
	shieldAdd : "Shield of Expression",
	action : [["bonus action", ""]]
}
MagicItemsList["smoldering armor"] = {
	name : "Smoldering Armor",
	nameTest : "Smoldering",
	source : ["X", 139],
	type : "armor (light, medium, or heavy)",
	rarity : "common",
	description : "Wisps of harmless, odorless smoke rise from this armor while it is worn.",
	descriptionFull : "Wisps of harmless, odorless smoke rise from this armor while it is worn.",
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "suffix",
		descriptionChange : ["prefix", "armor"]
	}
}
MagicItemsList["staff of adornment"] = {
	name : "Staff of Adornment",
	source : ["X", 139],
	type : "staff",
	rarity : "common",
	description : "If I place an object up to 1 lb above the tip of the staff while holding it, the object floats 1 inch from its tip and remains there until it is removed or until I no longer possess the staff. It can have up to three objects floating over its tip at any given time and I can make one or more objects slowly spin or turn in place.",
	descriptionFull : "If you place an object weighing no more than 1 pound (such as a shard of crystal, an egg, or a stone) above the tip of the staff while holding it, the object floats an inch from the staff's tip and remains there until it is removed or until the staff is no longer in your possession. The staff can have up to three such objects floating over its tip at any given time. While holding the staff, you can make one or more of the objects slowly spin or turn in place.",
	weight : 4
}
MagicItemsList["staff of birdcalls"] = {
	name : "Staff of Birdcalls",
	source : ["X", 139],
	type : "staff",
	rarity : "common",
	description : "This staff has 10 charges, regaining 1d6+4 at dawn, 5% chance it is destroyed when its last charge is used. As an action, I can use 1 charge to create a sound out to a range of 60 ft: a finch's chirp, raven's caw, duck's quack, chicken's cluck, goose's book, loon's call, turkey's gobble, seagull's cry, owl's hoot, or eagle's shriek.",
	descriptionFull : "This wooden staff is decorated with bird carvings. It has 10 charges. While holding it, you can use an action to expend 1 charge from the staff and cause it to create one of the following sounds out to a range of 60 feet: a finch's chirp, a raven's caw, a duck's quack, a chicken's cluck, a goose's book, a loon's call, a turkey's gobble, a seagull's cry, an owl's hoot, or an eagle's shriek.\n   The staff regains 1d6+4 expended charges daily at dawn. If you expend the last charge, roll a d20. On a 1, the staff explodes in a harmless cloud of bird feathers and is lost forever.",
	weight : 4,
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	action : [["action", ""]]
}
MagicItemsList["staff of flowers"] = {
	name : "Staff of Flowers",
	source : ["X", 139],
	type : "staff",
	rarity : "common",
	description : "This staff has 10 charges, regaining 1d6+4 at dawn, 5% chance it is destroyed when its last charge is used. As an action, I can use 1 charge to cause a flower of my choice to sprout from a patch of earth or soil within 5 ft or from the staff itself. The flower is nonmagical and grows or withers as a normal flower would.",
	descriptionFull : "This wooden staff has 10 charges. While holding it, you can use an action to expend 1 charge from the staff and cause a flower to sprout from a patch of earth or soil within 5 feet of you, or from the staff itself. Unless you choose a specific kind of flower, the staff creates a mildscented daisy. The flower is harmless and nonmagical, and it grows or withers as a normal flower would. The staff regains 1d6+4 expended charges daily at dawn. If you expend the last charge, roll a d20. On a 1, the staff turns into flower petals and is lost forever.",
	weight : 4,
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	action : [["action", ""]]
}
MagicItemsList["talking doll"] = {
	name : "Talking Doll",
	source : ["X", 139],
	type : "wondrous item",
	rarity : "common",
	description : "During a short rest with this stuffed doll within 5 ft of me, I can tell it to say up to 6 phrases of up to 6 words each, and set a condition under which the doll speaks each phrase. Conditions must happen within 5 ft of the doll. The doll can remember only 6 phrases and are lost when my attunement to it ends.",
	descriptionFull : "While this stuffed doll is within 5 feet of you, you can spend a short rest telling it to say up to six phrases, none of which can be more than six words long, and set a condition under which the doll speaks each phrase. You can also replace old phrases with new ones. Whatever the condition, it must occur within 5 feet of the doll to make it speak. For example, whenever someone picks up the doll, it might say, \"I want a piece of candy.\" The doll's phrases are lost when your attunement to the doll ends.",
	attunement : true
}
MagicItemsList["tankard of sobriety"] = {
	name : "Tankard of Sobriety",
	source : ["X", 139],
	type : "wondrous item",
	rarity : "common",
	description : "This tankard has a stern face sculpted into one side. I can drink ale, wine, or any other nonmagical alcoholic beverage poured into it without becoming inebriated. The tankard has no effect on magical liquids or harmful substances such as poison.",
	descriptionFull : "This tankard has a stern face sculpted into one side. You can drink ale, wine, or any other nonmagical alcoholic beverage poured into it without becoming inebriated. The tankard has no effect on magical liquids or harmful substances such as poison.",
	weight : 1
}
MagicItemsList["unbreakable arrow"] = {
	name : "Unbreakable Arrow",
	source : ["X", 139],
	type : "weapon (arrow)",
	rarity : "common",
	description : "This arrow can't be broken, except when it is within an Antimagic Field.",
	descriptionFull : "This arrow can't be broken, except when it is within an Antimagic Field.",
	weight : 0.05
}
MagicItemsList["veteran's cane"] = {
	name : "Veteran's Cane",
	source : ["X", 139],
	type : "wondrous item",
	rarity : "common",
	description : "Once as a bonus action, I can grasp this walking cane and speak its command word to have it transform into an ordinary longsword. Once transformed, the longsword is nonmagical and can't revert back to a walking cane.",
	descriptionFull : "When you grasp this walking cane and use a bonus action to speak the command word, it transforms into an ordinary longsword and ceases to be magical.",
	weight : 4,
	action : [["bonus action", ""]]
}
MagicItemsList["walloping ammunition"] = {
	name : "Walloping Ammunition",
	nameTest : "Walloping",
	source : ["X", 139],
	type : "weapon (any ammunition)",
	rarity : "common",
	description : "This magic ammunition packs a wallop. A creature hit by the ammunition must succeed on a DC 10 Strength saving throw or be knocked prone.",
	descriptionFull : "This ammunition packs a wallop. A creature hit by the ammunition must succeed on a DC 10 Strength saving throw or be knocked prone.",
	allowDuplicates : true,
	chooseGear : {
		type : "ammo",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "ammunition"],
		excludeCheck : function (inObjKey, inObj) {
			return (/vials|flasks/i).test(inObj.icon);
		}
	}
}
MagicItemsList["wand of conducting"] = {
	name : "Wand of Conducting",
	source : ["X", 140],
	type : "wand",
	rarity : "common",
	description : "This wand has 3 charges, regaining all at dawn. As an action, I can wave it around and expend 1 charge to create orchestral music that can be heard out to a range of 60 ft and ends when I stop waving the wand. If I use its last charge, roll a d20. On a 1, a sad tuba sound plays as the wand crumbles to dust.",
	descriptionFull : "This wand has 3 charges. While holding it, you can use an action to expend 1 of its charges and create orchestral music by waving it around. The music can be heard out to a range of 60 feet and ends when you stop waving the wand.\n   The wand regains all expended charges daily at dawn. If you expend the wand's last charge, roll a d20. On a 1, a sad tuba sound plays as the wand crumbles to dust and is destroyed.",
	weight : 1,
	action : [["action", ""]],
	usages : 3,
	recovery : "dawn"
}
MagicItemsList["wand of pyrotechnics"] = {
	name : "Wand of Pyrotechnics",
	source : ["X", 140],
	type : "wand",
	rarity : "common",
	description : "This wand has 7 charges, regaining 1d6+1 at dawn, 5% chance it is destroyed when its last charge is used. As an action, I can expend 1 charge to create a harmless burst of sound light at a point I can see up to 60 ft away, with the noise travelling 300 ft. The light is as bright as a torch flame but lasts only a second.",
	descriptionFull : "This wand has 7 charges. While holding it, you can use an action to expend 1 of its charges and create a harmless burst of multicolored light at a point you can see up to 60 feet away. The burst of light is accompanied by a crackling noise that can be heard up to 300 feet away. The light is as bright as a torch flame but lasts only a second.\n   The wand regains 1d6+1 expended charges daily at dawn. If you expend the wand's last charge, roll a d20. On a 1, the wand erupts in a harmless pyrotechnic display and is destroyed.",
	weight : 1,
	action : [["action", ""]],
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d6+1"
}
MagicItemsList["wand of scowls"] = {
	name : "Wand of Scowls",
	source : ["X", 140],
	type : "wand",
	rarity : "common",
	description : "This wand has 3 charges, regain all at dawn. As an action, I can expend 1 of its charges and target a humanoid I can see within 30 ft. The target must succeed on a DC 10 Charisma save or be forced to scowl for 1 minute. If I expend the wand's last charge, roll a d20. On a 1, the wand transforms into a wand of smiles.",
	descriptionFull : "This wand has 3 charges. While holding it, you can use an action to expend 1 of its charges and target a humanoid you can see within 30 feet of you. The target must succeed on a DC 10 Charisma saving throw or be forced to scowl for 1 minute.\n   The wand regains all expended charges daily at dawn. If you expend the wand's last charge, roll a d20. On a 1, the wand transforms into a wand of smiles.",
	weight : 1,
	action : [["action", ""]],
	usages : 3,
	recovery : "dawn"
}
MagicItemsList["wand of smiles"] = {
	name : "Wand of Smiles",
	source : ["X", 140],
	type : "wand",
	rarity : "common",
	description : "This wand has 3 charges, regain all at dawn. As an action, I can expend 1 of its charges and target a humanoid I can see within 30 ft. The target must succeed on a DC 10 Charisma save or be forced to smile for 1 minute. If I expend the wand's last charge, roll a d20. On a 1, the wand transforms into a wand of scowls.",
	descriptionFull : "This wand has 3 charges. While holding it, you can use an action to expend 1 of its charges and target a humanoid you can see within 30 feet of you. The target must succeed on a DC 10 Charisma saving throw or be forced to smile for 1 minute.\n   The wand regains all expended charges daily at dawn. If you expend the wand's last charge, roll a d20. On a 1, the wand transforms into a wand of scowls.",
	weight : 1,
	action : [["action", ""]],
	usages : 3,
	recovery : "dawn"
}
var iFileName = "pub_20180529_MToF.js";
RequiredSheetVersion(13);
// This file adds all the player-material from Mordenkainen's Tome of Foes to MPMB's Character Record Sheet

// Define the source
SourceList.MToF={
	name : "Mordenkainen's Tome of Foes",
	abbreviation : "MToF",
	group : "Primary Sources",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/mordenkainens-tome-foes",
	date : "2018/05/29"
};

// Tiefling subraces
RaceList["baalzebul tiefling"] = {
	regExpSearch : /^(?=.*baalzebul)(?=.*tiefling|planetouched).*$/i,
	name : "Baalzebul tiefling",
	sortname : "Tiefling, Baalzebul",
	source : [["MToF", 21], ["UA:FO", 1]],
	plural : "Baalzebul tieflings",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Infernal"],
	vision : [["Darkvision", 60]],
	dmgres : ["Fire"],
	age : " reach adulthood in their late teens and live around 100 years",
	height : " range from 5 to over 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to over 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 0, 1, 0, 2],
	trait : "Baalzebul Tiefling (+1 Intelligence, +2 Charisma)\n\nLegacy of Maladomini:\n   I know the Thaumaturgy cantrip.\n   At 3rd level, I can cast Ray of Sickness once per long rest as a 2nd-level spell.\n   At 5th level, I can also cast Crown of Madness once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Legacy of Maladomini (1)",
		spells : ["thaumaturgy"],
		selection : ["thaumaturgy"],
		firstCol : 'atwill'
	},
	features : {
		"ray of sickness" : {
			name : "Legacy of Maladomini (level 3)",
			limfeaname : "Ray of Sickness (3d8)",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Maladomini (3)",
				spells : ["ray of sickness"],
				selection : ["ray of sickness"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"ray of sickness" : {
					description : "Spell attack for 3d8 Poison dmg; save or also poisoned until end of my next turn",
					changes : "Using Legacy of Maladomini, I cast Ray of Sickness as if I'm using a 2nd-level spell slot."
				}
			}
		},
		"crown of madness" : {
			name : "Legacy of Maladomini (level 5)",
			limfeaname : "Crown of Madness",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Maladomini (5)",
				spells : ["crown of madness"],
				selection : ["crown of madness"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["dispater tiefling-mtof"] = {
	regExpSearch : /^(?=.*dispater)(?=.*tiefling|planetouched).*$/i,
	name : "Dispater tiefling",
	sortname : "Tiefling, Dispater",
	source : ["MToF", 21],
	plural : "Dispater tieflings",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Infernal"],
	vision : [["Darkvision", 60]],
	dmgres : ["Fire"],
	age : " reach adulthood in their late teens and live around 100 years",
	height : " range from 5 to over 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to over 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [0, 1, 0, 0, 0, 2],
	trait : "Dispater Tiefling (+1 Dexterity, +2 Charisma)\n\nLegacy of Dis:\n   I know the Thaumaturgy cantrip.\n   At 3rd level, I can cast Disguise Self once per long rest.\n   At 5th level, I can also cast Detect Thoughts once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Legacy of Dis (level 1)",
		spells : ["thaumaturgy"],
		selection : ["thaumaturgy"],
		firstCol : 'atwill'
	},
	features : {
		"disguise self" : {
			name : "Legacy of Dis (level 3)",
			limfeaname : "Disguise Self",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Dis (level 3)",
				spells : ["disguise self"],
				selection : ["disguise self"],
				firstCol : 'oncelr'
			}
		},
		"detect thoughts" : {
			name : "Legacy of Dis (level 5)",
			limfeaname : "Detect Thoughts",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Dis (level 5)",
				spells : ["detect thoughts"],
				selection : ["detect thoughts"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["fierna tiefling"] = {
	regExpSearch : /^(?=.*fierna)(?=.*tiefling|planetouched).*$/i,
	name : "Fierna tiefling",
	sortname : "Tiefling, Fierna",
	source : [["MToF", 21], ["UA:FO", 1]],
	plural : "Fierna tieflings",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Infernal"],
	vision : [["Darkvision", 60]],
	dmgres : ["Fire"],
	age : " reach adulthood in their late teens and live around 100 years",
	height : " range from 5 to over 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to over 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 0, 0, 1, 2],
	trait : "Fierna Tiefling (+1 Wisdom, +2 Charisma)\n\nLegacy of Phlegethos:\n   I know the Friends cantrip.\n   At 3rd level, I can cast Charm Person once per long rest as a 2nd-level spell.\n   At 5th level, I can also cast Suggestion once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Legacy of Phlegethos (1)",
		spells : ["friends"],
		selection : ["friends"],
		firstCol : 'atwill'
	},
	features : {
		"charm person" : {
			name : "Legacy of Phlegethos (level 3)",
			limfeaname : "Charm Person (2 targets)",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Phlegethos (3)",
				spells : ["charm person"],
				selection : ["charm person"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"charm person" : {
					description : "2 humanoids, max 30 ft apart, save or charmed; adv. on save if me/ally is fighting it",
					changes : "Using Legacy of Phlegethos, I cast Charm Person as if I'm using a 2nd-level spell slot."
				}
			}
		},
		"suggestion" : {
			name : "Legacy of Phlegethos (level 5)",
			limfeaname : "Suggestion",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Phlegethos (5)",
				spells : ["suggestion"],
				selection : ["suggestion"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["glasya tiefling"] = {
	regExpSearch : /^(?=.*glasya)(?=.*tiefling|planetouched).*$/i,
	name : "Glasya tiefling",
	sortname : "Tiefling, Glasya",
	source : [["MToF", 22], ["UA:FO", 2]],
	plural : "Glasya tieflings",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Infernal"],
	vision : [["Darkvision", 60]],
	dmgres : ["Fire"],
	age : " reach adulthood in their late teens and live around 100 years",
	height : " range from 5 to over 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to over 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [0, 1, 0, 0, 0, 2],
	trait : "Glasya Tiefling (+1 Dexterity, +2 Charisma)\n\nLegacy of Malbolge:\n   I know the Minor Illusion cantrip.\n   At 3rd level, I can cast Disguise Self once per long rest.\n   At 5th level, I can also cast Invisibility once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Legacy of Malbolge (1)",
		spells : ["minor illusion"],
		selection : ["minor illusion"],
		firstCol : 'atwill'
	},
	features : {
		"disguise self" : {
			name : "Legacy of Malbolge (level 3)",
			limfeaname : "Disguise Self",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Malbolge (3)",
				spells : ["disguise self"],
				selection : ["disguise self"],
				firstCol : 'oncelr'
			}
		},
		"invisibility" : {
			name : "Legacy of Malbolge (level 5)",
			limfeaname : "Invisibility",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Malbolge (5)",
				spells : ["invisibility"],
				selection : ["invisibility"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["levistus tiefling"] = {
	regExpSearch : /^(?=.*levistus)(?=.*tiefling|planetouched).*$/i,
	name : "Levistus tiefling",
	sortname : "Tiefling, Levistus",
	source : [["MToF", 22], ["UA:FO", 2]],
	plural : "Levistus tieflings",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Infernal"],
	vision : [["Darkvision", 60]],
	dmgres : ["Fire"],
	age : " reach adulthood in their late teens and live around 100 years",
	height : " range from 5 to over 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to over 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 1, 0, 0, 2],
	trait : "Levistus Tiefling (+1 Constitution, +2 Charisma)\n\nLegacy of Stygia:\n   I know the Ray of Frost cantrip.\n   At 3rd level, I can cast Armor of Agathys once per long rest as a 2nd-level spell.\n   At 5th level, I can also cast Darkness once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Legacy of Stygia (1)",
		spells : ["ray of frost"],
		selection : ["ray of frost"],
		firstCol : 'atwill'
	},
	features : {
		"armor of agathys" : {
			name : "Legacy of Stygia (level 3)",
			limfeaname : "Armor of Agathys (2nd-level)",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Stygia (3)",
				spells : ["armor of agathys"],
				selection : ["armor of agathys"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"armor of agathys" : {
					description : "10 temp HP; as long as temp HP last any crea that hits in melee takes 10 Cold dmg",
					changes : "Using Legacy of Stygia, I cast Armor of Agathys as if I'm using a 2nd-level spell slot."
				}
			}
		},
		"darkness" : {
			name : "Legacy of Stygia (level 5)",
			limfeaname : "Darkness",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Stygia (5)",
				spells : ["darkness"],
				selection : ["darkness"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["mammon tiefling"] = {
	regExpSearch : /^(?=.*mammon)(?=.*tiefling|planetouched).*$/i,
	name : "Mammon tiefling",
	sortname : "Tiefling, Mammon",
	source : [["MToF", 22], ["UA:FO", 2]],
	plural : "Mammon tieflings",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Infernal"],
	vision : [["Darkvision", 60]],
	dmgres : ["Fire"],
	age : " reach adulthood in their late teens and live around 100 years",
	height : " range from 5 to over 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to over 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 0, 1, 0, 2],
	trait : "Mammon Tiefling (+1 Intelligence, +2 Charisma)\nLegacy of Minauros:\n   I know the Mage Hand cantrip.\n   At 3rd level, I can cast Tenser's Floating Disk once per short rest.\n   At 5th level, I can also cast Arcane Lock without a material component once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Legacy of Minauros (1)",
		spells : ["mage hand"],
		selection : ["mage hand"],
		firstCol : 'atwill'
	},
	features : {
		"tenser's floating disk" : {
			name : "Legacy of Minauros (level 3)",
			limfeaname : "Tenser's Floating Disk",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Minauros (3)",
				spells : ["tenser's floating disk"],
				selection : ["tenser's floating disk"],
				firstCol : 'oncesr'
			}
		},
		"arcane lock" : {
			name : "Legacy of Minauros (level 5)",
			limfeaname : "Arcane Lock",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Minauros (5)",
				spells : ["arcane lock"],
				selection : ["arcane lock"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"arcane lock" : {
					components : "V,S",
					compMaterial : "",
					changes : "I can cast this spell once per long rest without requiring material components."
				}
			}
		}
	}
};
RaceList["mephistopheles tiefling-mtof"] = {
	regExpSearch : /^(?=.*mephistopheles)(?=.*tiefling|planetouched).*$/i,
	name : "Mephistopheles tiefling",
	sortname : "Tiefling, Mephistopheles",
	source : ["MToF", 23],
	plural : "Mephistopheles tieflings",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Infernal"],
	vision : [["Darkvision", 60]],
	dmgres : ["Fire"],
	age : " reach adulthood in their late teens and live around 100 years",
	height : " range from 5 to over 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to over 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 0, 1, 0, 2],
	trait : "Mephistopheles Tiefling (+1 Intelligence, +2 Charisma)\n\nLegacy of Cania:\n   I know the Mage Hand cantrip.\n   At 3rd level, I can cast Burning Hands once per long rest as a 2nd-level spell.\n   At 5th level, I can also cast Flame Blade once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Legacy of Cania (level 1)",
		spells : ["mage hand"],
		selection : ["mage hand"],
		firstCol : 'atwill'
	},
	features : {
		"burning hands" : {
			name : "Legacy of Cania (level 3)",
			limfeaname : "Burning Hands (4d6)",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Cania (level 3)",
				spells : ["burning hands"],
				selection : ["burning hands"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"burning hands" : {
					description : "All in area 4d6 Fire dmg; save halves; unattended flammable objects ignite",
					changes : "Using Legacy of Cania, I cast Burning Hands as if I'm using a 2nd-level spell slot."
				}
			}
		},
		"flame blade" : {
			name : "Legacy of Cania (level 5)",
			limfeaname : "Flame Blade",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Cania (level 5)",
				spells : ["flame blade"],
				selection : ["flame blade"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["zariel tiefling"] = {
	regExpSearch : /^(?=.*zariel)(?=.*tiefling|planetouched).*$/i,
	name : "Zariel tiefling",
	sortname : "Tiefling, Zariel",
	source : [["MToF", 23], ["UA:FO", 2]],
	plural : "Zariel tieflings",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Infernal"],
	vision : [["Darkvision", 60]],
	dmgres : ["Fire"],
	age : " reach adulthood in their late teens and live around 100 years",
	height : " range from 5 to over 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to over 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scores : [1, 0, 0, 0, 0, 2],
	trait : "Zariel Tiefling (+1 Strength, +2 Charisma)\n\nLegacy of Avernus:\n   I know the Thaumaturgy cantrip.\n   At 3rd level, I can cast Searing Smite once per long rest as a 2nd-level spell.\n   At 5th level, I can also cast Branding Smite once per long rest.\n   Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Legacy of Avernus (1)",
		spells : ["thaumaturgy"],
		selection : ["thaumaturgy"],
		firstCol : 'atwill'
	},
	features : {
		"searing smite" : {
			name : "Legacy of Avernus (level 3)",
			limfeaname : "Searing Smite (2d6)",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Avernus (3)",
				spells : ["searing smite"],
				selection : ["searing smite"],
				firstCol : 'oncelr'
			},
			spellChanges : {
				"searing smite" : {
					description : "Next melee weapon hit +2d6 Fire dmg and target ignites; save to end spell or 1d6 Fire dmg",
					changes : "Using Legacy of Avernus, I cast Searing Smite as if I'm using a 2nd-level spell slot."
				}
			}
		},
		"branding smite" : {
			name : "Legacy of Avernus (level 5)",
			limfeaname : "Branding Smite",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Legacy of Avernus (5)",
				spells : ["branding smite"],
				selection : ["branding smite"],
				firstCol : 'oncelr'
			}
		}
	}
};

// Elf subraces
RaceList["eladrin-mtof"] = {
	regExpSearch : /^(?!.*half)((?=.*eladrin)|((?=.*\b(elfs?|elves|elvish|elven)\b)(?=.*\b(feys?|feywild)\b))).*$/i,
	name : "Eladrin",
	sortname : "Elf, Fey (Eladrin)",
	source : ["MToF", 61],
	plural : "Eladrin",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Elvish"],
	vision : [["Darkvision", 60]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	skills : ["Perception"],
	age : " typically claim adulthood around age 100 and can live to be 750 years old",
	height : " range from under 5 to over 6 feet tall (4'6\" + 2d12\")",
	weight : " weigh around 115 lb (90 + 2d10 \xD7 1d4 lb)",
	heightMetric : " range from under 1,5 to over 1,8 metres tall (140 + 5d12 cm)",
	weightMetric : " weigh around 55 kg (40 + 5d10 \xD7 2d4 / 10 kg)",
	scores : [0, 2, 0, 0, 0, 1],
	abilitySave : 6,
	trait : "Eladrin (+2 Dexterity, +1 Charisma)" + desc([
		"Trance: Elves don't need to sleep, but meditate semiconsciously, for 4 hours a day. This gives the same benefit as a human gets from 8 hours of sleep (long rest takes only 4 hours).",
		"Fey Step: Once per short rest, as a bonus action, I can magically teleport up to 30 ft to an unoccupied space I can see. Once I reach 3rd level, this gains an additional effect, based on the current season I'm aligned with. See the third page notes section for the effects.",
		"Shifting Seasons: After I finish a long rest, I can align myself with a season of my choice."
	]),
	features : {
		"fey step" : {
			name : "Fey Step",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", ""]
		}
	},
	toNotesPage : [{
		name : "Eladrin Season Features",
		source : ["MToF", 62],
		popupName : "Eladrin Shifting Season Features",
		additional : "save DC 8 + Cha mod + prof bonus",
		page3notes : true,
		note : "\n  \u2022 Autumn (Eladrin Season, MToF 62)" + desc([
			" After using Fey Step, up to 2 creatures I can see within 10 ft of me must make a Wis save",
			" If failed, a target is charmed by me for 1 minute, or until I or my allies damage it"
		]) + "\n  \u2022 Winter (Eladrin Season, MToF 62)" + desc([
			" When I use Fey Step, one target in 5 ft of where I teleported from must make a Wis save",
			" If failed, it is frightened of me until the end of my next turn"
		]) + "\n  \u2022 Spring (Eladrin Season, MToF 62)" + desc([
			" When I use Fey Step, I can instead teleport one willing creature I touch within 5 ft of me",
			" It teleports to an unoccupied space of my choice that I can see within 30 ft of me"
		]) + "\n  \u2022 Summer (Eladrin Season, MToF 62)" + desc([
			" After using Fey Step, each creature of my choice within 5 ft of me takes fire damage",
			" This fire damage is equal to my Charisma modifier (minimum 1)"
		])
	}]
};
RaceList["sea elf"] = {
	regExpSearch : /^(?!.*half)((?=.*\b(elfs?|elves|elvish|elven)\b)(?=.*\b(seas?|oceans?|water)\b)).*$/i,
	name : "Sea elf",
	sortname : "Elf, Sea",
	source : [["MToF", 62], ["UA:ES", 1]],
	plural : "Sea elves",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : 30, enc : 20 }
	},
	weaponProfs : [false, false, ["spear", "trident", "light crossbow", "net"]],
	languageProfs : ["Common", "Elvish", "Aquan"],
	vision : [["Darkvision", 60]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	skills : ["Perception"],
	age : " typically claim adulthood around age 100 and can live to be 750 years old",
	height : " range from under 5 to almost 6 feet tall (4'6\" + 2d8\")",
	weight : " weigh around 115 lb (90 + 2d8 \xD7 1d4 lb)",
	heightMetric : " range from under 1,5 to almost 1,8 metres tall (140 + 5d8 cm)",
	weightMetric : " weigh around 52 kg (40 + 5d8 \xD7 2d4 / 10 kg)",
	scores : [0, 2, 1, 0, 0, 0],
	trait : "Sea Elf (+2 Dexterity, +1 Constitution)" + desc([
		"Trance: Elves don't need to sleep, but meditate semiconsciously, for 4 hours a day. While meditating, I can dream after a fashion. After resting in this way, I gain the same benefit that a human does from 8 hours of sleep, thus needing only 4 hours for a long rest.",
		"Child of the Sea. I have 30 ft swimming speed and can breathe air and water.",
		"Friend of the Sea: Through sounds and gestures, I can communicate simple ideas with any beast that has an inborn swimming speed."
	])
};
RaceList["shadar-kai-mtof"] = {
	regExpSearch : /^(?!.*half)((?=.*shadar-kai)|((?=.*\b(elfs?|elves|elvish|elven)\b)(?=.*\b(shadows?|shadowfell)\b))).*$/i,
	name : "Shadar-kai",
	sortname : "Elf, Shadow (Shadar-kai)",
	source : ["MToF", 62],
	plural : "Shadar-kai",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Elvish"],
	vision : [["Darkvision", 60]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	dmgres : ["Necrotic"],
	skills : ["Perception"],
	age : " typically claim adulthood around age 100 and can live to be 750 years old",
	height : " range from under 5 to over 6 feet tall (4'8\" + 2d8\")",
	weight : " weigh around 115 lb (90 + 2d8 \xD7 1d4 lb)",
	heightMetric : " range from under 1,5 to over 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 52 kg (40 + 5d8 \xD7 2d4 / 10 kg)",
	scores : [0, 2, 1, 0, 0, 0],
	trait : "Shadar-kai (+2 Dexterity, +1 Constitution)" + desc([
		"Trance: Elves don't need to sleep, but meditate semiconsciously, for 4 hours a day. This gives the same benefit as a human gets from 8 hours of sleep (long rest takes only 4 hours).",
		"Blessing of the Raven Queen: Once per long rest, as a bonus action, I can magically teleport up to 30 ft to an unoccupied space I can see.",
		"Once I reach 3rd level, after I use the Blessing of the Raven Queen, I appear translucent and have resistance to all damage until the start of my next turn."
	]),
	features : {
		"blessing of the raven queen" : {
			name : "Blessing of the Raven Queen",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			action : ["bonus action", ""]
		}
	}
};

// Gith and its two subraces
RaceList["githyanki-mtof"] = {
	regExpSearch : /githyanki/i,
	name : "Githyanki",
	source : ["MToF", 96],
	plural : "Githyanki",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Gith", 1],
	armorProfs : [true, true, false, false],
	weaponProfs : [false, false, ["shortsword", "longsword", "greatsword"]],
	skillstxt : "Choose any one skill or tool",
	age : " reach adulthood in their late teens and live for about a century",
	height : " are more leaner and taller than humans, most are a slender 6 feet tall (5'0\" + 2d12\")",
	weight : " weigh around 135 lb (100 + 2d12 \xD7 2d4 lb)",
	heightMetric : " are more leaner and taller than humans, most are a slender 1,8 metres tall (150 + 5d12 cm)",
	weightMetric : " weigh around 61 kg (45 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [2, 0, 0, 1, 0, 0],
	trait : "Githyanki (+2 Strength, +1 Intelligence)\n" + (typePF ? "\n" : "") + "Githyanki Psionics:" + desc([
		"I know the Mage Hand cantrip, but the hand is invisible.",
		"At 3rd level, I can cast Jump once per long rest.",
		"At 5th level, I can also cast Misty Step once per long rest.",
		"Intelligence is my spellcasting ability for these spells.",
		"I don't require components to cast these spells."
	]),
	spellcastingAbility : 4,
	spellcastingBonus : {
		name : "Githyanki Psionics (1)",
		spells : ["mage hand"],
		selection : ["mage hand"],
		firstCol : 'atwill'
	},
	features : {
		"jump" : {
			name : "Githyanki Psionics (level 3)",
			limfeaname : "Jump",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Githyanki Psionics (3)",
				spells : ["jump"],
				selection : ["jump"],
				firstCol : 'oncelr'
			}
		},
		"misty step" : {
			name : "Githyanki Psionics (level 5)",
			limfeaname : "Misty Step",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Githyanki Psionics (5)",
				spells : ["misty step"],
				selection : ["misty step"],
				firstCol : 'oncelr'
			}
		}
	}
};
AddRacialVariant("githyanki-mtof", "tool proficiency", {
	regExpSearch : /tool proficiency/i,
	skillstxt : "",
	toolProfs : [["Any tool", 1]]
});
AddRacialVariant("githyanki-mtof", "skill proficiency", {
	regExpSearch : /skill proficiency/i,
	skillstxt : "Choose any one skill"
});
RaceList["githzerai-mtof"] = {
	regExpSearch : /githzerai/i,
	name : "Githzerai",
	source : ["MToF", 96],
	plural : "Githzerai",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Gith"],
	age : " reach adulthood in their late teens and live for about a century",
	height : " are more leaner and taller than humans, most are a slender 6 feet tall (4'11\" + 2d12\")",
	weight : " weigh around 115 lb (90 + 2d12 \xD7 1d4 lb)",
	heightMetric : " are more leaner and taller than humans, most are a slender 1,8 metres tall (150 + 5d12 cm)",
	weightMetric : " weigh around 55 kg (40 + 5d10 \xD7 2d4 / 10 kg)",
	scores : [0, 0, 0, 1, 2, 0],
	trait : "Githzerai (+1 Intelligence, +2 Wisdom)\n" + (typePF ? "\n" : "") + "Githzerai Psionics:" + desc([
		"I know the Mage Hand cantrip, but the hand is invisible.",
		"At 3rd level, I can cast Shield once per long rest.",
		"At 5th level, I can also cast Detect Thoughts once per long rest.",
		"Wisdom is my spellcasting ability for these spells.",
		"I don't require components to cast these spells."
	]),
	savetxt : { adv_vs : ["charmed", "frightened"] },
	spellcastingAbility : 5,
	spellcastingBonus : {
		name : "Githzerai Psionics (1)",
		spells : ["mage hand"],
		selection : ["mage hand"],
		firstCol : 'atwill'
	},
	features : {
		"shield" : {
			name : "Githzerai Psionics (level 3)",
			limfeaname : "Shield",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Githzerai Psionics (3)",
				spells : ["shield"],
				selection : ["shield"],
				firstCol : 'oncelr'
			}
		},
		"detect thoughts" : {
			name : "Githzerai Psionics (level 5)",
			limfeaname : "Detect Thoughts",
			minlevel : 5,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Githzerai Psionics (5)",
				spells : ["detect thoughts"],
				selection : ["detect thoughts"],
				firstCol : 'oncelr'
			}
		}
	}
};

// Reprints
if (!RaceList["gray dwarf"]) { //reprint from Sword Coast Adventure Guide
	RaceList["gray dwarf"] = {
		regExpSearch : /^((?=.*\bduergars?\b)|((?=.*\b(dwarfs?|dwarves|dwarfish|dwarvish|dwarven)\b)(?=.*\b(grey|gray|underdark)\b))).*$/i,
		name : "Duergar",
		sortname : "Dwarf, Gray (Duergar)",
		source : [["S", 104], ["MToF", 81]],
		plural : "Duergar",
		size : 3,
		speed : {
			walk : { spd : 25, enc : 25 }
		},
		languageProfs : ["Common", "Dwarvish", "Undercommon"],
		vision : [["Darkvision", 120], ["Sunlight Sensitivity", 0]],
		savetxt : { adv_vs : ["charmed", "illusions", "paralyzed", "poison"] },
		dmgres : ["Poison"],
		weaponProfs : [false, false, ["battleaxe", "handaxe", "warhammer", "light hammer"]],
		toolProfs : [["Smith, brewer, or mason tools", 1]],
		age : " are considered young until they are 50 and live about 350 years",
		height : " stand between 4 and 5 feet tall (3'8\" + 2d4\")",
		weight : " weigh around 150 lb (115 + 2d4 \xD7 2d6 lb)",
		heightMetric : " stand between 1,2 and 1,5 metres tall (110 + 5d4 cm)",
		weightMetric : " weigh around 70 kg (55 + 5d4 \xD7 4d6 / 10 kg)",
		scores : [1, 0, 2, 0, 0, 0],
		trait : "Duergar (+2 Constitution, +1 Strength)\nStonecunning: Whenever I make an Int (History) check related to the origin of stonework, I am considered proficient in the skill and add double my proficiency bonus to the check.\nSunlight Sensitivity: Disadvantage on attack rolls and Wisdom (Perception) checks that rely on sight when I or what I am trying to attack/perceive is in direct sunlight.\nDuergar Magic: 3rd: Enlarge/Reduce to enlarge; 5th: Invisibility. If not in direct sunlight," + (!typePF ? "\n" : " ") + "I can cast both spells on myself once per long rest without material components, using Int.",
		spellcastingAbility : 4,
		features : {
			"enlarge" : {
				name : "Duergar Magic (level 3)",
				limfeaname : "Enlarge (self only)",
				minlevel : 3,
				usages : 1,
				recovery : "long rest",
				spellcastingBonus : {
					name : "Duergar Magic (level 3)",
					spells : ["enlarge/reduce"],
					selection : ["enlarge/reduce"],
					firstCol : 'oncelr'
				},
				spellChanges : {
					"enlarge/reduce" : {
						name : "Enlarge",
						range : "Self",
						components : "V,S",
						compMaterial : "",
						description : "I'm enlarged, adv. on Str checks/aves and +1d4 on weapon dmg; Can't cast this in direct sunlight",
						changes : "Using Duergar Magic, I cast Enlarge/Reduce while I'm not in direct sunlight, but only to enlarge myself."
					}
				}
			},
			"invisibility" : {
				name : "Duergar Magic (level 5)",
				limfeaname : "Invisibility (self only)",
				minlevel : 5,
				usages : 1,
				recovery : "long rest",
				spellcastingBonus : {
					name : "Duergar Magic (level 5)",
					spells : ["invisibility"],
					selection : ["invisibility"],
					firstCol : 'oncelr'
				},
				spellChanges : {
					"invisibility" : {
						range : "Self",
						components : "V,S",
						compMaterial : "",
						description : "I and worn/carried invisible until I attack or cast; Can't cast this spell in direct sunlight",
						changes : "Me and my worn/carried invisible until I attack or cast; Can't cast this spell in direct sunlight"
					}
				}
			}
		}
	};
}
if (!RaceList["deep gnome"]) {  //reprint from Elemental Evil Player's Companion and Sword Coast Adventure Guide
	RaceList["deep gnome"] = {
		regExpSearch : /^((?=.*svirfneblin)|((?=.*\bgnomes?\b)(?=.*\b(underdarks?|deep|depths?)\b))).*$/i,
		name : "Svirfneblin",
		sortname : "Gnome, Deep (Svirfneblin)",
		source : [["E", 7], ["S", 115], ["MToF", 113]],
		plural : "Svirfneblin",
		size : 4,
		speed : {
			walk : { spd : 25, enc : 15 }
		},
		languageProfs : ["Common", "Gnomish", "Undercommon"],
		vision : [["Darkvision", 120]],
		savetxt : { text : ["Adv. on Int/Wis/Cha saves vs. magic"] },
		age : " are considered full-grown adults when they reach 25 and live 200 to 250 years",
		height : " stand between 3 and 3 1/2 feet tall (2'9\" + 2d4\")",
		weight : " weigh around 90 lb (80 + 2d4 \xD7 1d4 lb)",
		heightMetric : " stand between 90 and 105 cm tall (85 + 5d4 cm)",
		weightMetric : " weigh around 50 kg (35 + 5d4 \xD7 4d4 / 10 kg)",
		scores : [0, 1, 0, 2, 0, 0],
		trait : "Svirfneblin (+1 Dexterity, +2 Intelligence)\n\nStone Camouflage:\n   I have advantage on Dexterity (stealth) checks to hide in rocky terrain."
	};
}

// Feat
if (!FeatsList["svirfneblin magic"]) {
	FeatsList["svirfneblin magic"] = {
		name : "Svirfneblin Magic",
		source : [["E", 7], ["S", 115], ["MToF", 114]],
		prerequisite : "Being a Svirfneblin (Deep Gnome)",
		prereqeval : function(v) { return CurrentRace.known === 'deep gnome'; },
		descriptionFull : "You have inherited the innate spellcasting ability of your ancestors. This ability allows you to cast Nondetection on yourself at will, without needing a material component. You can also cast each of the following spells once with this ability: Blindness/Deafness, Blur, and Disguise Self. You regain the ability to cast these spells when you finish a long rest.\n   Intelligence is your spellcasting ability for these spells, and you cast them at their lowest possible levels.",
		description : "I can cast Nondetection on myself at will, without a material component. I can also cast the spells Blindness/Deafness, Blur, and Disguise Self once each. I regain the ability to cast these spells when I finish a long rest. Intelligence is my spellcasting ability for these spells.",
		spellcastingBonus : [{
			name : "at will (self only)",
			spellcastingAbility : 4,
			spells : ["nondetection"],
			selection : ["nondetection"],
			firstCol : 'atwill'
		}, {
			name : "1x long rest (self only)",
			spells : ["blindness/deafness", "blur", "disguise self"],
			selection : ["blindness/deafness", "blur", "disguise self"],
			firstCol : 'oncelr',
			times : 3
		}],
		spellChanges : {
			"nondetection" : {
				range : "Self",
				components : "V,S",
				compMaterial : "",
				description : "I am hidden from all divination magic",
				changes : "Using Svirfneblin Magic, I can cast Nondetection without a material component, but only on myself."
			}
		}
	};
}

// Magic Items
MagicItemsList["greater silver sword"] = {
	name : "Greater Silver Sword",
	source : ["MToF", 89],
	type : "weapon (greatsword)",
	rarity : "legendary",
	description : "This magic greatsword gives +1 to hit and damage. While holding it, I have adv. on Int, Wis, and Cha saves, immunity to being charmed, and resistance to psychic damage. If I score a critical hit with it on a creature's astral body, I can cut the cord tethering it to its material body, instead of dealing damage.",
	descriptionFull : "This magic weapon grants a +3 bonus to attack and damage rolls made with it. While you hold the sword, you have advantage on Intelligence, Wisdom, and Charisma saving throws, you are immune to being charmed, and you have resistance to psychic damage. In addition, if you score a critical hit with it against a creature's astral body, you can cut the silvery cord that tethers the target to its material body, instead of dealing damage.",
	attunement : true,
	weight : 6,
	prerequisite : "Requires attunement by a creature that has psionic ability",
	prereqeval : function (v) {
		if (!v.isSpellcaster) return false;
		if ((/psion|mystic/i).test(What("Racial Traits"))) return true;
		for (var aCast in CurrentSpells) {
			var spCast = CurrentSpells[aCast];
			if ((/psion|mystic/i).test(spCast.name) || (spCast.list && spCast.list.psionic)) return true;
			if (!spCast.bonus) continue;
			for (var aBon in spCast.bonus) {
				if ((/psion|mystic/i).test(aBon) || (/psion|mystic/i).test(spCast.bonus[aBon].name)) return true;
			}
		}
	},
	weaponsAdd : ["Greater Silver Sword"],
	weaponOptions : {
		baseWeapon : "greatsword",
		regExpSearch : /^(?=.*greater)(?=.*silver)(?=.*sword).*$/i,
		name : "Greater Silver Sword",
		source : ["MToF", 89],
		description : "Heavy, two-handed; On crit vs. astral body, cut cord instead of damage",
		modifiers : [3, 3]
	},
	savetxt : { text : ["Adv. on Int, Wis, and Cha saves"], immune : ["charmed"] },
	advantages : [["Intelligence", true], ["Wisdom", true], ["Charisma", true]],
	dmgres : ["Psychic"]
}
MagicItemsList["infernal tack"] = {
	name : "Infernal Tack",
	source : [["MToF", 167], ["DiA", 224]],
	type : "wondrous item",
	rarity : "legendary",
	description : "While wearing the spurs of this set, the nightmare equipped with the bridle, bit, reins, saddle, and stirrups is under my command. As an action, I can have it appear in 20 ft at the start of my next turn. It acts on as my ally on my initiative, remains for 1 day, until I or it dies, or I dismiss it as an action. If it dies, it reforms in 24 h.",
	descriptionLong : "This tack consists of a bridle, bit, reins, saddle, stirrups, and spurs. A nightmare equipped with the tack serves whoever wears the spurs until the wearer dies or the tack is removed. As an action, I can clash the spurs together or scrape them through blood, causing the nightmare to appear within 20 ft at the start of my next turn. It acts as my ally on my initiative count, remains for 1 day, until I or it dies, or until I dismiss it as an action. If it dies, it reforms within 24 hours, after which I can summon it again. The tack doesn't create a nightmare from thin air; one must first be subdued so the tack can be placed on it.",
	descriptionFull : "A narzugon binds a nightmare to its service with infernal tack, which consists of a bridle, bit, reins, saddle, stirrups, and spurs. A nightmare equipped with infernal tack must serve whoever wears the spurs until the wearer dies or the tack is removed.\n   You can use an action to call a nightmare equipped with infernal tack by clashing the spurs together or scraping them through blood. The nightmare appears at the start of your next turn, within 20 feet of you. It acts as your ally and takes its turn on your initiative count. It remains for 1 day, until you or it dies, or until you dismiss it as an action. If the nightmare dies, it reforms in the Nine Hells within 24 hours, after which you can summon it again.\n   The tack doesn't conjure a nightmare from thin air; one must first be subdued so the tack can be placed on it. No nightmare accepts this forced servitude willingly, but some eventually form strong loyalties to their masters and become true partners in evil.",
	attunement : true,
	weight : 26, // riding saddle (25) + bit and bridle (1)
	prerequisite : "Requires attunement by a creature of evil alignment",
	prereqeval : function(v) { return (/evil/i).test(What("Alignment")); },
	action : [["action", ""]]
}
var iFileName = "pub_20180723_WGtE.js";
RequiredSheetVersion(13);
// This file adds the content from Wayfinder's Guide to Eberron to MPMB's Character Record Sheet

// Define the sources
SourceList.WGtE = {
	name : "Wayfinder's Guide to Eberron",
	abbreviation : "WGtE",
	group : "Primary Sources",
	url : "https://www.dmsguild.com/product/247882/",
	date : "2018/10/09" // the original is from 2018/07/23, but this script is based on the newer version that includes (most of) the UA:Dragonmark changes
};

// The changeling
RaceList["changeling-wgte"] = {
	regExpSearch : /changeling/i,
	name : "Changeling",
	source : [["WGtE", 61], ["UA:RoE", 2]],
	plural : "Changelings",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	skillstxt : "Choose two from Deception, Intimidation, Insight, and Persuasion",
	languageProfs : ["Common", 2],
	toolProfs : [["Any tool", 1]],
	age : " reach adulthood in their early teens and live around 80 years",
	height : " stand between 5 and 6 feet tall (5'1\" + 2d4\")", // Taken from 3e Eberron Campaign Setting
	weight : " weigh around 140 lb (115 + 2d4 \xD7 2d4 lb)", // Taken from 3e Eberron Campaign Setting
	heightMetric : " stand between 1,5 to over 1,8 metres tall (155 + 5d4 cm)",
	weightMetric : " weigh around 65 kg (52 + 5d4 \xD7 4d4 / 10 kg)",
	scorestxt : "+2 Charisma, and +1 Dexterity or +1 Intelligence",
	scores : [0, 0, 0, 0, 0, 2],
	trait : "Changeling (+2 Charisma, and +1 Dexterity or +1 Intelligence)\nChange Appearance: As an action, I can polymorph to or from a humanoid form of my size I have seen, not changing my equipment. I revert back if I die and have adv. on Deception.\nUnsettling Visage: As a reaction once per short rest when I'm attacked by a seen attacker, I can impose disadv. Doing this reveals my shapeshifting nature to all within 30 ft.\nDivergent Persona: I have proficiency with one tool, and an alternate persona. While in the alternate form, my proficiency bonus with that tool is doubled.",
	action : ["action", "Change Appearance"],
	features : {
		"unsettling visage" : {
			name : "Unsettling Visage",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["reaction", ""]
		}
	}
};

// The kalashtar
RaceList["kalashtar"] = { //this code includes contributions by /u/SoilentBrad
	regExpSearch : /kalashtar/i,
	name : "Kalashtar",
	source : [["WGtE", 63], ["UA:RoE", 4]],
	plural : "Kalashtar",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	skillstxt : "Advantage with either Insight, Intimidation, Performance, or Persuasion",
	languageProfs : ["Common", "Quori", 1],
	savetxt : { immune : ["effects that require me to dream"] },
	dmgres : ["Psychic"],
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " range from 5 and a half to well over 6 feet tall (5'3\" + 2d6\")", // Taken from 3e Eberron Campaign Setting
	weight : " weigh around 145 lb (120 + 2d6 \xD7 1d6 lb)", // Taken from 3e Eberron Campaign Setting
	heightMetric : " range from 1,7 to 1,9 metres tall (160 + 5d6 cm)",
	weightMetric : " weigh around 65 kg (55 + 5d6 \xD7 2d6 / 10 kg)",
	scorestxt : "+1 Wisdom, +1 Charisma, and +1 to one other ability score of my choice",
	scores : [0, 0, 0, 0, 1, 1],
	trait : "Kalashtar (+1 Wisdom, +1 Charisma, and +1 to one other" + (typePF ? "" : " ability score of my choice") + ")\nDual Mind: As a reaction after I roll a Wis" + (typePF ? " save, I can gain adv." : "dom saving throw, I can gain advantage") + " on it.\nMind Link: I can speak telepathically to any creature I can see within 60 ft, as long as it can speak at least one language. As a bonus action, I can give that creature the ability to speak telepathically back to me until the start of my next turn.\nPsychic Glamour: I have adv. on Insight, Intimidation, Performance, or Persuasion checks.\nSevered from Dreams: I don't dream and thus immune to spells that affect dreams.",
	action : [['bonus action', 'Mind Link'], ['reaction', 'Dual Mind']]
};

// The four subraces of the shifter
RaceList["beasthide shifter"] = {
	regExpSearch : /^(?=.*shifter)(?=.*beast)(?=.*hide).*$/i,
	name : "Beasthide shifter",
	sortname : "Shifter, Beasthide",
	source : [["WGtE", 66], ["UA:RoE", 6]],
	plural : "Beasthide shifters",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common"],
	vision : [["Darkvision", 60]],
	skills : ["Athletics", "Perception"],
	age : " reach young adulthood at age 10 and rarely live over 70",
	height : " range from under 5 to almost 6 feet tall (4'6\" + 2d8\")", // Taken from 3e Eberron Campaign Setting
	weight : " weigh around 140 lb (95 + 2d8 \xD7 2d4 lb)", // Taken from 3e Eberron Campaign Setting
	heightMetric : " range from under 1,5 to 1,8 metres tall (4'6\" + 5d8 cm)",
	weightMetric : " weigh around 65 kg (43 + 5d8 \xD7 4d4 / kg)",
	scores : [0, 1, 2, 0, 0, 0],
	trait : "Beasthide Shifter: (+1 Dexterity, +2 Constitution)\n\nShifting: As a bonus action once per short rest, I can assume a more bestial appearance.\nThis transformation lasts for 1 minute, until I die, or until I revert back as a bonus action.\nWhen I shift, I gain temporary HP equal to 1d6 + my level + my Constitution modifier (minimum 1 temporary hit point).\nWhile transformed like this, I have a +1 bonus to AC",
	features : {
		"shift" : {
			name : "Shift",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", " (start/end)"]
		}
	}
};
RaceList["longtooth shifter"] = {
	regExpSearch : /^(?=.*shifter)(?=.*long)(?=.*(tooth|teeth)).*$/i,
	name : "Longtooth shifter",
	sortname : "Shifter, Longtooth",
	source : [["WGtE", 66], ["UA:RoE", 6]],
	plural : "Longtooth shifters",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common"],
	weaponOptions : {
		baseWeapon : "unarmed strike",
		regExpSearch : /^(?=.*fangs?)(?=.*long)(?=.*(tooth|teeth)).*$/i,
		name : "Longtooth Fangs",
		source : [["WGtE", 66], ["UA:RoE", 6]],
		damage : [1, 6, "piercing"],
		description : "Only while shifted; One attack as bonus action"
	},
	weaponsAdd : ["Longtooth Fangs"],
	vision : [["Darkvision", 60]],
	skills : ["Intimidation", "Perception"],
	age : " reach young adulthood at age 10 and rarely live over 70",
	height : " range from under 5 to almost 6 feet tall (4'6\" + 2d8\")", // Taken from 3e Eberron Campaign Setting
	weight : " weigh around 140 lb (95 + 2d8 \xD7 2d4 lb)", // Taken from 3e Eberron Campaign Setting
	heightMetric : " range from under 1,5 to 1,8 metres tall (4'6\" + 5d8 cm)",
	weightMetric : " weigh around 65 kg (43 + 5d8 \xD7 4d4 / kg)",
	scores : [2, 1, 0, 0, 0, 0],
	trait : "Longtooth Shifter: (+2 Strength, +1 Dexterity)\nShifting: As a bonus action once per short rest, I can assume a more bestial appearance.\nThis transformation lasts for 1 minute, until I die, or until I revert back as a bonus action.\nWhen I shift, I gain temporary HP equal to my level + my Constitution modifier (minimum 1 temporary hit point).\nWhile transformed like this, I use my elongated fangs to make unarmed strikes, dealing 1d6 piercing damage. As a bonus action, I can maken one attack with my fangs.",
	action : ['bonus action', 'Attack with Longtooth Fangs'],
	features : {
		"shift" : {
			name : "Shift",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", " (start/end)"]
		}
	}
};
RaceList["swiftstride shifter"] = {
	regExpSearch : /^(?=.*shifter)(?=.*swift)(?=.*stride).*$/i,
	name : "Swiftstride shifter",
	sortname : "Shifter, Swiftstride",
	source : [["WGtE", 66], ["UA:RoE", 6]],
	plural : "Swiftstride shifters",
	size : 3,
	speed : {
		walk : { spd : 35, enc : 25 }
	},
	languageProfs : ["Common"],
	vision : [["Darkvision", 60]],
	skills : ["Acrobatics", "Perception"],
	age : " reach young adulthood at age 10 and rarely live over 70",
	height : " range from under 5 to almost 6 feet tall (4'6\" + 2d8\")", // Taken from 3e Eberron Campaign Setting
	weight : " weigh around 140 lb (95 + 2d8 \xD7 2d4 lb)", // Taken from 3e Eberron Campaign Setting
	heightMetric : " range from under 1,5 to 1,8 metres tall (4'6\" + 5d8 cm)",
	weightMetric : " weigh around 65 kg (43 + 5d8 \xD7 4d4 / kg)",
	scores : [0, 2, 0, 0, 0, 1],
	trait : "Swiftstride Shifter: (+2 Dexterity, +1 Charisma)\nShifting: As a bonus action once per short rest, I can assume a more bestial appearance.\nThis transformation lasts for 1 minute, until I die, or until I revert back as a bonus action.\nWhen I shift, I gain temporary HP equal to my level + my Con" + (typePF ? "stitution modifier (minimum 1 temporary hit point" : " mod (minimum 1 temp HP") + ").\nWhile transformed like this, my walking speed increases with 5 ft.\nAs a reaction when an enemy ends its turn within 5 ft of me while I'm shifted, I can move 10 ft without provoking opportunity attacks.",
	action : ['reaction', 'Stride (while shifted)'],
	features : {
		"shift" : {
			name : "Shift",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", " (start/end)"]
		}
	}
};
RaceList["wildhunt shifter"] = {
	regExpSearch : /^(?=.*shifter)(?=.*wild)(?=.*hunt).*$/i,
	name : "Wildhunt shifter",
	sortname : "Shifter, Wildhunt",
	source : [["WGtE", 66], ["UA:RoE", 6]],
	plural : "Wildhunt shifters",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common"],
	vision : [["Darkvision", 60]],
	skills : ["Perception", "Survival"],
	age : " reach young adulthood at age 10 and rarely live over 70",
	height : " range from under 5 to almost 6 feet tall (4'6\" + 2d8\")", // Taken from 3e Eberron Campaign Setting
	weight : " weigh around 140 lb (95 + 2d8 \xD7 2d4 lb)", // Taken from 3e Eberron Campaign Setting
	heightMetric : " range from under 1,5 to 1,8 metres tall (4'6\" + 5d8 cm)",
	weightMetric : " weigh around 65 kg (43 + 5d8 \xD7 4d4 / kg)",
	scores : [0, 1, 0, 0, 2, 0],
	trait : "Wildhunt Shifter: (+1 Dexterity, +2 Wisdom)\nShifting: As a bonus action once per short rest, I can transform and get adv. on Wis checks." + (typePF ? " " : "\n") + "This transformation lasts for 1 minute, until I die, or until I revert back as a bonus action.\nWhen I shift, I gain temporary HP equal to my level + my Con" + (typePF ? "stitution modifier (minimum 1 temporary hit point" : " mod (minimum 1 temp HP") + ").\nMark the Scent: As a bonus action once per short rest, I can mark a creature that I can see within 10 ft. Until the end of my next long rest, my proficiency bonus is doubled for checks to find this target, and I always know its location if it is within 60 ft of me.",
	features : {
		"shift" : {
			name : "Shift",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", " (start/end)"]
		},
		"mark the scent" : {
			name : "Mark the Scent",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", ""]
		}
	}
};

// The three subraces of the warforged
RaceList["envoy warforged"] = {
	regExpSearch : /^(?=.*warforged)(?=.*envoy).*$/i,
	name : "Envoy warforged",
	sortname : "Warforged, Envoy",
	source : [["WGtE", 69], ["UA:RoE", 9]],
	plural : "Envoy warforged",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", 1],
	toolProfs : [["Any tool", 1]],
	skillstxt : "Choose any one skill, any one tool, and expertise with any one tool I'm proficient with",
	savetxt : {
		text : ["Magic can't put me to sleep"],
		immune : ["disease", "exhaustion from lack of rest"],
		adv_vs : ["poison"]
	},
	dmgres : ["Poison"],
	age : " are created as adults and will only start to show signs of physical deterioration after 150 years, but have no further aging effects",
	height : " stand between 6 and 7 feet tall (5'10\" + 2d6\")", // Taken from 3e Eberron Campaign Setting
	weight : " weigh around 300 lb (270 + 2d6 \xD7 4 lb)", // Taken from 3e Eberron Campaign Setting
	heightMetric : " stand between 1,8 and 2,1 metres tall (178 + 5d6 cm)",
	weightMetric : " weigh around 135 kg (125 + 5d6 \xD7 8 / kg)",
	scorestxt : "+1 Constitution and +1 to two other ability scores of my choice",
	scores : [0, 0, 1, 0, 0, 0],
	trait : "Envoy Warforged (+1 Constitution and +1 to two other abilit" + (typePF ? "ies" : "y scores of my choice") + ")\nWarforged Resilience: I do not need to sleep, eat, drink, or breathe.\nSentry's Rest: To benefit from a long rest, I need to enter an inactive state for 6 hours, during which I am not rendered unconscious and can see and hear as normal.\nIntegrated Protection: My AC depends on armor proficiency: none (11+Dex), light (11+Dex+Prof B), medium (13+Dex+Prof B), heavy (16+Prof B; Stealth disadv.). I can use a shield.\nIntegrated Tool: I have expertise with one tool and it is integrated into my body.",
	eval : function() {
		var lightProf = tDoc.getField('Proficiency Armor Light').isBoxChecked(0);
		if (tDoc.getField('Proficiency Armor Heavy').isBoxChecked(0)) {
			CurrentRace.armorAdd = 'Heavy Plating (Prof)';
		} else if (tDoc.getField('Proficiency Armor Medium').isBoxChecked(0) && ((What('Dex') < 18 && lightProf) || !lightProf)) {
			CurrentRace.armorAdd = 'Composite Plating (Prof)';
		} else {
			CurrentRace.armorAdd = 'Darkwood Core' + (lightProf ? " (Prof)" : "");
		};
	},
	removeeval : function () {
		if ((/darkwood core|composite plating|heavy plating/).test(CurrentArmour.known)) {
			tDoc.resetForm(['AC Armor Description']);
		};
	},
	armorOptions : [{
		regExpSearch : /^(?=.*darkwood)(?=.*core).*$/i,
		name : "Darkwood core",
		source : [["WGtE", 69], ["UA:RoE", 9]],
		ac : 11
	}, {
		regExpSearch : /^(?=.*darkwood)(?=.*core)(?=.*prof).*$/i,
		name : "Darkwood core (Prof)",
		source : [["WGtE", 69], ["UA:RoE", 9]],
		ac : 11,
		addMod : true
	}, {
		regExpSearch : /^(?=.*composite)(?=.*plating).*$/i,
		name : "Composite plating (Prof)",
		source : [["WGtE", 69], ["UA:RoE", 9]],
		type : "medium",
		ac : 13,
		addMod : true,
		dex : 2
	}, {
		regExpSearch : /^(?=.*heavy)(?=.*plating).*$/i,
		name : "Heavy plating (Prof)",
		source : [["WGtE", 69], ["UA:RoE", 9]],
		type : "heavy",
		ac : 16,
		addMod : true,
		stealthdis : true
	}]
};
RaceList["juggernaut warforged"] = {
	regExpSearch : /^(?=.*warforged)(?=.*juggernaut).*$/i,
	name : "Juggernaut warforged",
	sortname : "Warforged, Juggernaut",
	source : [["WGtE", 70], ["UA:RoE", 9]],
	plural : "Juggernaut warforged",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common"],
	weaponOptions : {
		baseWeapon : "unarmed strike",
		regExpSearch : /^(?=.*warforged)(?=.*iron)(?=.*fists?).*$/i,
		name : "Warforged iron fists",
		source : [["WGtE", 70], ["UA:RoE", 9]],
		damage : [1, 4, "bludgeoning"]
	},
	weaponsAdd : ["Warforged Iron Fists"],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		immune : ["disease", "exhaustion from lack of rest"],
		adv_vs : ["poison"]
	},
	dmgres : ["Poison"],
	age : " are created as adults and will only start to show signs of physical deterioration after 150 years, but have no further aging effects",
	height : " stand between 6 and 7 feet tall (5'10\" + 2d6\")", // Taken from 3e Eberron Campaign Setting
	weight : " weigh around 300 lb (270 + 2d6 \xD7 4 lb)", // Taken from 3e Eberron Campaign Setting
	heightMetric : " stand between 1,8 and 2,1 metres tall (178 + 5d6 cm)",
	weightMetric : " weigh around 135 kg (125 + 5d6 \xD7 8 / kg)",
	scores : [2, 0, 1, 0, 0, 0],
	trait : "Juggernaut Warforged (+2 Strength, +1 Constitution)" + (typePF ? "" : " Iron Fists: unarmed strikes do 1d4.") + "\nWarforged Resilience: I do not need to sleep, eat, drink, or breathe.\nSentry's Rest: To benefit from a long rest, I need to enter an inactive state for 6 hours, during which I am not rendered unconscious and can see and hear as normal.\nIntegrated Protection: My AC depends on armor proficiency: none (11+Dex), light (11+Dex+Prof B), medium (13+Dex+Prof B), heavy (16+Prof B; Stealth disadv.). I can use a shield.\nPowerful Build: I count as one size larger for my carrying capacity, push, drag, and lift." + (typePF ? " Iron Fists: My unarmed strikes do 1d4 damage." : ""),
	carryingCapacity : 2,
	eval : function() {
		var lightProf = tDoc.getField('Proficiency Armor Light').isBoxChecked(0);
		if (tDoc.getField('Proficiency Armor Heavy').isBoxChecked(0)) {
			CurrentRace.armorAdd = 'Heavy Plating (Prof)';
		} else if (tDoc.getField('Proficiency Armor Medium').isBoxChecked(0) && ((What('Dex') < 18 && lightProf) || !lightProf)) {
			CurrentRace.armorAdd = 'Composite Plating (Prof)';
		} else {
			CurrentRace.armorAdd = 'Darkwood Core' + (lightProf ? " (Prof)" : "");
		};
	},
	removeeval : function () {
		if ((/darkwood core|composite plating|heavy plating/).test(CurrentArmour.known)) {
			tDoc.resetForm(['AC Armor Description']);
		};
	},
	armorOptions : [{
		regExpSearch : /^(?=.*darkwood)(?=.*core).*$/i,
		name : "Darkwood core",
		source : [["WGtE", 69], ["UA:RoE", 9]],
		ac : 11
	}, {
		regExpSearch : /^(?=.*darkwood)(?=.*core)(?=.*prof).*$/i,
		name : "Darkwood core (Prof)",
		source : [["WGtE", 69], ["UA:RoE", 9]],
		ac : 11,
		addMod : true
	}, {
		regExpSearch : /^(?=.*composite)(?=.*plating).*$/i,
		name : "Composite plating (Prof)",
		source : [["WGtE", 69], ["UA:RoE", 9]],
		type : "medium",
		ac : 13,
		addMod : true,
		dex : 2
	}, {
		regExpSearch : /^(?=.*heavy)(?=.*plating).*$/i,
		name : "Heavy plating (Prof)",
		source : [["WGtE", 69], ["UA:RoE", 9]],
		type : "heavy",
		ac : 16,
		addMod : true,
		stealthdis : true
	}]
};
RaceList["skirmisher warforged"] = {
	regExpSearch : /^(?=.*warforged)(?=.*skirmisher).*$/i,
	name : "Skirmisher warforged",
	sortname : "Warforged, Skirmisher",
	source : [["WGtE", 70], ["UA:RoE", 9]],
	plural : "Skirmisher warforged",
	size : 3,
	speed : {
		walk : { spd : 35, enc : 25 }
	},
	languageProfs : ["Common"],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		immune : ["disease", "exhaustion from lack of rest"],
		adv_vs : ["poison"]
	},
	dmgres : ["Poison"],
	age : " are created as adults and will only start to show signs of physical deterioration after 150 years, but have no further aging effects",
	height : " stand between 6 and 7 feet tall (5'10\" + 2d6\")", // Taken from 3e Eberron Campaign Setting
	weight : " weigh around 300 lb (270 + 2d6 \xD7 4 lb)", // Taken from 3e Eberron Campaign Setting
	heightMetric : " stand between 1,8 and 2,1 metres tall (178 + 5d6 cm)",
	weightMetric : " weigh around 135 kg (125 + 5d6 \xD7 8 / kg)",
	scores : [0, 2, 1, 0, 0, 0],
	trait : "Skirmisher Warforged (+2 Dexterity, +1 Constitution)\nWarforged Resilience: I do not need to sleep, eat, drink, or breathe.\nSentry's Rest: To benefit from a long rest, I need to enter an inactive state for 6 hours, during which I am not rendered unconscious and can see and hear as normal.\nIntegrated Protection: My AC depends on armor proficiency: none (11+Dex), light (11+Dex+Prof B), medium (13+Dex+Prof B), heavy (16+Prof B; Stealth disadv.). I can use a shield.\nLight Step: If I travel alone for an hour or more, I can move stealthily at a normal pace.",
	eval : function() {
		var lightProf = tDoc.getField('Proficiency Armor Light').isBoxChecked(0);
		if (tDoc.getField('Proficiency Armor Heavy').isBoxChecked(0)) {
			CurrentRace.armorAdd = 'Heavy Plating (Prof)';
		} else if (tDoc.getField('Proficiency Armor Medium').isBoxChecked(0) && ((What('Dex') < 18 && lightProf) || !lightProf)) {
			CurrentRace.armorAdd = 'Composite Plating (Prof)';
		} else {
			CurrentRace.armorAdd = 'Darkwood Core' + (lightProf ? " (Prof)" : "");
		};
	},
	removeeval : function () {
		if ((/darkwood core|composite plating|heavy plating/).test(CurrentArmour.known)) {
			tDoc.resetForm(['AC Armor Description']);
		};
	},
	armorOptions : [{
		regExpSearch : /^(?=.*darkwood)(?=.*core).*$/i,
		name : "Darkwood core",
		source : [["WGtE", 69], ["UA:RoE", 9]],
		ac : 11
	}, {
		regExpSearch : /^(?=.*darkwood)(?=.*core)(?=.*prof).*$/i,
		name : "Darkwood core (Prof)",
		source : [["WGtE", 69], ["UA:RoE", 9]],
		ac : 11,
		addMod : true
	}, {
		regExpSearch : /^(?=.*composite)(?=.*plating).*$/i,
		name : "Composite plating (Prof)",
		source : [["WGtE", 69], ["UA:RoE", 9]],
		type : "medium",
		ac : 13,
		addMod : true,
		dex : 2
	}, {
		regExpSearch : /^(?=.*heavy)(?=.*plating).*$/i,
		name : "Heavy plating (Prof)",
		source : [["WGtE", 69], ["UA:RoE", 9]],
		type : "heavy",
		ac : 16,
		addMod : true,
		stealthdis : true
	}]
};

// Elf Variants
if (RaceList["wood elf"]) {
	AddRacialVariant("wood elf", "aereni", {
		regExpSearch : /aereni/i,
		name : "Aereni wood elf",
		source : ["WGtE", 73],
		plural : "Aereni wood elves",
		weaponProfs : "",
		skillstxt : "Proficiency and expertise with any one skill or tool",
		trait : "Aereni " + RaceList["wood elf"].trait
	});
	AddRacialVariant("wood elf", "valenar", {
		regExpSearch : /valenar/i,
		name : "Valenar wood elf",
		source : ["WGtE", 73],
		plural : "Valenar wood elves",
		weaponProfs : [false, false, ["scimitar", "double-bladed scimitar", "longbow", "shortbow"]],
		trait : "Valenar " + RaceList["wood elf"].trait
	});
}
AddRacialVariant("high elf", "aereni", {
	regExpSearch : /aereni/i,
	name : "Aereni high elf",
	source : ["WGtE", 73],
	plural : "Aereni high elves",
	weaponProfs : "",
	skillstxt : "Proficiency and expertise with any one skill or tool",
	trait : "Aereni " + RaceList["high elf"].trait
});
AddRacialVariant("high elf", "valenar", {
	regExpSearch : /valenar/i,
	name : "Valenar high elf",
	source : ["WGtE", 73],
	plural : "Valenar high elves",
	weaponProfs : [false, false, ["scimitar", "double-bladed scimitar", "longbow", "shortbow"]],
	trait : "Valenar " + RaceList["high elf"].trait
});

// Double bladed scimitar
WeaponsList["double-bladed scimitar"] = {
	regExpSearch : /^(?=.*double)(?=.*scimitar).*$/i,
	name : "Double-bladed scimitar",
	source : ["WGtE", 74],
	list : "melee",
	ability : 1,
	type : "Martial",
	damage : [2, 4, "slashing"],
	range : "Melee",
	weight : 6,
	description : "Two-handed; With Attack action, one attack as bonus action for 1d4",
	abilitytodamage : true
};

// Revenant blade feat
FeatsList["revenant blade"] = {
	name : "Revenant Blade",
	source : ["WGtE", 74],
	prerequisite : "Being an Elf",
	prereqeval : function(v) { return (/^(?!.*half)(?=.*(elf|eladrin|avariel|grugach|shadar-kai)).*$/i).test(CurrentRace.known); },
	descriptionFull : "You are descended from a master of the double blade and their skills have passed on to you. You gain the following benefits:\n \u2022 While wielding a double-bladed weapon with two hands, the weapon has the finesse trait for your attacks with it, and you gain +1 AC.\n \u2022 On your turn, when you use a bonus action to make a melee attack with the blade at the opposite end of the weapon, the weapon's damage die for this attack increases to 2d4, instead of 1d4.",
	description : "As a bonus action with the Attack action, I can make an extra with a double-bladed weapon for 2d4 slashing damage. I treat double-bladed weapons as having the finesse trait. +1 AC while wielding a double-bladed weapon with two hands. [+1 Strength or Dexterity]",
	scorestxt : "+1 Strength or Dexterity",
	action : ["bonus action", " (with Attack action)"],
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (v.baseWeaponName == 'double-bladed scimitar' && fields.Proficiency) {
					fields.Description = fields.Description.replace('Two-handed; With Attack action, one attack as bonus action for 1d4', 'Finesse, two-handed; With Attack action, one attack as bonus action');
					fields.Mod = v.StrDex;
				};
			},
			"Double-bladed weapons count as having finesse for me and I can make an extra attack with them as a bonus action when taking the Attack action."
		]
	},
	extraAC : {
		mod : 1,
		text : "I gain a +1 bonus to AC while I'm wielding a double-bladed weapon in two hands.",
		stopeval : function (v) { return v.usingShield && !(/animated/i).test(What("AC Shield Bonus Description")); }
	}
};

// Creature
CreatureList["clawfoot raptor"] = {
	name : "Clawfoot Raptor",
	source : ["WGtE", 81],
	size : 3,
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 14,
	hp : 16,
	hd : [3, 8],
	speed : "50 ft",
	scores : [17, 17, 13, 2, 12, 10],
	saves : ["", "", "", "", "", ""],
	skills : {
		"athletics" : 5,
		"perception" : 5,
		"stealth" : 5
	},
	senses : "",
	passivePerception : 15,
	languages : "",
	challengeRating : "1/2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Claw",
		ability : 1,
		damage : [2, 6, "slashing"],
		range : "Melee (5 ft)",
		description : "If used after moving 30 ft straight in the same round, see Pounce trait"
	}, {
		name : "Bite",
		ability : 1,
		damage : [2, 4, "piercing"],
		range : "Melee (5 ft)",
		description : "Can be used in combination with claw while pouncing (see Pounce trait)"
	}],
	traits : [{
		name : "Pounce",
		description : "If the clawfoot moves at least 30 ft straight toward a creature and then hits it with a claw attack on the same turn, that target must succeed on a DC 13 Strength saving throw or be knocked prone. If the target is prone, the clawfoot can make one bite attack against it as a bonus action."
	}]
};

// House Agent backgrounds
BackgroundList["house agent"] = { // the default is House Cannith
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*(noble|cannith)).*$/i,
	name : "Agent of House Cannith",
	source : ["WGtE", 94],
	skills : ["Investigation", "Persuasion"],
	gold : 20,
	equipright : [
		["Fine clothes", "", 6],
		["Signet ring of house Cannith", "", ""],
		["ID papers", "", ""],
		["Purse (with coins)", "", 1]
	],
	feature : "House Connections",
	trait : [
		"I never let emotion complicate work.",
		"I'm always looking to improve efficiency.",
		"I share trivia about my house's business (medicine, ships, warforged).",
		"I hold myself and anyone I work with to extremely high standards.",
		"I never forget an insult made against myself or my house.",
		"I'm very excited and enthusiastic about everything my house does.",
		"I'm representing my house and take great pride in my personal appearance.",
		"I'm critical of monarchies and opposed to any restrictions on the houses."
	],
	ideal : [
		["Common Good",
			"Common Good: My house serves a vital function, and its properity will help everyone. (Good)"
		],
		["Tradition",
			"Tradition: I uphold traditions of my house and bring honor to my family. (Lawful)"
		],
		["Innovation",
			"Innovation: Abondon old traditions and find better ways to do things. (Chaotic)"
		],
		["Power",
			"Power: I want to ensure the prosperity of my house and wield its power myself. (Evil)"
		],
		["Discovery",
			"Discovery: I want to learn all I can, both for my house and for my own curiosity. (Any)"
		],
		["Comfort",
			"Comfort: I want to ensure that me and friends of mine enjoy the best things in life. (Any)"
		]
	],
	bond : [
		"My house is my family, and I would do anything for my family.",
		"I love someone from another house, but such relationships are forbidden.",
		"Someone I love was killed by a rival faction within my house, and I will have revenge.",
		"I don't care about the house as a whole, but I would do anything for my old mentor.",
		"I believe my house needs to evolve to survive, and I need to lead that change.",
		"I am determined to impress the leaders of my house, and to become a leader myself."
	],
	flaw : [
		"I'm overly concerned with following established procedures and protocols.",
		"I'm obsessed with conspiracy theories and worried about secret societies and hidden demons.",
		"I believe that my house and bloodline makes me better than everyone else.",
		"I'm concealing a secret that could get me driven from my house.",
		"I have strong religious beliefs that aren't shared by others in my house.",
		"I'm working for a hidden faction in my house that gives me secret assignments."
	],
	extra : [
		"Select an House Agent Role",
		"Acquisition",
		"Investigation",
		"Research \u0026 Development",
		"Security",
		"Intimidation",
		"Exploration",
		"Negotiation",
		"Covert Operations"
	],
	toolProfs : ["Alchemist's supplies", "Tinker's tools"]
};
AddBackgroundVariant("house agent", "deneith", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*deneith).*$/i,
	name : "Agent of House Deneith",
	source : ["WGtE", 94],
	toolProfs : [["Gaming set", 1], "Vehicles (land)"]
});
AddBackgroundVariant("house agent", "ghallanda", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*ghallanda).*$/i,
	name : "Agent of House Ghallanda",
	source : ["WGtE", 94],
	toolProfs : ["Brewer's supplies", "Cook's utensils"]
});
AddBackgroundVariant("house agent", "jorasco", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*jorasco).*$/i,
	name : "Agent of House Jorasco",
	source : ["WGtE", 94],
	toolProfs : ["Alchemist's supplies", "Herbalism kit"]
});
AddBackgroundVariant("house agent", "kundarak", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*kundarak).*$/i,
	name : "Agent of House Kundarak",
	source : ["WGtE", 94],
	toolProfs : [["Thieves' tools", "Dex"], "Tinker's tools"]
});
AddBackgroundVariant("house agent", "lyrandar", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*lyrandar).*$/i,
	name : "Agent of House Lyrandar",
	source : ["WGtE", 94],
	toolProfs : ["Navigator's tools", "Vehicles (sea/air)"]
});
AddBackgroundVariant("house agent", "medani", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*medani).*$/i,
	name : "Agent of House Medani",
	source : ["WGtE", 94],
	toolProfs : ["Disguise kit", ["Thieves' tools", "Dex"]]
});
AddBackgroundVariant("house agent", "orien", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*orien).*$/i,
	name : "Agent of House Orien",
	source : ["WGtE", 94],
	toolProfs : [["Gaming set", 1], "Vehicles (land)"]
});
AddBackgroundVariant("house agent", "phiarlan", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*phiarlan).*$/i,
	name : "Agent of House Phiarlan",
	source : ["WGtE", 94],
	toolProfs : ["Disguise kit", ["Musical instrument", 1]]
});
AddBackgroundVariant("house agent", "sivis", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*sivis).*$/i,
	name : "Agent of House Sivis",
	source : ["WGtE", 94],
	toolProfs : ["Calligrapher's tools", "Forgery kit"]
});
AddBackgroundVariant("house agent", "tharashk", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*tharashk).*$/i,
	name : "Agent of House Tharashk",
	source : ["WGtE", 94],
	toolProfs : [["Gaming set", 1], ["Thieves' tools", "Dex"]]
});
AddBackgroundVariant("house agent", "thuranni", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*thuranni).*$/i,
	name : "Agent of House Thuranni",
	source : ["WGtE", 94],
	toolProfs : [["Musical instrument", 1], "Poisoner's kit"]
});
AddBackgroundVariant("house agent", "vadalis", {
	regExpSearch : /^(?=.*agent)(?=.*house)(?=.*vadalis).*$/i,
	name : "Agent of House Vadalis",
	source : ["WGtE", 94],
	toolProfs : ["Herbalism kit", "Vehicles (land)"]
});
BackgroundFeatureList["house connections"] = {
	description : "As an agent of my house, I can always get food and lodging for my friends at a house enclave. My house usually provides me with necessary supplies and transportation if it assigns me a mission. I have many old friends, mentors, and rivals in my house that I might run into and be willing to help me depending on my current standing in the house.",
	source : ["WGtE", 95]
};

// Dragonmarks subraces
RaceList["dragonmark detection half-elf"] = {
	regExpSearch : /^((?=.*mark)(?=.*detection)|(?=.*house)(?=.*medani)).*$/i,
	name : "Half-elf (dragonmark)",
	sortname : "Dragonmark, Detection (Half-Elf)",
	source : [["WGtE", 96], ["UA:D", 2]],
	plural : "Half-elves (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Elvish"],
	vision : [["Darkvision", 60]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	age : " reach adulthood around age 20 and often live over 180 years",
	height : " range from 5 to 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scorestxt : "+1 Intelligence, +1 Charisma, and +1 to any one ability score of my choice",
	scores : [0, 0, 0, 1, 0, 1],
	trait : "Half-Elf, Dragonmark of Detection (+1 Intelligence, +1 Charisma, and +1 to any one ability score of my choice)\n" + (typePF ? "\n" : "   ") + "Deductive Intuition: I can add my Intuition Die (1d4) to my Intelligence (Investigation) and Wisdom (Insight) checks.\n" + (typePF ? "\n" : "   ") + "Sense Threats: I can cast Detect Magic and Detect Poison and Disease as rituals using Intelligence as my spellcasting ability.",
	spellcastingAbility : 4,
	spellcastingBonus : {
		name : "Sense Threats",
		spells : ["detect magic", "detect poison and disease"],
		selection : ["detect magic", "detect poison and disease"],
		firstCol : "(R)",
		times : 2
	},
	spellChanges : {
		"detect magic" : {
			time : "10 min",
			changes : "I can cast this spell only as a ritual, thus its casting time is 10 minutes longer."
		},
		"detect poison and disease" : {
			time : "10 min",
			changes : "I can cast this spell only as a ritual, thus its casting time is 10 minutes longer."
		}
	}
};
RaceList["dragonmark finding half-orc"] = {
	regExpSearch : /^(?=.*half)(?=.*\bor(c|k))((?=.*mark)(?=.*finding)|(?=.*house)(?=.*tharashk)).*$/i,
	name : "Half-orc (dragonmark)",
	sortname : "Dragonmark, Finding (Half-Orc)",
	source : [["WGtE", 97], ["UA:D", 2]],
	plural : "Half-orcs (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Orc"],
	vision : [["Darkvision", 60]],
	age : " reach adulthood around age 14 and rarely live longer than 75 years",
	height : " range from 5 to well over 6 feet tall (4'10\" + 2d10\")",
	weight : " weigh around 215 lb (140 + 2d10 \xD7 2d6 lb)",
	heightMetric : " range from 1,5 to well over 1,8 metres tall (150 + 5d10 cm)",
	weightMetric : " weigh around 100 kg (65 + 5d10 \xD7 4d6 / 10 kg)",
	scorestxt : "+1 Strength, +1 Wisdom, and +1 to any one ability score of my choice",
	scores : [1, 0, 0, 0, 1, 0],
	trait : "Half-Orc, Dragonmark of Finding (+1 Str" + (typePF ? ", +1 Wis, +1 to one ability" : "ength, +1 Wisdom, +1 to any one ability score") + ")\n   Hunter's Intuition: I add my Intuition Die (1d4) to my Perception and Survival checks.\n   Imprint Prey: As a bonus action once per short rest, I imprint a target I can see in 30 ft or with a Survival check when tracking it, lasting until it dies or I use this again. I double my Intuition Die for tracking it, sense its general location in 60 ft, my attacks vs. it ignore half cover and don't have disadv. if I can't see it, and it has no adv. vs. me if I can't see it.\n" + (typePF ? "Nature's Voice: cast Locate Animals/Plants as a ritual from 3rd level." : "   Nature's Voice: Once I reach 3rd level, I can cast Locate Animals or Plants as a ritual."),
	features : {
		"imprint prey" : {
			name : "Imprint Prey",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", ""]
		},
		"locate animals or plants" : {
			name : "Locate Animals or Plants",
			minlevel : 3,
			spellcastingBonus : {
				name : "Nature's Voice",
				spells : ["locate animals or plants"],
				selection : ["locate animals or plants"],
				firstCol : "(R)"
			},
			spellChanges : {
				"locate animals or plants" : {
					time : "10 min",
					changes : "I can cast this spell only as a ritual, thus its casting time is 10 minutes longer."
				}
			}
		}
	}
};
RaceList["dragonmark handling human"] = {
	regExpSearch : /^((?=.*mark)(?=.*handling)|(?=.*house)(?=.*vadalis)).*$/i,
	name : "Human (dragonmark)",
	sortname : "Dragonmark, Handling (Human)",
	source : [["WGtE", 98], ["UA:D", 3]],
	plural : "Humans (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", 1],
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scorestxt : "+1 Dexterity, +1 Wisdom, and +1 to any one ability score of my choice",
	scores : [0, 1, 0, 0, 1, 0],
	trait : "Human, Dragonmark of Handling (+1 Dex" + (typePF ? ", +1 Wis, +1 to one ability" : "terity, +1 Wisdom, +1 to any one ability score") + ")\n   Wild Intuition: I can add my Intuition Die (1d4) to my Wisdom (Animal Handling) and Intelligence (Nature) checks.\n   Expert Handling: I can use the Help action to aid an ally animal companion or mount even when they are within 30 ft of me, rather than just within 5 ft.\n   Primal Connection: Once per short rest, I can cast Animal Friendship using Wisdom " + (typePF ? "as my spellcasting ability" : "") + ".\n   " + (typePF ? "The Bigger They Are: My spells that normally affect only beasts now also affect monstrosities with an Intelligence of 3 or lower." : "Bigger They Are: My spells that affect only beasts, also affect monstrosities with Int < 4."),
	spellcastingAbility : 5,
	features : {
		"animal friendship" : {
			name : "Primal Connection",
			limfeaname : "Animal Friendship",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			spellcastingBonus : {
				name : "Primal Connection",
				spells : ["animal friendship"],
				selection : ["animal friendship"],
				firstCol : 'oncesr'
			}
		}
	},
	calcChanges : {
		spellAdd : [
			function (spellKey, spellObj, spName) {
				switch (spellKey) {
					case "animal friendship" :
						spellObj.description = spellObj.description.replace("beasts", "beasts/monstrosities");
						return true;
					case "beast bond" :
						spellObj.description = "Telepathic link with 1 beast/monstrosity Int<4 while in sight; it has adv. on atks vs. crea I can see";
						return true;
					case "beast sense" :
						spellObj.description = "Use senses of 1 willing monstrosity Int<4 or beast; I'm blinded and deafened while doing so";
						return true;
					case "dominate beast" :
						spellObj.description = "1 monstrosity Int<4 or beast save or charmed, follows telepathic commands, 1 a for complete control";
						return true;
					case "speak with animals" :
						spellObj.description = "Communicate verbally with monstrosities Int<4 or beasts for duration; interactions limited by their Int";
						return true;
				}
			},
			"Spells I cast that only affect beasts can also affect monstrosities with an Intelligence score of 3 or lower."
		]
	}
};
RaceList["dragonmark healing halfling"] = {
	regExpSearch : /^((?=.*mark)(?=.*healing)|(?=.*house)(?=.*jorasco)).*$/i,
	name : "Halfling (dragonmark)",
	sortname : "Dragonmark, Healing (Halfling)",
	source : [["WGtE", 99], ["UA:D", 3]],
	plural : "Halflings (dragonmark)",
	size : 4,
	speed : {
		walk : { spd : 25, enc : 15 }
	},
	languageProfs : ["Common", "Halfling"],
	savetxt : { adv_vs : ["frightened"] },
	age : " reach adulthood at age 20 and live around 150 years",
	height : " average about 3 feet tall (2'7\" + 2d4\")",
	weight : " weigh around 40 lb (35 + 2d4 lb)",
	heightMetric : " average about 90 cm tall (80 + 5d4)",
	weightMetric : " weigh around 18 kg (16 + 5d4 / 10 kg)",
	scores : [0, 2, 0, 0, 1, 0],
	trait : "Halfling, Dragonmark of Healing (+2 Dexterity, +1 Wisdom)" + (typePF ? "\n  " : "") +
		" Lucky: When I roll a 1 on an attack roll, ability check, or saving throw, I can reroll the die and must use the new roll." + desc([
		"Halfling Nimbleness: I can move through the space of Medium and larger creatures.",
		"Medical Intuition: I " + (typePF ? "" : "can") + " add my Intuition Die (1d4) to " + (typePF ? "Medicine" : "my Wisdom (Medicine)") + " checks.",
		"Healing Touch: As an action once per short rest, I can spend one of my Hit Dice to heal myself or a creature I touch. I heal the roll of the die plus my Wisdom modifier.",
		"Jorasco's Blessing: I know the Spare the Dying cantrip."
	]),
	features : {
		"healing touch" : {
			name : "Healing Touch",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["action", ""]
		}
	},
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Jorasco's Blessing",
		spells : ["spare the dying"],
		selection : ["spare the dying"],
		firstCol : 'atwill'
	}
};
RaceList["dragonmark hospitality halfling"] = {
	regExpSearch : /^((?=.*mark)(?=.*hospitality)|(?=.*house)(?=.*ghallanda)).*$/i,
	name : "Halfling (dragonmark)",
	sortname : "Dragonmark, Hospitality (Halfling)",
	source : [["WGtE", 100], ["UA:D", 4]],
	plural : "Halflings (dragonmark)",
	size : 4,
	speed : {
		walk : { spd : 25, enc : 15 }
	},
	languageProfs : ["Common", "Halfling"],
	savetxt : { adv_vs : ["frightened"] },
	age : " reach adulthood at age 20 and live around 150 years",
	height : " average about 3 feet tall (2'7\" + 2d4\")",
	weight : " weigh around 40 lb (35 + 2d4 lb)",
	heightMetric : " average about 90 cm tall (80 + 5d4)",
	weightMetric : " weigh around 18 kg (16 + 5d4 / 10 kg)",
	scores : [0, 2, 0, 0, 0, 1],
	trait : "Halfling, Dragonmark of Hospitality (+2 Dexterity, +1 Charisma)\nLucky: When I roll a 1 on an attack roll, ability check, or saving throw, I can reroll the die and must use the new roll.\nHalfling Nimbleness: I can move through the space of Medium and larger creatures.\nEver Hospitable: I can add my Intuition Die (1d4) to my Charisma (Persuasion) checks and ability checks involving brewer's supplies or cook's utensils.\nInnkeeper's Charms: I know Friends and Prestidigitation with Cha as my spellcasting ability.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Innkeeper's Charms",
		spells : ["friends", "prestidigitation"],
		selection : ["friends", "prestidigitation"],
		firstCol : 'atwill',
		times : 2
	}
};
RaceList["dragonmark making human"] = {
	regExpSearch : /^((?=.*mark)(?=.*making)|(?=.*house)(?=.*cannith)).*$/i,
	name : "Human (dragonmark)",
	sortname : "Dragonmark, Making (Human)",
	source : [["WGtE", 101], ["UA:D", 4]],
	plural : "Humans (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", 1],
	toolProfs : [["Artisan's tools", 1]],
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scorestxt : "+1 Dexterity, +1 Intelligence, and another +1 to either Dexterity or Intelligence",
	scores : [0, 1, 0, 1, 0, 0],
	trait : "Human, Dragonmark of Making (+1 Dex" + (typePF ? ", +2 Int or +2 Dex, +1 Int" : "terity, +1 Intelligence, +1 to Dex or Int, my choice") + ")\nArtisan's Intuition: I can add my Intuition Die (1d4) to ability checks with artisan's tools.\nMagecraft: I can create a magic item that gives me the ability to cast one wizard cantrip of my choice, using Intelligence as my spellcasting ability. This works while the item is in my possession. At the end of a long rest, I can replace it with a new item and cantrip.\nSpellsmith: Once per long rest, I can spend 1 minute to make a nonmagical armor or weapon gain a +1 bonus for the next hour. Maker's Gift: I know the mending cantrip.",
	features : {
		"spellsmith" : {
			name : "Spellsmith",
			minlevel : 1,
			usages : 1,
			recovery : "long rest"
		}
	},
	eval : function () {
		CurrentSpells['dragonmark making human'] = {
			name : 'Human (dragonmark)',
			ability : 4,
			list : { 'class' : 'wizard', level : [0, 0] },
			known : { cantrips : 1, spells : 'list' },
			bonus : {
				bonus1 : {
					name : "Maker's Gift",
					spells : ['mending'],
					selection : ['mending'],
					firstCol : 'atwill'
				}
			},
			typeList : 2,
			refType : "race"
		};
		SetStringifieds('spells'); CurrentUpdates.types.push('spells');
	},
	removeeval : function () {
		delete CurrentSpells['dragonmark making human'];
		SetStringifieds('spells'); CurrentUpdates.types.push('spells');
	}
};
RaceList["dragonmark passage human"] = {
	regExpSearch : /^((?=.*mark)(?=.*passage)|(?=.*house)(?=.*orien)).*$/i,
	name : "Human (dragonmark)",
	sortname : "Dragonmark, Passage (Human)",
	source : ["WGtE", 102],
	plural : "Humans (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 40, enc : 30 }
	},
	languageProfs : ["Common", 1],
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scorestxt : "+2 Dexterity and +1 to another ability score of my choice",
	scores : [0, 2, 0, 0, 0, 0],
	trait : "Human, Dragonmark of Passage (+2 Dexterity and +1 to another ability score)\n   Intuitive Motion: I can add my Intuition Die (1d4) to my Strength (Athletics) checks and any ability checks involving operating or maintaining a land vehicle.\n   Determined Stride: When I use the Dash action, difficult terrain doesn't cost me extra movement for that turn.\n   Shared Passage: As a bonus action once per long rest, I can teleport myself and a willing ally within 5 ft a distance up to my walking speed to an unoccupied space I can see.",
	features : {
		"shared passage" : {
			name : "Shared Passage",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			action : ["bonus action", ""]
		}
	}
};
RaceList["dragonmark scribing gnome"] = {
	regExpSearch : /^((?=.*mark)(?=.*scribing)|(?=.*house)(?=.*sivis)).*$/i,
	name : "Gnome (dragonmark)",
	sortname : "Dragonmark, Scribing (Gnome)",
	source : [["WGtE", 103], ["UA:D", 5]],
	plural : "Gnomes (dragonmark)",
	size : 4,
	speed : {
		walk : { spd : 25, enc : 15 }
	},
	languageProfs : ["Common", "Gnomish", 1],
	toolProfs : ["Calligrapher's supplies", "Forgery kits"],
	vision : [["Darkvision", 60]],
	savetxt : { text : ["Adv. on Int/Wis/Cha saves vs. magic"] },
	age : " start adult life around age 40 and can live 350 to almost 500 years",
	height : " are 3 to 4 feet tall (2'11\" + 2d4\")",
	weight : " weigh around 40 lb (35 + 2d4 lb)",
	heightMetric : " are 90 to 120 cm tall (2'11\" + 5d4)",
	weightMetric : " weigh around 18 kg (16 + 5d4 / 10 kg)",
	scores : [0, 0, 0, 2, 0, 1],
	trait : "Gnome, Dragonmark of Scribing (+2 Intelligence, +1 Charisma)\n   Gifted Scribe: I can add my Intuition Die (1d4) to ability checks involving calligrapher's supplies or forgery kits. I am proficient with both of these tools.\n   Whispering Wind: I know the Message cantrip.\n   Scribe's Insight: I can cast Comprehend Languages once per long rest.\nIntelligence is my spellcasting ability for the spells gained from being a gnome, dragonmark of scribing.",
	spellcastingAbility : 4,
	spellcastingBonus : {
		name : "Whispering Wind",
		spells : ["message"],
		selection : ["message"],
		firstCol : 'atwill'
	},
	features : {
		"comprehend languages" : {
			name : "Scribe's Insight",
			limfeaname : "Comprehend Languages",
			minlevel : 1,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Scribe's Insight",
				spells : ["comprehend languages"],
				selection : ["comprehend languages"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["dragonmark sentinel human"] = {
	regExpSearch : /^((?=.*mark)(?=.*sentinel)|(?=.*house)(?=.*deneith)).*$/i,
	name : "Human (dragonmark)",
	sortname : "Dragonmark, Sentinel (Human)",
	source : [["WGtE", 104], ["UA:D", 5]],
	plural : "Humans (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", 1],
	age : " reach adulthood in their late teens and live less than 100 years",
	height : " range from barely 5 to well over 6 feet tall (4'8\" + 2d10\")",
	weight : " weigh around 165 lb (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " range from barely 1,5 to well over 1,8 metres tall (145 + 5d10 cm)",
	weightMetric : " weigh around 75 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scorestxt : "+1 Strength, +1 Wisdom, and +1 to any one ability score of my choice",
	scores : [1, 0, 0, 0, 1, 0],
	trait : "Human, Dragonmark of Sentinel (+1 Str" + (typePF ? ", +1 Wis, +1 to one ability" : "ength, +1 Wisdom, +1 to any one ability score") + ")\n   Sentinel's Intuition: I can add my Intuition Die (1d4) to Initiative rolls and my Wisdom (Perception) checks.\n   Sentinel's Shield: I know the Blade Ward cantrip. I can cast Shield once per short rest.\n   Vigilant Guardian: As an action, I can designate an ally as my ward, gaining adv. on Insight and Perception checks to spot threats to it. As a reaction when I see my ward being attacked while within 5 ft, I can swap places with it, becoming the target of the attack.",
	action : [['action', 'Vigilant Guardian (designate ward)'], ['reaction', 'Vigilant Guardian (swap with ward)']],
	features : {
		"shield" : {
			name : "Sentinel's Shield",
			limfeaname : "Shield",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["reaction", ""],
			spellcastingBonus : [{
				name : "Sentinel's Shield",
				spells : ["blade ward"],
				selection : ["blade ward"],
				firstCol : 'atwill'
			}, {
				name : "Sentinel's Shield",
				spells : ["shield"],
				selection : ["shield"],
				firstCol : 'oncesr'
			}]
		}
	}
};
RaceList["dragonmark shadow elf"] = {
	regExpSearch : /^((?=.*mark)(?=.*shadow)|(?=.*house)(?=.*(phiarlan|thuranni))).*$/i,
	name : "Elf (dragonmark)",
	sortname : "Dragonmark, Shadow (Elf)",
	source : [["WGtE", 105], ["UA:D", 6]],
	plural : "Elves (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Elvish"],
	vision : [["Darkvision", 60]],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	skills : ["Perception"],
	skillstxt : "Perception and proficiency with either Performance or one musical instrument",
	age : " typically claim adulthood around age 100 and can live to be 750 years old",
	height : " range from under 5 to over 6 feet tall (4'6\" + 2d10\")",
	weight : " weigh around 115 lb (90 + 2d10 \xD7 1d4 lb)",
	heightMetric : " range from under 1,5 to over 1,8 metres tall (140 + 5d10 cm)",
	weightMetric : " weigh around 55 kg (40 + 5d10 \xD7 2d4 / 10 kg)",
	scores : [0, 2, 0, 0, 0, 1],
	trait : "Elf, Dragonmark of Shadow (+2 Dexterity, +1 Charisma)\nTrance: Elves don't need to sleep, but meditate semiconsciously, for 4 hours a day. This gives the same benefit as a human gets from 8 hours of sleep (long rest takes only 4 hours).\nGift of the Shadows: I can add my Intuition Die (1d4) to Performance and Stealth checks.\nShape Shadows: I know the Minor Illusion cantrip using Charisma as my spellcasting ability.\nSlip Into Shadow: As a bonus action once per short rest, I can use the Hide action even while I have no cover or if I'm being observed.",
	spellcastingAbility : 6,
	spellcastingBonus : {
		name : "Shape Shadows",
		spells : ["minor illusion"],
		selection : ["minor illusion"],
		firstCol : 'atwill'
	},
	features : {
		"slip into shadow" : {
			name : "Slip Into Shadow",
			minlevel : 1,
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", ""]
		}
	}
};
AddRacialVariant("dragonmark shadow elf", "performance, ", {
	regExpSearch : /performance/i,
	source : [["WGtE", 105], ["UA:D", 6]],
	skills : ["Perception", "Performance"],
	skillstxt : ""
});
AddRacialVariant("dragonmark shadow elf", "musical instrument, ", {
	regExpSearch : /musical instrument/i,
	source : [["WGtE", 105], ["UA:D", 6]],
	skillstxt : "",
	toolProfs : [["Musical instrument", 1]]
});
RaceList["dragonmark storm half-elf"] = {
	regExpSearch : /^((?=.*mark)(?=.*storm)|(?=.*house)(?=.*lyrandar)).*$/i,
	name : "Half-elf (dragonmark)",
	sortname : "Dragonmark, Storm (Half-Elf)",
	source : [["WGtE", 106], ["UA:D", 6]],
	plural : "Half-elves (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Elvish"],
	vision : [["Darkvision", 60]],
	dmgres : ["Lightning"],
	savetxt : {
		text : ["Magic can't put me to sleep"],
		adv_vs : ["charmed"]
	},
	age : " reach adulthood around age 20 and often live over 180 years",
	height : " range from 5 to 6 feet tall (4'9\" + 2d8\")",
	weight : " weigh around 155 lb (110 + 2d8 \xD7 2d4 lb)",
	heightMetric : " range from 1,5 to 1,8 metres tall (145 + 5d8 cm)",
	weightMetric : " weigh around 70 kg (50 + 5d8 \xD7 4d4 / 10 kg)",
	scorestxt : "+1 Dexterity, +1 Charisma, and +1 to any one ability score of my choice",
	scores : [0, 1, 0, 0, 0, 1],
	trait : "Half-Elf, Dragonmark of Storm (+1 Dexterity, +1 Charisma, and +1 to any one ability score of my choice)\n" + (typePF ? "\n" : "   ") + "Windwright's Intuition: I can add my Intuition Die (1d4) to my Dexterity (Acrobatics) checks and any ability checks involving operating or maintaining a water or air vehicle.\n" + (typePF ? "\n" : "   ") + "Headwinds: I know the Gust cantrip. Once I reach 3rd level, I can cast Gust of Wind once per long rest. Charisma is my spellcasting ability for these spells.",
	spellcastingAbility : 6, // Not mentioned in WGtE, but essential!
	spellcastingBonus : {
		name : "Headwinds (level 1)",
		spells : ["gust"],
		selection : ["gust"],
		firstCol : 'atwill'
	},
	features : {
		"gust of wind" : {
			name : "Headwinds (level 3)",
			limfeaname : "Gust of Wind",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Headwinds (level 3)",
				spells : ["gust of wind"],
				selection : ["gust of wind"],
				firstCol : 'oncelr'
			}
		}
	}
};
RaceList["dragonmark warding dwarf"] = {
	regExpSearch : /^((?=.*mark)(?=.*warding)|(?=.*house)(?=.*kundarak)).*$/i,
	name : "Dwarf (dragonmark)",
	sortname : "Dragonmark, Warding (Dwarf)",
	source : [["WGtE", 108], ["UA:D", 7]],
	plural : "Dwarves (dragonmark)",
	size : 3,
	speed : {
		walk : { spd : 25, enc : 25 }
	},
	languageProfs : ["Common", "Dwarvish"],
	vision : [["Darkvision", 60]],
	savetxt : { adv_vs : ["poison"] },
	dmgres : ["Poison"],
	weaponProfs : [false, false, ["battleaxe", "handaxe", "warhammer", "light hammer"]],
	toolProfs : [["Smith, brewer, or mason tools", 1]],
	age : " are considered young until they are 50 and live about 350 years",
	height : " stand between 4 and 5 feet tall (4' + 2d4\")",
	weight : " weigh around 150 lb (130 + 2d4 \xD7 2d6 lb)",
	heightMetric : " stand between 1,2 and 1,5 metres tall (120 + 5d4 cm)",
	weightMetric : " weigh around 75 kg (60 + 5d4 \xD7 4d6 / 10 kg)",
	scores : [0, 1, 2, 1, 0, 0],
	trait : "Dwarf, Dragonmark of Warding (+1 Dex" + (typePF ? ", +2 Con, +1 Int" : "terity, +2 Constitution, +1 Intelligence") + ")\n   Stonecunning: When I make an Intelligence (History) check related to the origin of stonework, I am considered having expertise in the History skill.\n   Master of Locks: I can add my Intuition Die (1d4) to Intelligence (History), Intelligence (Investigation), and ability checks with thieves' tools, if it involves lock or trap mechanisms.\n   Wards and Seals: I can cast Alarm as a ritual. Once I reach 3rd level, I can cast Arcane Lock once per long rest. Intelligence is my spellcasting ability for these.",
	spellcastingAbility : 4,
	spellcastingBonus : {
		name : "Wards and Seals (level 1)",
		spells : ["alarm"],
		selection : ["alarm"],
		firstCol : "(R)"
	},
	spellChanges : {
		"alarm" : {
			time : "11 min",
			changes : "I can cast this spell only as a ritual, thus its casting time is 10 minutes longer."
		}
	},
	features : {
		"arcane lock" : {
			name : "Wards and Seals (level 3)",
			limfeaname : "Arcane Lock",
			minlevel : 3,
			usages : 1,
			recovery : "long rest",
			spellcastingBonus : {
				name : "Wards and Seals (level 3)",
				spells : ["arcane lock"],
				selection : ["arcane lock"],
				firstCol : 'oncelr'
			}
		}
	}
};

// Gust cantrip reprint
if (!SpellsList["gust"]) {
	SpellsList["gust"] = {
		name : "Gust",
		classes : ["druid", "sorcerer", "wizard"],
		source : [["WGtE", 107], ["X", 157], ["E", 19], ["UA:D", 6]],
		level : 0,
		school : "Trans",
		time : "1 a",
		range : "30 ft",
		components : "V,S",
		duration : "Instantaneous",
		save : "Str",
		description : "Med. or smaller crea save or push 5 ft; or push unattended 5 lb obj 10 ft; or harmless sensory effect",
		descriptionFull : "You seize the air and compel it to create one of the following effects at a point you can see within range." + "\n " + "\u2022 One Medium or smaller creature that you choose must succeed on a Strength saving throw or be pushed up to 5 feet away from you." + "\n " + "\u2022 You create a small blast of air capable of moving one object that is neither held nor carried and that weighs no more than 5 pounds. The object is pushed up to 10 feet away from you. It isn't pushed with enough force to cause damage." + "\n " + "\u2022 You create a harmless sensory affect using air, such as causing leaves to rustle, wind to slam shutters shut, or your clothing to ripple in a breeze."
	};
}

// Greater Dragonmark feats
FeatsList["greater dragonmark"] = {
	name : "Greater Dragonmark",
	source : [["WGtE", 110], ["UA:D", 7]],
	descriptionFull : "Your dragonmark has grown in size and power. This enhances your existing dragonmark, and the benefits are based on the mark that you already possess. A greater dragonmark provides the following benefits:\n \u2022 Increase one ability score by 1, to a maximum of 20. The abilities available to you are based on your mark, as shown on the Greater Dragonmark Benefits table.\n \u2022 The die type of your dragonmarked Intuition Die increases by one (for example, from a d4 to a d6).\n \u2022 You learn a set of spells, each of which you can cast once without expending a spell slot or using a material component. The list of spells, the spellcasting ability for them, and the type of rest you must complete to regain the use of these spells are shown on the Greater Dragonmark Benefits table.",
	description : "Select the type of greater dragonmark using the square button on this feat line.\nMy Intuition Die increases with one step (for example d4 to d6), I gain spellcating abilities, and an increase to one ability score.",
	eval : function () {
		var raceTrait = What('Racial Traits');
		if ((/my Intuition Die \(1d4\)/i).test(raceTrait)) {
			Value('Racial Traits', raceTrait.replace(/my Intuition Die \(1d4\)/i, 'my Intuition Die (1d6)'));
		};
	},
	removeeval : function () {
		var raceTrait = What('Racial Traits');
		if ((/my Intuition Die \(1d6\)/i).test(raceTrait)) {
			Value('Racial Traits', raceTrait.replace(/my Intuition Die \(1d6\)/i, 'my Intuition Die (1d4)'));
		};
	},
	choices : ["Detection", "Finding", "Handling", "Healing", "Hospitality", "Making", "Passage", "Scribing", "Sentinel", "Shadow", "Storm", "Warding"],
	"detection" : {
		prerequisite : "Being level 8 or higher and possessing the Dragonmark of Detection",
		prereqeval : function(v) { return v.characterLevel > 7 && (/^(?=.*dragonmark)(?=.*detection).*$/i).test(CurrentRace.known); },
		descriptionFull : "Your dragonmark has grown in size and power. This enhances your existing dragonmark, and the benefits are based on the mark that you already possess. A greater dragonmark provides the following benefits:\n \u2022 Increase your Charisma or Intelligence score by 1, to a maximum of 20.\n \u2022 The die type of your dragonmarked Intuition Die increases by one (for example, from a d4 to a d6).\n \u2022 You learn the spells See Invisibility and True Seeing, each of which you can cast once without expending a spell slot or using a material component. Intelligence is your spellcasting ability for these spells. Once you cast a spell using this feature, and you must finish a long rest before you can do so again.",
		description : "My Intuition Die increases with one step (d4 to d6, for example). I can cast See Invisibility and True Seeing each once per long rest without using spell slots or requiring material components. Intelligence is my spellcasting ability for these. [+1 Charisma or Intelligence]",
		scorestxt : "+1 Charisma or Intelligence",
		spellcastingBonus : {
			name : "1\u00D7 per long",
			spells : ["see invisibility", "true seeing"],
			selection : ["see invisibility", "true seeing"],
			spellcastingAbility : 4,
			firstCol : 'oncelr',
			times : 2
		},
		spellChanges : {
			"see invisibility" : {
				components : "V,S",
				compMaterial : "",
				changes : "Spells cast through my Greater Dragonmark don't require material components."
			},
			"true seeing" : {
				components : "V,S",
				compMaterial : "",
				description : "1 willing crea gains truesight 120 ft; see through illusions, hidden doors, ethereal plane",
				changes : "Spells cast through my Greater Dragonmark don't require material components."
			}
		}
	},
	"finding" : {
		prerequisite : "Being level 8 or higher and possessing the Dragonmark of Finding",
		prereqeval : function(v) { return v.characterLevel > 7 && (/^(?=.*dragonmark)(?=.*finding).*$/i).test(CurrentRace.known); },
		descriptionFull : "Your dragonmark has grown in size and power. This enhances your existing dragonmark, and the benefits are based on the mark that you already possess. A greater dragonmark provides the following benefits:\n \u2022 Increase your Dexterity, Strength, or Wisdom score by 1, to a maximum of 20.\n \u2022 The die type of your dragonmarked Intuition Die increases by one (for example, from a d4 to a d6).\n \u2022 You learn the spells Locate Creature and Find the Path, each of which you can cast once without expending a spell slot or using a material component. Wisdom is your spellcasting ability for these spells. Once you cast a spell using this feature, and you must finish a long rest before you can do so again.",
		description : "My Intuition Die increases with one step (d4 to d6, for example). I can cast Locate Creature and Find the Path each once per long rest without using spell slots or requiring material components. Wisdom is my spellcasting ability for these. [+1 " + (typePF ? "Strength, Dexterity, or Wisdom]" : "Str, Dex, or Wis]"),
		scorestxt : "+1 Strength, Dexterity, or Wisdom",
		spellcastingBonus : {
			name : "1\u00D7 per long",
			spells : ["locate creature", "find the path"],
			selection : ["locate creature", "find the path"],
			spellcastingAbility : 5,
			firstCol : 'oncelr',
			times : 2
		},
		spellChanges : {
			"locate creature" : {
				components : "V,S",
				compMaterial : "",
				changes : "Spells cast through my Greater Dragonmark don't require material components."
			},
			"find the path" : {
				components : "V,S",
				compMaterial : "",
				description : "Know the shortest route to a location I am familiar with and are on the same plane with",
				changes : "Spells cast through my Greater Dragonmark don't require material components."
			}
		}
	},
	"handling" : {
		prerequisite : "Being level 8 or higher and possessing the Dragonmark of Handling",
		prereqeval : function(v) { return v.characterLevel > 7 && (/^(?=.*dragonmark)(?=.*handling).*$/i).test(CurrentRace.known); },
		descriptionFull : "Your dragonmark has grown in size and power. This enhances your existing dragonmark, and the benefits are based on the mark that you already possess. A greater dragonmark provides the following benefits:\n \u2022 Increase your Dexterity or Wisdom score by 1, to a maximum of 20.\n \u2022 The die type of your dragonmarked Intuition Die increases by one (for example, from a d4 to a d6).\n \u2022 You learn the spells Beast Sense and Dominate Beast, each of which you can cast once without expending a spell slot or using a material component. Wisdom is your spellcasting ability for these spells. Once you cast a spell using this feature, and you must finish a long rest before you can do so again.",
		description : "My Intuition Die increases with one step (d4 to d6, for example). I can cast Beast Sense and Dominate Beast each once per long rest without using spell slots or requiring material components. Wisdom is my spellcasting ability for these. [+1 Dexterity or Wisdom]",
		scorestxt : "+1 Dexterity or Wisdom",
		spellcastingBonus : {
			name : "1\u00D7 per long",
			spells : ["beast sense", "dominate beast"],
			selection : ["beast sense", "dominate beast"],
			spellcastingAbility : 5,
			firstCol : 'oncelr',
			times : 2
		}
	},
	"healing" : {
		prerequisite : "Being level 8 or higher and possessing the Dragonmark of Healing",
		prereqeval : function(v) { return v.characterLevel > 7 && (/^(?=.*dragonmark)(?=.*healing).*$/i).test(CurrentRace.known); },
		descriptionFull : "Your dragonmark has grown in size and power. This enhances your existing dragonmark, and the benefits are based on the mark that you already possess. A greater dragonmark provides the following benefits:\n \u2022 Increase your Dexterity or Wisdom score by 1, to a maximum of 20.\n \u2022 The die type of your dragonmarked Intuition Die increases by one (for example, from a d4 to a d6).\n \u2022 You learn the spells Mass Healing Word and Greater Restoration, each of which you can cast once without expending a spell slot or using a material component. Wisdom is your spellcasting ability for these spells. Once you cast a spell using this feature, and you must finish a long rest before you can do so again.",
		description : "My Intuition Die increases with one step (d4 to d6, for example). I can cast Mass Healing Word and Greater Restoration each once per long rest without using spell slots or requiring material components. Wisdom is my spellcasting ability for these. [+1 Dexterity or Wisdom]",
		scorestxt : "+1 Dexterity or Wisdom",
		spellcastingBonus : {
			name : "1\u00D7 per long",
			spells : ["mass healing word", "greater restoration"],
			selection : ["mass healing word", "greater restoration"],
			spellcastingAbility : 5,
			firstCol : 'oncelr',
			times : 2
		},
		spellChanges : {
			"greater restoration" : {
				components : "V,S",
				compMaterial : "",
				description : "Reduce exhaustion or end charm, petrify, curse, stat or max HP reduction",
				changes : "Spells cast through my Greater Dragonmark don't require material components."
			}
		}
	},
	"hospitality" : {
		prerequisite : "Being level 8 or higher and possessing the Dragonmark of Hospitality",
		prereqeval : function(v) { return v.characterLevel > 7 && (/^(?=.*dragonmark)(?=.*hospitality).*$/i).test(CurrentRace.known); },
		descriptionFull : "Your dragonmark has grown in size and power. This enhances your existing dragonmark, and the benefits are based on the mark that you already possess. A greater dragonmark provides the following benefits:\n \u2022 Increase your Dexterity or Charisma score by 1, to a maximum of 20.\n \u2022 The die type of your dragonmarked Intuition Die increases by one (for example, from a d4 to a d6).\n \u2022 You learn the spells Sanctuary and Mordenkainen's Magnificent Mansion, each of which you can cast once without expending a spell slot or using a material component. Charisma is your spellcasting ability for these spells. Once you cast a spell using this feature, and you must finish a long rest before you can do so again.",
		description : "My Intuition Die increases with one step (d4 to d6, for example). I can cast Sanctuary and " + (typePF ? "Mordenkainen's " : "") + "Magnificent Mansion each once per long rest without using spell slots or requiring material components. Charisma is my spellcasting ability for these. [+1 Dexterity or Charisma]",
		scorestxt : "+1 Dexterity or Charisma",
		spellcastingBonus : {
			name : "1\u00D7 per long",
			spells : ["sanctuary", "mordenkainen's magnificent mansion"],
			selection : ["sanctuary", "mordenkainen's magnificent mansion"],
			spellcastingAbility : 6,
			firstCol : 'oncelr',
			times : 2
		},
		spellChanges : {
			"sanctuary" : {
				components : "V,S",
				compMaterial : "",
				changes : "Spells cast through my Greater Dragonmark don't require material components."
			},
			"mordenkainen's magnificent mansion" : {
				components : "V,S",
				compMaterial : "",
				description : "Create extradimensional mansion with rooms, food and servants to serve 100 people; see book",
				changes : "Spells cast through my Greater Dragonmark don't require material components."
			}
		}
	},
	"making" : {
		prerequisite : "Being level 8 or higher and possessing the Dragonmark of Making",
		prereqeval : function(v) { return v.characterLevel > 7 && (/^(?=.*dragonmark)(?=.*making).*$/i).test(CurrentRace.known); },
		descriptionFull : "Your dragonmark has grown in size and power. This enhances your existing dragonmark, and the benefits are based on the mark that you already possess. A greater dragonmark provides the following benefits:\n \u2022 Increase your Dexterity or Intelligence score by 1, to a maximum of 20.\n \u2022 The die type of your dragonmarked Intuition Die increases by one (for example, from a d4 to a d6).\n \u2022 You learn the spells Fabricate and Creation, each of which you can cast once without expending a spell slot or using a material component. Intelligence is your spellcasting ability for these spells. Once you cast a spell using this feature, and you must finish a long rest before you can do so again.",
		description : "My Intuition Die increases with one step (d4 to d6, for example). I can cast Fabricate and Creation each once per long rest without using spell slots or requiring material components. Intelligence is my spellcasting ability for these. [+1 Dexterity or Intelligence]",
		scorestxt : "+1 Dexterity or Intelligence",
		spellcastingBonus : {
			name : "1\u00D7 per long",
			spells : ["fabricate", "creation"],
			selection : ["fabricate", "creation"],
			spellcastingAbility : 4,
			firstCol : 'oncelr',
			times : 2
		},
		spellChanges : {
			"creation" : {
				components : "V,S",
				compMaterial : "",
				changes : "Spells cast through my Greater Dragonmark don't require material components."
			}
		}
	},
	"passage" : {
		prerequisite : "Being level 8 or higher and possessing the Dragonmark of Passage",
		prereqeval : function(v) { return v.characterLevel > 7 && (/^(?=.*dragonmark)(?=.*passage).*$/i).test(CurrentRace.known); },
		descriptionFull : "Your dragonmark has grown in size and power. This enhances your existing dragonmark, and the benefits are based on the mark that you already possess. A greater dragonmark provides the following benefits:\n \u2022 Increase your Dexterity or Constitution score by 1, to a maximum of 20.\n \u2022 The die type of your dragonmarked Intuition Die increases by one (for example, from a d4 to a d6).\n \u2022 You learn the spells Blink and Teleportation Circle, each of which you can cast once without expending a spell slot or using a material component. Constitution is your spellcasting ability for these spells. Once you cast a spell using this feature, and you must finish a long rest before you can do so again.",
		description : "My Intuition Die increases with one step (d4 to d6, for example). I can cast Blink and Teleportation Circle each once per long rest without using spell slots or requiring material components. Constitution is my spellcasting ability for these. [+1 Dexterity or Constitution]",
		scorestxt : "+1 Dexterity or Constitution",
		spellcastingBonus : {
			name : "1\u00D7 per long",
			spells : ["blink", "teleportation circle"],
			selection : ["blink", "teleportation circle"],
			spellcastingAbility : 3,
			firstCol : 'oncelr',
			times : 2
		},
		spellChanges : {
			"teleportation circle" : {
				components : "V,S",
				compMaterial : "",
				description : "Create a circle to teleport to another teleportation circle on same plane; see book",
				changes : "Spells cast through my Greater Dragonmark don't require material components."
			}
		}
	},
	"scribing" : {
		prerequisite : "Being level 8 or higher and possessing the Dragonmark of Scribing",
		prereqeval : function(v) { return v.characterLevel > 7 && (/^(?=.*dragonmark)(?=.*scribing).*$/i).test(CurrentRace.known); },
		descriptionFull : "Your dragonmark has grown in size and power. This enhances your existing dragonmark, and the benefits are based on the mark that you already possess. A greater dragonmark provides the following benefits:\n \u2022 Increase your Intelligence or Charisma score by 1, to a maximum of 20.\n \u2022 The die type of your dragonmarked Intuition Die increases by one (for example, from a d4 to a d6).\n \u2022 You learn the spells Sending and Tongues, each of which you can cast once without expending a spell slot or using a material component. Intelligence is your spellcasting ability for these spells. Once you cast a spell using this feature, and you must finish a short or long rest before you can do so again.",
		description : "My Intuition Die increases with one step (d4 to d6, for example). I can cast Sending and Tongues each once per short rest without using spell slots or requiring material components. Intelligence is my spellcasting ability for these. [+1 Intelligence or Charisma]",
		scorestxt : "+1 Intelligence or Charisma",
		spellcastingBonus : {
			name : "1\u00D7 per short",
			spells : ["sending", "tongues"],
			selection : ["sending", "tongues"],
			spellcastingAbility : 4,
			firstCol : 'oncesr',
			times : 2
		},
		spellChanges : {
			"sending" : {
				components : "V,S",
				compMaterial : "",
				changes : "Spells cast through my Greater Dragonmark don't require material components."
			},
			"tongues" : {
				components : "V,S",
				compMaterial : "",
				changes : "Spells cast through my Greater Dragonmark don't require material components."
			}
		}
	},
	"sentinel" : {
		prerequisite : "Being level 8 or higher and possessing the Dragonmark of Sentinel",
		prereqeval : function(v) { return v.characterLevel > 7 && (/^(?=.*dragonmark)(?=.*sentinel).*$/i).test(CurrentRace.known); },
		descriptionFull : "Your dragonmark has grown in size and power. This enhances your existing dragonmark, and the benefits are based on the mark that you already possess. A greater dragonmark provides the following benefits:\n \u2022 Increase your Strength or Wisdom score by 1, to a maximum of 20.\n \u2022 The die type of your dragonmarked Intuition Die increases by one (for example, from a d4 to a d6).\n \u2022 You learn the spells Compelled Duel, Warding Bond, each of which you can cast once without expending a spell slot or using a material component. Wisdom is your spellcasting ability for these spells. Once you cast a spell using this feature, and you must finish a short or long rest before you can do so again.",
		description : "My Intuition Die increases with one step (d4 to d6, for example). I can cast Compelled Duel and Warding Bond each once per short rest without using spell slots or requiring material components. Wisdom is my spellcasting ability for these. [+1 Strength or Wisdom]",
		scorestxt : "+1 Strength or Wisdom",
		spellcastingBonus : {
			name : "1\u00D7 per short",
			spells : ["compelled duel", "warding bond"],
			selection : ["compelled duel", "warding bond"],
			spellcastingAbility : 5,
			firstCol : 'oncesr',
			times : 2
		},
		spellChanges : {
			"warding bond" : {
				components : "V,S",
				compMaterial : "",
				description : "1 crea +1 AC, +1 saves, resistance all dmg; if it takes dmg I take same dmg; ends if >60 ft away",
				changes : "Spells cast through my Greater Dragonmark don't require material components."
			}
		}
	},
	"shadow" : {
		prerequisite : "Being level 8 or higher and possessing the Dragonmark of Shadow",
		prereqeval : function(v) { return v.characterLevel > 7 && (/^(?=.*dragonmark)(?=.*shadow).*$/i).test(CurrentRace.known); },
		descriptionFull : "Your dragonmark has grown in size and power. This enhances your existing dragonmark, and the benefits are based on the mark that you already possess. A greater dragonmark provides the following benefits:\n \u2022 Increase your Dexterity or Charisma score by 1, to a maximum of 20.\n \u2022 The die type of your dragonmarked Intuition Die increases by one (for example, from a d4 to a d6).\n \u2022 You learn the spells Nondetection and Mislead, each of which you can cast once without expending a spell slot or using a material component. Charisma is your spellcasting ability for these spells. Once you cast a spell using this feature, and you must finish a long rest before you can do so again.",
		description : "My Intuition Die increases with one step (d4 to d6, for example). I can cast Nondetection and Mislead each once per long rest without using spell slots or requiring material components. Charisma is my spellcasting ability for these. [+1 Dexterity or Charisma]",
		scorestxt : "+1 Dexterity or Charisma",
		spellcastingBonus : {
			name : "1\u00D7 per long",
			spells : ["nondetection", "mislead"],
			selection : ["nondetection", "mislead"],
			spellcastingAbility : 6,
			firstCol : 'oncelr',
			times : 2
		},
		spellChanges : {
			"nondetection" : {
				components : "V,S",
				compMaterial : "",
				description : "1 crea or object up to 10 cu ft hidden from all divination magic",
				changes : "Spells cast through my Greater Dragonmark don't require material components."
			}
		}
	},
	"storm" : {
		prerequisite : "Being level 8 or higher and possessing the Dragonmark of Storm",
		prereqeval : function(v) { return v.characterLevel > 7 && (/^(?=.*dragonmark)(?=.*storm).*$/i).test(CurrentRace.known); },
		descriptionFull : "Your dragonmark has grown in size and power. This enhances your existing dragonmark, and the benefits are based on the mark that you already possess. A greater dragonmark provides the following benefits:\n \u2022 Increase your Dexterity or Charisma score by 1, to a maximum of 20.\n \u2022 The die type of your dragonmarked Intuition Die increases by one (for example, from a d4 to a d6).\n \u2022 You learn the spells Control Water and Control Winds, each of which you can cast once without expending a spell slot or using a material component. Charisma is your spellcasting ability for these spells. Once you cast a spell using this feature, and you must finish a long rest before you can do so again.",
		description : "My Intuition Die increases with one step (d4 to d6, for example). I can cast Control Water and Control Winds each once per long rest without using spell slots or requiring material components. Charisma is my spellcasting ability for these. [+1 Dexterity or Charisma]",
		scorestxt : "+1 Dexterity or Charisma",
		spellcastingBonus : {
			name : "1\u00D7 per long",
			spells : ["control water", "control winds"],
			selection : ["control water", "control winds"],
			spellcastingAbility : 6,
			firstCol : 'oncelr',
			times : 2
		},
		spellChanges : {
			"control water" : {
				components : "V,S",
				compMaterial : "",
				changes : "Spells cast through my Greater Dragonmark don't require material components."
			}
		}
	},
	"warding" : {
		prerequisite : "Being level 8 or higher and possessing the Dragonmark of Warding",
		prereqeval : function(v) { return v.characterLevel > 7 && (/^(?=.*dragonmark)(?=.*warding).*$/i).test(CurrentRace.known); },
		descriptionFull : "Your dragonmark has grown in size and power. This enhances your existing dragonmark, and the benefits are based on the mark that you already possess. A greater dragonmark provides the following benefits:\n \u2022 Increase your Dexterity or Intelligence score by 1, to a maximum of 20.\n \u2022 The die type of your dragonmarked Intuition Die increases by one (for example, from a d4 to a d6).\n \u2022 You learn the spells Knock, Glyph of Warding and Leomund's Secret Chest*, each of which you can cast once without expending a spell slot or using a material component. Intelligence is your spellcasting ability for these spells. Once you cast a spell using this feature, and you must finish a long rest before you can do so again.\n\n* To cast Leomund's Secret Chest using this feat, you must have a Siberys dragonshard with a value of at least 100 gp. While you have this dragonshard in hand, it serves as the spell's focus, and you can use it to summon and dismiss the chest.",
		description : "My Intuition Die increases one step. I can cast Knock, Secret Chest, and Glyph of Warding each once per long rest without spell slot or material component. Secret Chest requires a 100 gp Siberys dragonshard as a focus. These use Int as spellcasting ability. [+1 Dex or Int]",
		scorestxt : "+1 Dexterity or Intelligence",
		spellcastingBonus : [{
			name : "1\u00D7 per long",
			spells : ["knock", "glyph of warding"],
			selection : ["knock", "glyph of warding"],
			spellcastingAbility : 4,
			firstCol : 'oncelr',
			times : 2
		}, {
			name : "with Siberys dragonshard",
			spells : ["leomund's secret chest"],
			selection : ["leomund's secret chest"],
			firstCol : 'oncelr'
		}],
		spellChanges : {
			"glyph of warding" : {
				components : "V,S",
				compMaterial : "",
				description : "Create a glyph that triggers on set condition; Int(Investigation) vs. Spell DC; see book",
				changes : "Spells cast through my Greater Dragonmark don't require material components."
			},
			"glyph of warding" : {
				compMaterial : "A Siberys dragonshard with a value of at least 100 gp",
				description : "Hide chest with content in Ethereal Plane for 60 days, after that chance of loss; 1 a reappear (100gp)",
				changes : "Leomund's Secret Chest cast through my Greater Dragonmark of Warding requires a Siberys dragonshard as a focus instead of an exquisite chest and its tiny replica."
			}
		}
	}
};

// Aberrant Dragonmark feat
FeatsList["aberrant dragonmark"] = {
	name : "Aberrant Dragonmark",
	source : [["WGtE", 112], ["UA:D", 9]],
	prerequisite : "Not having a dragonmark",
	prereqeval : function(v) { return !(/dragonmark/i).test(CurrentRace.known); },
	descriptionFull : "You have manifested an aberrant dragonmark. Determine its appearance and the flaw associated with it (see the table below for examples). You gain the following benefits:\n \u2022 Increase your Constitution score by 1, to a maximum of 20.\n \u2022 You learn a cantrip from the sorcerer spell list. In addition, choose a 1st-level spell from the sorcerer spell list. You learn that spell and can cast it at its lowest level. Once you cast it, you must finish a long rest before you can cast it again. Constitution is your spellcasting ability for these spells.\n \u2022 You can increase the power of your aberrant spells at the risk of your own vitality. When you cast a spell with your aberrant mark, you can use one of your Hit Dice to increase the spell's level by 1. Immediately after you cast the spell, roll the Hit Die. You take damage equal to the number rolled.\n\n" + toUni("1d8") + "\t" + toUni("Aberrant Mark Flaw") + "\n1\tYour mark is a source of constant physical pain.\n2\tYour mark whispers to you, though you may not understand what it says.\n3\tIn times of stress, your mark may trigger a cantrip effect involuntarily.\n4\tThe skin around your mark has an unusual appearance: burned, scaly, withered, etc.\n5\tMundane animals become uneasy around you.\n6\tYou have dramatic mood swings any time you use your mark.\n7\tYour appearance changes in a minor way every time you use your mark.\n8\tYou have horrific nightmares after you use your mark.",
	description : "I learn a sorcerer cantrip and a 1st-level sorcerer spell, using Con as my spellcasting ability. I can cast the spell once per long rest without a spell slot. I can use a Hit Die when casting the spell, casting it as if with a level 2 spell slot and taking the HD as damage. [+1 Con]",
	scores : [0, 0, 1, 0, 0, 0],
	spellcastingAbility : 3,
	spellcastingBonus : [{
		name : "Sorcerer cantrip",
		'class' : 'sorcerer',
		level : [0, 0],
		firstCol : 'atwill'
	}, {
		name : "Sorcerer 1st-level spell",
		'class' : 'sorcerer',
		level : [1, 1],
		firstCol : 'oncelr'
	}]
};

// Magic Items
MagicItemsList["armblade"] = {
	name : "Armblade",
	source : [["WGtE", 120], ["UA:MIoE", 3]],
	type : "weapon (any one-handed melee weapon)",
	rarity : "common",
	description : "As a warforged, I can integrate this weapon in my forearm by attuning to it. While attached, it can't be disarmed or removed against my will, but I can't use that hand for other actions. I can spend one minute to end the attunement and remove the armblade. The weapon isn't inherently magical.",
	descriptionFull : "An armblade is a weapon designed to integrate with the forearm of a warforged. If you're a warforged, you can attach an armblade by attuning to it. An attached armblade cannot be disarmed or removed from you against your will, but while the weapon is attached you cannot use that hand for other actions. You can spend one minute to end the attunement and remove the armblade.\n   An armblade isn't inherently considered to be a magic weapon for purposes of overcoming damage resistance. However, any sort of magical melee weapon could be created as an armblade, so you could acquire a vicious armblade or a vorpal armblade.",
	attunement : true,
	prerequisite : "Requires attunement by a warforged",
	prereqeval : function (v) { return (/warforged/i).test(CurrentRace.known); },
	allowDuplicates : true,
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "brackets",
		descriptionChange : ["replace", "weapon"],
		excludeCheck : function (inObjKey, inObj) {
			return (!inObj.description || (/two.{0,3}handed/i).test(inObj.description)) || (!inObj.range || !(/melee/i).test(inObj.range));
		}
	}
}
MagicItemsList["bag of bounty"] = {
	name : "Bag of Bounty",
	source : ["WGtE", 116],
	type : "wondrous item",
	rarity : "uncommon",
	description : "As an action three times per dawn, I can cast Create Food and Water, but can try and create fine food with a Cha check. If I'm proficient with cook's utensils, I add my proficiency bonus. Meal quality: modest (DC 10), comfortable (DC 13), wealthy (DC 15), aristocratic (DC 18). Failure results in a sour and squalid meal. ",
	descriptionFull : "This is a sturdy leather sack with tiny Siberys shards embedded into the lining. If you have the Mark of Hospitality you can use an action to cast create food and water, drawing a feast from within the bag. You shape this meal with your thoughts. You can create the standard bland fare without requiring any sort of check, but you can attempt to create finer food by making a Charisma check; if you're proficient with cook's utensils, add your bonus to this check. A failed check results in a sour and squalid meal.\n\n" + toUni("DC\tFood Quality") + "\nNo roll\tPoor\n10\tModest\n13\tComfortable\n15\tWealthy\n18\tAristocratic\n\nA bag of bounty can be used up to three times over the course of a day. After that, the bag can't be used again until the next dawn.",
	prerequisite : "Can only be used by someone with a Dragonmark of Hospitality",
	prereqeval : function (v) {
		return (/^(?=.*dragonmark)(?=.*hospitality).*$/i).test(CurrentRace.known);
	},
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "3 times per long rest",
		spells : ["create food and water"],
		selection : ["create food and water"],
		firstCol : 1
	},
	spellChanges : {
		"create food and water" : {
			description : "Create 45 lb food and 30 gal water; feeds 15 humanoids or 5 steeds for 24h; Cha check for quality",
			changes : "Using the Bag of Bounty, I can create the standard bland fare without requiring any sort of check, but I can attempt to create finer food by making a Charisma check, adding my proficiency bonus if I'm proficient with cook's utensils. A failed check results in a sour and squalid meal."
		}
	},
	usages : 3,
	recovery : "dawn"
}
MagicItemsList["band of loyalty"] = {
	name : "Band of Loyalty",
	source : [["WGtE", 115], ["UA:MIoE", 2]],
	type : "ring",
	rarity : "common",
	description : "If I'm reduced to zero hit points while attuned to this ring, I instantly die. These rings are favored by spies who can't afford to fall into enemy hands.",
	descriptionFull : "If you are reduced to zero hit points while attuned to a band of loyalty, you instantly die. These rings are favored by spies who can't afford to fall into enemy hands.",
	attunement : true
}
MagicItemsList["cleansing stone"] = {
	name : "Cleansing Stone",
	source : [["WGtE", 115], ["UA:MIoE", 2]],
	type : "wondrous item",
	rarity : "common",
	description : "This stone sphere is 1 ft in diameter and engraved with mystic sigils. As an action while touching it, I can activate it to remove dirt and grime from my garments and my person.",
	descriptionFull : "A cleansing stone is a stone sphere one foot in diameter, engraved with mystic sigils. When touching the stone, you can use an action to activate it and remove dirt and grime from your garments and your person. Cleansing stones are often embedded into pedestals in public squares in Aundair or found in high-end Ghallanda inns.",
	action : [["action", ""]]
}
var docentFullDescription = [
	"A docent is a small metal sphere, approximately 2 inches across, studded with dragonshards. Despite a strong magical aura, it has no obvious abilities. When you attune to a docent, the sphere becomes embedded in your chest and comes to life\u2014literally.",
	">>Sentience<<. A docent is a sentient neutral item with an Intelligence of 16, a Wisdom of 14, and a Charisma of 14. It can perceive the world through your senses.",
	"A docent communicates telepathically with its wielder and can speak, read, and understand Common and Giant.",
	">>Personality<<. A docent is designed to advise and assist the warforged it's attached to. One of the simple functions of a docent is to serve as a translator. The docent's properties are under its control, and if you have a bad relationship with your docent it may refuse to assist you… or simply lie about information that it obtains. However, if you treat your docent well it could serve as a useful ally.",
	"The origin of docents is a great mystery. House Cannith created the first warforged thirty years ago. But the docents come from the distant land of Xen'drik and appear to be thousands of years old. Were they created to interface with some other form of construct? Or are the modern warforged a new interpretation of an ancient design? The docents claim to have forgotten their creators… but this is a mystery waiting to be unraveled. While all docents come from Xen'drik, some have been brought to Khorvaire by explorers and it's possible to encounter them in the Five Nations.",
	">>Languages<<. All docents understand Common and Giant, but a docent knows up to four additional languages. Elvish and Draconic are common options. If a docent knows less than six languages in total, it can add new languages to its repertoire after encountering them. So a docent found in Xen'drik may have never encountered a dwarf before… but after spending some time in Khorvaire studying dwarves, it could pick up the Dwarvish language.",
	">>Properties<<. A docent possesses up to three of the following properties:",
	"\u2022 The docent can cast the detect magic spell at will.",
	"\u2022 The docent can cast the detect evil and good spell at will.",
	"\u2022 The docent can detect any form of divination or scrying targeting it and its warforged host.",
	"\u2022 The docent has a +7 bonus to Intelligence (Arcana) checks.",
	"\u2022 The docent has a +7 bonus to Intelligence (History) checks.",
	"\u2022 The docent has a +7 bonus to Intelligence (Investigation) checks.",
	"\u2022 The docent has a +7 bonus to Intelligence (Nature) checks.",
	"\u2022 The docent has a +6 bonus to Wisdom (Insight) checks.",
	"\u2022 The docent has a +6 bonus to Wisdom (Perception) checks.",
	"\u2022 The docent has a +6 bonus to Wisdom (Medicine) checks targeting its warforged host. If the host is rendered unconscious, the docent will automatically attempt to stabilize them once each turn.",
	"You can use a bonus action on your turn to request that the docent use one of its properties on your behalf."
];
MagicItemsList["docent"] = {
	name : "Docent",
	source : [["WGtE", 121], ["UA:MIoE", 3]],
	type : "wondrous item",
	rarity : "rare",
	description : "I can embed this sentient small metal sphere studded with dragonshards into my chest. I can communicate telepathically with it. It can serve me as an advisor and a translator, as it knowns 6 languages. It also knows spells and/or skills that I can have it use as a bonus action. See Notes page.",
	descriptionFull : docentFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	attunement : true,
	prerequisite : "Requires attunement by a warforged",
	prereqeval : function (v) { return (/warforged/i).test(CurrentRace.known); },
	action : [["bonus action", ""]],
	toNotesPage : [{
		name : "Features",
		popupName : "Features of Docent",
		note : desc(docentFullDescription).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/you are /ig, "I am ").replace(/(of|on|assist) you/ig, "$1 me").replace(/you /ig, "I ") + "\n\n" + sentientItemConflictTxt
	}]
}
MagicItemsList["everbright lantern"] = {
	name : "Everbright Lantern",
	source : [["WGtE", 115], ["UA:MIoE", 2]],
	type : "wondrous item",
	rarity : "common",
	description : "This bullseye lantern is powered by a dragonshard imbued with the effect of a Continual Flame spell. The light never goes out, but it can be shuttered off. It casts bright light in a 60-ft cone and dim light for an additional 60 ft.",
	descriptionFull : "An everbright lantern contains an Eberron dragonshard imbued with the effect of a continual flame spell. This bright light is mounted inside a normal bullseye lantern, allowing the light to be shuttered off. An everbright lantern provides clear illumination in a 60-foot cone and shadowy illumination in a 120-foot cone, just like a mundane bullseye lantern, but its flame never goes out."
}
MagicItemsList["feather token"] = {
	name : "Feather Token",
	source : [["WGtE", 115], ["UA:MIoE", 2]],
	type : "wondrous item",
	rarity : "common",
	description : "Once as a bonus action while the token is in my possession, I can use it to cast Feather Fall. This small metal disk is inscribed with the image of a feather and only holds sufficient charge for a single use, after which it loses its power.",
	descriptionFull : "This small metal disk is inscribed with the image of a feather. While the token is in your possession, you can cast feather fall as a bonus action. A feather token only holds sufficient charge for a single use, after which it loses its power. While it's an expensive form of insurance, frequent airship travelers and citizens of Sharn often appreciate the security it provides."
}
MagicItemsList["glamerweave"] = {
	name : "Glamerweave",
	source : [["WGtE", 115], ["UA:MIoE", 2]],
	type : "wondrous item",
	rarity : "common",
	description : "Glamerweave clothing is imbued with cosmetic illusions that have no impact on combat. Most of the time, these patterns are contained within the cloth, but higher-end glamerweave can have more dramatic effects. A gown could appear to be wreathed in flames, or a hat orbited by illusory butterflies.",
	descriptionFull : "Glamerweave clothing is imbued with cosmetic illusions. Traditionally, these patterns are contained within the cloth, but higher-end glamerweave can have more dramatic effects. You could have a gown that appears to be wreathed in flames, or a hat that's orbited by illusory butterflies. Regardless of the design, these are cosmetic effects and have no impact on combat.\n\n" + [
		toUni("1d8\tDescription"),
		"  1\tA hat orbited by the twelve moons",
		"  2\tLong gloves wreathed in cold flames",
		"  3\tA traveler's cloak lined with glittering stars",
		"  4\tA scarlet gown that glows with inner radiance",
		"  5\tA cloth shirt that appears to be a chain shirt",
		"  6\tA silver gown surrounded by drifting snowflakes",
		"  7\tA robe with two dragons wrestling across the back",
		"  8\tA cloak that slowly and subtly shifts colors"
	].join("\n")
}
MagicItemsList["imbued wood"] = {
	name : "Imbued Wood",
	source : [["WGtE", 114], ["UA:MIoE", 1]],
	type : "wondrous item",
	rarity : "common",
	description : "While holding a rod, wand, or staff made of imbued wood, spells I cast that deal the associated damage type add a +1 bonus to one of their damage rolls.",
	descriptionFull : "Powerful manifest zones can infuse local trees with planar energies. A gifted artificer can tap into this to create a wand, staff, or rod that is especially effective at channeling a particular type of energy.\n   When you cast a spell that deals damage of the type associated with the material your arcane focus is made from, the spell gains a +1 bonus to one damage roll of that spell. The materials and their associated damage types are listed here.\n \u2022 Fernian ash: Fire damage.\n \u2022 Irian rosewood: Radiant damage.\n \u2022 Kythrian manchineel: Acid or poison damage.\n \u2022 Lamannian oak: Lightning or thunder damage.\n \u2022 Mabaran ebony: Necrotic damage.\n \u2022 Quori beech, Xorian wenge: Psychic damage.\n \u2022 Risian pine: Cold damage.\n \u2022 Shavarran birch: Force damage.",
	attunement : true,
	allowDuplicates : true,
	choices : ["Fernian Ash (fire)", "Irian Rosewood (radiant)", "Kythrian Manchineel (acid and poison)", "Lamannian Oak (lightning and thunder)", "Mabaran Ebony (necrotic)", "Quori Beech (psychic)", "Risian Pine (cold)", "Shavarran Birch (force)", "Xorian Wenge (psychic)"],
	"fernian ash (fire)" : {
		name : "Fernian Ash Arcane Focus",
		description : "While holding a rod, wand, or staff made of Fernian ash, spells I cast that deal fire damage add a +1 bonus to one of their damage rolls.",
		spellAdd : [
			function (spellKey, spellObj, spName) {
				if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "fire", 1, true, true);
			},
			"Cantrips and spells that deal fire damage get a +1 bonus added to one of their damage rolls."
		]
	},
	"irian rosewood (radiant)" : {
		name : "Irian Rosewood Arcane Focus",
		description : "While holding a rod, wand, or staff made of Irian rosewood, spells I cast that deal radiant damage add a +1 bonus to one of their damage rolls.",
		spellAdd : [
			function (spellKey, spellObj, spName) {
				if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "radiant", 1, true, true);
			},
			"Cantrips and spells that deal radiant damage get a +1 bonus added to one of their damage rolls."
		]
	},
	"kythrian manchineel (acid and poison)" : {
		name : "Kythrian Manchineel Arcane Focus",
		description : "While holding a rod, wand, or staff made of Kythrian manchineel, spells I cast that deal acid or poison damage add a +1 bonus to one of their damage rolls.",
		spellAdd : [
			function (spellKey, spellObj, spName) {
				if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "acid|poison", 1, true, true);
			},
			"Cantrips and spells that deal acid or poison damage get a +1 bonus added to one of their damage rolls."
		]
	},
	"lamannian oak (lightning and thunder)" : {
		name : "Lamannian Oak Arcane Focus",
		description : "While holding a rod, wand, or staff made of Lamannian oak, spells I cast that deal lightning or thunder damage add a +1 bonus to one of their damage rolls.",
		spellAdd : [
			function (spellKey, spellObj, spName) {
				if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "lightning|thunder", 1, true, true);
			},
			"Cantrips and spells that deal lightning or thunder damage get a +1 bonus added to one of their damage rolls."
		]
	},
	"mabaran ebony (necrotic)" : {
		name : "Mabaran Ebony Arcane Focus",
		description : "While holding a rod, wand, or staff made of Mabaran ebony, spells I cast that deal necrotic damage add a +1 bonus to one of their damage rolls.",
		spellAdd : [
			function (spellKey, spellObj, spName) {
				if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "necrotic", 1, true, true);
			},
			"Cantrips and spells that deal necrotic damage get a +1 bonus added to one of their damage rolls."
		]
	},
	"quori beech (psychic)" : {
		name : "Quori Beech Arcane Focus",
		description : "While holding a rod, wand, or staff made of Quori beech, spells I cast that deal psychic damage add a +1 bonus to one of their damage rolls.",
		spellAdd : [
			function (spellKey, spellObj, spName) {
				if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "psychic", 1, true, true);
			},
			"Cantrips and spells that deal psychic damage get a +1 bonus added to one of their damage rolls."
		]
	},
	"risian pine (cold)" : {
		name : "Risian Pine Arcane Focus",
		description : "While holding a rod, wand, or staff made of Risian pine, spells I cast that deal cold damage add a +1 bonus to one of their damage rolls.",
		spellAdd : [
			function (spellKey, spellObj, spName) {
				if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "cold", 1, true, true);
			},
			"Cantrips and spells that deal cold damage get a +1 bonus added to one of their damage rolls."
		]
	},
	"shavarran birch (force)" : {
		name : "Shavarran Birch Arcane Focus",
		description : "While holding a rod, wand, or staff made of Shavarran birch, spells I cast that deal force damage add a +1 bonus to one of their damage rolls.",
		spellAdd : [
			function (spellKey, spellObj, spName) {
				if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "force", 1, true, true);
			},
			"Cantrips and spells that deal force damage get a +1 bonus added to one of their damage rolls."
		]
	},
	"xorian wenge (psychic)" : {
		name : "Xorian Wenge Arcane Focus",
		description : "While holding a rod, wand, or staff made of Xorian wenge, spells I cast that deal psychic damage add a +1 bonus to one of their damage rolls.",
		spellAdd : [
			function (spellKey, spellObj, spName) {
				if (!spellObj.psionic) return genericSpellDmgEdit(spellKey, spellObj, "psychic", 1, true, true);
			},
			"Cantrips and spells that deal psychic damage get a +1 bonus added to one of their damage rolls."
		]
	}
}
MagicItemsList["inquisitive's goggles"] = {
	name : "Inquisitive's Goggles",
	source : ["WGtE", 115],
	type : "wondrous item",
	rarity : "uncommon",
	description : "I can add my Intuition Die to my Wis (Insight) checks. When I examine an object, I can make a Wis (Perception) check to sense the aura of the last living creature to touch it (DC is 13 + days since last contact). On a success, I learn the creature's species and I can immediately use my Imprint Prey ability to target it.",
	descriptionLong : "The lenses of these garish goggles are carved from Siberys dragonshards. It allows me to can add my Intuition Die to my Wisdom (Insight) checks. When I examine an object, I can use it to make a Wisdom (Perception) check to identify the aura of the last living creature to touch the object.The DC is 13 + the number of days since the last contact occurred. If the check is successful, I learn the species of the creature and I can immediately use my Imprint Prey ability to target this creature.",
	descriptionFull : "The lenses of these goggles are carved from Siberys dragonshards. While garish in appearance, these goggles are a boon to any Tharashk inquisitive. To attune to the goggles, you must possess the Mark of Finding. As long as this condition is met, you gain the following benefits:\n \u2022 You can add your Intuition die from the Hunter's Intuition trait of the mark when you make Wisdom (Insight) checks.\n \u2022 When you examine an object, you can make a Wisdom (Perception) check to identify the aura of the last living creature to touch the object. The DC is 13 + the number of days since the last contact occurred. If the check is successful, you learn the species of the creature and you can immediately use your Imprint Prey ability to target this creature.",
	attunement : true,
	prerequisite : "Requires attunement by someone with a Dragonmark of Finding",
	prereqeval : function (v) {
		return (/^(?=.*dragonmark)(?=.*finding).*$/i).test(CurrentRace.known);
	}
}
MagicItemsList["keycharm"] = {
	name : "Keycharm",
	source : ["WGtE", 115],
	type : "wondrous item",
	rarity : "common",
	description : "When I cast Alarm, Arcane Lock, Glyph of Warding, or a similar abjuration effect, I can tie it to the keycharm. Whoever holds the keycharm is considered to be the owner of this effect. For example, they receive the notification from Alarm, can safely avoid a Glyph of Warding, or can circumvent the Arcane Lock.",
	descriptionFull : "This simple object plays a vital role in the work of House Kundarak. If you possess the Mark of Warding, when you cast alarm, arcane lock, glyph of warding, or similar abjuration effects, you can tie the effect to the keycharm. Whoever holds the keycharm is considered to the owner of this enchantment; they receive the notification from alarm, they can safely avoid a glyph, and they can deactivate any associated effect.",
	prerequisite : "Can only be used by someone with a Dragonmark of Warding",
	prereqeval : function (v) {
		return (/^(?=.*dragonmark)(?=.*warding).*$/i).test(CurrentRace.known);
	}
}
MagicItemsList["orb of shielding"] = {
	name : "Orb of Shielding",
	source : [["WGtE", 114], ["UA:MIoE", 1]],
	type : "wondrous item",
	rarity : "common",
	description : "An orb of shielding is made from crystal or stone aligned to one of the planes. While I am holding the orb and take damage of the type associated with the material the orb is made from, I can use my reaction to reduce the damage by 1d4.",
	descriptionFull : "An orb of shielding is made from crystal or stone aligned to one of the planes. While you are holding the orb and take damage of the type associated with the material your orb is made from, you can use your reaction to reduce the damage by 1d4. The materials and their associated damage types are listed below.\n" +
	"\n \u2022 Fernian basalt: Fire damage" +
	"\n \u2022 Irian quartz: Radiant damage" +
	"\n \u2022 Kythrian skarn: Acid or poison damage" +
	"\n \u2022 Lamannian flint: Lightning or thunder damage" +
	"\n \u2022 Mabaran obsidian: Necrotic damage" +
	"\n \u2022 Quori celestine, Xorian marble: Psychic damage" +
	"\n \u2022 Risian shale: Cold damage" +
	"\n \u2022 Shavaran chert: Force damage",
	attunement : true,
	weight : 3,
	action : [["reaction", ""]],
	choices : ["Fernian Basalt (fire)", "Irian Quartz (radiant)", "Kythrian Skarn (acid or poison)", "Lamannian Flint (lightning or thunder)", "Mabaran Obsidian (necrotic)", "Quori Celestine (psychic)", "Risian Shale (cold)", "Shavaran Chert (force)", "Xorian Marble (psychic)"],
	"fernian basalt (fire)" : {
		name : "Orb of Shielding [Fernian Basalt]",
		description : "This stone orb is made from fernian basalt. As a reaction while I am holding the orb and take fire damage, I can reduce the damage by 1d4."
	},
	"irian quartz (radiant)" : {
		name : "Orb of Shielding [Irian Quartz]",
		description : "This crystal orb is made from irian quartz. As a reaction while I am holding the orb and take radiant damage, I can reduce the damage by 1d4."
	},
	"kythrian skarn (acid or poison)" : {
		name : "Orb of Shielding [Kythrian Skarn]",
		description : "This stone orb is made from kythrian skarn. As a reaction while I am holding the orb and take acid or poison damage, I can reduce the damage by 1d4."
	},
	"lamannian flint (lightning or thunder)" : {
		name : "Orb of Shielding [Lamannian Flint]",
		description : "This stone orb is made from lamannian flint. As a reaction while I am holding the orb and take lightning or thunder damage, I can reduce the damage by 1d4."
	},
	"mabaran obsidian (necrotic)" : {
		name : "Orb of Shielding [Mabaran Obsidian]",
		description : "This crystal orb is made from mabaran obsidian. As a reaction while I am holding the orb and take necrotic damage, I can reduce the damage by 1d4."
	},
	"quori celestine (psychic)" : {
		name : "Orb of Shielding [Quori Celestine]",
		description : "This crystal orb is made from quori celestine. As a reaction while I am holding the orb and take psychic damage, I can reduce the damage by 1d4."
	},
	"risian shale (cold)" : {
		name : "Orb of Shielding [Risian Shale]",
		description : "This stone orb is made from risian shale. As a reaction while I am holding the orb and take cold damage, I can reduce the damage by 1d4."
	},
	"shavaran chert (force)" : {
		name : "Orb of Shielding [Shavaran Chert]",
		description : "This stone orb is made from shavaran chert. As a reaction while I am holding the orb and take force damage, I can reduce the damage by 1d4."
	},
	"xorian marble (psychic)" : {
		name : "Orb of Shielding [Xorian Marble]",
		description : "This stone orb is made from xorian marble. As a reaction while I am holding the orb and take psychic damage, I can reduce the damage by 1d4."
	}
}
MagicItemsList["rings of shared suffering"] = {
	name : "Rings of Shared Suffering",
	source : ["WGtE", 117],
	type : "ring",
	rarity : "uncommon",
	description : "I can only attune to one of these rings. As a bonus action, I can link this ring to the other of its pair, if a creature is attuned to it. From then on, when that creature takes damage, they only suffer half and I take the rest. This effect has no range limit and lasts until either of us ends it as a bonus action or removes their ring.",
	descriptionFull : "These rings come in linked pairs. If you possess the Mark of Sentinel, you can use a bonus action to form a link to the creature attuned to the other ring; from then on, whenever that creature suffers damage, they only suffer half of that damage and you take the rest. This effect continues until you end it as a bonus action or until you or the other creature removes their ring. This effect isn't limited by range. A creature cannot be attuned to more than one ring of shared suffering.",
	attunement : true,
	prerequisite : "Requires attunement by someone with a Dragonmark of Sentinel",
	prereqeval : function (v) {
		return (/^(?=.*dragonmark)(?=.*sentinel).*$/i).test(CurrentRace.known);
	}
}
MagicItemsList["scribe's pen"] = {
	name : "Scribe's Pen",
	source : ["WGtE", 115],
	type : "wondrous item",
	rarity : "common",
	description : "I can use this quill to write on any surface. This can be visible(traced in glowing mystical lines) or invisible to any creature without the Mark of Scribing. Detect Magic reveals the invisible writing. As an action, I or others with the Mark of Scribing can make it (in)visible. Marks on living creatures fade within a week.",
	descriptionFull : "If you possess the Mark of Scribing, you can use this quill to write on any surface. This can be visible\u2014traced in glowing mystical lines\u2014or invisible to any creature without the Mark of Scribing. Invisible writing will be revealed by Detect Magic, See Invisibility, or True Seeing. Any creature with the Mark of Scribing can also reveal your writing or make it invisible as an action. If you mark a living creature, the mark will fade within a week.",
	prerequisite : "Can only be used by someone with a Dragonmark of Scribing",
	prereqeval : function (v) {
		return (/^(?=.*dragonmark)(?=.*scribing).*$/i).test(CurrentRace.known);
	}
}
MagicItemsList["shiftweave"] = {
	name : "Shiftweave",
	source : [["WGtE", 115], ["UA:MIoE", 2]],
	type : "wondrous item",
	rarity : "common",
	description : "Up to five different outfits are embedded into these clothes that have transmutation magic woven into their fabric. As an action, I can speak a command word to transform the outfit into one of the other designs contained within.",
	descriptionFull : "Transmutation magic is woven into the fabric of shiftweave clothing. When a suit of shiftweave is created, up to five different outfits can be embedded into the cloth. By taking an action and uttering a command word, you can transform your shiftweave outfit into one of the other designs contained within it. To determine the price of a suit of shiftweave, combine the value of all of the outfits it contains and add 25 gp to that amount.",
	action : [["action", ""]]
}
MagicItemsList["spellshard"] = {
	name : "Spellshard",
	source : [["WGtE", 115], ["UA:MIoE", 3]],
	type : "wondrous item",
	description : "This dragonshard is imbued with a text. By concentrating while holding it, I can see its pages in my mind's eye and it will draw me to the right section if I think of a topic. I can add content to it with a simple ritual and can use it as a wizard's spellbook, costing 1 gp per \"page\" I add to the shard.",
	allowDuplicates : true,
	choices : ["normal", "advanced"],
	"normal" : {
		name : "Spellshard ",
		allowDuplicates : true,
		rarity : "common",
		description : "This dragonshard is imbued with a work of literature. By holding it and concentrating, I can see its pages in my mind's eye and it will draw me to the right section if I think of a topic. I can add content to it with a simple ritual and can use it as a wizard's spellbook, costing 1 gp per \"page\" I add to the shard.",
		descriptionLong : "This polished dragonshard fits into the palm of my hand. It is imbued with a particular work of literature. By holding it and concentrating, I can see its pages in my mind's eye. Thinking of a particular phrase or topic will draw me to the first section that addresses it. I can add content to it with a simple ritual, allowing me to use it as a wizard's spellbook costing 1 gp per \"page\" in the shard, but otherwise functions as a mundane spellbook. Spellshards can also be used as diaries or journals."
	},
	"advanced" : {
		name : "Advanced Spellshard",
		allowDuplicates : true,
		rarity : "uncommon",
		description : "This dragonshard is imbued with a text. By concentrating and speaking the passphrase, I can see its pages in my mind's eye and it will draw me to the right section if I think of a topic. I can add content to it with a simple ritual and can use it as a wizard's spellbook, costing 1 gp per \"page\" I add to the shard.",
		descriptionLong : "This polished dragonshard fits into the palm of my hand. It is imbued with a particular work of literature. By holding it, concentrating, and speaking its passphrase, I can see its pages in my mind's eye. Thinking of a particular phrase or topic will draw me to the first section that addresses it. I can add content to it with a simple ritual, allowing me to use it as a wizard's spellbook costing 1 gp per \"page\" in the shard, but otherwise functions as a mundane spellbook. Spellshards can also be used as diaries or journals."
	}
}
MagicItemsList["wand sheath"] = {
	name : "Wand Sheath",
	source : [["WGtE", 115], ["UA:MIoE", 4]],
	type : "wondrous item",
	rarity : "common",
	description : "As a warforged, I can integrate this sheath in my forearm by attuning to it. It can only be removed if I spend a minute to end the attunement. As an action, I can insert a wand in it. The wand doesn't count to the number of items I can attune to. As a bonus action, I can then retract/extend it while keeping my hand free.",
	descriptionLong : "As a warforged, I can integrate this sheath in my forearm by attuning to it. It can only be removed if I spend a minute to end the attunement. As an action, I can insert a wand in it. I still need to attune to this wand if it requires me to do so, but the wand wand then doesn't count towards the number of items I can attune to. When I take the wand out of the sheath, I lose attunement with it. As a bonus action, I can retract or extend a wand in the sheath. While retracted, the wand can't be damaged. While extended, I can use the wand as if holding it, but my hand remains free for other actions.",
	descriptionFull : "A wand sheath is designed to integrate with the forearm of a warforged. If you're a warforged, you can attach a wand sheath by attuning to it. While the wand sheath is attached, it cannot be removed from you against your will. You can spend one minute to end the attunement and remove the wand sheath.\n   You can insert a wand into the sheath as an action. While the wand is sheathed, you gain the following benefits:\n \u2022 You can retract the wand into your forearm or extend it from your forearm as a bonus action. While it is retracted, it cannot be damaged or removed.\n \u2022 While the wand is extended, you can use it as if you were holding it, but your hand remains free for other actions.\n \u2022 If the sheathed wand requires attunement, you must attune to the wand before you can use it. However, the wand sheath and the attached wand only count as a single item for purposes of the maximum number of items you can be attuned to. If you remove the wand from the sheath, you immediately lose your attunement to the wand.",
	attunement : true,
	prerequisite : "Requires attunement by a warforged",
	prereqeval : function (v) {
		return (/warforged/i).test(CurrentRace.known);
	},
	action : [["action", " (insert)"], ["bonus action", " (extend/retract)"]]
}
MagicItemsList["wheel of wind and water"] = {
	name : "Wheel of Wind and Water",
	source : ["WGtE", 115],
	type : "wondrous item",
	rarity : "uncommon",
	description : "I can telepathically control the elemental bound into the elemental galleon or airship that has this wheel mounted at its helm. If a wheel of wind and water is mounted on a mundane sailing ship, I can create an area of ideal conditions around the vessel, increasing its speed by 5 miles per hour.",
	descriptionFull : "When mounted at the helm of an elemental galleon or airship, this allows a character who possesses the Mark of Storm to telepathically control the elemental bound into the vessel.\n   If a wheel of wind and water is mounted on a mundane sailing ship, a character with the Mark of Storm can create an area of ideal conditions around the vessel, increasing its speed by 5 miles per hour.",
	prerequisite : "Can only be used by someone with a Dragonmark of Storm",
	prereqeval : function (v) {
		return (/^(?=.*dragonmark)(?=.*storm).*$/i).test(CurrentRace.known);
	}
}
var iFileName = "pub_20180918_WDH.js";
RequiredSheetVersion(13);
// This file adds the magic items from the Waterdeep: Dragon Heist adventure to MPMB's Character Record Sheet

// Define the source
SourceList["WDH"] = {
	name : "Waterdeep: Dragon Heist [items]",
	abbreviation : "WDH",
	group : "Adventure Books",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/dragonheist",
	date : "2018/09/18"
};

// Magic Items
var azuredgeFullDescription = "Forged by the archwizard Ahghairon, this intelligent battleaxe was crafted to defend Waterdeep. Its current wielder is a former member of Force Grey named Meloon Wardragon, but the weapon is searching for a new owner.\n   Azuredge has a solid steel handle etched with tiny runes, wrapped in blue dragon hide with a star sapphire set into the pommel. The axe head is forged from silver, electrum, and steel alloys whose edges constantly shimmer with a deep blue luminescence.\n   You gain a +3 bonus to attack and damage rolls made with this magic weapon. The Shield spell provides no defense against the axe, which passes through that spell's barrier of magical force.\n   When you hit a fiend or an undead with the axe, cold blue flames erupt from its blade and deal an extra 2d6 radiant damage to the target.\n   >>Hurling<<. The battleaxe has 3 charges. You can expend 1 charge and make a ranged attack with the axe, hurling it as if it had the thrown property with a normal range of 60 feet and a long range of 180 feet. Whether it hits or misses, the axe flies back to you at the end of the current turn, landing in your open hand or at your feet in your space (as you choose). The axe regains all expended charges daily at dawn.\n   >>Illumination<<. While holding the axe, you can use an action to cause the axe to glow blue or to quench the glow. This glow sheds bright light in a 30-foot radius and dim light for an additional 30 feet.\n   >>Sentience<<. Azuredge is a sentient lawful neutral weapon with an Intelligence of 12, a Wisdom of 15, and a Charisma of 15. It has hearing and darkvision out to a range of 120 feet.\n   The weapon communicates telepathically with its wielder and can speak, read, and understand Common. It has a calm, delicate voice. The weapon can sense the presence of non-lawful creatures within 120 feet of it.\n   >>Personality<<. Azuredge is sworn to protect Waterdeep, and it desires to be wielded by a law-abiding person willing to dedicate everything to the city's defense. The weapon is patient and takes its time finding its ideal wielder.\n   If someone tries to use Azuredge against its will, the axe can become ten times heavier than normal, and can magically adhere to any Medium or larger object or surface it comes into contact with. Once it does so, the axe can't be wielded. Nothing short of a Wish spell can separate the axe from the item or surface to which it is adhered without destroying one or the other, though the axe can choose to end the effect at any time.";
MagicItemsList["azuredge"] = {
	name : "Azuredge",
	source : ["WDH", 189],
	type : "weapon (battleaxe)",
	rarity : "legendary",
	storyItemAL : true,
	description : "This battleaxe is sentient, adds +3 to hit and damage, and deals +2d6 radiant damage vs. fiends/undead. As an action, I can stop or start its glow of bright light in a 30-ft radius and dim light for another 30 ft. It has 3 charges, regaining all at dawn, which can be used to throw it, after which it returns to my hand. See Notes.",
	descriptionFull : azuredgeFullDescription.replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	attunement : true,
	weight : 4,
	action : [["action", " (glow/end)"]],
	usages : 3,
	recovery : "dawn",
	additional : "throw",
	weaponsAdd : ["Azuredge"],
	weaponOptions : {
		baseWeapon : "battleaxe",
		regExpSearch : /azuredge/i,
		name : "Azuredge",
		source : ["WDH", 189],
		range : "Melee, 60/180 ft",
		description : "Versatile (1d10), thrown (1 charge); Returning; Ignores Shield spell; +2d6 radiant damage vs. fiends/undead",
		modifiers : [3,3]
	},
	spellcastingBonus : {
		name : "Once per dawn",
		spells : ["crusader's mantle"],
		selection : ["protection from evil and good"],
		firstCol : "oncelr"
	},
	toNotesPage : [{
		name : "Features",
		popupName : "Features of Azuredge",
		note : "\n   " + azuredgeFullDescription.replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/you /ig, "I ") + "\n\n" + sentientItemConflictTxt
	}]
}
MagicItemsList["badge of the watch"] = { // contains contributions by Pengsloth
	name : "Badge of the Watch",
	source : ["WDH", 189],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "F",
	description : "While wearing this badge and not using a shield, I gain +2 AC. If it is more than 5 ft away from me for over 1 minute, it vanishes and reappears within 5 ft of the Open Lord. While holding the badge, the Open Lord knows my location if we are both on the same plane and can, as an action end my attunement to it.",
	prerequisite : "Requires attunement by someone designated by the Open Lord of Waterdeep",
	prereqeval : function () { return false; },
	descriptionFull : "A badge of the Watch is given only to those who have earned the trust of the Open Lord of Waterdeep. The badge, signifying the rank of captain in Waterdeep's City Watch, bears the emblem of Waterdeep and is meant to be worn or carried.\n   While wearing the badge, you gain a +2 bonus to AC if you aren't using a shield.\n   If the badge is more than 5 feet away from you for more than 1 minute, it vanishes and harmlessly reappears on a surface within 5 feet of the Open Lord. While holding the badge, the Open Lord knows your location, provided the two of you are on the same plane of existence and your attunement to the badge hasn't ended.\n   As an action, the Open Lord can touch the badge and end your attunement to it.",
	attunement : true,
	extraAC : [{
		mod : 2,
		name : "Badge of the Watch",
		magic : true,
		text : "While wearing the badge, I gain a +2 bonus to AC if I'm not using a shield.",
		stopeval : function (v) {
			return v.usingShield;
		}
	}]
}
var blackstaffFullDescription = "The Blackstaff is a sentient, rune-carved staff set with thin silver veins. It is the symbol of office for the Blackstaff, the highest-ranking wizard in Waterdeep. As the rightful owner of the Blackstaff, Vajra Safahr is the only one who can become attuned to it. The staff can, however, choose a new owner (see \"Personality\" below).\n   This staff can be wielded as a magic quarterstaff that grants a +2 bonus to attack and damage rolls made with it. While holding it, you gain a +2 bonus to Armor Class, saving throws, and spell attack rolls.\n   The staff has 20 charges for the following properties. The staff regains 2d8+4 expended charges daily at dawn. If you expend the last charge, roll a d20. On a 1, the staff retains its +2 bonus to attack and damage roll but loses all other properties. On a 20, the staff regain 1d8+2 charges.\n   >>Power Strike<<. When you hit with a melee attack using the staff, you can expend 1 charge to deal an extra 1d6 force damage to the target.\n   >>Spells<<. While holding this staff, you can use an action to expend 1 or more of its charges to cast one of the following spells from it, using your spell save DC and spell attack bonus: Cone of Cold (5 charges), Fireball (5th-level version, 5 charges), Globe of Invulnerability (6 charges), Hold Monster (5 charges), Levitate (2 charges). Lightning Bolt (5th-level version, 5 charges), Magic Missile (1 charge), Ray of Enfeeblement (1 charge), or Wall of Force (5 charges).\n   >>Retributive Strike<<. You can use an action to break the staff over your knee or against a solid surface, performing a retributive strike. The staff is destroyed and releases its remaining magic in an explosion that expands to fill a 30-foot-radius sphere centered on it.\n   You have a 50% chance to instantly travel to a random plane of existence, avoiding the explosion. If you fail to avoid the effect, you take force damage equal to 16 \xD7 the number of charges in the staff. Every other creature in the area must make a DC 17 Dexterity saving throw. On a failed save, a creature takes an amount of damage based on how far away it is from the point of origin, as shown in the following table. On a successful save, a creature takes half as much damage.\n\n>>Distance from Origin\tEffect<<\n10 ft. away or closer\t8 \xD7 the number of charges in the staff\n11 to 20 ft. away\t6 \xD7 the number of charges in the staff\n21 to 30 ft. away\t4 \xD7 the number of charges in the staff\n\n\n   >>Animate Walking Statues<<. You can expend 1 or more of the staff's charges as an action to animate or deactivate one or more of the walking statues of Waterdeep. You must be in the city to use this property, and you can animate or deactivate one statue for each charge expended. An animated statue obeys the telepathic commands of Khelben Arunsun's spirit, which is trapped inside the staff (see \"Personality\" below). A walking statue becomes inanimate if deactivated or if the staff is broken.\n   >>Dispel Magic<<. You can expend 1 of the staff's charges as a bonus action to cast Dispel Magic on a creature, an object, or a magical effect that you touch with the tip of the staff. If the target is an unwilling creature or an object in the possession of such a creature, you must hit the creature with a melee attack using the Blackstaff before you can expend the charge to cast the spell.\n   >>Drain Magic<<. This property affects only creatures that use spell slots. When you hit such a creature with a melee attack using the Blackstaff, you can expend 1 of the staff's charges as a bonus action, causing the target to expend one spell slot of the highest spell level it can cast without casting a spell. If the target has already expended all its spell slots, nothing happens. Spell slots that are expended in this fashion are regained when the target finishes a long rest, as normal.\n   >>Master of Enchantment<<. When you cast an enchantment spell of 1st level or higher while holding the staff, you can make an Intelligence (Arcana) check with a DC of 10 + the level of the spell. If the check succeeds, you cast the spell without expending a spell slot.\n   >>Sentience<<. The Blackstaff is a sentient staff of neutral alignment, with an Intelligence of 22, a Wisdom of 15, and a Charisma of 18. It has hearing and darkvision out to a range of 120 feet, and it can communicate telepathically with any creature that is holding it.\n   >>Personality<<. The staff has the spirits of all previous Blackstaffs trapped within it. Its creator, Khelben Arunsun, is the dominant personality among them. Like Khelben, the staff is extremely devious and manipulative. It prefers to counsel its owner without exerting outright control. The staff's primary goal is to protect Waterdeep and its Open Lord, currently Laeral Silverhand. Its secondary goal is to help its wielder become more powerful.\n   In the event that the holder of the office of the Blackstaff no longer serves the staff's wishes, the staff ceases to function until it finds a worthy inheritor\u2014someone whose loyalty to Waterdeep is beyond reproach.\n   >>Spirit Trap<<. When the Blackstaff dies, the spirit of that individual becomes trapped in the staff along with the spirits of the previous Blackstaffs. (A Blackstaff whose spirit is trapped in the staff can't be raised from the dead.)\n   Destroying the staff would release the spirits trapped inside it, but in that event, Khelben's spirit can lodge itself inside any one piece of the staff that remains. The piece containing Khelben's spirit has the staff's Sentience property but none of its other properties. As long as this piece of the staff exists, Khelben's spirit can make the staff whole again whenever he wishes. When the staff is remade, the spirits of the previous Blackstaffs become trapped inside it again.";
MagicItemsList["blackstaff"] = {
	name : "Blackstaff",
	source : ["WDH", 190],
	type : "staff",
	rarity : "legendary",
	storyItemAL : true,
	description : "This +2 quarterstaff gives me a +2 bonus on saves, AC, and spell attacks. It has 20 charges, regaining 2d8+4 at dawn, which can be used to cast spells, deal +1d6 force damage in melee, drain magic from a target hit in melee, or animate walking statues. It is sentient and has more features, see Notes page.",
	descriptionFull : blackstaffFullDescription.replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	attunement : true,
	weight : 4,
	prerequisite : "Requires attunement by the Blackstaff heir, who must be a wizard",
	prereqeval : function(v) { return classes.known.wizard ? true : false; },
	usages : 20,
	recovery : "dawn",
	additional : "regains 2d8+4",
	weaponsAdd : ["Blackstaff"],
	weaponOptions : {
		baseWeapon : "quarterstaff",
		regExpSearch : /blackstaff/i,
		name : "Blackstaff",
		source : ["WDH", 190],
		description : "Versatile (1d8); On hit, use 1 charge for: +1d6 force damage or, as a bonus action, Drain Magic or Dispel Magic",
		modifiers : [2, 2]
	},
	calcChanges : {
		spellCalc : [
			function (type, spellcasters, ability) {
				if (type == "attack") return 2;
			},
			"While holding the Blackstaff, I have a +2 bonus to spell attack rolls."
		]
	},
	addMod : [{ type : "save", field : "all", mod : 2, text : "While holding the Blackstaff, I gain a +2 bonus to all my saving throws." }],
	extraAC : [{name : "Blackstaff", mod : 2, magic : true, text : "I gain a +2 bonus to AC while attuned."}],
	action : [
		["action"," (Animate Walking Statues)"],
		["action", " (Retributive Strike)"],
		["bonus action", " (Drain Magic)"]
	],
	spellcastingAbility : "class",
	spellFirstColTitle : "Ch",
	spellcastingBonus : MagicItemsList["staff of power"].spellcastingBonus.concat([{
		name : "1 charge",
		spells : ["dispel magic"],
		selection : ["dispel magic"],
		firstCol : 1
	}]),
	spellChanges : {
		"fireball" : MagicItemsList["staff of power"].spellChanges.fireball,
		"lightning bolt" : MagicItemsList["staff of power"].spellChanges["lightning bolt"],
		"dispel magic" : {
			time : "1 bns",
			range : "Melee atk",
			description : "Dispel all magic on crea or object hit with melee atk; DC 10+SL spellcasting ability check if level >3",
			changes : "Can cast as a bonus action, but only on something touched by the staff. It might first require an attack by the staff to be able to cast it on"
		}
	},
	toNotesPage : [{
		name : "Features",
		popupName : "Features of Blackstaff",
		note : "\n   " + blackstaffFullDescription.replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/you /ig, "I ")
	}, {
		name : "Sentient Item Features",
		note : sentientItemConflictTxt
	}]
}
MagicItemsList["bracer of flying daggers"] = {
	name : "Bracer of Flying Daggers",
	source : ["WDH", 190],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "This armband appears to have thin daggers strapped to it. As an action, I can pull up to two magic daggers from the bracer and immediately hurl them, making a ranged attack with each dagger. A dagger vanishes if I don't hurl it right away, and the daggers disappear right after they hit or miss.",
	descriptionFull : "This armband appears to have thin daggers strapped to it. As an action, you can pull up to two magic daggers from the bracer and immediately hurl them, making a ranged attack with each dagger. A dagger vanishes if you don't hurl it right away, and the daggers disappear right after they hit or miss. The bracer never runs out of daggers.",
	attunement : true,
	action : [["action", ""]],
	weaponsAdd : ["Bracer of Flying Daggers"],
	weaponOptions : {
		baseWeapon : "dagger",
		regExpSearch : /^(?=.*bracer)(?=.*flying)(?=.*dagger).*$/i,
		name : "Bracer of Flying Daggers",
		source : ["WDH", 190],
		range : "20/60 ft",
		description : "Finesse, light, thrown; As action, throw 2; Doesn't work with Attack action"
	}
}
MagicItemsList["dragonstaff of ahghairon"] = { // contains contributions by Pengsloth
	name : "Dragonstaff of Ahghairon",
	source : ["WDH", 191],
	type : "staff",
	rarity : "legendary",
	storyItemAL : true,
	description : "This staff has 10 charges, regaining 1d10 at dawn, which can be used to cast Command. Dragons have disadv. on their save against it. The staff gives me adv. on saves against the spells and breath weapons of dragons. I can touch a dragon with the staff, allowing it to ignore the effects of Ahghairon's Dragonward.",
	descriptionFull : "While holding the dragonstaff of Ahghairon, you have advantage on saving throws against the spells and breath weapons of dragons, as well as the breath weapons of other creatures of the dragon type (such as dragon turtles).\n   A creature of the dragon type that you touch with the staff can move through the city of Waterdeep, ignoring Ahghairon's dragonward (see \"Ahghairon's Dragonward,\" in the Introduction of Waterdeep: Dragon Heist). This effect lasts until the creature is touched again by the staff or until a time you proclaim when you confer the benefit.\n   The staff has 10 charges. While holding it, you can expend 1 charge as an action to cast the Command spell. If you target a dragon with this casting, the dragon has disadvantage on its saving throw. The staff regains 1d10 charges daily at dawn.",
	attunement : true,
	savetxt : { adv_vs : ["dragon breath weapons", "dragon spells"] },
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d10",
	spellcastingAbility : "class",
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name: "1 charge",
		spells: ["command"],
		selection: ["command"],
		firstCol : 1
	}],
	spellChanges : {
		"command" : {
			description : "1 crea, save or follow one word command, e.g. approach, drop, flee, halt; dragons disadv. on save",
			changes : "When this spell is cast on a dragon they have disadvantage on the saving throw."
		}
	}
}
MagicItemsList["feather of diatryma summoning"] = {
	name : "Feather of Diatryma Summoning",
	source : ["WDH", 191],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "D",
	description : "As an action once per 7 days, I can speak the command word and throw this feather to an empty large space in 5 ft, where it becomes a diatryma (axe beak stats) for 6 hours, until I speak the command again, or it reaches 0 hp. It is friendly, understands my languages, obeys my commands, and can be used as a mount.",
	descriptionFull : "This bright plume is made from the feather of a diatryma (pronounced dee-ah-TRY-mah), a Large, colorful, flightless bird native to the Underdark. If you use an action to speak the command word and throw the feather into a Large unoccupied space on the ground within 5 feet of you, the feather becomes a living diatryma for up to 6 hours, after which it reverts to its feather form. It reverts to feather form early if it drops to 0 hit points or if you use an action to speak the command word again while touching the bird.\n   When the diatryma reverts to feather form, the magic of the feather can't be used again until 7 days have passed.\n   The diatryma uses the statistics of an axe beak, except that its beak deals piercing damage instead of slashing damage. The creature is friendly to you and your companions, and it can be used as a mount. It understands your languages and obeys your spoken commands. If you issue no commands, the diatryma defends itself but takes no other actions.",
	attunement : true,
	usages : 1,
	recovery : "7 days",
	action : [["action", ""]]
}
MagicItemsList["knave's eye patch"] = { // contains contributions by Pengsloth
	name : "Knave's Eye Patch",
	source : ["WDH", 191],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "While wearing this eye patch I have advantage on Perception checks that rely on sight, I am unaffected by Sunlight Sensitivity if I have it, and I am immune to magic that would read my thoughts or determine whether I'm lying. Creatures can communicate telepathically with me only if I allow it.",
	descriptionFull : "While wearing this eye patch, you gain these benefits:\n \u2022 You have advantage on Wisdom (Perception) checks that rely on sight.\n \u2022 If you have the Sunlight Sensitivity trait, you are unaffected by the trait.\n \u2022 You are immune to magic that allows other creatures to read your thoughts or determine whether you are lying. Creatures can communicate telepathically with you only if you allow it.",
	attunement : true,
	vision : [["Adv. on Perception checks relying on sight", 0]]
}
MagicItemsList["lord's ensemble"] = {
	name : "Lord's Ensemble",
	source : ["WDH", 191],
	type : "wondrous item",
	rarity : "very rare",
	storyItemAL : true,
	prerequisite : "Requires attunement by a creature with a humanoid build",
	description : "While wearing this helm, amulet, and ring, my identity can't be determined. I move through difficult terrain as normal terrain. Magic can't be used to reduce my speed, paralyze me, restrain me, read my thoughts, or learn my alignment, creature type, or if I'm lying. I'm hidden from scrying and Divination magic.",
	descriptionLong : "This set of a helm, amulet, and ring can be worn and attuned to as a single magic item, but only while within Waterdeep. The helm magically alters my voice to sound genderless, and makes me immune to magic that reads my thoughts, determines if I'm lying, or reveals my alignment or creature type. Creatures can't speak telepathically with me unless I allow it. The amulet causes me to be hidden from Divination magic and magical scrying sensors. The robe makes me look nondescript, makes difficult terrain not cost me extra movement, and stops magic from reducing my speed or me to be paralyze or restrained.",
	descriptionFull : "The Masked Lords of Waterdeep don this ensemble when meeting with one another. This raiment renders each lord indistinguishable from the others. The ensemble consists of three pieces\u2014a helm, an amulet, and a robe\u2014that function as a single magic item when worn together, but only within the city of Waterdeep and its sewers. You become attuned to the ensemble as a single item.\n   " + toUni("Lord's Helm") + ". This bucket helm covers your head and conceals your face. Screens over the eyes help to shroud your identity without blinding you. While you wear the helm, your voice is magically altered to sound genderless, and you are immune to magic that allows other creatures to read your thoughts, to determine whether you are lying, to know your alignment, or to know your creature type. Creatures can communicate telepathically with you only if you allow it.\n   " + toUni("Lord's Amulet") + ". This amulet bears the crest of Waterdeep. It functions as an amulet of proof against detection and location.\n   " + toUni("Lord's Robe") + ". This elegant robe functions as a ring of free action, and it creates the illusion that you have a nondescript, androgynous humanoid build and stand 6 feet tall.",
	attunement : true,
	savetxt : { immune : ["paralyzed", "restrained"] }
}
MagicItemsList["paper bird"] = {
	name : "Paper Bird",
	source : ["WDH", 191],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "B",
	description : "I can write up to 50 words on a sheet of the 1d6+3 in this box and speak a creature's name, causing the parchment to fold into a Tiny bird and fly to that creature on the same plane if it isn't stopped. It has 60 ft fly speed, 1 HP, AC 13, Dex 16, 1 in all other ability scores, and immunity to poison and psychic damage.",
	descriptionFull : "After you write a message of fifty words or fewer on this magic sheet of parchment and speak a creature's name, the parchment magically folds into a Tiny paper bird and flies to the recipient whose name you uttered. The recipient must be on the same plane of existence as you, otherwise the bird turns into ash as it takes flight.\n   The bird is an object that has 1 hit point, an Armor Class of 13, a flying speed of 60 feet, a Dexterity of 16 (+3), and a score of 1 (\u22125) in all other abilities, and it is immune to poison and psychic damage.\n   It travels to within 5 feet of its intended recipient by the most direct route, whereupon it turns into a nonmagical and inanimate sheet of parchment that can be unfolded only by the intended recipient. If the bird's hit points or speed is reduced to 0 or if it is otherwise immobilized, it turns into ash.\n   Paper birds usually come in small, flat boxes containing 1d6 + 3 sheets of the parchment.",
	usages : "1d6+3",
	recovery : "Never"
}
MagicItemsList["ring of truth telling"] = {
	name : "Ring of Truth Telling",
	source : ["WDH", 192],
	type : "ring",
	rarity : "uncommon",
	magicItemTable : "B",
	description : "While wearing this ring, I have advantage on Wisdom (Insight) checks to determine whether someone is lying to me.",
	descriptionFull : "While wearing this ring, you have advantage on Wisdom (Insight) checks to determine whether someone is lying to you.",
	attunement : true
}
MagicItemsList["smokepowder"] = {
	name : "Smokepowder",
	source : ["WDH", 192],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "B",
	description : "",
	descriptionFull : "Smokepowder is a magical explosive chiefly used to propel a bullet out of the barrel of a firearm. It is stored in airtight wooden kegs or tiny, waterproof leather packets. A packet contains enough smokepowder for five shots, and a keg holds enough smokepowder for five hundred shots.\n   If smokepowder is set on fire, dropped, or otherwise handled roughly, it explodes and deals fire damage to each creature or object within 20 feet of it: 1d6 for a packet, 9d6 for a keg. A successful DC 12 Dexterity saving throw halves the damage.\n   Casting Dispel Magic on smokepowder renders it permanently inert.",
	allowDuplicates : true,
	choices : ["Keg (500 shots)", "Packet (5 shots)"],
	"packet (5 shots)" : {
		name : "Smokepowder Packet",
		description : "This magical explosive is used to propel a bullet out of a firearm. These tiny, waterproof leather packets contain enough for five shots. Casting dispel magic on it renders it permanently inert. If it is set on fire, dropped, or handled roughly, it explodes and deals 1d6 fire damage to all within 20 ft, DC 12 Dex save halves.",
		usages : 5,
		recovery : "Never",
		additional : "shots",
		weight : 0.1, // 7000 grains per lb, 100 grains per shot
		extraTooltip : "AL: can be purchased for 1 treasure checkpoint. Once found, this item goes on a character's evergreen list of available items.",
	},
	"keg (500 shots)" : {
		name : "Smokepowder Keg",
		description : "This magical explosive is used to propel a bullet out of a firearm. This airtight wooden kegs contain enough for five hundred shots. Casting dispel magic on it renders it permanently inert. If it is set on fire, dropped, or handled roughly, it explodes and deals 9d6 fire damage to all within 20 ft, DC 12 Dex save halves.",
		usages : 500,
		recovery : "Never",
		additional : "shots",
		weight : 12 // 7000 grains per lb, 100 grains per shot (+2 for the keg itself)
	}
}
var iFileName = "pub_20181107_LLoK.js";
RequiredSheetVersion(13);
// This file adds the magic items from the Lost Laboratory of Kwalish adventure to MPMB's Character Record Sheet

// Define the source
SourceList["LLoK"] = {
	name : "Lost Laboratory of Kwalish [items, spells]",
	abbreviation : "LLoK",
	group : "Adventure Books",
	url : "https://www.dmsguild.com/product/258047",
	date : "2018/11/07"
};

// Magic Items
MagicItemsList["blade of the medusa"] = {
	name : "Blade of the Medusa",
	nameTest : "of the Medusa",
	source : ["LLoK", 53],
	type : "weapon (any sword)",
	rarity : "very rare",
	magicItemTable : "H",
	description : "I'm unwilling to part with this magic blade. When I attack a creature with it and roll a 20 to hit, it must make a DC 15 Con save or be restrained, and on a roll of 1, I must make that save. At the end of each of the target's turns, it can save again, ending the effect with 3 successes, or petrified for 1 hour after 3 failures.",
	descriptionLong : "I'm unwilling to part with this magic sword. When I attack a creature with it and roll a 20 to hit, it must make a DC 15 Constitution save or be restrained. However, if I roll of 1 on the attack roll, I must make that same save. At the end of each of the effected target's turns, it can make the save again. If it successfully saves against this effect three times, the effect ends. However, if it failed three times, it is turned to stone and petrified for 1 hour. A creature is immune to this effect if it is immune to damage of the weapon's type, does not have a body made of flesh, or has legendary actions.",
	descriptionFull : "When you attack a creature with this magic weapon and roll a 20 on the attack roll, the creature must make a DC 15 Constitution saving throw in addition to suffering the attack's normal effects. On a failed save, the creature is restrained and must make another Constitution saving throw at the end of each of its turns. If it successfully saves against this effect three times, the effect ends. If it fails its saves three times, it is turned to stone and subjected to the petrified condition for 1 hour.\n   A creature is immune to this effect if it is immune to damage of the weapon's type, does not have a body made of flesh, or has legendary actions.\n   " + toUni("Curse") + ". This weapon is cursed, and becoming attuned to it extends the curse to you. Until the curse is broken with a remove curse spell or similar magic, you are unwilling to part with the weapon. Whenever you attack a creature with this weapon and roll a 1 on the attack roll, you must succeed on a DC 15 Constitution saving throw or be restrained and forced to make additional saves against being petrified, as above.",
	attunement : true,
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "prefix",
		descriptionChange : ["replace", "sword"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /sword|scimitar|rapier/i;
			return !(testRegex).test(inObjKey) && (!inObj.baseWeapon || !(testRegex).test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/of the medusa/i).test(v.WeaponText)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + 'On 20 to hit: DC 15 Con save or restrained, see item; On 1 to hit: I same save';
				}
			},
			'If I include the words "of the Medusa" in a the name of a sword, it will be treated as the magic weapon Blade of the Medusa.'
		]
	}
}
MagicItemsList["galder's bubble pipe"] = {
	name : "Galder's Bubble Pipe",
	source : ["LLoK", 55],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G",
	description : "This finely carved pipe has 3 charges, regaining all at dawn, which I can use to cast spells. As an action, I can expend all 3 charges to summon a steam mephit. It acts on its own initiative, is friendly to me, obeys my verbal commands, and disappears after 1 minute or if it ends its turn more than 60 ft from the pipe.",
	descriptionFull : "This finely carved pipe blows odorless bubbles instead of smoke when used. The pipe has 3 charges, and it regains all spent charges daily at dawn. While you hold the pipe, you can expend charges to gain access to the following properties:\n \u2022 You can cast Fog Cloud as an action (1 charge).\n \u2022 You can cast Misty Step as a bonus action (2 charges).\n \u2022 You can summon a steam mephit as an action (3 charges). The mephit is friendly to you, obeys your verbal commands, and acts on its own turn in the initiative order. It disappears in a harmless puff of steam after 1 minute or if it ends its turn more than 60 feet from the pipe.",
	attunement : true,
	usages : 3,
	recovery : "dawn",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["fog cloud"],
		selection : ["fog cloud"],
		firstCol : 1
	}, {
		name : "2 charges",
		spells : ["misty step"],
		selection : ["misty step"],
		firstCol : 2
	}]
}
MagicItemsList["gambler's blade"] = {
	name : "Gambler's Blade",
	nameTest : "Gambler's",
	source : ["LLoK", 55],
	type : "weapon (any sword)",
	rarity : "rare",
	magicItemTable : "H",
	description : "I am unwilling to part with this sword until I'm freed of its curse. Each day at dawn, I can choose its magical bonus to attack and damage rolls of +1, +2, or +3. However, I take a corresponding penalty (-1, -2, or -3) to my death saving throws.",
	descriptionFull : "Choose a magical bonus of +1 to +3. This sword gains that bonus to its attack and damage rolls. For each point of bonus you choose for the sword, you take a corresponding penalty (-1 to -3) to your death saving throws. You can change this magical bonus each day at dawn.\n   " + toUni("Curse") + ". This weapon is cursed, and becoming attuned to it extends the curse to you. Until the curse is broken with a remove curse spell or similar magic, you are unwilling to part with the weapon.",
	attunement : true,
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "sword"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /sword|scimitar|rapier/i;
			return !(testRegex).test(inObjKey) && (!inObj.baseWeapon || !(testRegex).test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/gambler's/i).test(v.WeaponText)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + 'Choose its magic bonus (1-3), but equal penalty on death saves';
				}
			},
			"If I include the word \"Gambler's\" in a the name of a sword, it will be treated as the magic weapon Gambler's Blade."
		]
	}
}
MagicItemsList["heward's hireling armor"] = {
	name : "Heward's Hireling Armor",
	nameAlt : "Hireling Armor",
	source : ["LLoK", 55],
	type : "armor (leather)",
	rarity : "very rare",
	magicItemTable : "G",
	description : "This leather armor gives me a +1 bonus to AC and allows me to draw or stow two one-handed weapons when I would normally be able to draw or stow only one. It has 6 pockets that hold 20 lb (2 cu ft) each as they are extradimensional spaces. Retrieving an item from a pocket requires an action.",
	descriptionFull : "A number of Kwalish's experiments were attempts to research the works of the legendary mage Heward, who first crafted what he named hireling armor. While wearing this armor, you gain a +1 bonus to AC. In addition, the armor's animated straps can assist with the drawing and sheathing of weapons, such that you can draw or stow two one-handed weapons when you would normally be able to draw or stow only one.\n   This armor also has six pockets, each of which is an extradimensional space. Each pocket can hold up to 20 pounds of material, not exceeding a volume of 2 cubic feet. The armor always weighs 10 pounds, regardless of its pockets' contents. Placing an object into one of the armor's pockets follows the normal rules for interacting with objects. Retrieving an item from a pocket of the armor requires you to use an action. When you reach into a pocket for a specific item, the item is always magically on top.\n   Placing the armor inside an extradimensional space created by a bag of holding, a Heward's handy haversack, or a similar item instantly destroys both items and opens a gate to the Astral Plane. The gate originates where the one item was placed inside the other. Any creature within 10 feet of the gate is sucked through it and deposited in a random location on the Astral Plane. The gate then closes. The gate is one-way only and can't be reopened.",
	weight : 10,
	action : [["action", " (retrieve item)"]],
	armorAdd : "Heward's Hireling Armor",
	armorOptions : {
		regExpSearch : /^(?=.*heward)(?=.*hireling)(?=.*armor).*$/i,
		name : "Heward's Hireling Armor",
		source : ["LLoK", 55],
		type : "light",
		ac : 12,
		weight : 10
	}
}
if (MagicItemsList["ioun stone"]) {
	MagicItemsList["ioun stone"].choices = MagicItemsList["ioun stone"].choices.concat(["Supreme Intellect", "Historical Knowledge", "Natural Knowledge", "Religious Knowledge", "Language Knowledge", "Self-Preservation"]);
	MagicItemsList["ioun stone"].choices.sort();
	MagicItemsList["ioun stone"].incrementSkill = function (aSkill, iType, forceRemove) {
		if (SkillsList.abbreviations.indexOf(aSkill) == -1) return;
		var aIndx = SkillsList.abbreviations.indexOf(aSkill);
		var aFld = (Who("Text.SkillsNames") === "alphabeta" ? aSkill : SkillsList.abbreviationsByAS[aIndx]) + " Bonus";
		var iSkill = SkillsList.names[aIndx];
		var iName = "Ioun Stone of " + iType;
		var iTxt = "While the " + iName + " orbits my head and I'm proficient with the " + iSkill + " skill, I gain a +1 bonus on checks with it.";
		var addIt = forceRemove ? false : CurrentProfs.skill[aSkill] && CurrentProfs.skill[aSkill].length > 1;
		var hasBonus = How(aFld).indexOf(iTxt) !== -1;
		if (hasBonus !== addIt) {
			processMods( addIt, iName + " (magic item)", [{ type : "skill", field : aSkill, mod : 1, text : iTxt }] );
		}
	}
	MagicItemsList["ioun stone"]["supreme intellect"] = {
		source : ["LLoK", 55],
		rarity : "rare",
		magicItemTable : "G",
		description : "As an action, I can make this faceted sphere orbit my head at 1d3 ft or retrieve it. Others can catch it as an action with an attack or Acrobatics check (AC/DC 24). It has 10 HP and resistance to all damage. While it orbits my head, I gain a +1 bonus on Intelligence checks.",
		descriptionFull : "An Ioun stone is named after Ioun, a god of knowledge and prophecy revered on some worlds. Many types of Ioun stone exist, each type a distinct combination of shape and color.\n   When you use an action to toss one of these stones into the air, the stone orbits your head at a distance of 1d3 feet and confers a benefit to you. Thereafter, another creature must use an action to grasp or net the stone to separate it from you, either by making a successful attack roll against AC 24 or a successful DC 24 Dexterity (Acrobatics) check. You can use an action to seize and stow the stone, ending its effect.\n   A stone has AC 24, 10 hit points, and resistance to all damage. It is considered to be an object that is being worn while it orbits your head.\n   You gain a +1 bonus to Intelligence checks while this faceted sphere orbits your head.",
		addMod : [
			{ type : "skill", field : "Arcana", mod : 1, text : "While the Ioun stone of Supreme Intellect orbits my head, I gain a +1 bonus on Intelligence checks." },
			{ type : "skill", field : "History", mod : 1, text : "While the Ioun stone of Supreme Intellect orbits my head, I gain a +1 bonus on Intelligence checks." },
			{ type : "skill", field : "Investigation", mod : 1, text : "While the Ioun stone of Supreme Intellect orbits my head, I gain a +1 bonus on Intelligence checks." },
			{ type : "skill", field : "Nature", mod : 1, text : "While the Ioun stone of Supreme Intellect orbits my head, I gain a +1 bonus on Intelligence checks." },
			{ type : "skill", field : "Religion", mod : 1, text : "While the Ioun stone of Supreme Intellect orbits my head, I gain a +1 bonus on Intelligence checks." }
		]
	}
	MagicItemsList["ioun stone"]["historical knowledge"] = {
		source : ["LLoK", 55],
		rarity : "rare",
		magicItemTable : "G",
		description : "As an action, I can make this polished, steely sphere orbit my head at 1d3 ft or retrieve it. Others can catch it as an action with an attack or Acrobatics check (AC/DC 24). It has resistance to all damage and 10 HP. While it orbits my head, I gain proficiency in the History skill, or a +1 bonus with it if I'm already proficient.",
		descriptionFull : "An Ioun stone is named after Ioun, a god of knowledge and prophecy revered on some worlds. Many types of Ioun stone exist, each type a distinct combination of shape and color.\n   When you use an action to toss one of these stones into the air, the stone orbits your head at a distance of 1d3 feet and confers a benefit to you. Thereafter, another creature must use an action to grasp or net the stone to separate it from you, either by making a successful attack roll against AC 24 or a successful DC 24 Dexterity (Acrobatics) check. You can use an action to seize and stow the stone, ending its effect.\n   A stone has AC 24, 10 hit points, and resistance to all damage. It is considered to be an object that is being worn while it orbits your head.\n   You gain proficiency in the History skill, or a +1 bonus to checks with that skill if already proficient, while this polished, steely sphere orbits your head.",
		skills : ["History"],
		changeeval : function () { MagicItemsList["ioun stone"].incrementSkill("His", "Historical Knowledge"); },
		removeeval : function () { MagicItemsList["ioun stone"].incrementSkill("His", "Historical Knowledge", true); }
	}
	MagicItemsList["ioun stone"]["natural knowledge"] = {
		source : ["LLoK", 55],
		rarity : "rare",
		magicItemTable : "G",
		description : "As an action, I can make this burnished, brassy stone orbit my head at 1d3 ft or retrieve it. Others can catch it as an action with an attack or Acrobatics check (AC/DC 24). It has resistance to all damage and 10 HP. While it orbits my head, I gain proficiency in the Nature skill, or a +1 bonus with it if I'm already proficient.",
		descriptionFull : "An Ioun stone is named after Ioun, a god of knowledge and prophecy revered on some worlds. Many types of Ioun stone exist, each type a distinct combination of shape and color.\n   When you use an action to toss one of these stones into the air, the stone orbits your head at a distance of 1d3 feet and confers a benefit to you. Thereafter, another creature must use an action to grasp or net the stone to separate it from you, either by making a successful attack roll against AC 24 or a successful DC 24 Dexterity (Acrobatics) check. You can use an action to seize and stow the stone, ending its effect.\n   A stone has AC 24, 10 hit points, and resistance to all damage. It is considered to be an object that is being worn while it orbits your head.\n   You gain proficiency in the Nature skill, or a +1 bonus to checks with that skill if already proficient, while this burnished, brassy stone orbits your head.",
		skills : ["Nature"],
		changeeval : function () { MagicItemsList["ioun stone"].incrementSkill("Nat", "Natural Knowledge"); },
		removeeval : function () { MagicItemsList["ioun stone"].incrementSkill("Nat", "Natural Knowledge", true); }
	}
	MagicItemsList["ioun stone"]["religious knowledge"] = {
		source : ["LLoK", 55],
		rarity : "rare",
		magicItemTable : "G",
		description : "As an action, I can make this tiny golden gem orbit my head at 1d3 ft or retrieve it. Others can catch it as an action with an attack or Acrobatics check (AC/DC 24). It has resistance to all damage and 10 HP. While it orbits my head, I gain proficiency in the Religion skill, or a +1 bonus with it if I'm already proficient.",
		descriptionFull : "An Ioun stone is named after Ioun, a god of knowledge and prophecy revered on some worlds. Many types of Ioun stone exist, each type a distinct combination of shape and color.\n   When you use an action to toss one of these stones into the air, the stone orbits your head at a distance of 1d3 feet and confers a benefit to you. Thereafter, another creature must use an action to grasp or net the stone to separate it from you, either by making a successful attack roll against AC 24 or a successful DC 24 Dexterity (Acrobatics) check. You can use an action to seize and stow the stone, ending its effect.\n   A stone has AC 24, 10 hit points, and resistance to all damage. It is considered to be an object that is being worn while it orbits your head.\n   You gain proficiency in the Religion skill, or a +1 bonus to checks with that skill if already proficient, while this tiny golden gem orbits your head.",
		skills : ["Religion"],
		changeeval : function () { MagicItemsList["ioun stone"].incrementSkill("Rel", "Religious Knowledge"); },
		removeeval : function () { MagicItemsList["ioun stone"].incrementSkill("Rel", "Religious Knowledge", true); }
	}
	MagicItemsList["ioun stone"]["language knowledge"] = {
		source : ["LLoK", 55],
		rarity : "rare",
		magicItemTable : "G",
		description : "As an action, I can make this pulsating bit of red jeweled crystal orbit my head at 1d3 ft or retrieve it. Others can catch it as an action with an attack or Acrobatics check (AC/DC 24). It has 10 HP and resistance to all damage. While it orbits my head, I am fluent in one additional language chosen by the DM.",
		descriptionFull : "An Ioun stone is named after Ioun, a god of knowledge and prophecy revered on some worlds. Many types of Ioun stone exist, each type a distinct combination of shape and color.\n   When you use an action to toss one of these stones into the air, the stone orbits your head at a distance of 1d3 feet and confers a benefit to you. Thereafter, another creature must use an action to grasp or net the stone to separate it from you, either by making a successful attack roll against AC 24 or a successful DC 24 Dexterity (Acrobatics) check. You can use an action to seize and stow the stone, ending its effect.\n   A stone has AC 24, 10 hit points, and resistance to all damage. It is considered to be an object that is being worn while it orbits your head.\n   You are fluent in one additional language while this pulsating bit of red jeweled crystal orbits your head. The DM chooses the language bestowed by the stone.",
		languageProfs : [1]
	}
	MagicItemsList["ioun stone"]["self-preservation"] = {
		source : ["LLoK", 55],
		rarity : "rare",
		description : "As an action, I can make this silvery gem orbit my head at 1d3 ft or retrieve it. Others can catch it as an action with an attack or Acrobatics check (AC/DC 24). It has 10 HP and resistance to all damage. While it orbits my head, I gain a +1 bonus to Intelligence saving throws.",
		descriptionFull : "An Ioun stone is named after Ioun, a god of knowledge and prophecy revered on some worlds. Many types of Ioun stone exist, each type a distinct combination of shape and color.\n   When you use an action to toss one of these stones into the air, the stone orbits your head at a distance of 1d3 feet and confers a benefit to you. Thereafter, another creature must use an action to grasp or net the stone to separate it from you, either by making a successful attack roll against AC 24 or a successful DC 24 Dexterity (Acrobatics) check. You can use an action to seize and stow the stone, ending its effect.\n   A stone has AC 24, 10 hit points, and resistance to all damage. It is considered to be an object that is being worn while it orbits your head.\n   You gain a +1 bonus to Intelligence saving throws while this silvery gem orbits your head.",
		addMod : [{ type : "save", field : "Int", mod : 1, text : "While the Ioun stone of Self-Preservation orbits my head, I gain a +1 bonus to Intelligence saving throws." }]
	}
}
var leatherGolemArmorFullDescription = [
	"Strange rituals have repurposed the body of a flesh golem into this partially sentient suit of leather armor. While wearing this armor, you gain the following benefits:",
	"\u2022 You gain a +1 bonus to AC and to saving throws against spells and other magical effects.",
	"\u2022 >>Immutable Form<<. You are immune to any spell or effect that would alter your form.",
	"\u2022 >>Lightning Absorption<<. You gain resistance to lightning damage. Whenever you take lightning damage, you gain 5 temporary hit points.",
	">>Curse<<. This armor is cursed, and it extends to whomever becomes attuned to it. Until the curse is broken with a remove curse spell or similar magic, you are unwilling to part with the armor. In addition, while you wear the cursed armor, you gain the following properties:",
	"\u2022 >>Aversion of Fire<<. If you take fire damage, you have disadvantage on attack rolls and ability checks until the end of your next turn.",
	"\u2022 >>Berserk<<. Whenever you suffer a critical hit, roll a d6. On a 6, you go beserk because of the armor. On each of your turns while berserk, you attack the nearest creature you can see. If no creature is near enough to move to and attack, you attack an object, with preference for an object smaller than yourself. Once you go beserk because of the armor, it cannot be removed. You continue to attack until you are incapacitated or until another creature is able to change your state of mind with appropriate magic (such as a calm emotions spell) or a successful DC 15 Charisma (Persuasion) check."
];
MagicItemsList["leather golem armor"] = {
	name : "Leather Golem Armor",
	source : ["LLoK", 55],
	type : "armor (leather)",
	rarity : "rare",
	magicItemTable : "G",
	description : "I am unwilling to part with this leather armor until its curse is lifted from me, see Notes page. The curse makes me go berserk and have an aversion to fire. It gives me a +1 bonus to AC and saves vs. spells and magical effects. I have resistance to lightning damage and when I suffer such damage, I gain 5 temporary HP.",
	descriptionFull : leatherGolemArmorFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	attunement : true,
	weight : 10,
	dmgres : ["Lightning"],
	cursed : true,
	armorAdd : "Leather Golem Armor",
	armorOptions : {
		regExpSearch : /^(?=.*leather)(?=.*golem)(?=.*armor).*$/i,
		name : "Leather Golem Armor",
		source : ["LLoK", 55],
		type : "light",
		ac : 12,
		weight : 10
	},
	savetxt : { text : ["+1 vs. spells and magical effects"] },
	toNotesPage : [{
		name : "Features",
		popupName : "Features of Leather Golem Armor",
		note : desc(leatherGolemArmorFullDescription).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/you are /ig, "I am ").replace(/you /ig, "I ")
	}]
}
var polymorphBladeFullDescription = [
	"When you attack a creature with this magic weapon and roll a 20 on the attack roll, the creature must make a DC 15 Wisdom saving throw in addition to suffering the attack's normal effects. On a failed save, the creature also suffers the effects of a polymorph spell. Roll a d20 and consult the following table to determine the form the target creature is transformed into.",
	">>d20\tNew Form   \td20\tNew Form<<",
	"  1\tTyrannosaurus\t 11\tWolf",
	"  2\tGiant ape    \t 12\tHorse",
	"  3\tElephant     \t 13\tOx",
	"  4\tGiant scorpion\t 14\tGiant frog",
	"  5\tRhinoceros   \t 15\tPoisonous snake",
	"  6\tPolar bear   \t 16\tHawk",
	"  7\tGiant toad   \t 17\tOctopus",
	"  8\tGiant eagle  \t 18\tCat",
	"  9\tBlack bear   \t 19\tRat",
	"10\tCrocodile     \t 20\tRabbit",
	"A creature is immune to this effect if it is immune to damage of the weapon's type, is a shapechanger, or has legendary actions.",
	">>Curse<<. This weapon is cursed, and it extends to whomever becomes attuned to it. Until the curse is broken with a Remove Curse spell or similar magic, you are unwilling to part with the weapon. Whenever you attack a creature with this weapon and roll a 1 on the attack roll, you suffer the effect of a polymorph spell for 1 hour, rolling on the table to determine your new form."
];
MagicItemsList["polymorph blade"] = {
	name : "Polymorph Blade",
	nameTest : "Polymorph",
	source : ["LLoK", 59],
	type : "weapon (any sword)",
	rarity : "very rare",
	magicItemTable : "H",
	description : "I'm unwilling to part with this magic double-bladed . When I attack a creature with it and roll a 20 to hit, the creature must make a DC 15 Wisdom save or be polymorphed for 1 hour into a random beast (see Notes page). However, on a roll of 1 to hit, I am the one being polymorphed for 1 hour without a save.",
	descriptionFull : polymorphBladeFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	attunement : true,
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "sword"],
		excludeCheck : function (inObjKey, inObj) {
			var testRegex = /sword|scimitar|rapier/i;
			return !(testRegex).test(inObjKey) && (!inObj.baseWeapon || !(testRegex).test(inObj.baseWeapon));
		}
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && v.isMeleeWeapon && (/sword|scimitar|rapier/i).test(v.baseWeaponName) && (/polymorph/i).test(v.WeaponText)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + 'On 20 to hit: DC 15 Wis save or polymorphed, see item; On 1 to hit: I polymorph';
				}
			},
			'If I include the word "Polymorph" in a the name of a sword, it will be treated as the magic weapon Polymorph Blade.'
		]
	},
	toNotesPage : [{
		name : "Features",
		popupName : "Features of a Polymorph Blade",
		note : desc(polymorphBladeFullDescription).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/you are /ig, "I am ").replace(/you /ig, "I ")
	}]
}
var poweredArmorFullDescription = [
	"Powered armor resembles a suit of unusual plate armor, with finely articulated joints connected by an oily, black, leather-like material. The armor has been worked to create the appearance of a heavily muscled warrior, and its great helm is unusual in that it has no openings\u2014only a broad glass plate in the front with a second piece of glass above it. Strange plates, tubing, and large metal bosses adorn the armor in seemingly random fashion. On the back of the armor's left gauntlet is a rectangular metal box, from which projects a short rod tipped with a cone-shaped red crystal.",
	"While wearing this armor, you gain the following benefits:",
	"\u2022 You have a +1 bonus to AC.",
	"\u2022 Your Strength score is 18 (this has no effect if your Strength is already 18 or higher).",
	"\u2022 You have advantage on death saving throws.",
	"The armor has further capabilities that can be powered either by energy cells or by your own life energy. You can use a bonus action to draw power from an energy cell or sacrifice hit points to gain one of the following benefits:",
	"\u2022 Emit a force field to gain 2d6 + 5 temporary hit points (1 charge or 5 hit points).",
	"\u2022 Activate boosters to gain a flying speed of 15 feet for 1 minute (1 charge or 5 hit points).",
	"\u2022 Fire arm-mounted laser: +8 to hit, range 120 feet, one target. 2d6 radiant damage (1 charge or 5 hit points).",
	"\u2022 Translate any writing you can see in any nonmagical language, to a total of one thousand words over 1 minute (1 charge or 5 hit points).",
	"\u2022 Fill the armor with air, so you can breathe normally in any environment for up to 1 hour (1 charge or 5 hit points).",
	"u2022 Gain darkvision to a range of 60 feet for up to 1 hour (1 charge or 5 hit points).",
	"The armor can accept only one energy cell at a time. It is found with one energy cell attached, containing 2d10 charges."
];
MagicItemsList["powered armor"] = {
	name : "Powered Armor",
	source : ["LLoK", 56],
	type : "armor (plate)",
	rarity : "legendary",
	notLegalAL : true,
	description : "This unusual plate armor looks like a heavily muscled warrior with a helm without openings. It gives me a +1 bonus to AC, increases my Strength to 18, and adv. on death saves. As a bonus action, I can use charges from its energy cell or expend my own HP to have it do various things, see Notes page.",
	descriptionFull : poweredArmorFullDescription.join("\n   "),
	attunement : true,
	weight : 65,
	scoresOverride : [18, 0, 0, 0, 0, 0],
	savetxt : { text : ["Adv. on death saves"] },
	action : [["bonus action", " (use energy)"]],
	armorAdd : "Powered Armor",
	armorOptions : {
		regExpSearch : /^(?=.*powered)(?=.*armor).*$/i,
		name : "Powered Armor",
		source : ["LLoK", 56],
		type : "heavy",
		ac : 19,
		stealthdis : true,
		weight : 65,
		strReq : 15
	},
	usages : "2d10",
	recovery : "Never",
	additional : "energy cell",
	toNotesPage : [{
		name : "Features",
		popupName : "Features of Powered Armor",
		note : desc(poweredArmorFullDescription).replace(/your/g, "my").replace(/you /ig, "I ")
	}],
	weaponsAdd : ["Arm-Mounted Laser"],
	weaponOptions : {
		regExpSearch : /^(?=.*arm)(?=.*mounted)(?=.*laser).*$/i,
		name : "Arm-Mounted Laser",
		source : ["LLoK", 56],
		ability : 0,
		type : "Magic Item",
		damage : [2, 6, "radiant"],
		range : "120 ft",
		description : "Bonus action; Uses 1 charge or 5 HP",
		abilitytodamage : false,
		modifiers : [8, ""]
	}
}

// Spells (contain contributions by /u/KittenWithMittens)
SpellsList["flock of familiars"] = {
    name: "Flock of Familiars",
    classes: ["warlock", "wizard"],
    source: ["LLoK", 57],
    level: 2,
    school: "Conj",
    time: "1 min",
    range: "Touch",
    components: "V,S",
    duration: "Conc, 1 h",
    description : "Summon 3+1/SL familiars as Find Familiar; can see through their eyes and deliver touch spells; see B",
    descriptionFull: "You temporarily summon three familiars\u2014spirits that take animal forms of your choice. Each familiar uses the same rules and options for a familiar conjured by the find familiar spell. All the familiars conjured by this spell must be the same type of creature (celestials, fey, or fiends; your choice). If you already have a familiar conjured by the find familiar spell or similar means, then one fewer familiars are conjured by this spell.\n   Familiars summoned by this spell can telepathically communicate with you and share their visual or auditory senses while they are within 1 mile of you.\n   When you cast a spell with a range of touch, one of the familiars conjured by this spell can deliver the spell, as normal. However, you can cast a touch spell through only one familiar per turn." + AtHigherLevels + "When you cast this spell using a spell slot of 3rd level or higher, you conjure an additional familiar for each slot level above 2nd."
}
SpellsList["galder's speedy courier"] = {
    name: "Galder's Speedy Courier",
    classes: ["warlock", "wizard"],
    source: ["LLoK", 57],
    level: 4,
    school: "Conj",
    time: "1 a",
    range: "10 ft",
    components: "V,S,M\u2020",
    compMaterial: "25 gp, or mineral goods of equivalent value, which the spell consumes",
    duration: "10 min",
	description: "Send 3\xD73\xD73 ft chest of items I put in it to named crea on same plane; SL8: other plane (25gp cons.)",
	descriptionMetric : "Send 1\xD71\xD71 m chest of items I put in it to named crea on same plane; SL8: other plane (25gp cons.)",
    descriptionFull: "You summon a Small air elemental to a spot within range. The air elemental is formless, nearly transparent, immune to all damage, and cannot interact with other creatures or objects. It carries an open, empty chest whose interior dimensions are 3 feet on each side. While the spell lasts, you can deposit as many items inside the chest as will fit. You can then name a living creature you have met and seen at least once before, or any creature for which you possess a body part, lock of hair, clipping from a nail, or similar portion of the creature's body.\n   As soon as the lid of the chest is closed, the elemental and the chest disappear, then reappear adjacent to the target creature. If the target creature is on another plane, or if it is proofed against magical detection or location, the contents of the chest reappear on the ground at your feet.\n   The target creature is made aware of the chest's contents before it chooses whether or not to open it, and knows how much of the spell's duration remains in which it can retrieve them. No other creature can open the chest and retrieve its contents. When the spell expires or when all the contents of the chest have been removed, the elemental and the chest disappear. The elemental also disappears if the target creature orders it to return the items to you. When the elemental disappears, any items not taken from the chest reappear on the ground at your feet." + AtHigherLevels + "When you cast this spell using an 8th-level spell slot, you can send the chest to a creature on a different plane of existence from you."
}
SpellsList["galder's tower"] = {
    name: "Galder's Tower",
    classes: ["wizard"],
    source: ["LLoK", 57],
    level: 3,
    school: "Conj",
    time: "10 min",
    range: "30 ft",
    components: "V,S,M",
    compMaterial: "A fragment of stone, wood, or other building material",
    duration: "24 h",
    description: "Conjure round or square tower with 2+1/Sl stories, each 100 sq ft and 10 ft high; see book",
    descriptionFull: "You conjure a two-story tower made of stone, wood, or similar suitably sturdy materials. The tower can be round or square in shape. Each level of the tower is 10 feet tall and has an area of up to 100 square feet. Access between levels consists of a simple ladder and hatch. Each level takes one of the following forms, chosen by you when you cast the spell:" +
	"\n \u2022 A bedroom with a bed, chairs, chest, and magical fireplace" +
	"\n \u2022 A study with desks, books, bookshelves, parchments, ink, and ink pens" +
	"\n \u2022 A dining space with a table, chairs, magical fireplace, containers, and cooking utensils" +
	"\n \u2022 A lounge with couches, armchairs, side tables and footstools" +
	"\n \u2022 A washroom with toilets, washtubs, a magical brazier, and sauna benches" +
	"\n \u2022 An observatory with a telescope and maps of the night sky" +
	"\n \u2022 An unfurnished, empty room" +
	"\n\nThe interior of the tower is warm and dry, regardless of conditions outside. Any equipment or furnishings conjured with the tower dissipate into smoke if removed from it. At the end of the spell's duration, all creatures and objects within the tower that were not created by the spell appear safely outside on the ground, and all traces of the tower and its furnishings disappear." +
	"\n   You can cast this spell again while it is active to maintain the tower's existence for another 24 hours. You can create a permanent tower by casting this spell in the same location and with the same configuration every day for one year." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, the tower can have one additional story for each slot level beyond 3rd."
}
var iFileName = "pub_20181120_GGtR.js";
RequiredSheetVersion(13);
// This file adds all material from the Guildmasters' Guide to Ravnica to MPMB's Character Record Sheet

// Define the source
SourceList.G = {
	name : "Guildmasters' Guide to Ravnica",
	abbreviation : "GGtR",
	group : "Primary Sources",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/guildmasters-guide-ravnica",
	date : "2018/11/20"
};

// Add the Centaur race
RaceList["centaur-ggtr"] = {
	regExpSearch : /centaur/i,
	name : "Centaur",
	sortname : "Centaur",
	source : ["G", 15],
	plural : "Centaurs",
	size : 3,
	speed : {
		walk : { spd : 40, enc : 30 }
	},
	languageProfs : ["Common", "Sylvan"],
	weaponOptions : {
		baseWeapon : "unarmed strike",
		regExpSearch : /\b(hoofs?|hooves)\b/i,
		name : "Hooves",
		source : ["G", 15],
		damage : [1, 4, "bludgeoning"],
		description : "Use as bonus action after charge 30 ft"
	},
	weaponsAdd : ["Hooves"],
	skillstxt : "Choose one from Animal Handling, Medicine, Nature, or Survival",
	age : " mature and age at about the same rate as humans",
	height : " stand between 6 and 7 feet tall, with their equine bodies reaching about 4 feet at the withers (6'0\" + 1d10\")",
	weight : " weigh around 670 lb (600 + 1d10 \xD7 2d12 lb)",
	heightMetric : " stand around 2 metres tall, with their equine bodies reaching about 1,5 metres at the withers (183 + 3d8 cm)",
	weightMetric : " weigh around 300 kg (270 + 3d8 \xD7 4d12 / 10 kg)",
	scores : [2, 0, 0, 0, 1, 0],
	trait : "Centaur (+2 Strength +1 Wisdom)" + desc([
		"Fey: My creature type is fey, rather than humanoid.",
		"Hooves: I can use my hooves for unarmed strikes (1d4 bludgeoning damage).",
		"Charge: If I move 30 ft straight toward a creature and then hit it with a melee weapon attack on the same turn, I can make a hooves attack against it as a bonus action.",
		"Equine Build: I count as one size larger for my carrying capacity and the weight I can push, drag, or lift. Because of my hooves, 1 ft of movement while climbing costs me 4 ft."
	]),
	features : {
		"charge" : {
			name : "Charge",
			minlevel : 1,
			action : ["bonus action", "Hooves (after charge)"]
		}
	},
	carryingCapacity : 2
};

if (!RaceList["goblin"]) { // reprint from Volo's Guide to Monsters
	RaceList["goblin"] = {
		regExpSearch : /^(?=.*\bgoblins?\b)(?!.*hobgoblin|bugbear).*$/i,
		name : "Goblin",
		source : [["V", 119], ["G", 17]],
		plural : "Goblins",
		size : 4,
		speed : {
			walk : { spd : 30, enc : 20 }
		},
		languageProfs : ["Common", "Goblin"],
		vision : [["Darkvision", 60]],
		age : " rearch adulthood at age 8 and live up to 60 years",
		height : " are between 3 and a half and 4 feet tall (3'5\" + 2d4\")",
		weight : " weigh between 40 and 70 lb (35 + 2d4 \xD7 1 lb)",
		heightMetric : " are between 100 and 120 cm tall (100 + 5d4 cm)",
		weightMetric : " weigh between 20 and 30 kg (17 + 5d4 \xD7 2 / 10 kg)",
		scores : [0, 2, 1, 0, 0, 0],
		features : {
			"fury of the small" : {
				name : "Fury of the Small",
				minlevel : 1,
				usages : 1,
				recovery : "short rest",
				additional : levels.map(function (n) { return "+" + n + " damage"; })
			},
			"nimble escape" : {
				name : "Nimble Escape",
				minlevel : 1,
				action : ["bonus action", " (disengage/hide)"]
			}
		},
		trait : "Goblin (+2 Dexterity, +1 Constitution)\n\nFury of the Small: Once per short rest, when I hit a creature of a size category larger than mine, I deal extra damage equal to my level.\n\nNimble Escape: As a bonus action, I can take the Disengage or Hide action."
	};
}

// Add Loxodon
RaceList["loxodon-ggtr"] = {
	regExpSearch : /loxodon/i,
	name : "Loxodon",
	source : ["G", 18],
	plural : "Loxodons",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Loxodon"],
	savetxt : { adv_vs : ["charmed", "frightened"] },
	armorOptions : {
		regExpSearch : /^(?=.*loxodon)(?=.*(natural|hide|skin)).*$/i,
		name : "Loxodon Natural Armor (Con)",
		source : ["G", 18],
		ac : 12,
		dex : -10,
		addMod : true
	},
	armorAdd : "Loxodon Natural Armor (Con)",
	vision : [["Keen Smell", 0]],
	age : " physically mature at the same rate as humans, but are considered young until they reach the age of 60 and live about 450 years",
	height : " stand between 7 and 8 feet tall (6'7\" + 2d10\")",
	weight : " weigh between 300 and 400 pounds (295 + 2d10 \xD7 2d4 lb)",
	heightMetric : " stand between 2 and 2,5 metres tall (200 + 5d10 cm)",
	weightMetric : " weigh between 135 and 200 kg (133 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 2, 0, 1, 0],
	trait : "Loxodon (+2 Constitution, +1 Wisdom)" +
		"\n  Powerful Build: I count as one size larger for my carrying capacity, push, drag, and lift." +
		"\n  Natural Armor: " + (typePF ? "I have an AC of" : "My thick, leathery skin gives me AC") + " 12 + Constitution modifier + shield." +
		"\n  Trunk: I can grasp things with my trunk or use it as a snorkel. It has a reach of 5 ft and can lift things up to 5× my Strength in pounds. I can also use it to make unarmed strikes, but I can't use it to wield weapons, shields, or anything that requires manual precision." +
		"\n  Keen Smell: I have " + (typePF ? "advantage on Wisdom (Perception), Wisdom (Survival), and Intelligence (Investigation) checks that involve smell." : "adv. on Perception, Survival, and Investigation checks involving smell."),
	carryingCapacity : 2
};

// Add the Minotaur race
RaceList["minotaur-ggtr"] = {
	regExpSearch : /minotaur/i,
	name : "Minotaur",
	sortname : "Minotaur",
	source : ["G", 19],
	plural : "Minotaurs",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Minotaur"],
	weaponOptions : {
		baseWeapon : "unarmed strike",
		regExpSearch : /\bhorns?\b/i,
		name : "Horns",
		source : ["G", 19],
		damage : [1, 6, "piercing"],
		description : "Attack as a bonus action after moving 20 ft with the Dash action"
	},
	weaponsAdd : ["Horns"],
	skillstxt : "Choose one from Intimidation or Persuasion",
	age : " reach adulthood around age 17 and live up to 150 years",
	height : " stand around 6 feet tall (5'4\" + 2d8\")",
	weight : " weigh around 300 pounds (175 + 2d8 \xD7 2d6 lb)",
	heightMetric : " stand around 175 cm tall (163 + 5d8 cm)",
	weightMetric : " weigh around 135 kg (80 + 5d8 \xD7 4d6 / 10 kg)",
	scores : [2, 0, 1, 0, 0, 0],
	abilitySave : 1,
	trait : "Minotaur (+2 Strength +1 Constitution)" + desc([
		"Horns: I can use my horns for unarmed strikes (1d6 piercing damage).",
		"Goring Rush: When taking a Dash action and moving at least 20 ft, I can make a horns attack as a bonus action.",
		"Hammering Horns: As a bonus action after I hit a melee attack during my Attack action, I can shove that target with my horns, if it is up to than one size larger than me. It must make a Str save (DC 8 + Str mod + Prof bonus) or be pushed up to 10 ft away from me."
	]),
	features : {
		"goring rush" : {
			name : "Goring Rush",
			minlevel : 1,
			action : ["bonus action", " (with Dash)"]
		},
		"hammering horns" : {
			name : "Hammering Horns",
			minlevel : 1,
			action : ["bonus action", " (after hit)"]
		}
	}
};

// Add Simic Hybrid
RaceList["simic hybrid-ggtr"] = {
	regExpSearch : /^(?=.*(simic|elf|dwarf|human|orc))(?=.*hybrid).*$/i,
	name : "Simic hybrid",
	source : ["G", 20],
	plural : "Simic hybrids",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", ["Elvish or Vedalken", 1]],
	vision : [["Darkvision", 60]],
	weaponOptionsSp : [{
		baseWeapon : "unarmed strike",
		regExpSearch : /^(?=.*grappling)(?=.*(appendage|tentacle|claw)).*$/i,
		name : "Grappling Appendages",
		source : ["G", 20],
		damage : [1, 6, "bludgeoning"],
		description : "After hitting, start grapple on target as a bonus action"
	}, {
		regExpSearch : /^(?=.*acid)(?=.*spit).*$/i,
		name : "Acid Spit",
		source : ["G", 21],
		ability : 3,
		type : "Natural",
		damage : ["C", 10, "acid"],
		range : "30 ft",
		description : "Dex save, success - no damage",
		abilitytodamage : false,
		dc : true
	}],
	extraACSp : {
		name : "Carapace",
		mod : 1,
		text : "I gain a +1 bonus to AC while I'm not wearing heavy armor.",
		stopeval : function (v) { return v.heavyArmor; }
	},
	age : " age slightly faster than their base humanoid race and their maximum lifespan is somewhat reduced",
	height : " are of the same height as typical for their humanoid race",
	weight : " are of the same weight as typical for their humanoid race",
	scorestxt : "Simic Hybrid: +2 Constitution and +1 to one other ability score of my choice;",
	scores : [0, 0, 2, 0, 0, 0],
	trait : "Simic Hybrid (+2 Constitution and +1 to one other ability score of my choice)\n   Animal Enhancement (1st level): Choose one to three types of enhancement using the \"Racial Options\" button: Manta Glide, Nimble Climber, or Underwater Adaptation.\n   Animal Enhancement (5th level): At 5th level, I gain another animal enhancement. I can either choose one I didn't take at 1st level or choose Grappling Appendages, Carapace, or Acid Spit.",
	features : {
		"animal enhancement" : {
			name : "Animal Enhancement",
			minlevel : 5,
			eval : function() {
				var curChoice = ParseRace(What('Race Remember'))[1].capitalize();
				var AEoptions = ["Manta Glide", "Nimble Climber", "Underwater Adaptation", "Grappling Appendages", "Carapace", "Acid Spit"];
				if (curChoice && AEoptions.indexOf(curChoice) !== -1) AEoptions.splice(AEoptions.indexOf(curChoice), 1);
				var theChoice = AskUserOptions('Simic Hybrid 5th-level Animal Enhancement', 'The Simic Hybrid race offers a choice of animal enhancement at 5th-level. Make a selection to update the sheet accordingly. You can only change this selection by removing the Simic Hybrid race or changing its variant.', AEoptions, 'radio', true);
				var feaTxt = '';
				var rObjNm = "simic hybrid-ggtr";
				var rObj = RaceList[rObjNm];
				var rNm = rObj.name;
				switch (theChoice) {
					case "Manta Glide":
						feaTxt = "Animal Enhancement (Manta Glide): I have manta ray-like wings that I can use to slow my fall. I subtract 100 ft when calculating falling damage and I can move 2 ft horizontally for every 1 ft I descend.";
						break;
					case "Nimble Climber":
						feaTxt = "Animal Enhancement (Nimble Climber): I have a climbing speed equal to my walking speed.";
						SetProf("speed", true, { climb : { spd : 'walk', enc : 'walk' } }, rNm + ": Animal Enhancement (Nimble Climber)");
						break;
					case "Underwater Adaptation":
						feaTxt = "Animal Enhancement (Underwater Adaptation): I can breathe air and water, and I have a swimming speed equal to my walking speed.";
						SetProf("speed", true, { swim : { spd : 'walk', enc : 'walk' } }, rNm + ": Animal Enhancement (Underwater Adaptation)");
						break;
					case "Grappling Appendages":
						feaTxt = "Animal Enhancement (Grappling Appendages): I have two extra appendages which I can use to make unarmed strikes for 1d6 bludgeoning damage. As a bonus action after hitting with them, I can try to grapple the target. I can't use these appendages to wield anything.";
						processWeaponOptions(true, rObjNm, rObj.weaponOptionsSp[0]);
						AddWeapon("Grappling Appendages");
						AddAction("bonus action", "Grappling Appendages (after hit)", rNm + ": Animal Enhancement (Grappling Appendages)");
						break;
					case "Carapace":
						feaTxt = "Animal Enhancement (Carapace): My skin is covered by a thick shell, giving my a +1 to AC whenever I'm not wearing heavy armor.";
						processExtraAC(true, rNm + ": Animal Enhancement (Carapace)", rObj.extraACSp, rNm);
						break;
					case "Acid Spit":
						feaTxt = "Animal Enhancement (Acid Spit): As an action, I can spit acid at a creature within 30 ft that I can see. It must make a Dex save (DC 8 + Con mod + Prof bonus) or take 2d10 acid damage (+1d10 at 11th and 17th level). I can do this my Con mod times per long rest.";
						AddFeature("Acid Spit", "Con Mod", "", "long rest", rNm + ": Animal Enhancement (Acid Spit)", 0, "event.value = Math.max(1, What('Con Mod'));");
						processWeaponOptions(true, rObjNm, rObj.weaponOptionsSp[1]);
						AddWeapon("Acid Spit");
						break;
				};
				if (What("Unit System") !== "imperial") feaTxt = ConvertToMetric(feaTxt, 0.5);
				Value("Racial Traits", What("Racial Traits").replace(/Animal Enhancement \(5th level\):.*/, '') + feaTxt);
				Value("Race Remember", What("Race Remember") + "-*" + theChoice.replace(' ', '_') + "*");
			},
			removeeval : function() {
				var theRegex = /\*(Manta_Glide|Nimble_Climber|Underwater_Adaptation|Grappling_Appendages|Carapace|Acid_Spit)\*/i;
				var raceRem = What("Race Remember");
				if (!theRegex.test(raceRem)) return;
				var theChoice = raceRem.match(theRegex)[1].replace('_', ' ').capitalize();
				var rObjNm = "simic hybrid-ggtr";
				var rObj = RaceList[rObjNm];
				var rNm = rObj.name;
				switch (theChoice) {
					case "Nimble Climber":
						SetProf("speed", false, { climb : { spd : 'walk', enc : 'walk' } }, rNm + ": Animal Enhancement (Nimble Climber)");
						break;
					case "Underwater Adaptation":
						SetProf("speed", false, { swim : { spd : 'walk', enc : 'walk' } }, rNm + ": Animal Enhancement (Underwater Adaptation)");
						break;
					case "Grappling Appendages":
						RemoveWeapon("Grappling Appendages");
						processWeaponOptions(false, rObjNm, rObj.weaponOptionsSp[0]);
						RemoveAction("bonus action", "Grappling Appendages (after hit)", rNm + ": Animal Enhancement (Grappling Appendages)");
						break;
					case "Carapace":
						processExtraAC(false, rNm + ": Animal Enhancement (Carapace)", rObj.extraACSp, rNm);
						break;
					case "Acid Spit":
						RemoveFeature("Acid Spit", "", "", "", "", "", "event.value = Math.max(1, What('Con Mod'));");
						RemoveWeapon("Acid Spit");
						processWeaponOptions(false, rObjNm, rObj.weaponOptionsSp[1]);
						break;
				};
				Value("Racial Traits", What("Unit System") === "imperial" ? CurrentRace.trait : ConvertToMetric(CurrentRace.trait, 0.5));
			}
		}
	}
};
AddRacialVariant("simic hybrid-ggtr", "manta glide", {
	regExpSearch : /manta glide/i,
	source : ["G", 20],
	trait : "Simic Hybrid (+2 Constitution and +1 to one other ability score of my choice)\n   Animal Enhancement (Manta Glide): I have manta ray-like wings that I can use to slow my fall. I subtract 100 ft when calculating falling damage and I can move 2 ft horizontally for every 1 ft I descend.\n   Animal Enhancement (5th level): At 5th level, I gain another animal enhancement. I can choose Nimble Climber, Underwater Adaptation, Grappling Appendages, Carapace, or Acid Spit."
});
AddRacialVariant("simic hybrid-ggtr", "nimble climber", {
	regExpSearch : /nimble climber/i,
	source : ["G", 20],
	speed : {
		walk : { spd : 30, enc : 20 },
		climb : { spd : 'walk', enc : 'walk' }
	},
	trait : "Simic Hybrid (+2 Constitution and +1 to one other ability score of my choice)\n   Animal Enhancement (Nimble Climber): I have a climbing speed equal to my walking speed.\n   Animal Enhancement (5th level): At 5th level, I gain another animal enhancement. I can choose Manta Glide, Underwater Adaptation, Grappling Appendages, Carapace, or Acid Spit."
});
AddRacialVariant("simic hybrid-ggtr", "underwater adaptation", {
	regExpSearch : /underwater adaptation/i,
	source : ["G", 20],
	speed : {
		walk : { spd : 30, enc : 20 },
		swim : { spd : 'walk', enc : 'walk' }
	},
	trait : "Simic Hybrid (+2 Constitution and +1 to one other ability score of my choice)\n   Animal Enhancement (Underwater Adaptation): I can breathe air and water, and I have a swimming speed equal to my walking speed.\n   Animal Enhancement (5th level): At 5th level, I gain another animal enhancement. I can choose Manta Glide, Nimble Climber, Grappling Appendages, Carapace, or Acid Split."
});

// Add Vedalken
RaceList["vedalken-ggtr"] = {
	regExpSearch : /vedalken/i,
	name : "Vedalken",
	source : ["G", 21],
	plural : "Vedalken",
	size : 3,
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	savetxt : { text : ["Adv. on Int/Wis/Cha saves"] },
	skillstxt : "Choose one from Arcana, History, Investigation, Medicine, Performance, or Sleight of Hand. I add 1d4 to a check with the chosen skill",
	languageProfs : ["Common", "Vedalken", 1],
	toolProfs : [["Any tool", 1]],
	age : " reach maturity around age 40 and typically live 350 years, with some living up to 500 years",
	height : " stand between 6 and 6 and a half feet tall (5'4\" + 2d10\")",
	weight : " are slender, weighing around 200 pounds (110 + 2d10 \xD7 2d4 lb)",
	heightMetric : " stand between 1,8 and 2 metres tall (163 + 5d10 cm)",
	weightMetric : " are slender, weighing around 100 kg (50 + 5d10 \xD7 4d4 / 10 kg)",
	scores : [0, 0, 0, 2, 1, 0],
	trait : "Vedalken (+2 Intelligence, +1 Wisdom)" + desc([
		"Vedalken Dispassion: I have advantage on all Intelligence, Wisdom, and Charisma saves.",
		"Tireless Precision: I am proficient with any one tool and one skill of my choice: Arcana, History, Investigation, Medicine, Performance, or Sleight of Hand. Whenever I make an ability check with the chosen tool or skill, I can add 1d4 to the check's total.",
		"Partially Amphibious: Once per long rest, I can breathe underwater for 1 hour by absorbing oxygen through my skin."
	]),
	features : {
		"partially amphibious" : {
			name : "Partially Amphibious",
			minlevel : 1,
			usages : 1,
			recovery : "long rest"
		}
	},
	advantages : [["Int", true], ["Wis", true], ["Cha", true]]
};

// New Subclass for Cleric: Order Domain
AddSubClass("cleric", "order domain-ggtr", {
	regExpSearch : /^(?=.*(cleric|priest|clergy|acolyte))(?=.*order).*$/i,
	subname : "Order Domain",
	source : ["G", 25],
	spellcastingExtra : ["command", "heroism", "hold person", "zone of truth", "mass healing word", "slow", "compulsion", "locate creature", "commune", "dominate person"],
	features : {
		"subclassfeature1" : {
			name : "Bonus Proficiency",
			source : ["G", 26],
			minlevel : 1,
			description : "\n   " + "I gain proficiency with heavy armor, and either the Intimidation or Persuasion skill",
			armorProfs : [false, false, true, false],
			skillstxt : "Choose one from Intimidation or Persuasion"
		},
		"subclassfeature1.1" : {
			name : "Voice of Authority",
			source : ["G", 26],
			minlevel : 1,
			description : desc([
				"Whenever I use a spell slot to cast a spell on an ally, it can use its reaction to attack",
				"The ally makes one weapon attack against a target of my choice that I can see",
				"If the spell targets multiple allies, I can choose which one can make the attack"
			])
		},
		"subclassfeature2" : {
			name : "Channel Divinity: Order's Demand",
			source : ["G", 26],
			minlevel : 2,
			description : desc([
				"As an action, all chosen targets in 30 ft that can see or hear me must make a Wis save",
				"If failed, it is charmed by me until the end of my next turn or it takes any damage",
				"Also, I can choose to have a charmed target drop what its holding when it fails its save"
			]),
			action : ["action", ""]
		},
		"subclassfeature6" : {
			name : "Embodiment of the Law",
			source : ["G", 26],
			minlevel : 6,
			description : desc([
				"When I cast an enchantment spell using a spell slot, I can reduce its casting time",
				"If the spell normally has a casting time of an action, I can now cast it as a bonus action"
			]),
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest",
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						if (CurrentSpells[spName].refType == "class" && spellObj.school == "Ench" && spellObj.time == "1 a") {
							spellObj.time = "1a/bns"
							return true;
						};
					},
					"When I cast an enchantment spell using a spell slot that normally requires 1 action to cast, I can reduce its casting time to a bonus action."
				]
			}
		},
		"subclassfeature8" : {
			name : "Divine Strike",
			source : ["G", 26],
			minlevel : 8,
			description : "\n   " + "Once per turn, when I hit a creature with a weapon attack, I can do extra damage",
			additional : levels.map(function (n) {
				if (n < 8) return "";
				return "+" + (n < 14 ? 1 : 2) + "d8 psychic damage";
			}),
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (classes.known.cleric && classes.known.cleric.level > 7 && !v.isSpell) {
							fields.Description += (fields.Description ? '; ' : '') + 'Once per turn +' + (classes.known.cleric.level < 14 ? 1 : 2) + 'd8 psychic damage';
						}
					},
					"Once per turn, I can have one of my weapon attacks that hit do extra psychic damage."
				]
			}
		},
		"subclassfeature17" : {
			name : "Order's Wrath",
			source : ["G", 26],
			minlevel : 17,
			description : desc([
				"If I deal my Divine Strike damage to a creature, it is cursed until my next turn starts",
				"The next time it is hit by a weapon attack from my allies, it takes +2d8 psychic damage"
			])
		}
	}
});

// New Subclass for Druid: Circle of Spores
AddSubClass("druid", "circle of spores-ggtr", {
	regExpSearch : /^(?=.*(druid|shaman))(?=.*spores).*$/i,
	subname : "Circle of Spores",
	source : ["G", 26],
	features : {
		"subclassfeature2" : {
			name : "Circle Spells",
			source : ["G", 27],
			minlevel : 2,
			description : desc([
				"I learn the Chill Touch cantrip and gain the ability to cast certain spells",
				"These are always prepared, but don't count against the number of spells I can prepare"
			]),
			spellcastingBonus : {
				name : "Circle Spells",
				spells : ["chill touch"],
				selection : ["chill touch"]
			},
			spellcastingExtra : ["blindness/deafness", "gentle repose", "animate dead", "gaseous form", "blight", "confusion", "cloudkill", "contagion"]
		},
		"subclassfeature2.1" : {
			name : "Halo of Spores",
			source : ["G", 27],
			minlevel : 2,
 			description : desc([
				"As a reaction when someone I can see in 10 ft starts its turn or moves, I can have it save",
				"It must succeed on a Constitution save or take necrotic damage from my cloud of spores"
			]),
			additional : levels.map(function (n) { return n < 2 ? "" : 'Con save or 1d' + (n < 6 ? 4 : n < 10 ? 6 : n < 14 ? 8 : 10) + " necrotic damage"; }),
			action : ["reaction", ""]
		},
		"subclassfeature2.2" : {
			name : "Symbiotic Entity",
			source : ["G", 27],
			minlevel : 2,
			description : desc([
				"As an action, I expend a Wild Shape use to boost my spores instead of transforming",
				"I gain 4 temporary hit points per druid level and my Halo of Spores damage increases",
				"Also, my melee weapon attacks do +1d6 poison damage with every hit",
				"This lasts for 10 min, until these temporary HP run out, or until I use Wild Shape again"
			]),
			additional : levels.map(function (n) {
				return n < 2 ? "" : Math.floor(n*4) + " temp HP; Halo of Spores: 2d" + (n < 6 ? 4 : n < 10 ? 6 : n < 14 ? 8 : 10);
			}),
			action : ["action", ""],
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (v.isMeleeWeapon && !v.isNaturalWeapon && (/\b(spore|symbiotic)\b/i).test(v.WeaponText)) {
							fields.Description += (fields.Description ? '; ' : '') + '+1d6 poison damage';
						};
					},
					"If I include the word 'Spore' or 'Symbiotic' in a melee weapon's name, it gets treated as a weapon that is infused by my Symbiotic Entity feature, adding +1d6 poison damage in the description."
				]
			}
		},
		"subclassfeature6" : {
			name : "Fungal Infestation",
			source : ["G", 27],
			minlevel : 6,
			description : desc([
				"As a reaction when a Small/Medium beast/humanoid dies in 10 ft, I can animate it",
				"It rises as a zombie with 1 HP that follows my mental commands and dies after 1 hour",
				"It can only take the attack action for one melee attack; It takes its turns after mine"
			]),
			usages : "Wisdom modifier per ",
			usagescalc : "event.value = Math.max(1, What('Wis Mod'));",
			recovery : "long rest",
			action : ["reaction", ""]
		},
		"subclassfeature10" : {
			name : "Spreading Spores",
			source : ["G", 27],
			minlevel : 10,
			description : " [only while Symbiotic Entity is active]" + desc([
				"As a bonus action, I create a 10-ft cube of fungal spores within 30 ft, lasting for 1 min",
				"Any creature moving into or starting its turn in it must save against my Halo of Spores",
				"The cube ends if I use this feature again; While it persists, I can't use my Halo of Spores"
			]),
			action : ["bonus action", " (start/end)"]
		},
		"subclassfeature14" : {
			name : "Fungal Body",
			source : ["G", 27],
			minlevel : 14,
			description : desc([
				"I'm immune to being blinded, deafened, frightened, poisoned, and critical hits"
			]),
			savetxt : { immune : ["blinded", "deafened", "frightened", "poisoned", "critical hits (unless incapacitated)"] }
		}
	}
});

BackgroundList["azorius functionary"] = {
	regExpSearch : /^(?=.*azorius)(?=.*functionary).*$/i,
	name : "Azorius Functionary",
	source : ["G", 33],
	skills : ["Insight", "Intimidation"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["friends", "message", "command", "ensnaring strike", "arcane lock", "calm emotions", "hold person", "clairvoyance", "counterspell", "compulsion", "divination", "dominate person"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Friends, Message, Command, Ensnaring Strike, Arcane Lock, Calm Emotions, Hold Person, Clairvoyance, Counterspell, Compulsion, Divination, and Dominate Person."
		]
	},
	gold : 10,
	equipleft : [
		["Scroll with law text", "", ""],
		["Blue ink, 1 ounce bottle of", 1, ""],
		["Ink pen (quill)", "", ""]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Azorius insignia", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [2],
	feature : "Legal Authority",
	trait : [
		"I try never to let my judgment become clouded by emotion.",
		"I have infinite patience with the dolts and boors I'm forced to deal with every day.",
		"When I give an order, I expect it to be obeyed.",
		"I just want things the way I like them: neat, orderly, and clean.",
		"No wrongdoing can escape my watchful gaze.",
		"I always say exactly what I mean, no matter how many words it takes to communicate the particular nuance I am attempting to convey.",
		"I'm very literal and don't appreciate metaphor or sarcasm.",
		"I never change my mind once it's made up."
	],
	ideal : [
		["Guild", "Guild: My guild is all that really matters. (Any)"],
		["Order", "Order: The law is meant to ensure that the gears of society turn smoothly and quietly. (Lawful)"],
		["Peace", "Peace: The ultimate object of the law is to remove violence from society. (Good)"],
		["Compliance", "Compliance: Coercion is a fine way of ensuring that the laws are obeyed. (Lawful)"],
		["Legislation", "Legislation: The law embodies excellence in its precision and detail. (Lawful)"],
		["Punishment", "Punishment: A public display of consequences is an excellent deterrent for other criminals. (Evil)"]
	],
	bond : [
		"I am beholden to an Azorius arrester who captured the criminal who killed my parents, saving me from the same fate.",
		"I hope one day to write the laws, not just enforce them.",
		"I tried and failed to prevent a murder, and I have sworn to find and arrest the perpetrator.",
		"I successfully prevented a murder, and the would-be perpetrator wants me dead.",
		"One of my parents was prominent in the guild, and I resent constantly being compared to that standard.",
		"I've modeled my career after a highly respected lawmage or arrester, but I fear that my role model might be involved in something illegal."
	],
	flaw : [
		"I'm unable to distinguish between the letter and the spirit of the law.",
		"I seem like a harsh judge to others, but I judge myself most harshly of all.",
		"I have a secret, illegal vice.",
		"I was traumatized by witnessing a crime as a child.",
		"I'm incapable of deception.",
		"I wish I had joined the Boros, but I fear they'd never accept me."
	]
};
BackgroundFeatureList["legal authority"] = {
	description : "I have the authority to enforce the laws of Ravnica, inspiring respect and fear as a result. People mind their manners, avoid my attention, and assume I have a right to be wherever I am. My Azorius insignia gets me an audience with anyone I want, though it might work adversely with incorrigible lawbreakers. Abusing this privilege can get me in serious trouble.",
	source : ["G", 33]
};

BackgroundList["boros legionnaire"] = {
	regExpSearch : /^(?=.*boros)(?=.*legionnaire).*$/i,
	name : "Boros Legionnaire",
	source : ["G", 40],
	skills : ["Athletics", "Intimidation"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["fire bolt", "sacred flame", "guiding bolt", "heroism", "aid", "scorching ray", "beacon of hope", "blinding smite", "death ward", "wall of fire", "flame strike"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Fire Bolt, Sacred Flame, Guiding Bolt, Heroism, Aid, Scorching Ray, Beacon of Hope, Blinding Smite, Death Ward, Wall of Fire, and Flame Strike."
		]
	},
	gold : 2,
	equipleft : [
		["Feather from angel's wing", "", ""],
		["Tattered piece of Boros banner", 1, ""],
		["Ink pen (quill)", "", ""]
	],
	equipright : [
		["Common clothes", "", 3],
		["Boros insignia", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [["Celestial, Draconic, Goblin, or Minotaur", 1]],
	toolProfs : [["Gaming set", 1]],
	feature : "Legion Station",
	trait : [
		"I approach every task with the same high degree of military precision.",
		"I am always the first into the fray.",
		"I bear any injury or indignity with stoic discipline.",
		"My righteous wrath is easily inflamed by the slightest iniquity.",
		"My honor is more important to me than my life.",
		"Dangerous work is best accomplished by an orderly group working with common purpose.",
		"I treat my weapons, uniform, and insignia with reverence, for they are gifts of the angels.",
		"I pace when standing and fidget incessantly when forced to sit."
	],
	ideal : [
		["Guild", "Guild: My guild is all that really matters. (Any)"],
		["Justice", "Justice: Achieving justice requires establishing fair, equitable, and compassionate relationships within a community. (Good)"],
		["Protection", "Protection: It isn't right for innocents to suffer because of the arrogance of the powerful. (Good)"],
		["Solidarity", "Solidarity: It is most crucial to act with a single will, marching side by side in perfect accord. (Lawful)"],
		["Order", "Order: Society functions only if people do their duty and respect the chain of command. (Lawful)"],
		["Conviction", "Conviction: Anything worth doing is worth doing with your whole heart. (Lawful)"]
	],
	bond : [
		"I would lay down my life for Aurelia and the angels.",
		"I owe my life to the Boros captain who took me in when I was living on the streets.",
		"My fellow legionnaires are my family.",
		"I wield the same Boros weapon my grandparent did, for the honor of our family.",
		"I ran with the Rakdos in my youth, and I'm striving to atone for my past misdeeds.",
		"I do what I can to help out the spouse of a comrade who died in battle."
	],
	flaw : [
		"I act bravely when I'm in a group, but I'm a coward when I'm alone.",
		"I see everything in clear-cut black and white.",
		"I'm just a little fascinated by the ways of the Gruul.",
		"I trust the chain of command more than anything\u2014more even than my closest friends.",
		"I'm slow to trust members of other guilds.",
		"I've been known to turn a blind eye to injustice, with the help of a modest bribe."
	],
	lifestyle : "poor"
};
BackgroundFeatureList["legion station"] = {
	description : "I am established in the hierarchy of the Boros Legion. I can requisition simple equipment for temporary use. I have access to any Boros garrison in Ravnica where I can rest in safety and have access to medics. I'm paid 1 gp per week (a Boros-minted 1-zino coin), allowing me (together with the free garrison lodging) to have a poor lifestyle between adventures.",
	source : ["G", 40]
};

BackgroundList["dimir operative"] = {
	regExpSearch : /^(?=.*dimir)(?=.*operative).*$/i,
	name : "Dimir Operative",
	source : ["G", 46],
	skills : ["Deception", "Stealth"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["encode thoughts", "mage hand", "disguise self", "sleep", "detect thoughts", "pass without trace", "gaseous form", "meld into stone", "nondetection", "arcane eye", "freedom of movement", "modify memory"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Encode Thoughts, Mage Hand, Disguise Self, Sleep, Detect Thoughts, Pass Without Trace, Gaseous Form, Meld into Stone, Nondetection, Arcane Eye, Freedom of Movement, and Modify Memory."
		]
	},
	gold : 0,
	equipleft : [
		["Small knife", 3, 0.25],
		["Starting equipment of secondary guild", "", ""]
	],
	equipright : [
		["Dark-colored common clothes", "", 3],
		["Dimi insignia", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [1],
	toolProfs : ["Disguise kit"],
	feature : "False Guild Identity",
	trait : [
		"I'm good at hiding my true thoughts and feelings.",
		"When I'm in doubt about revealing something, I assume it's a secret, and I don't share it.",
		"I like to sound mysterious, because wisdom hidden grows deeper with time.",
		"I have no patience with people who get in my way.",
		"I love hearing about other people's nightmares.",
		"Combat is meant to be quick, clean, and one-sided.",
		"I like to stick to the shadows.",
		"I never show my anger. I just plot my revenge."
	],
	ideal : [
		["Guild", "Guild: My true guild is all that really matters. (Any)"],
		["Control", "Control: I like pulling the strings. (Lawful)"],
		["Secrets", "Secrets: I collect secrets and never reveal them. (Any)"],
		["Knowledge", "Knowledge: I want to know as much as I can about this city and how it works. (Any)"],
		["Independence", "Independence: I value the freedom to pursue my own goals without interference. (Chaotic)"],
		["Nihilism", "Nihilism: I don't believe in anything, and anyone who does is a fool. (Neutral)"]
	],
	bond : [
		"I discovered a secret I can't let anyone else uncover\u2014including my guild superiors.",
		"I formed a close friendship or romance with someone in the guild I'm infiltrating.",
		"The Dimir agent who recruited me was unmasked and killed. My revenge on the killers will be thorough and painful.",
		"I spend as much time as I can in the Ismeri Library because I'm certain an information hub operates behind its facade. I want its secrets!",
		"I'm utterly loyal to my superior in the guild, more than to the guild or its guildmaster.",
		"Someone has discovered my true identity."
	],
	flaw : [
		"I like secrets so much that I'm reluctant to share details of a plan even with those who need to know.",
		"I would let my friends die rather than reveal my true identity.",
		"I have trouble trusting anyone but myself.",
		"I have a particular vice that puts all my secrets at risk if I'm not careful.",
		"I'm pretty sure I've done something horrible that I can't remember because of the guild's mind magic.",
		"I put too much trust in the people who give me orders."
	],
	extra : [
		"Select a Reason for Infiltration",
		"Parental link",
		"Track activities",
		"Spy on individual",
		"Recruit more spies",
		"Member before recruitment",
		"Destroy from within",
		"Secret wish to join",
		"Randomly chosen"
	]
};
BackgroundFeatureList["false guild identity"] = {
	description : "I have more than one identity. The one I wear most of the time makes me appear to be a member of a guild other than my own. I have documentation, established acquaintances, and disguises that allow me to assume that persona and fit into the secondary guild. Whenever I choose, I can drop this identity and blend into the guildless masses of the city.",
	source : ["G", 46]
};

BackgroundList["golgari agent"] = {
	regExpSearch : /^(?=.*golgari)(?=.*agent).*$/i,
	name : "Golgari Agent",
	source : ["G", 53],
	skills : ["Nature", "Survival"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["dancing lights", "spare the dying", "entangle", "ray of sickness", "protection from poison", "ray of enfeeblement", "spider climb", "animate dead", "plant growth", "giant insect", "grasping vine", "cloudkill", "insect plague"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Dancing Lights, Spare the Dying, Entangle, Ray of Sickness, Protection from Poison, Ray of Enfeeblement, Spider Climb, Animate Dead, Plant Growth, Giant Insect, Grasping Vine, Cloudkill, and Insect Plague."
		]
	},
	gold : 10,
	equipleft : [
		["Poisoner's kit", "", 2]
	],
	equipright : [
		["Common clothes", "", 3],
		["Golgari insignia", "", ""],
		["Pet beetle or spider", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [["Elvish, Giant, or Kraul", 1]],
	toolProfs : ["Poisoner's kit"],
	feature : "Undercity Paths",
	trait : [
		"Remember, I could kill you in your sleep. Or put centipedes in your bedroll.",
		"I like to remind people of their inevitable demise.",
		"Sometimes I give voice to the whispers of the rot, which I hear but no one else does.",
		"I do my best to discourage anyone from approaching or talking to me.",
		"I have accepted my death. Hence, I don't fear it.",
		"Like roots growing through stone, I am relentless and determined in my action.",
		"I put my knowledge of anatomy to use by narrating the injuries my enemies suffer in grisly detail.",
		"Like a wild animal, I lash out viciously when I'm provoked\u2014and I'm easily provoked."
	],
	ideal : [
		["Guild", "Guild: My guild is all that really matters. (Any)"],
		["Stoicism", "Stoicism: All of us are part of the cyclical march of nature, which will continue with or without us. (Neutral)"],
		["Nature", "Nature: The natural world is more important than the edifices of the city and civilization. (Neutral)"],
		["Interdependence", "Interdependence: We are all part of nature's web. (Lawful)"],
		["Ambition", "Ambition: The time of Golgari ascendance is at hand, and I intend to have a prominent place in the new world order. (Evil)"],
		["Live and Let Live", "Live and Let Live: Meddling in the affairs of other guilds is a great way to get squashed like a bug. (Neutral)"]
	],
	bond : [
		"I cherish the finger of a family member who was petrified by a medusa.",
		"I have an identical twin who is as different from me as any person could be.",
		"I want to lead one faction of the guild to a new position of dominance.",
		"I love spending time in the moss-covered building where I took part in my first reclamation mission.",
		"I found something in the sewer that must never come to light.",
		"I am forever grateful to the reclaimer who found me floating facedown in the sewer, moments from death."
	],
	flaw : [
		"Death comes for us all, so you can't expect me to take care of someone who can't fight it off.",
		"I assume that anyone outside the Golgari looks down on me.",
		"I feel a need for revenge against those who enjoy the privilege of living above ground.",
		"I don't bother to couch my opinions in flattering words.",
		"I can't help but pocket any trinket or coin I come across, no matter how worthless.",
		"I'm convinced that I'm better and stronger than members of other guilds, isolated as they are from the realities of life and death."
	]
};
BackgroundFeatureList["undercity paths"] = {
	description : "I know hidden, underground pathways that I can use to bypass crowds, obstacles, and observation as I move through the city. I can lead a group to travel between two locations in the city twice as fast as normally. The paths of the undercity are haunted by dangers that rarely brave the light of the surface world, so my journey isn't guaranteed to be safe.",
	source : ["G", 53]
};

BackgroundList["gruul anarch"] = {
	regExpSearch : /^(?=.*gruul)(?=.*anarch).*$/i,
	name : "Gruul Anarch",
	source : ["G", 60],
	skills : ["Nature", "Survival"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["fire bolt", "produce flame", "compelled duel", "speak with animals", "thunderwave", "beast sense", "shatter", "conjure animals", "conjure barrage", "dominate beast", "stoneskin", "destructive wave"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Fire Bolt, Produce Flame, Compelled Duel, Speak with Animals, Thunderwave, Beast Sense, Shatter, Conjure Animals, Conjure Barrage, Dominate Beast, Stoneskin, and Destructive Wave."
		]
	},
	gold : 10,
	equipleft : [
		["Herbalism kit", "", 3],
		["Skull of a boar", "", ""]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Gruul insignia", "", ""],
		["Hunting trap", "", 25],
		["Beast-hide cloak", "", 1],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [["Draconic, Giant, Goblin, or Sylvan", 1]],
	toolProfs : ["Herbalism kit"],
	feature : "Rubblebelt Refuge",
	trait : [
		"Unlike people, the beasts of the wild are friends who won't stab me in the back.",
		"Go ahead and insult me\u2014I dare you.",
		"I scorn those who can't survive away from the comforts of the city.",
		"Don't tell me I'm not allowed to do something.",
		"Laws are for people who are afraid to face their inner beasts.",
		"I smear the blood of my enemies over my skin.",
		"I was, in fact, raised by maaka.",
		"HarrRRAAGGHH! [I rarely form a coherent sentence and prefer to express myself by breaking things.]"
	],
	ideal : [
		["Clan", "Clan: My clan is all that really matters. (Any)"],
		["Anarchy", "Anarchy: No person or law or custom can tell another what to do. (Chaotic)"],
		["Nature", "Nature: We weren't born tame or domesticated, so we shouldn't have to live that way. (Neutral)"],
		["Might", "Might: The strongest are meant to dominate the weak. (Evil)"],
		["Rage", "Rage: AAAAAARRRRggggh! [To live is to feel and express the rage burning in your belly.] (Chaotic)"],
		["Tradition", "Tradition: The Old Ways must be preserved and upheld. (Any)"]
	],
	bond : [
		"I am determined that one day I will lead my clan\u2014or a new one.",
		"I would give my life for my clan chieftain.",
		"The chieftain of another clan has a grudge against me.",
		"I am devoted to a sacred site in the midst of the rubblebelt.",
		"My weapon is made from the first raktusk I ever hunted.",
		"GrrrRRAAAAGGHH! [I will do anything to prove myself greater than my siblings or ancestors.]"
	],
	flaw : [
		"If you question my courage, I will never back down.",
		"HrrrGGGAAAARRuuuh! [My anger in battle led to the death of a loved one.]",
		"I'm as stubborn as a batterboar.",
		"I'm so convinced of my superiority over soft, civilized people that I'll take great risks to prove it.",
		"I'm easily manipulated by people I find attractive.",
		"I'm not actually all that angry."
	],
	extra : [
		"Select a Gruul Clan",
		"Burning Tree clan",
		"Ghor clan",
		"Scab clan",
		"Slitz clan",
		"Gravel Hide clan",
		"Zhur-Taa clan",
		"Minor or new clan",
		"Trog"
	]
};
BackgroundFeatureList["rubblebelt refuge"] = {
	description : "I'm very familiar with areas of the city that most people shun: neighborhoods ruined by wurms, overgrown parks gone untended for decades, and the vast, long abandoned rubblebelts of broken terrain. There, I can find a suitable place for me and my allies to hide or rest, as well as food and fresh water for myself and up to five other people each day.",
	source : ["G", 60]
};

BackgroundList["izzet engineer"] = {
	regExpSearch : /^(?=.*izzet)(?=.*engineer).*$/i,
	name : "Izzet Engineer",
	source : ["G", 66],
	skills : ["Arcana", "Investigation"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["produce flame", "shocking grasp", "chaos bolt-xgte", "create or destroy water", "unseen servant", "heat metal", "rope trick", "call lightning", "elemental weapon", "glyph of warding", "conjure minor elementals", "divination", "otiluke's resilient sphere", "animate objects", "conjure elemental"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Produce Flame, Shocking Grasp, Chaos Bolt, Create or Destroy Water, Unseen Servant, Heat Metal, Rope Trick, Call Lightning, Elemental Weapon, Glyph of Warding, Conjure Minor Elementals, Divination, Otiluke's Resilient Sphere, Animate Objects, and Conjure Elemental."
		]
	},
	gold : 5,
	equipleft : [
		["Set of artisan's tools", "", ""],
		["Twisted remains of failed experiment", "", ""],
		["Hammer", "", 3],
		["Block and tackle", "", 5]
	],
	equipright : [
		["Common clothes", "", 3],
		["Izzet insignia", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [["Draconic, Goblin, or Vedalken", 1]],
	toolProfs : [["Artisan's tools", 1]],
	feature : "Urban Infrastructure",
	trait : [
		"I have a hard time staying focused on ... oh, and my brain tends to jump from one ... did I mention focus?",
		"I get really excited about my ideas and I can't wait to talk about them and start putting them into practice and tinkering with them and I want to tell you about how exciting it all is!",
		"It's not magic\u2014or anything, really\u2014if you do it only halfway. Whatever I do, I give it all I've got.",
		"I do what my gut tells me.",
		"Life's an experiment, and I can't wait to see what happens.",
		"I pepper my speech with the incomprehensible jargon of my trade, like mizzium droplets inserted into a weird-field suspension.",
		"Great ideas are fine, but great results are what counts.",
		"If you can guess what I'm about to do, that means I've run out of imagination."
	],
	ideal : [
		["Guild", "Guild: My guild is all that really matters. (Any)"],
		["Creativity", "Creativity: Half the world's troubles come from stodgy thinking, stuck in the past. We need innovative solutions. (Chaotic)"],
		["Discovery", "Discovery: Every experiment has the potential to reveal more secrets of the multiverse. (Any)"],
		["Science", "Science: A rigorous application of logical principles and protocols will lead us toward progress more surely than any belief system. (Lawful)"],
		["Fun", "Fun: I love my job! Despite the dangerous working conditions, there's nothing I'd rather do. (Chaotic)"],
		["Power", "Power: Someday I'll find or create the magic that will make me the most powerful being in Ravnica. (Evil)"]
	],
	bond : [
		"I have dedicated my life to finding a solution to a scientific problem.",
		"I'll never forget the laboratory where I learned my skills, or the other attendants who learned alongside me.",
		"I'm convinced it was sabotage that destroyed my first laboratory and killed many of my friends, and I seek revenge against whoever did it.",
		"I have the schematics for an invention that I hope to build one day, once I have the necessary resources.",
		"A fellow student and I are racing to solve the same scientific puzzle.",
		"I would do anything the guildmaster told me to do."
	],
	flaw : [
		"If there's a plan, I'll probably forget it. If I don't forget it, I'll probably ignore it.",
		"I get bored easily, and if nothing is happening I'll make something happen.",
		"Nothing is ever simple, and if it seems simple, I'll find a way to make it complicated.",
		"I tend to ignore sleep for days when I'm conducting research, often at the expense of my own health and safety.",
		"I'm convinced there's not a soul in Ravnica, except maybe the great Niv-Mizzet, who can match my boundless intellect.",
		"I'm incapable of admitting a flaw in my logic."
	]
};
BackgroundFeatureList["urban infrastructure"] = {
	description : "Although the Izzet League is infamous for mad inventions it is also involved in construction of the city's infrastructure. I have a basic knowledge of the structure of buildings and what is behind its walls. I can find their blueprints showing entry points, secret spaces, structural weaknesses, or secret spaces. My guild won't protect me if I use this knowledge unlawfully.",
	source : ["G", 66]
};

BackgroundList["orzhov representative"] = {
	regExpSearch : /^(?=.*orzhov)(?=.*representative).*$/i,
	name : "Orzhov Representative",
	source : ["G", 72],
	skills : ["Intimidation", "Religion"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["friends", "guidance", "command", "illusory script", "enthrall", "ray of enfeeblement", "zone of truth", "bestow curse", "speak with dead", "spirit guardians", "blight", "death ward", "leomund's secret chest", "geas"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Friends, Guidance, Command, Illusory Script, Enthrall, Ray of Enfeeblement, Zone of Truth, Bestow Curse, Speak with Dead, Spirit Guardians, Blight, Death Ward, Leomund's Secret Chest, and Geas."
		]
	},
	gold : 10,
	equipright : [
		["Fine clothes", "", 6],
		["Orzhov insignia", "", ""],
		["Vestments", "", 4],
		["Chain of 10 golden coins", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [2],
	feature : "Leverage",
	trait : [
		"I am always willing to act in accordance with the financial incentive offered.",
		"Debts are never meant to be forgiven.",
		"I am accustomed to enjoying the finest pleasures money can buy.",
		"No one could doubt that I am a cut above the masses of pitiful peasants that infest the city.",
		"I can't stand to spend a zib more than necessary to purchase what I need.",
		"I hate it when people try to make light of a serious situation.",
		"I want to make sure everyone is aware of how wealthy, powerful, and important I am.",
		"I can't think of anything to look forward to."
	],
	ideal : [
		["Guild", "Guild: My guild is all that really matters. (Any)"],
		["Wealth", "Wealth: I will do whatever it takes to become as rich as the oligarchs. (Evil)"],
		["Power", "Power: One day, I will be the one giving orders. (Evil)"],
		["Prestige", "Prestige: I want to be admired, respected, feared, or even hated for my position and wealth. (Evil)"],
		["Stability", "Stability: The economy functions best when chaos is kept under control and everyone knows their place. (Lawful)"],
		["Eternity", "Eternity: I want to live forever\u2014in the flesh as long as possible, and as a spirit afterward. (Any)"]
	],
	bond : [
		"The unbearable weight of my debt has driven me to desperation.",
		"I'm duty-bound to obey the dictates of an ancestor on the Ghost Council.",
		"I value my worldly goods more highly than my mortal life.",
		"An oligarch publicly humiliated me, and I will exact revenge on that whole family.",
		"My faith in the Obzedat never wavers.",
		"I want to prove myself more worthy than an older sibling and thereby ensure that I inherit a greater share of my parents' wealth."
	],
	flaw : [
		"I hold a scandalous secret that could ruin my family forever\u2014but could also earn me the favor of the Ghost Council.",
		"I'm convinced that everyone I know is plotting against me.",
		"I'll brave any risk if the monetary reward is great enough.",
		"I am convinced that I am far more important than anyone else is willing to acknowledge.",
		"I have little respect for anyone who isn't wealthy.",
		"I'll take any opportunity to steal from wealthier people, even for worthless trinkets."
	]
};
BackgroundFeatureList["leverage"] = {
	description : "I can exert leverage over one or more below me in the guild's hierarchy and demand their help as needs warrant. For example, deliver a message, arrange a ride, or clean up a bloody mess. As my status in the guild improves, I gain influence over more people of higher station. The DM decides if the demands are reasonable and if subordinates are available.",
	source : ["G", 72]
};

BackgroundList["rakdos cultist"] = {
	regExpSearch : /^(?=.*rakdos)(?=.*cultist).*$/i,
	name : "Rakdos Cultist",
	source : ["G", 79],
	skills : ["Acrobatics", "Performance"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["fire bolt", "vicious mockery", "burning hands", "dissonant whispers", "hellish rebuke", "crown of madness", "enthrall", "flaming sphere", "fear", "haste", "confusion", "wall of fire", "dominate person"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Fire Bolt, Vicious Mockery, Burning Hands, Dissonant Whispers, Hellish Rebuke, Crown of Madness, Enthrall, Flaming Sphere, Fear, Haste, Confusion, Wall of Fire, and Dominate Person."
		]
	},
	gold : 10,
	equipleft : [
		["Musical instrument", "", ""],
		["Costume", "", 4],
		["Hooded lantern of wrought iron", "", 2],
		["Chain with spiked links, feet of", 10, 1],
		["Tinderbox", "", 1],
		["Torches", 10, 1],
		["Sweet, red juice, bottle of", "", 4]
	],
	equipright : [
		["Common clothes", "", 3],
		["Rakdos insignia", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [["Abyssal or Giant", 1]],
	toolProfs : [["Musical instrument", 1]],
	feature : "Fearsome Reputation",
	trait : [
		"I revel in mayhem, the more destructive the better.",
		"When violence breaks out, I lose myself in rage, and it's sometimes hard to stop.",
		"Everything is funny to me, and the most hilarious and bloodiest things leave me cackling with sadistic glee.",
		"I derive genuine pleasure from the pain of others.",
		"I enjoy testing other people's patience.",
		"I can't stand it when things are predictable, so I like to add a little chaos to every situation.",
		"I throw my weight around to make sure I get my way.",
		"I enjoy breaking delicate works of art. And fingers, which are sort of the same."
	],
	ideal : [
		["Guild", "Guild: My guild is all that really matters. (Any)"],
		["Hedonism", "Hedonism: Death comes for everyone, so take as much pleasure as you can from every moment of life. (Neutral)"],
		["Creativity", "Creativity: I strive to find more ways to express my art through pain\u2014my own as well as others'. (Chaotic)"],
		["Freedom", "Freedom: No one tells me what to do. (Chaotic)"],
		["Equality", "Equality: I want to see Ravnica remade, with no guilds and no hierarchies. (Chaotic)"],
		["Spectacle", "Spectacle: People are inspired by the greatness they see in art. (Any)"]
	],
	bond : [
		"I have belonged to the same performance troupe for years, and these people mean everything to me.",
		"A blood witch told me I have a special destiny to fulfill, and I'm trying to figure out what it is.",
		"I'm secretly hoping that I can change the cult from the inside, using my influence to help rein in the wanton violence.",
		"I own something that Rakdos once touched (it's seared black at the spot), and I cherish it.",
		"I want to be better at my chosen form of performance than any other member of my troupe.",
		"I am devoted to Rakdos and live to impress him."
	],
	flaw : [
		"My family is prominent in another guild. I enjoy my wild life, but I don't want to embarrass them.",
		"I couldn't hide my emotions and opinions even if I wanted to.",
		"I throw caution to the wind.",
		"I resent the rich and powerful.",
		"When I'm angry, I lash out in violence.",
		"There's no such thing as too much pleasure."
	],
	extra : [
		"Select a Performance Style",
		"Spikewheel acrobat",
		"Lampooning satirist",
		"Fire juggler",
		"Marionette puppeteer",
		"Pain artist",
		"Noise musician",
		"Nightmare clown",
		"Master of ceremonies"
	]
};
BackgroundFeatureList["fearsome reputation"] = {
	description : "People recognize me as a member of the Cult of Rakdos, and they're careful not to draw my anger or ridicule. I can get away with minor criminal offenses, such as refusing to pay for food at a restaurant or breaking down a door at a local shop, if no legal authorities witness the crime. Most are too daunted by me to report my wrongdoing to the Azorius.",
	source : ["G", 79]
};

BackgroundList["selesnya initiate"] = {
	regExpSearch : /^(?=.*selesnya)(?=.*initiate).*$/i,
	name : "Selesnya Initiate",
	source : ["G", 86],
	skills : ["Nature", "Persuasion"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["druidcraft", "friends", "aid", "animal friendship", "charm person", "animal messenger", "calm emotions", "warding bond", "plant growth", "speak with plants", "aura of life", "conjure minor elementals", "awaken", "commune with nature"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Druidcraft, Friends, Aid, Animal Friendship, Charm Person, Animal Messenger, Calm Emotions, Warding Bond, Plant Growth, Speak with Plants, Aura of Life, Conjure Minor Elementals, Awaken, and Commune with Nature."
		]
	},
	gold : 5,
	equipleft : [
		["Healer's kit", "", 3]
	],
	equipright : [
		["Common clothes", "", 3],
		["Robes", "", 4],
		["Selesnya insignia", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [["Elvish, Loxodon, or Sylvan", 1]],
	toolProfs : [["Artisan's tools or musical instrument", 1]],
	feature : "Conclave's Shelter",
	trait : [
		"I never raise my voice or lose my temper.",
		"I feel the pains and joys of everyone around me, friend or foe.",
		"I would rather make a friend than thwart an enemy.",
		"I'm always straining to peer into another reality that seems to be just beyond my senses.",
		"I'm uneasy if I can't see plants growing or feel soil beneath my feet.",
		"Seeing illness or injury in any creature saddens me.",
		"I have much to be proud of, but I am still just one strand in the grand, interwoven tapestry of life.",
		"Nature offers rich and abundant metaphors for understanding the complexities of life."
	],
	ideal : [
		["Guild", "Guild: My guild is all that really matters. (Any)"],
		["Harmony", "Harmony: Nothing is more beautiful than voices and actions aligned in common purpose. (Good)"],
		["Order", "Order: Like a well-pruned tree, society thrives when everything is kept in good order. (Lawful)"],
		["Life", "Life: Preserving life and nature is always a worthwhile endeavor. (Good)"],
		["Humility", "Humility: Ambition and pride are the roots of strife. (Good)"],
		["Evangelism", "Evangelism: When all have joined the Selesnya Conclave, Ravnica will finally know peace. (Any)"]
	],
	bond : [
		"I would give my life in the defense of the small enclave where I first encountered Mat'Selesnya.",
		"I love beasts and plants of all kinds, and am loath to harm them.",
		"A healer nursed me to recovery from a mortal illness.",
		"I'll sing the invitation of Mat'Selesnya with my dying breath.",
		"I cherish a leaf from Vitu-Ghazi that changes color with the seasons, even though it is no longer attached to the tree.",
		"Every member of the conclave is my kin, and I would fight for any one of them."
	],
	flaw : [
		"I'm terrified of getting into a fight where my side is outnumbered.",
		"I assume that people mean well until they prove otherwise.",
		"I enjoy comfort and quiet, and prefer to avoid extra effort.",
		"I have a fierce temper that doesn't reflect the inner calm I seek.",
		"I'm convinced that everyone else in the conclave has a deeper connection to the Worldsoul than I do.",
		"I'm trying to atone for the life of crime I led before I joined the Selesnya, but I find it hard to give up my bad habits."
	]
};
BackgroundFeatureList["conclave's shelter"] = {
	description : "My companions and I can find a place to hide or rest in any Selesnya enclave in the city, unless I have proven to be a danger to them. The members of the enclave will shield me from anyone searching for me, but will not risk their lives. I can receive free healing and care at a Selesnya enclave, though I must provide material components needed for spells.",
	source : ["G", 86]
};

BackgroundList["simic scientist"] = {
	regExpSearch : /^(?=.*simic)(?=.*scientist).*$/i,
	name : "Simic Scientist",
	source : ["G", 93],
	skills : ["Arcana", "Medicine"],
	calcChanges : {
		spellList : [
			function(spList, spName, spType) {
				// don't add if this is not a class or a list of spells is already given
				if (!ClassList[spName] || spList.spells || spList.psionic) return;
				// if this is an 'extra spell', also test if it uses the class' spell list or not
				if (spType.indexOf("bonus") !== -1 && (spList.school || !spList["class"] || (spList["class"].indexOf(spName) === -1 && spName !== "fighter"))) return;
				spList.extraspells = spList.extraspells.concat(["acid splash", "druidcraft", "detect poison and disease", "expeditious retreat", "jump", "alter self", "enhance ability", "enlarge/reduce", "gaseous form", "water breathing", "wind wall", "freedom of movement", "polymorph", "creation"]);
			},
			"My background adds extra spells to the spell list(s) of my spellcasting class(es): Acid Splash, Druidcraft, Detect Poison and Disease, Expeditious Retreat, Jump, Alter Self, Enhance Ability, Enlarge/reduce, Gaseous Form, Water Breathing, Wind Wall, Freedom of Movement, Polymorph, and Creation."
		]
	},
	gold : 10,
	equipleft : [
		["Book of research notes", "", 5],
		["Squid ink, 1 ounce bottle of", "", ""],
		["Ink pen", "", ""],
		["Blubber oil, flasks of", "", 1],
		["Acid, vials of", "", 1],
		["Fish scales, vial of", "", 1],
		["Seaweed, vial of", "", 1],
		["Jellyfish stingers, vial of", "", 1],
		["Unidentified slime, glass bottle of", "", 4]
	],
	equipright : [
		["Common clothes", "", 3],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [2],
	feature : "Simic Researcher",
	trait : [
		"I can't wait to see what I become next!",
		"I am convinced that everything inclines toward constant improvement.",
		"I'm eager to explain every detail of my most intricate experiments and theories to anyone who shows the least bit of interest.",
		"I assume that everyone needs even the most basic concepts explained to them.",
		"I describe everything that happens as if it were going into my research notes (and it often is).",
		"I am insatiably curious about the seemingly infinite forms and adaptations of life.",
		"I can't resist prying into anything forbidden, since it must be terribly interesting.",
		"I employ a highly technical vocabulary to avoid imprecision and ambiguity in my communication."
	],
	ideal : [
		["Guild", "Guild: My guild is all that really matters. (Any)"],
		["Change", "Change: All life is meant to progress toward perfection, and our work is to hurry it along\u2014no matter what must be upended along the way. (Chaotic)"],
		["Knowledge", "Knowledge: Understanding the world is more important than what you do with your knowledge. (Neutral)"],
		"Greater Good. I want to reshape the world into higher forms of life so that all can enjoy evolution. (Good)",
		["Logic", "Logic: It's foolish to let emotions and principles interfere with the conclusions of logic. (Lawful)"],
		["Superiority", "Superiority: My vast intellect and strength are directed toward increasing my sway over others. (Evil)"]
	],
	bond : [
		"I helped create a krasis that I love like a pet and would carry with me everywhere ... except it's the size of a building, and it might eat me.",
		"In my laboratory, I discovered something that I think could eliminate half the life on Ravnica.",
		"The other researchers in my clade are my family\u2014a big, eccentric family including members and parts of many species.",
		"The laboratory where I did my research contains everything that is precious to me.",
		"I will get revenge on the shortsighted fool who killed my precious krasis creation.",
		"Everything I do is an attempt to impress someone I love."
	],
	flaw : [
		"I have a rather embarrassing mutation that I do everything I can to keep hidden.",
		"I'm more interested in taking notes on monstrous anatomy than in fighting monsters.",
		"Every social situation I'm in seems to lead to my asking rude personal questions.",
		"I'm supremely confident in my ability to adapt to any situation and handle any danger.",
		"I'll take any risk to earn recognition for my scientific brilliance.",
		"I have a tendency to take shortcuts in my research and any other tasks I have to complete."
	],
	extra : [
		"Select a Clade or Research",
		"Hull Clade: protection/durability",
		"Fin Clade: movement",
		"Gyre Clade: patterns/metamagic",
		"Guardian Project: guard monsters/super soldiers",
		"Crypsis Project: (counter)intelligence",
		"Independent research in a new area"
	]
};
BackgroundFeatureList["simic researcher"] = {
	description : "I know where or from whom I can acquire scientific facts, usually from a Simic laboratory, or sometimes an Izzet facility, library, university, independent scholar, or creature. I might need to offer bribes, favors, or other incentives to induce people to reveal their secrets. The DM can rule that the knowledge is inaccessible place, can't be found, or requires a quest.",
	source : ["G", 93]
};

// Spells
SpellsList["encode thoughts"] = {
	name : "Encode Thoughts",
	classes : [],
	source : ["G", 47],
	level : 0,
	school : "Ench",
	time : "1 a",
	range : "Self",
	components : "S",
	duration : "Up to 8 h",
	description : "Make physical through strand of memory or vice versa; works with detect thoughts \u0026 modify memory",
	descriptionFull : "Putting a finger to your head, you pull a memory, an idea, or a message from your mind and transform it into a tangible string of glowing energy called a thought strand, which persists for the duration or until you cast this spell again. The thought strand appears in an unoccupied space within 5 feet of you as a Tiny, weightless, semisolid object that can be held and carried like a ribbon. It is otherwise stationary." + "\n   " + "If you cast this spell while concentrating on a spell or an ability that allows you to read or manipulate the thoughts of others (such as detect thoughts or modify memory), you can transform the thoughts or memories you read, rather than your own, into a thought strand." + "\n   " + "Casting this spell while holding a thought strand allows you to instantly receive whatever memory, idea, or message the thought strand contains. (Casting detect thoughts on the strand has the same effect.)"
};
if (!SourceList.X) { // reprint from Xanathar's Guide to Everything
	SpellsList["chaos bolt-xgte"] = {
		name : "Chaos Bolt",
		classes : ["sorcerer"],
		source : [["X", 151], ["G", 67]],
		level : 1,
		school : "Evoc",
		time : "1 a",
		range : "120 ft",
		components : "V,S",
		duration : "Instantaneous",
		description : "Spell atk 2d8+1d6+1d6/SL dmg, d8s set dmg type, see B; double on d8s: new atk vs. crea in 30 ft",
		descriptionFull : "You hurl an undulating, warbling mass of chaotic energy at one creature in range. Make a ranged spell attack against the target. On a hit, the target takes 2d8 + 1d6 damage. Choose one of the d8s. The number rolled on that die determines the attack's damage type, as shown below." + "\n\n" + toUni("d8") + "\t" + toUni("Damage Type") + "\n  1\tAcid" + "\n  2\tCold" + "\n  3\tFire" + "\n  4\tForce" + "\n  5\tLightning" + "\n  6\tPoison" + "\n  7\tPsychic" + "\n  8\tThunder" + "\n\n   " + "If you roll the same number on both d8s, the chaotic energy leaps from the target to a different creature of your choice within 30 feet of it. Make a new attack roll against the new target, and make a new damage roll, which could cause the chaotic energy to leap again." + "\n   " + "A creature can be targeted only once by each casting of this spell." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, each target takes 1d6 extra damage of the type rolled for each slot level above 1st."
	};
}

// Magic Items
MagicItemsList["guild keyrune"] = {
	name : "Guild Keyrune",
	source : ["G", 177],
	type : "wondrous item",
	description : "As an action, I can speak this ceremonial key's command word to have it transforms into a creature. It is friendly to me and my allies. It obeys my spoken commands, taking only the Dodge action if not commanded otherwise. It lasts for some hours, until it has 0 HP, or I dismiss it as an action.",
	descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a creature if there is enough space. The creature is friendly to me and my allies, understands my languages, and obeys my spoken commands. It takes only the Dodge action if not commanded otherwise. It reverts back to its keyrune form after some hours, when it drops to 0 HP, or if I touch it and speak its command word as an action. Once it reverts back, it can't transform again until 36 hours have passed.",
	descriptionFull : "Associated with a particular guild, a guild keyrune is a ceremonial, stylized key, about 1 foot long, made from carved stone. Not a literal key, the item is a badge of authority that gives its bearer access to privileged places in its guild's headquarters and outposts. At the DM's discretion, a character might be given a keyrune upon attaining a renown score of 25 in their guild.\n    When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the key rune transforms into a creature. If there isn't enough space for the creature, the keyrune doesn't transform. See the Monster Manual for the creature's stat block- the name of which is given in bold in the keyrune's description- unless you're directed to chapter 6 of this book instead.\n    The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n    The creature exists for a duration specific to each keyrune. At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
	attunement : true,
	action : [["action", ""]],
	choices : ["Azorius", "Boros", "Dimir", "Golgari", "Gruul", "Izzet", "Orzhov", "Rakdos", "Selesnya", "Simic"],
	"azorius" : {
		rarity : "rare",
		description : "As an action, I can speak this ceremonial key's command word and have it transform into a giant eagle for 1 hour with which I can talk telepathically if within 1 mile. It is friendly to me and my allies and obeys my spoken commands. As an action, I can see and hear what it does. I can have it revert back as an action.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a a giant eagle for 1 hour. While within 1 mile, I can communicate telepathically with it. It is friendly to me and my allies and obeys my spoken commands, otherwise using only the Dodge action. It reverts back to its keyrune form when it drops to 0 HP or if I touch it and speak the command word as an action. Once it does, it can't transform again for 36 hours. As an action, I can see/hear through its senses as if I had keen sight until the start of my next turn, but I can't use my own senses during that time.",
		descriptionFull : "This keyrune is carved from white marble and lapis lazuli to resemble a noble bird of prey. It can become a giant eagle for up to 1 hour. While the transformed eagle is within 1 mile of you, you can communicate with it telepathically. As an action, you can see through the eagle's eyes and hear what it hears until the start of your next turn, and you gain the benefit of its keen sight. During this time, you are deaf and blind with regard to your own senses.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a giant eagle. If there isn't enough space for the eagle, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the eagle takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Azorius guild",
		prereqeval : function (v) {
			return (/azorius/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	},
	"boros" : {
		rarity : "rare",
		description : "As an action, I can speak this ceremonial key's command word and place it on the ground to transforms into a human veteran. It is friendly to me and my allies. It obeys my spoken commands, taking only the Dodge action if not commanded otherwise. It lasts for 8 hours, until it has 0 HP, or I dismiss it as an action.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a human veteran if there is enough space. The creature is friendly to me and my allies and gives tactical advice, but is easily revealed as an artificial human. It understands my languages and obeys my spoken commands, taking only the Dodge action if not commanded otherwise. It reverts back to its keyrune form after some hours, when it drops to 0 HP, or if I dismiss it as an action by touching it and speaking the command word again. Once it does, it can't transform again until 36 hours have passed.",
		descriptionFull : "Carved from red sandstone with white granite elements to resemble a member of the Boros Legion, this keyrune can become a veteran (human) for up to 8 hours. In addition to fighting on your behalf, this veteran cheerfully offers tactical advice, which is usually sound. Anyone who talks with the transformed keyrune or examines it closely can easily recognize that it is an artificial human.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a veteran (human). If there isn't enough space for the veteran, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Boros guild",
		prereqeval : function (v) {
			return (/boros/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	},
	"dimir" : {
		rarity : "very rare",
		description : "As an action, I can speak this ceremonial key's command word to have it transform into an intellect devourer. It is friendly to me and my allies. It lasts for 24 hours, until it has 0 HP, or I dismiss it as an action. I can command it to pursue only a single mission each times it transforms and it returns to me at the end of it.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into an intellect devourer if there is enough space. The creature is friendly to me and my allies, understands my languages, and obeys my spoken commands. It lasts for 24 hours, during which time it pursues a single mission set by me, like information gathering, returning to me afterwards to report and transform back to the keyrune. It also reverts back when it drops to 0 HP or if I touch it and speak its command word as an action. Once it reverts back, it can't transform again for 36 hours.",
		descriptionFull : "This keyrune, carved from black stone accented with steel, resembles a stylized horror. On command, it transforms into an intellect devourer that resembles the Dimir guild symbol, with six bladelike legs. The creature exists for up to 24 hours. During that time, it pursues only a single mission you give it\u2014usually an assignment to take over someone's body, either to impersonate that person for a brief time or to extract secrets from their mind. When the mission is complete, the creature returns to you, reports its success, and reverts to its keyrune form.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a intellect devourer. If there isn't enough space for the creature, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Dimir guild",
		prereqeval : function (v) {
			return (/dimir/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	},
	"golgari" : {
		rarity : "very rare",
		description : "As an action, I can speak this ceremonial key's command word to have it transforms into a giant scorpion with which I can talk telepathically if in 60 ft. It is friendly to me and my allies and obeys my commands. It reverts back after 6 hours, if it drops to 0 HP, or I touch it and speak its command word as an action.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a giant scorpion if there is enough space. While within 60 ft of it, I can communicate with it telepathically. The creature is friendly to me and my allies, understands my languages, and obeys my spoken commands. It takes only the Dodge action if not commanded otherwise. It reverts back to its keyrune form after some hours, when it drops to 0 HP, or if I touch it and speak its command word as an action. Once it reverts back, it can't transform again until 36 hours have passed.",
		descriptionFull : "Made from deep green jade with black veins, this keyrune has an insectile shape. It can transform into a giant scorpion for up to 6 hours. The scorpion has an Intelligence of 4 and can communicate with you telepathically while it is within 60 feet of you, though its messages are largely limited to describing the passage of potential prey.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a giant scorpion. If there isn't enough space for the creature, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Golgari guild",
		prereqeval : function (v) {
			return (/golgari/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	},
	"gruul" : {
		type : "wondrous item",
		rarity : "rare",
		description : "As an action, I can speak this ceremonial key's command word to have it transforms into a ceratok (rhinoceros stats). It is friendly to me and my allies. It obeys my spoken commands, taking only the Dodge action if not commanded otherwise. It lasts for 1 hour, until it has 0 HP, or I dismiss it as an action.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a ceratok (rhinoceros stats) if there is enough space. The creature is friendly to me and my allies, understands my languages, and obeys my spoken commands. It takes only the Dodge action if not commanded otherwise. It reverts back to its keyrune form after 1 hour, when it drops to 0 HP, or if I touch it and speak its command word as an action. Once it reverts back, it can't transform again until 36 hours have passed.",
		descriptionFull : "This crude keyrune is cobbled together from bits of rubble, broken glass, bone, and animal hair. One end resembles a horned beast. On command, the keyrune transforms into a ceratok, a horned creature much like a rhinoceros (and with the same statistics). It remains in its ceratok form for 1 hour.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a ceratok. If there isn't enough space for the creature, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Gruul guild",
		prereqeval : function (v) {
			return (/gruul/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	},
	"izzet" : {
		rarity : "rare",
		description : "As an action, I can speak this ceremonial key's command word to have it transforms into a galvanice weird. It is friendly to me and my allies. It obeys my spoken commands, taking only the Dodge action if not commanded otherwise. It lasts for 3 hours, until it has 0 HP, or I dismiss it as an action.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a galvanice weird if there is enough space. The creature is friendly to me and my allies, understands my languages, and obeys my spoken commands. It takes only the Dodge action if not commanded otherwise. It reverts back to its keyrune form after 3 hours, when it drops to 0 HP, or if I touch it and speak its command word as an action. Once it reverts back, it can't transform again until 36 hours have passed.",
		descriptionFull : "Formed of carved and polished red and blue stone, the keyrune includes bits of cable and wire. One end resembles a humanlike head, suggesting the jagged elemental form of the galvanice weird that it can become for a duration of 3 hours. In this form, it will serve you as a bodyguard, lift and carry things for you, act as a test subject for your experiments, or aid you in any other way that its capabilities allow.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a galvanice weird. If there isn't enough space for the creature, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Izzet guild",
		prereqeval : function (v) {
			return (/izzet/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	},
	"orzhov" : {
		rarity : "rare",
		description : "As an action, I can speak this ceremonial key's command word to have it transforms into a winged thrull. It is friendly to me and my allies. It obeys my spoken commands, taking only the Dodge action if not commanded otherwise. It lasts for 2 hours, until it has 0 HP, or I dismiss it as an action.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a winged thrull if there is enough space. The creature is friendly to me and my allies, understands my languages, and obeys my spoken commands. It takes only the Dodge action if not commanded otherwise. It reverts back to its keyrune form after 2 hours, when it drops to 0 HP, or if I touch it and speak its command word as an action. Once it reverts back, it can't transform again until 36 hours have passed.",
		descriptionFull : "This keyrune is carved from white marble with veins of black. The end is shaped like a thrull's head, with a gold faceplate affixed. On command, the keyrune transforms into a winged thrull for up to 2 hours. If you don't come from an Orzhov oligarch family, it serves you grudgingly, clownishly aping your movements and mannerisms while carrying out your orders.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a winged thrull. If there isn't enough space for the creature, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Orzhov guild",
		prereqeval : function (v) {
			return (/orzhov/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	},
	"rakdos" : {
		rarity : "uncommon",
		description : "As an action, I can speak this ceremonial key's command word to have it transforms into a cackler. It is friendly to me and my allies. It obeys my spoken commands, taking only the Dodge action if not commanded otherwise. It lasts for 1 hour, until it has 0 HP, or I dismiss it as an action.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a cackler if there is enough space. The creature is friendly to me and my allies, understands my languages, and obeys my spoken commands. It takes only the Dodge action if not commanded otherwise. It reverts back to its keyrune form after 1 hour, when it drops to 0 HP, or if I touch it and speak its command word as an action. Once it reverts back, it can't transform again until 36 hours have passed.",
		descriptionFull : "This dark granite keyrune is marbled with scarlet veins and carved with the leering visage of a mischievous demon. When activated, it transforms into a cackler for up to 1 hour.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a cackler. If there isn't enough space for the creature, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Rakdos guild",
		prereqeval : function (v) {
			return (/rakdos/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	},
	"selesnya" : {
		rarity : "rare",
		description : "As an action, I can speak this ceremonial key's command word to have it transforms into a wolf with Int 6 with which I can talk telepathically if within 1 mile. It is friendly to me and my allies. It obeys my commands, but only uses the Dodge action otherwise. It lasts for 8 hours, until it has 0 HP, or I dismiss it as an action.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a wolf with Intelligence 6 if there is enough space. The creature is friendly to me and my allies, understands Elvish and Sylvan (but can't speak them), and obeys my commands. While within 1 mile, we can communicate telepathically. It takes only the Dodge action if not commanded otherwise. It reverts back to its keyrune form after 8 hours, when it drops to 0 HP, or if I touch it and speak its command word as an action. Once it reverts back, it can't transform again until 36 hours have passed.",
		descriptionFull : "Carved from white and green marble in the shape of a wolf's head, this keyrune transforms into a dire wolf. The wolf persists for 8 hours. Its Intelligence is 6, and it understands Elvish and Sylvan but can't speak those languages. While it is within 1 mile of you, you can communicate with each other telepathically.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a dire wolf. If there isn't enough space for the creature, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Selesnya guild",
		prereqeval : function (v) {
			return (/selesnya/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	},
	"simic" : {
		rarity : "uncommon",
		description : "As an action, I can speak this ceremonial key's command word to have it transforms into a krasis (cat. 2, Grabber and Stabilizing Legs). It is friendly to me and my allies. It obeys my commands, taking only the Dodge action if not commanded otherwise. It lasts for 5 hours, until it has 0 HP, or I dismiss it as an action.",
		descriptionLong : "As an action, I can speak this ceremonial key's command word and place it on the ground where it transforms into a category 2 krasis that has the Grabber and Stabilizing Legs adaptations if there is enough space. The creature is friendly to me and my allies, understands my languages, and obeys my spoken commands. It takes only the Dodge action if not commanded otherwise. It reverts back to its keyrune form after 5 hours, when it drops to 0 HP, or if I touch it and speak its command word as an action. Once it reverts back, it can't transform again until 36 hours have passed.",
		descriptionFull : "This keyrune is assembled from coral, mother-of-pearl, and chrome and adorned with the spirals and curves characteristic of Simic ornamentation. The head resembles the shell of a sea creature. On command, the keyrune turns into a category 2 krasis that has the Grabber and Stabilizing Legs adaptations. The transformation lasts for up to 5 hours.\n   When you use an action to speak the item's command word and place the keyrune on the ground in an unoccupied space within 5 feet of you, the keyrune transforms into a category 2 krasis that has the Grabber and Stabilizing Legs adaptations. If there isn't enough space for the creature, the keyrune doesn't transform.\n   The creature is friendly to you, your companions, and other members of your guild (unless those guild members are hostile to you). It understands your languages and obeys your spoken commands. If you issue no commands, the creature takes the Dodge action and moves to avoid danger.\n   At the end of the duration, the creature reverts to its keyrune form. It reverts early if it drops to 0 hit points or if you use an action to speak the command word again while touching it. When the creature reverts to its keyrune form, it can't transform again until 36 hours have passed.",
		prerequisite : "Requires attunement by a member of the Simic guild",
		prereqeval : function (v) {
			return (/simic/i).test(What("Background") + What("Background Extra") + What("Background_Faction.Text"));
		},
		usages : 1,
		recovery : "36 h"
	}
}
MagicItemsList["guild signet"] = {
	name : "Guild Signet",
	source : ["G", 178],
	type : "ring",
	rarity : "uncommon",
	description : "This signet ring bears a symbol of its associated guild. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast the spell within (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
	descriptionFull : "This ring, adorned with the symbol of a guild, allows you to cast one spell closely associated with that guild, as shown in the table below. A guild signet is sometimes awarded to a guild member whose renown score in that guild is 5 or higher, as a reward for performing special services for the guild. Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.\n   A signet has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, you can expend 1 charge to cast the associated spell (save DC 13).\n\n" +
	toUni("Guild \tAssociated Spell") +
	"\nAzorius\tensnaring strike" +
	"\nBoros\theroism" +
	"\nDimir\tdisguise self" +
	"\nGolgari\tentangle" +
	"\nGruul\tcompelled duel" +
	"\nlzzet\tchaos bolt" +
	"\nOrzhov\tcommand" +
	"\nRakdos\thellish rebuke" +
	"\nSelesnya\tcharm person" +
	"\nSimic\texpeditious retreat",
	attunement : true,
	usages : 3,
	recovery : "dawn",
	additional : "regains 1d3",
	choices : ["Azorius", "Boros", "Dimir", "Golgari", "Gruul", "Izzet", "Orzhov", "Rakdos", "Selesnya", "Simic"],
	"azorius" : {
		description : "\nAzorius\tensnaring strike",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["ensnaring strike"],
			selection : ["ensnaring strike"],
			firstCol : 1
		}
	},
	"boros" : {
		description : "This signet ring bears a symbol of Boros. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Heroism (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["heroism"],
			selection : ["heroism"],
			firstCol : 1
		}
	},
	"dimir" : {
		description : "This signet ring bears a symbol of Dimir. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Disguise Self (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["disguise self"],
			selection : ["disguise self"],
			firstCol : 1
		}
	},
	"golgari" : {
		description : "This signet ring bears a symbol of Golgari. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Entangle (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["entangle"],
			selection : ["entangle"],
			firstCol : 1
		}
	},
	"gruul" : {
		description : "This signet ring bears a symbol of Gruul. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Compelled Duel (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["compelled duel"],
			selection : ["compelled duel"],
			firstCol : 1
		}
	},
	"izzet" : {
		description : "This signet ring bears a symbol of lzzet. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Chaos Bolt (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["chaos bolt"],
			selection : ["chaos bolt"],
			firstCol : 1
		}
	},
	"orzhov" : {
		description : "This signet ring bears a symbol of Orzhov. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Command (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["command"],
			selection : ["command"],
			firstCol : 1
		}
	},
	"rakdos" : {
		description : "This signet ring bears a symbol of Rakdos. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Hellish Rebuke (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["hellish rebuke"],
			selection : ["hellish rebuke"],
			firstCol : 1
		}
	},
	"selesnya" : {
		description : "This signet ring bears a symbol of Selesnya. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Charm Person (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["charm person"],
			selection : ["charm person"],
			firstCol : 1
		}
	},
	"simic" : {
		description : "This signet ring bears a symbol of Simic. It has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing it, I can expend 1 charge to cast Expeditious Retreat (save DC 13). Aside from its magical properties, the ring is also an indicator of the guild's recognition and favor.",
		spellFirstColTitle : "Ch",
		fixedDC : 13,
		spellcastingBonus : {
			name : "1 charge",
			spells : ["expeditious retreat"],
			selection : ["expeditious retreat"],
			firstCol : 1
		}
	}
}
MagicItemsList["illusionist's bracers"] = {
	name : "Illusionist's Bracers",
	source : ["G", 178],
	type : "wondrous item",
	rarity : "very rare",
	description : "While wearing the bracers, whenever I cast a cantrip, I can use a bonus action on the same turn to cast that cantrip a second time.",
	descriptionFull : "A powerful illusionist of House Dimir originally developed these bracers, which enabled her to create multiple minor illusions at once. The bracers' power, though, extends far beyond illusions.\n   While wearing the bracers, whenever you cast a cantrip, you can use a bonus action on the same turn to cast that cantrip a second time.",
	weight : 1,
	attunement : true,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	action : [["bonus action", " (with cantrip)"]]
}
MagicItemsList["mizzium apparatus"] = {
	name : "Mizzium Apparatus",
	source : ["G", 179],
	type : "wondrous item",
	rarity : "uncommon",
	description : "I can use this harness as an arcane focus and to attempt to cast a spells that I do not know or have prepared but is on my class' spell list. This requires an Int (Arcana) check DC 10 + twice the spell slot level and components and a spell slot as appropriate for the spell. On a failure, I cast a random spell, see Notes page.",
	descriptionLong : "This apparatus is a collection of leather straps, flexible tubing, glass cylinders, and plates, bracers, and fittings made from a magic-infused metal alloy called mizzium, all assembled into a harness. I can use it as an arcane focus. In addition, I can use it to attempt to cast a spell that I do not know or have prepared but is on my class' spell list. I use components and a spell slot as appropriate for the spell as normal, but I must succeed on an Intelligence (Arcana) check DC 10 + twice the spell slot level. On a failure, I cast a random spell, see Notes page. The DC for cantrips is 10, and on a failure nothing happens.",
	descriptionFull : "Innovation is a dangerous pursuit, at least the way the mages of the Izzet League engage in it. As protection against the risk of an experiment going awry, they have developed a device to help channel and control their magic. This apparatus is a collection of leather straps, flexible tubing, glass cylinders, and plates, bracers, and fittings made from a magic-infused metal alloy called mizzium, all assembled into a harness. The item weighs 8 pounds.\n   While you are wearing the mizzium apparatus, you can use it as an arcane focus. In addition, you can attempt to cast a spell that you do not know or have prepared. The spell you choose must be on your class's spell list and of a level for which you have a spell slot, and you must provide the spell's components.\n   You expend a spell slot to cast the spell as normal, but before resolving it you must make an Intelligence (Arcana) check. The DC is 10 + twice the level of the spell slot you expend to cast the spell.\n   On a successful check, you cast the spell as normal, using your spell save DC and spellcasting ability modifier. On a failed check, you cast a different spell from the one you intended. Randomly determine the spell you cast by rolling on the table for the level of the spell slot you expended. If the slot is 6th level or higher, roll on the table for 5th-level spells.\n   If you try to cast a cantrip you don't know, the DC for the Intelligence (Arcana) check is 10, and on a failed check, there is no effect.\n\n" + [
		toUni("d6\t1st-level spell"),
		" 1\tBurning Hands",
		" 2\tChaos Bolt",
		" 3\tColor Spray",
		" 4\tFaerie Fire",
		" 5\tFog Cloud",
		" 6\tThunderwave\n",
		toUni("d6\t2nd-level spell"),
		" 1\tBlur",
		" 2\tGust of Wind",
		" 3\tHeat Metal",
		" 4\tMelf's Acid Arrow",
		" 5\tScorching Ray",
		" 6\tShatter\n",
		toUni("d6\t3rd-level spell"),
		" 1\tFear",
		" 2\tFeign Death",
		" 3\tFireball",
		" 4\tGaseous Form",
		" 5\tSleet Storm",
		" 6\tStinking Cloud\n",
		toUni("d4\t4th-level spell"),
		" 1\tConfusion",
		" 2\tConjure Minor Elementals",
		" 3\tEvard's Black Tentacles",
		" 4\tIce Storm\n",
		toUni("d4\t5th-level spell"),
		" 1\tAnimate Objects",
		" 2\tCloudkill",
		" 3\tCone of Cold",
		" 4\tFlame Strike"
	].join("\n"),
	weight : 8,
	attunement : true,
	prerequisite : "Requires attunement by a sorcerer, warlock, or wizard",
	prereqeval : function(v) { return classes.known.sorcerer || classes.known.warlock || classes.known.wizard ? true : false; },
	toNotesPage : [{
		name : "Random Spells",
		popupName : "Mizzium Apparatus's Random Spells",
		note : [
			"This apparatus is a collection of leather straps, flexible tubing, glass cylinders, and plates, bracers, and fittings made from a magic-infused metal alloy called mizzium, all assembled into a harness.",
			"While I am wearing the mizzium apparatus, I can use it as an arcane focus. In addition, I can attempt to cast a spell that I do not know or have prepared. The spell I choose must be on my class's spell list and of a level for which I have a spell slot, and I must provide the spell's components.",
			"I expend a spell slot to cast the spell as normal, but before resolving it I must make an Intelligence (Arcana) check. The DC is 10 + twice the level of the spell slot I expend to cast the spell. On a successful check, I cast the spell as normal, using my spell save DC and spellcasting ability modifier. On a failed check, I cast a different spell from the one I intended, randomly determining the spell I cast by rolling on the table for the level of the spell slot expended. If the slot is 6th level or higher, I roll on the table for 5th-level spells. If I try to cast a cantrip I don't know, the DC for the Intelligence (Arcana) check is 10, and on a failed check, there is no effect.\n",
			"1D6\t1ST-LEVEL SPELL\t1D6\t2ND-LEVEL SPELL",
			"  1\tBurning Hands \t  1\tBlur",
			"  2\tChaos Bolt    \t  2\tGust of Wind",
			"  3\tColor Spray   \t  3\tHeat Metal",
			"  4\tFaerie Fire   \t  4\tMelf's Acid Arrow",
			"  5\tFog Cloud     \t  5\tScorching Ray",
			"  6\tThunderwave   \t  6\tShatter\n",
			"1D6\t3RD-LEVEL SPELL",
			"  1\tFear",
			"  2\tFeign Death",
			"  3\tFireball",
			"  4\tGaseous Form",
			"  5\tSleet Storm",
			"  6\tStinking Cloud\n",
			"1D4\t4TH-LEVEL SPELL\t1D4\t5TH-LEVEL SPELL (AND HIGHER)",
			"  1\tConfusion\t\t  1\tAnimate Objects",
			"  2\tConjure Minor Elem.\t  2\tCloudkill",
			"  3\tEvard's Black Tentacles\t  3\tCone of Cold",
			"  4\tIce Storm\t\t  4\tFlame Strike"
		]
	}]
}
MagicItemsList["mizzium armor"] = {
	name : "Mizzium Armor",
	nameTest : "Mizzium",
	source : ["G", 179],
	type : "armor (medium or heavy)",
	rarity : "rare",
	description : "This armor is reinforced with a magically enhanced metal alloy called mizzium. While I'm wearing it, any critical hit against me becomes a normal hit. In addition, when I'm subjected to a magical effect that allows me to make a Str or Con save to take only half damage, I instead take no damage if I succeed on it.",
	descriptionFull : "This suit of armor is reinforced with a magically enhanced metal alloy called mizzium, which is made in Izzet foundries. While you're wearing the armor, any critical hit against you becomes a normal hit. In addition, when you are subjected to a magical effect that allows you to make a Strength or Constitution saving throw to take only half damage, you instead take no damage if you succeed on the saving throw.",
	savetxt : { text : ["No damage on success Str or Con save for half damage"] },
	allowDuplicates : true,
	chooseGear : {
		type : "armor",
		prefixOrSuffix : "suffix",
		excludeCheck : function (inObjKey, inObj) {
			return !(/medium|heavy/i).test(inObj.type) || (/hide/i).test(inObj.name);
		},
		descriptionChange : ["prefix", "armor"]
	}
}
MagicItemsList["mizzium mortar"] = {
	name : "Mizzium Mortar",
	source : ["G", 179],
	type : "wondrous item",
	rarity : "rare",
	description : "This 4-ft-long, 6-inch-diameter tube has 4 charges, regaining 1d4 at dawn. As an action, I can expend 1 charge to have all in a 30-ft cone take 5d4 fire damage. As an action, I can expend 3 charges to have all in a 20-ft radius, 40-ft high cylinder in 60 ft take 5d8 fire damage. For both effects DC 15 Dex save halves.",
	descriptionLong : "This 4-ft-long, 6-inch-diameter mizzium tube has 4 charges, regaining 1d4 expended charges at dawn. The end that's pointed toward a target is open, and a glowing ball of molten metal can be seen at the other end as long as the mortar has at least 1 charge remaining. As an action, I can expend 1 charge to create a spray of molten mizzium in a 30-ft cone. All within the cone take 5d4 fire damage, DC 15 Dexterity saving throw halves. As an action, I can expend 3 charges to create a 20-ft radius, 40-ft high cylinder within 60 ft of me that deals 5d8 fire damage to all within, DC 15 Dexterity saving throw halves.",
	descriptionFull : "This short tube, about 2 feet long and 6 inches in diameter, is made from mizzium, a magically enhanced metal alloy forged by the Izzet League. The end that's pointed toward a target is open, and a glowing ball of molten metal can be seen at the other end as long as the mortar has at least 1 charge remaining.\n   The mortar has 4 charges for the following properties. It regains 1d4 expended charges daily at dawn.\n   " + toUni("Molten Spray") + ". You can expend 1 charge as an action to loose a 30-foot cone of molten mizzium. Each creature in the area must make a DC 15 Dexterity saving throw, taking 5d4 fire damage on a failed save, or half as much damage on a successful one.\n   " + toUni("Mizzium Bombard") + ". You can expend 3 charges as an action to launch a hail of molten projectiles in a 20-foot-radius, 40-foot-high cylinder centered on a point you can see within 60 feet of you. Each creature in the area must make a DC 15 Dexterity saving throw. A creature takes 5d8 fire damage on a failed save, or half as much damage on a successful one.",
	weight : 1,
	usages : 4,
	recovery : "dawn",
	additional : "regains 1d4"
}
MagicItemsList["moodmark paint"] = {
	name : "Moodmark Paint",
	source : ["G", 180],
	type : "wondrous item",
	rarity : "common",
	description : "Once, I can spend 1 minute to apply this thick black paint to a creature's face. For the next 8 hours, anyone seeing the target can make a DC 10 Wisdom (Insight) check to see if it is happy, sad, angry, disgusted, surprised, or afraid, as well as the main source of that emotion. Drows have advantage on this check.",
	descriptionFull : "This thick, black paint is stored in a small jar, containing enough paint to apply moodmarks to one creature. The paint is dabbed on the face in spots or markings that often resemble the eyes of insects or spiders. Applying the paint in this way takes 1 minute.\n   For the next 8 hours, the marks change to reflect your mental state. A creature that can see you and makes a successful DC 10 Wisdom (Insight) check can discern whether you are happy, sad, angry, disgusted, surprised, or afraid, as well as the main source of that emotion. For example, you might communicate fear caused by a monster you just saw around the corner, grief at the loss of a friend, or happiness derived from pride in your performance in combat. A dark elf has advantage on this check.",
	weight : 1
}
MagicItemsList["pariah's shield"] = {
	name : "Pariah's Shield",
	source : ["G", 180],
	type : "shield",
	rarity : "rare",
	description : "While I wield this shield. I gain a +1 bonus to AC for every two allies within 5 ft of me on top of the shield's AC bonus, up to a +3 bonus. As a reaction when a creature I can see within 5 ft of me takes damage, I can take that damage instead, but the damage type for it changes to force.",
	descriptionFull : "Soldiers of the Boros Legion consider it an honor to bear this shield, even knowing that it might be the last honor they receive. The front of the shield is sculpted to depict a grieving human face.\n   You gain a +1 bonus to AC for every two allies within 5 feet of you (up to a maximum of +3) while you wield this shield. This bonus is in addition to the shield's normal bonus to AC.\n   When a creature you can see within 5 feet of you takes damage, you can use your reaction to take that damage, instead of the creature taking it. When you do so, the damage type changes to force.",
	attunement : true,
	weight : 6,
	shieldAdd : "Pariah's Shield",
	action : [["reaction", ""]]
}
MagicItemsList["peregrine mask"] = {
	name : "Peregrine Mask",
	source : ["G", 180],
	type : "wondrous item",
	rarity : "very rare",
	description : "While wearing this winged helm, I have a flying speed of 60 ft and advantage on initiative rolls.",
	descriptionFull : "While wearing this winged helm, you have a flying speed of 60 feet. In addition, you have advantage on initiative rolls.",
	attunement : true,
	advantages : [["Initiative", true]],
	speed : { fly : { spd : "fixed60", enc : "fixed50" } }
}
MagicItemsList["pyroconverger"] = {
	name : "Pyroconverger",
	source : ["G", 180],
	type : "wondrous item",
	rarity : "uncommon",
	description : "As an action, I can use this flamethrower to deal 4d6 fire damage to all in a 10-ft cone, DC 13 Dex save halves. I must roll a d10 each time I use it and add the times it was used since my last long rest. If the total is 11 or higher, it malfunctions and I take 4d6 fire damage and I can't use it again until I finish a long rest.",
	descriptionFull : "A Pyroconverger is an Izzet-made flamethrower. It carries a risk of malfunction each time you use it.\n   As an action, you can cause the Pyroconverger to project fire in a 10-foot cone. Each creature in that area must make a DC 13 Dexterity saving throw, taking 4d6 fire damage on a failed save, or half as much damage on a successful one.\n   Each time you use the Pyroconverger, roll a d10 and add the number of times you have used it since your last long rest. If the total is 11 or higher, the Pyroconverger malfunctions: you take 4d6 fire damage, and you can't use the Pyroconverger again until you finish a long rest.",
	attunement : true,
	weight : 1,
	weaponsAdd : ["Pyroconverger"],
	weaponOptions : {
		regExpSearch : /pyroconverger/i,
		name : "Pyroconverger",
		source : ["G", 180],
		ability : 0,
		type : "Magic Item",
		damage : [4, 6, "fire"],
		range : "10-ft cone",
		description : "Hits all in area; Dex save, success - half damage; Roll each time for malfunction, see item",
		abilitytodamage : false,
		modifiers : ["dc+5", ""]
	},
	usages : 1,
	recovery : "long rest",
	additional : "if malfunction"
}
MagicItemsList["rakdos riteknife"] = {
	name : "Rakdos Riteknife",
	source : ["G", 180],
	type : "weapon (dagger)",
	rarity : "legendary",
	description : "This has +1 to hit/damage and imprisons souls of any killed with it, up to 5. It deals +1d4 necr. per stored soul. As a bonus action, I can release souls to regain 1d10 HP per soul. Once per long rest as a reaction after I deal damage with it, I can release 5 souls to have the target make a DC 15 Con save or die if below 75 HP.",
	descriptionLong : "This magical dagger has a +1 bonus on attack and damage rolls made with it. When used to slay a creature, it imprisons its soul. It can store up to five souls. While it holds souls, it deals +1d4 necrotic damage per stored soul. [Siphon Vitality] As a bonus action, I can release one or more soul to regain 1d10 HP per soul released. [Annihilation] As a reaction after I deal damage with it, I can release five souls to have the target of the attack make a DC 15 Constitution saving throw or die if below 75 HP. If the target dies, I can't use this property again until I finish a long rest.",
	descriptionFull : "You gain a +1 bonus to attack and damage rolls made with this magic weapon. Its blade is cruelly serrated, and its hilt resembles a demonic head and wings. Whenever you slay a creature with an attack using the dagger, the creature's soul is imprisoned inside the dagger, and that creature can be restored to life only by a Wish spell. The dagger can hold a maximum of five souls.\n   For each soul imprisoned in the dagger, your attacks with it deal an extra 1d4 necrotic damage on a hit. While the dagger is within 5 feet of you, your dreams are haunted by whispers from the trapped souls.\n   The dagger has the following additional properties.\n   " + toUni("Siphon Vitality") + ". As a bonus action, you can release any number of stored souls from the dagger to regain 1d10 hit points per soul released.\n   " + toUni("Annihilation") + ". If the dagger holds five souls, you can use this property: As a reaction immediately after you hit a creature with the dagger and deal damage to that target, you can release all five souls. If the target now has fewer than 75 hit points, it must succeed on a DC 15 Constitution saving throw or die. If the target dies, you can't use this property again until you finish a long rest.",
	attunement : true,
	weight : 1,
	action : [["bonus action", " (Siphon Vitality)"], ["reaction", " (Annihilation)"]],
	weaponsAdd : ["Rakdos Riteknife"],
	weaponOptions : {
		baseWeapon : "dagger",
		regExpSearch : /^(?=.*rakdos)(?=.*riteknife).*$/i,
		name : "Rakdos Riteknife",
		source : ["G", 180],
		description : "Finesse, light, thrown; Imprisons soul on kill (max 5); +1d4 necrotic damage per stored soul",
		modifiers : [1,1]
	},
	usages : 1,
	recovery : "long rest",
	additional : "Annihilation"
}
MagicItemsList["skyblinder staff"] = {
	name : "Skyblinder Staff",
	source : ["G", 181],
	type : "staff",
	rarity : "uncommon",
	description : "This +1 quarterstaff gives me a +1 bonus on spell attacks. As a reaction when a flying creature I can see within 30 ft makes an attack roll against me, I can cause the staff to flare with light. The attacker has disadvantage on the attack roll, and it must make a DC 15 Con save or be blinded until the start of its next turn.",
	descriptionFull : "You gain a +1 bonus to attack and damage rolls made with this magic quarterstaff. While holding it, you gain a +1 bonus to spell attack rolls.\n   If a flying creature you can see within 30 feet of you makes an attack roll against you, you can use your reaction to hold the staff aloft and cause it to flare with light. The attacker has disadvantage on the attack roll, and it must succeed on a DC 15 Constitution saving throw or be blinded until the start of its next turn.",
	attunement : true,
	weight : 4,
	action : [["reaction", " (vs. flying)"]],
	weaponsAdd : ["Skyblinder Staff"],
	weaponOptions : {
		baseWeapon : "quarterstaff",
		regExpSearch : /^(?=.*skyblinder)(?=.*staff).*$/i,
		name : "Skyblinder Staff",
		source : ["G", 181],
		description : "Versatile (1d8); On hit, 1 charge for +1d6 force damage",
		modifiers : [1, 1]
	},
	calcChanges : {
		spellCalc : [
			function (type, spellcasters, ability) {
				if (type == "attack") return 1;
			},
			"While holding the Skyblinder Staff, I have a +1 bonus to spell attack rolls."
		]
	}
}
MagicItemsList["spies' murmur"] = {
	name : "Spies' Murmur",
	source : ["G", 181],
	type : "wondrous item",
	rarity : "uncommon",
	description : "This dark metal headpiece is worn curved around the ear. I can communicate telepathically with others that I know within 1 mile who are also wearing a spies' murmur. As a bonus action, I can allow that creature to hear everything I hear for 1 hour. I can end this effect as a bonus action, and it ends if I am incapacitated.",
	descriptionFull : "This headpiece, crafted from dark metal, is worn curved around the ear. If you know a creature wearing another Spies' Murmur and that creature is within 1 mile of you, you can communicate telepathically with each other. As a bonus action, you can allow that creature to hear everything you hear for 1 hour. You can end this effect as a bonus action, and it ends if you're incapacitated.",
	attunement : true
}
MagicItemsList["sunforger"] = {
	name : "Sunforger",
	source : ["G", 181],
	type : "weapon (warhammer)",
	rarity : "rare",
	description : "This warhammer adds +2 to attack and damage rolls made with it. As an action once per short rest, I can hurl it up to 120 ft to a point I can see where it explodes in a 20-ft radius, dealing 6d6 fire damage to all within, DC 15 Dex save halves. Within 24 hours afterward, I can have it reform in my hand as an action.",
	descriptionFull : "You gain a +2 bonus to attack and damage rolls made with this magic weapon.\n   As an action, you can hurl the weapon up to 120 feet to a point you can see. When it reaches that point, the weapon vanishes in an explosion, and each creature in a 20-foot-radius sphere centered on that point must make a DC 15 Dexterity saving throw, taking 6d6 fire damage on a failed save, or half as much damage on a successful one. Afterward, you can use an action to cause the weapon to reappear in your empty hand. You can't cause it to explode again until you finish a short or long rest.\n   If you don't call the weapon back to your hand, it reappears at the point where it exploded when you are no longer attuned to it or when 24 hours have passed.",
	attunement : true,
	weight : 2,
	action : [["action", " (hurl/recall)"]],
	weaponsAdd : ["Sunforger"],
	weaponOptions : {
		baseWeapon : "warhammer",
		regExpSearch : /sunforger/i,
		name : "Sunforger",
		source : ["G", 181],
		description : "Versatile (1d10); As action, hurl 120 ft for 20-ft rad 6d6 fire dmg, Dex DC 15 half",
		modifiers : [2, 2]
	},
	usages : 1,
	recovery : "short rest",
	additional : "Hurl"
}
MagicItemsList["sword of the paruns"] = {
	name : "Sword of the Paruns",
	source : ["G", 181],
	type : "weapon (longsword)",
	rarity : "very rare",
	description : "This longsword has a +1 to hit and damage. Once per round after I take an action while holding it, I can use it to have a creature within 60 ft use its reaction to do something based on the action I was taking: [Attack] make one weapon attack, [Dash] move its speed, or [Dodge] gain the benefits of a Dodge action.",
	descriptionFull : "You gain a +1 bonus to attack and damage rolls made with this magic weapon. Additionally, once on each of your turns, you can use one of the following properties if you're holding the sword:\n \u2022 Immediately after you use the Attack action to attack with the sword, you can enable one creature within 60 feet of you to use its reaction to make one weapon attack.\n \u2022 Immediately after you take the Dash action, you can enable one creature within 60 feet of you to use its reaction to move up to its speed.\n \u2022 Immediately after you take the Dodge action, you can enable one creature within 60 feet of you to use its reaction to gain the benefits of the Dodge action.",
	attunement : true,
	weight : 3,
	weaponsAdd : ["Sword of the Paruns"],
	weaponOptions : {
		baseWeapon : "longsword",
		regExpSearch : /^(?=.*sword)(?=.*paruns).*$/i,
		name : "Sword of the Paruns",
		source : ["G", 181],
		description : "Versatile (1d10); Have ally in 60 ft do something when I take the Attack, Dash, or Dodge action",
		modifiers : [1, 1]
	}
}
MagicItemsList["voyager staff"] = {
	name : "Voyager Staff",
	source : ["G", 181],
	type : "staff",
	rarity : "very rare",
	description : "This +1 quarterstaff gives me a +1 bonus on spell attacks. It has 10 charges, regaining 1d6+4 expended charges at dawn. If I expend its last charge, roll a d20. On a 1, it vanishes. I can use its charges to cast Banishment (4 ch), Blink (3 ch), Misty Step (2 ch), Passwall (5 ch), and Teleport (7 ch), using my spellcasting ability.",
	descriptionFull : "You gain a +1 bonus to attack and damage rolls made with this magic quarterstaff. While you hold it, you gain a +1 bonus to spell attack rolls.\n   This staff has 10 charges. While holding it, you can use an action to expend 1 or more of the staff's charges to cast one of the following spells from it, using your spell save DC: Banishment (4 charges), Blink (3 charges), Misty Step (2 charges), Passwall (5 charges), or Teleport (7 charges).\n   The staff regains 1d6 + 4 expended charges daily at dawn. If you expend the last charge, roll a d20. On a 1, the staff vanishes forever.",
	attunement : true,
	weight : 4,
	prerequisite : "Requires attunement by a spellcaster",
	prereqeval : function(v) { return v.isSpellcaster; },
	weaponsAdd : ["Voyager Staff"],
	weaponOptions : {
		baseWeapon : "quarterstaff",
		regExpSearch : /^(?=.*voyager)(?=.*staff).*$/i,
		name : "Voyager Staff",
		source : ["G", 181],
		modifiers : [1, 1]
	},
	calcChanges : {
		spellCalc : [
			function (type, spellcasters, ability) {
				if (type == "attack") return 1;
			},
			"While holding the Voyager Staff, I have a +1 bonus to spell attack rolls."
		]
	},
	usages : 10,
	recovery : "dawn",
	additional : "regains 1d6+4",
	spellcastingAbility : "class",
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "2 charges",
		spells : ["misty step"],
		selection : ["misty step"],
		firstCol : 2
	}, {
		name : "3 charges",
		spells : ["blink"],
		selection : ["blink"],
		firstCol : 3
	}, {
		name : "4 charges",
		spells : ["banishment"],
		selection : ["banishment"],
		firstCol : 4
	}, {
		name : "5 charges",
		spells : ["passwall"],
		selection : ["passwall"],
		firstCol : 5
	}, {
		name : "7 charges",
		spells : ["teleport"],
		selection : ["teleport"],
		firstCol : 7
	}]
}
var iFileName = "pub_20181120_WDotMM.js";
RequiredSheetVersion(13);
// This file adds the magic items from the Waterdeep: Dungeon of the Mad Mage adventure to MPMB's Character Record Sheet

// Define the source
SourceList["WDotMM"] = {
	name : "Waterdeep: Dungeon of the Mad Mage [items]",
	abbreviation : "WDotMM",
	group : "Adventure Books",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/waterdeep-dungeon-mad-mage",
	date : "2018/11/20"
};

// Magic Items
MagicItemsList["dagger of blindsight"] = {
	name : "Dagger of Blindsight",
	source : ["WDotMM", 86],
	type : "weapon (dagger)",
	rarity : "rare",
	magicItemTable : "G",
	description : "This magical dagger has a saw-toothed edge and a black pearl nested in its pommel. While I'm attuned to it, I have blindsight out to a range of 30 ft.",
	descriptionFull : "This rare magic item requires attunement. A creature attuned to it gains blindsight out to a range of 30 feet. The dagger has a saw-toothed edge and a black pearl nested in its pommel.",
	attunement : true,
	weight : 1,
	weaponsAdd : ["Dagger of Blindsight"],
	vision : [["Blindsight", 30]]
}
MagicItemsList["professor orb"] = { // contains contributions by Pengsloth
	name : "Professor Orb",
	source : ["WDotMM", 131],
	type : "wondrous item",
	rarity : "rare",
	storyItemAL : true,
	description : "This orb is sentient with the personality of a scholar, but no will of its own. It has Int 18, Wis and Cha of 3d6 each. It knows and reads 4 languages, can see/hear as a human out to 60 ft, and has extensive knowledge of 4 narrow academic subjects (+9 on checks). It knows Mage Hand, which it uses to move around.",
	descriptionFull : "Each professor orb takes the form of a smooth, solid, 5-pound sphere of smoky gray quartz about the size of a grapefruit. Close examination reveals two or more pinpricks of silver light deep inside the sphere.\n   A Professor Orb is sentient and has the personality of a scholar. Its alignment is determined by rolling on the alignment table in the \"Sentient Magic Items\" section in chapter 7 of the Dungeon Master's Guide. Regardless of its disposition, the orb has an Intelligence of 18, and Wisdom and Charisma scores determined by rolling 3d6 for each ability. The orb speaks, reads, and understands four languages, and can see and hear normally out to a range of 60 feet. Unlike most sentient items, the orb has no will of its own and can't initiate a conflict with the creature in possession of it.\n   A Professor Orb has extensive knowledge of four narrow academic subjects. When making an Intelligence check to recall lore from any of its areas of expertise, the orb has a +9 bonus to its roll (including its Intelligence modifier).\n   In addition to the knowledge it possesses, a professor orb can cast the Mage Hand cantrip at will. It uses the spell only to transport itself. Its spellcasting ability is Intelligence."
}
MagicItemsList["horn of valhalla"].choices.push("Endless Maze (rare; 3d4+3 berserkers; prereq: simple weapons prof.)");
MagicItemsList["horn of valhalla"]["endless maze (rare; 3d4+3 berserkers; prereq: simple weapons prof.)"] = {
	name : "Horn of the Endless Maze",
	source : ["WDotMM", 163],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "G", // interpretation, made it the same as Brass Horn of Valhalla,
	description : "As an action once per 7 days, I can blow this horn to summon 3d4+3 minotaurs (use berserker stats) from the Abyss in 60 ft. They return after 1 hour or when they drop to 0 hp. They follow my commands and are friendly to me and my companions if I'm proficient with all simple weapons. Otherwise, they attack me.",
	descriptionFull : "You can use an action to blow this horn. In response, 3d4+3 warrior spirits from the Abyss appear within 60 feet of you. They look like Minotaurs and use the statistics of a berserker. They return to the Abyss after 1 hour or when they drop to 0 hit points. Once you use the horn, it can't be used again until 7 days have passed.\n   If you blow the horn without having proficiency with all simple weapons, the summoned berserkers attack you. If you meet the requirement, they are friendly to you and your companions and follow your commands."
}
MagicItemsList["dodecahedron of doom"] = {
	name : "Dodecahedron of Doom",
	source : ["WDotMM", 174],
	type : "wondrous item",
	rarity : "rare",
	notLegalAL : true,
	description : "This twelve-sided metal die is 1 ft across and bears the numbers 1 through 12 engraved on its pentagonal sides. As an action, I can hurl it up to 60 ft. A random magical effect occurs when the die comes to rest after rolling across the ground for at least 10 ft. See the Notes page for the table of effects.",
	descriptionFull : "This twelve-sided metal die is 12 inches across and bears the numbers 1 through 12 engraved on its pentagonal sides. The dodecahedron contains arcane clockwork mechanisms that whir and click whenever the die is cast.\n   The dodecahedron can be hurled up to 60 feet as an action. A random magical effect occurs when the die comes to rest after rolling across the ground for at least 10 feet. If an effect requires a target and no eligible target is within range, nothing happens. Spells cast by the dodecahedron require no components. Roll a d12 and consult the following table to determine the effect:\n\n" + toUni("d12\teffect") + "\n1-2\tThe dodecahedron explodes and is destroyed. Each creature within 20 feet of the exploding die must make a DC 13 Dexterity saving throw, taking 40 (9d8) force damage on a failed save, or half as much damage on a successful one.\n3-4\tThe dodecahedron casts Light on itself. The effect lasts until a creature touches the die.\n5-6\tThe dodecahedron casts Ray of Frost (+5 to hit), targeting a random creature within 60 feet of it that doesn't have total cover against the attack.\n7-8\tThe dodecahedron casts Shocking Grasp (+5 to hit) on the next creature that touches it.\n9-10\tThe dodecahedron casts Darkness on itself. The effect has a duration of 10 minutes.\n11-12\tThe next creature to touch the dodecahedron gains 1d10 temporary hit points that last for 1 hour.",
	weight : 2,
	toNotesPage : [{
		name : "Effect Table",
		popupName : "Dodecahedron of Doom effect table",
		note : [
			"This twelve-sided metal die is 12 inches across and bears the numbers 1 through 12 engraved on its pentagonal sides. The dodecahedron contains arcane clockwork mechanisms that whir and click whenever the die is cast.",
			"If an effect requires a target and no eligible target is within range, nothing happens.",
			"d12\tEFFECT",
			"1-2\tThe dodecahedron explodes and is destroyed. Each creature within 20 feet of the exploding die must make a DC 13 Dexterity saving throw, taking 40 (9d8) force damage on a failed save, or half as much damage on a successful one.",
			"3-4\tThe dodecahedron casts light on itself. The effect lasts until a creature touches the die.",
			"5-6\tThe dodecahedron casts ray of frost (+5 to hit), targeting a random creature within 60 feet of it that doesn't have total cover against the attack.",
			"7-8\tThe dodecahedron casts shocking grasp (+5 to hit) on the next creature that touches it.",
			"9-10\tThe dodecahedron casts darkness on itself. The effect has a duration of 10 minutes.",
			"11-12\tThe next creature to touch the dodecahedron gains 1d10 temporary hit points that last for 1 hour."
		]
	}]
}
MagicItemsList["orb of gonging"] = { // contains contributions by Pengsloth
	name : "Orb of Gonging",
	source : ["WDotMM", 174],
	type : "wondrous item",
	rarity : "common",
	description : "This item is a hollow, 5-inch-diameter orb with notches along its outside bronze rings. As an action, I can align the notches, causing the orb to gong loudly until the notches are no longer aligned. The sounds are spaced 6 seconds apart and can be heard out to a range of 600 ft.",
	descriptionFull : "This common wondrous item is a hollow, 5-inch-diameter orb that weighs 5 pounds. Its outer shell is composed of notched bronze rings, which can be turned so that the notches line up. Aligning the notches requires an action, and doing so causes the orb to gong loudly until the notches are no longer aligned. The sounds are spaced 6 seconds apart and can be heard out to a range of 600 feet."
}
MagicItemsList["black crystal tablet"] = { // contains contributions by Pengsloth
	name : "Black Crystal Tablet",
	source : ["WDotMM", 284],
	type : "wondrous item",
	rarity : "legendary",
	magicItemTable : "I",
	description : "As an action once per dawn, I can use the tablet to cast Eyebite or Gate, but the latter only links to the Far Realm. When attuning to it, I must make a DC 20 Wisdom saving throw or be afflicted by afflicted long-term madness (see table at SRD 201 or DMG 259).",
	descriptionFull : "Any creature that attunes to the tablet must make a DC 20 Wisdom saving throw at the end of its next long rest. On a failed save, the creature becomes afflicted with a random form of long-term madness (see \"Madness\" in chapter 8 of the Dungeon Master's Guide).\n   As an action, a creature attuned to the Black Crystal Tablet can use it to cast Eyebite or Gate (the portal created by this spell links to the Far Realm only). After the tablet is used to cast a spell, it cannot be used again until the next dawn.",
	attunement : true,
	prerequisite : "Requires attunement by a creature that has proficiency in the arcana skill",
	prereqeval : function(v) { return v.skillProfs.indexOf("Arcana") !== -1; },
	usages : 1,
	recovery : "dawn",
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["eyebite", "gate"],
		selection : ["eyebite", "gate"],
		firstCol : 1,
		times : 2
	},
	spellChanges : {
		"gate" : {
			description : "Create a portal to a precise location in the far realm; can transport named crea to me",
			changes : "The spell can only connect to the Far Realm."
		}
	}
}
MagicItemsList["helm of the scavenger"] = {
	name : "Helm of the Scavenger",
	source : ["WDotMM", 297],
	type : "wondrous item",
	rarity : "legendary",
	notLegalAL : true,
	description : "This ornate chair can be placed on a ship weighing up to 100 tons. It generates artificial gravity and an envelope of fresh air at 70 \u00B0F around the ship when in the void of space. While attuned to it and sitting in the chair, I can propel the ship, steer it, and see what is happening anywhere on it, but I can't use spell slots.",
	descriptionFull : "This ornate chair is designed to propel and maneuver a ship through space.\n   " + toUni("Passive Properties") + ". The following properties of the helm come into play even when no creature is attuned to it:\n \u2022 When placed aboard a vessel weighing between 1 and 100 tons, the helm generates an envelope of fresh air around the ship while it is in the void of space (but not underwater). This envelope extends out from the edges of the hull in all directions for a distance equal in length to the vessel's beam, so that creatures aboard and near the ship can breathe normally in space. The temperature within the air envelope is 70 degrees Fahrenheit.\n \u2022 When placed aboard a vessel weighing between 1 and 100 tons, the helm generates an artificial gravity field while the ship is in the void of space, so that creatures can walk on the ship's decks as they normally would. Creatures and objects that fall overboard bob in a gravity plane that extends out from the main deck for a distance equal in length to the vessel's beam.\n\n" + toUni("Active Properties") + ". The sensation of being attuned to the helm is akin to being immersed in warm water. While attuned to the helm, you gain the following abilities while you sit in it:\n \u2022 You can use the helm to propel the vessel across or through water and other liquids at a maximum speed in miles per hour equal to your highest-level unexpended spell slot.\n \u2022 You can use the helm to propel the vessel through air or space at a maximum speed in miles per hour equal to your highest-level unexpended spell slot \xD7 10.\n \u2022 Provided you have at least one unexpended spell slot, you can steer the vessel, albeit in a somewhat clumsy fashion, in much the same way that oars or a rudder can maneuver a seafaring ship.\n \u2022 Whenever you like, you can see what's happening on and around the vessel as though you were standing in a location of your choice aboard it.\n\n" + toUni("Drawback") + ". While attuned to the helm, you cannot expend your own spell slots.",
	attunement : true,
	toNotesPage : [{
		name : "Features",
		popupName : "Helm of the Scavenger features",
		note : [
			"When placed aboard a vessel weighing between 1 and 100 tons, this ornate chair can propel and maneuver a ship through space.",
			"The following properties of the helm come into play even when no creature is attuned to it:",
			" \u2022 The helm generates an envelope of fresh air around the ship while it is in the void of space (but not underwater). This envelope extends out from the edges of the hull in all directions for a distance equal in length to the vessel's beam, so that creatures aboard and near the ship can breathe normally in space. The temperature within the air envelope is 70 degrees Fahrenheit.",
			" \u2022 The helm generates an artificial gravity field while the ship is in the void of space, so that creatures can walk on the ship's decks as they normally would. Creatures and objects that fall overboard bob in a gravity plane that extends out from the main deck for a distance equal in length to the vessel's beam.",
			"The sensation of being attuned to the helm is akin to being immersed in warm water. While attuned to the helm, I gain the following abilities while I sit in it:",
			" \u2022 I can use the helm to propel the vessel across or through water and other liquids at a maximum speed in miles per hour equal to my highest-level unexpended spell slot.",
			" \u2022 I can use the helm to propel the vessel through air or space at a maximum speed in miles per hour equal to my highest-level unexpended spell slot \xD7 10.",
			" \u2022 Provided I have at least one unexpended spell slot, I can steer the vessel, albeit in a somewhat clumsy fashion, in much the same way that oars or a rudder can maneuver a seafaring ship.",
			" \u2022 Whenever I like, I can see what's happening on and around the vessel as though I were standing in a location of my choice aboard it.",
			" \u2022 I cannot expend my own spell slots."
		]
	}]
}
MagicItemsList["shield of the uven rune"] = { // contains contributions by Pengsloth
	name : "Shield of the Uven Rune",
	source : ["WDotMM", 299],
	storyItemAL : true,
	description : "I can use the shield as it is, or transfer its runic properties over to a weapon.",
	descriptionFull : "This shield is made from the scale of an ancient white dragon. It has a rune burned into its outward-facing side. A character who examines the rune and succeeds on a DC 20 Intelligence (History) check recognizes it as an uven (\"enemy\" in Giant) rune that confers great power.\n   While holding the shield, you benefit from the following properties.\n   " + toUni("Winter's Friend") + ". You are immune to cold damage.\n   " + toUni("Deadly Rebuke") + ". Immediately after a creature hits you with a melee attack, you can use your reaction to deal 3d6 necrotic damage to that creature.\n   " + toUni("Bane") + ". You can cast the Bane spell from the shield (save DC 17). The spell does not require concentration and lasts for 1 minute. Once you cast the spell from the shield, you can't do so again until you finish a short or long rest.\n   " + toUni("Gift of Vengeance") + ". You can transfer the shield's magic to a nonmagical weapon by tracing the uven rune on the weapon with one finger. The transfer takes 8 hours of work that requires the two items to be within 5 feet of each other. At the end, the shield is destroyed, and the rune is etched or burned into the chosen weapon. This weapon becomes a rare magic item that requires attunement. It has the properties of a +1 weapon. The bonus increases to +3 when the weapon is used against one of the following creature types, chosen by you at the time of the magic weapon's creation: aberrations, celestials, constructs, dragons, elementals, fey, fiends, giants, or undead.",
	attunement : true,
	choices : ["Shield", "Transferred to a weapon"],
	"shield" : {
		name : "Shield of the Uven Rune ",
		type : "shield",
		rarity : "very rare",
		description : "This shield made from the scale of a white dragon gives me cold damage immunity. As a reaction when I'm hit by a melee attack, I can deal 3d6 necrotic damage to the attacker. Once per short rest, I can cast Bane (DC 16) needing no concentration. I can do an 8 hour ritual to transfer the rune to a weapon, see book.",
		weight : 6,
		usages : 1,
		recovery : "short rest",
		additional : "Bane",
		shieldAdd : "Shield of the Uven Rune",
		action : [["reaction", ""]],
		savetxt : {	immune : ["cold"] },
		fixedDC : 17,
		spellcastingBonus : {
			name : "Once per short rest",
			spells : ["bane"],
			selection : ["bane"],
			firstCol : "oncesr"
		},
		spellChanges : {
			"bane" : {
				duration : "1 min",
				changes : "The spell does not require concentration."
			}
		}
	},
	"transferred to a weapon" : {
		name : "Uven Rune Weapon",
		type : "weapon (any)",
		rarity : "rare",
		description : "This magic weapon adds a +1 bonus to attack and damage rolls made with it. This bonus increases to +3 when it is used against the creature type, chosen at the time of the magic weapon's creation: aberrations, celestials, constructs, dragons, elementals, fey, fiends, giants, or undead.",
		chooseGear : {
			type : "weapon",
			prefixOrSuffix : "brackets",
			descriptionChange : ["replace", "weapon"],
			itemName1stPage : ["suffix", "Uven Rune"]
		},
		calcChanges : {
			atkAdd : [
				function (fields, v) {
					if (!v.theWea.isMagicWeapon && (/^(?=.*\buven\b)(?=.*(rune|runic)).*$/i).test(v.WeaponText)) {
						v.theWea.isMagicWeapon = true;
						fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
						fields.Description += (fields.Description ? '; ' : '') + '+2 to hit/damage vs. chosen creature type';
					}
				},
				'If I include the words "Uven Rune" in a the name of a weapon, it will be treated as the magic weapon Uven Rune Weapon, which has a +1 bonus, or a +3 bonus against its chosen creature type.'
			],
			atkCalc : [
				function (fields, v, output) {
					if ((/^(?=.*\buven\b)(?=.*(rune|runic)).*$/i).test(v.WeaponText)) {
						output.magic = v.thisWeapon[1] + 1;
					}
				}, ''
			]
		}
	}
}
MagicItemsList["blast scepter"] = {  // contains contributions by Pengsloth
	name : "Blast Scepter",
	source : ["WDotMM", 310],
	type : "rod",
	rarity : "very rare",
	storyItemAL : true,
	description : "While attuned to the Blast Scepter, I gain resistance to fire and lightning damage and can, as an action, use it to cast Thunderwave as a 4th-level spell (save DC 16) without expending a spell slot. It can be used as an arcane focus.",
	descriptionFull : "The Blast Scepter can be used as an arcane focus.\n   Whoever is attuned to the Blast Scepter gains resistance to fire and lightning damage and can, as an action, use it to cast Thunderwave as a 4th-level spell (save DC 16) without expending a spell slot.",
	attunement : true,
	dmgres : ["Fire", "Lightning"],
	fixedDC : 16,
	spellcastingBonus : {
		name : "At will (4th level)",
		spells : ["thunderwave"],
		selection : ["thunderwave"],
		firstCol : "atwill"
	},
	spellChanges : {
		"thunderwave" : {
			nameShort : "Thunderwave (4th level)",
			description : "All crea/obj in area 5d8 Thunder dmg, pushed 10 ft away; save halves and not pushed",
			changes : "Cast as if using a 4th-level spell slot"
		}
	}
}
MagicItemsList["chest of preserving"] = {
	name : "Chest of Preserving",
	source : ["WDotMM", 139],
	type : "wondrous item",
	rarity : "common",
	description : "Food and other perishable items do not age or decay while inside this chest. It is 2.5 ft long, 1.5 ft wide, and 1 ft tall with a half-barrel lid. The chest has a lock, which can be picked with thieves' tools and a successful DC 15 Dexterity check. Smashing the lock or any other part of the chest renders it nonmagical.",
	descriptionFull : "Food and other perishable items do not age or decay while inside a Chest of Preserving. The chest is 2\xBD feet long, 1\xBD feet wide, and 1 foot tall with a half-barrel lid. The chest has a lock, which can be picked with thieves' tools and a successful DC 15 Dexterity check. Smashing the lock or any other part of the chest renders it nonmagical.",
	weight : 25
}
MagicItemsList["circlet of human perfection"] = { // contains contributions by Pengsloth
	name : "Circlet of Human Perfection",
	source : ["WDotMM", 30],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "F",
	prerequisite : "Requires attunement by a humanoid",
	description : "Wearing this circlet transforms my appearance into an attractive human of average height and weight, but otherwise doesn't change anything. The circlet chooses the physical characteristics of the form, such as age, gender, skin color, hair color, and voice. Removing the circlet ends the effect.",
	descriptionFull : "The Circlet of Human Perfection transforms its attuned wearer into an attractive human of average height and weight. The circlet chooses the physical characteristics of the form, such as age, gender, skin color, hair color, and voice. Except for size, the wearer's statistics and racial traits don't change, nor do items worn or carried by the wearer. Removing the circlet ends the effect.",
	attunement : true
}
MagicItemsList["propeller helm"] = { // contains contributions by Pengsloth
	name : "Propeller Helm",
	source : ["WDotMM", 251],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "F",
	prerequisite : "Requires attunement by a Small humanoid",
	prereqeval : function () { return tDoc.getField("Size Category").currentValueIndices == 4; },
	description : "While worn, the helm allows me to use an action to cast Levitate, requiring no components. Each time the spell ends, there is a 50 percent chance that the helm loses its magic and becomes nonmagical.",
	descriptionFull : "While worn, the helm allows its wearer to use an action to cast the Levitate spell, requiring no components. The helm's propeller spins and whirs loudly until the spell ends. Each time the spell ends, there is a 50 percent chance that the helm loses its magic and becomes nonmagical.",
	attunement : true,
	spellcastingBonus : {
		name : "At will",
		spells : ["levitate"],
		selection : ["levitate"],
		firstCol : "atwill"
	}
}
MagicItemsList["tearulai"] = { // contains contributions by Pengsloth
	name : "Tearulai",
	source : ["WDotMM", 76],
	type : "weapon (longsword)",
	rarity : "very rare",
	storyItemAL : true,
	description : "If I roll a 20 on an attack with this sword, it deals +14 slashing damage and there is a 5% chance its lobs off a limb. It deals max damage to objects and has 6 charges, regaining 1d4+2 at dawn, which it can use to cast spells. It can shed light on command and is a sentient weapon with a will of its own, see Notes page.",
	descriptionFull : "The longsword, Tearulai, is a sentient, neutral good sword of sharpness with an emerald-colored blade and precious gemstones embedded in its hilt and pommel. The sword's magical properties are suppressed until it is removed from Valdemar's skull.\n   Evil creatures can't attune to Tearulai; any evil creature that tries to do so takes 20 psychic damage. The weapon's emerald blade can't be damaged or dulled, and the sword can't be teleported anywhere without its wielder while the two are attuned to one another.\n   " + toUni("Sword of Sharpness") + "When you attack an object with this magic sword and hit, maximize your weapon damage dice against the target.\n   When you attack a creature with this weapon and roll a 20 on the attack roll, that target takes an extra 14 slashing damage. Then roll another d20. If you roll a 20, you lop off one of the target's limbs, with the effect of such loss determined by the DM. If the creature has no limb to sever, you lop off a portion of its body instead.\n   In addition, you can speak the sword's command to cause the blade to shed bright light in a 10-foot radius and dim light for an additional 10 feet. Speaking the command word again or sheathing the sword puts out the light.\n\nNote: According to the SRD, it is an extra 4d6 slashing damage, although this is incorrect.\n   " + toUni("Spells") + ". The sword has 6 charges and regains 1d4 + 2 expended charges daily at dawn. A creature attuned to the sword can use an action and expend 1 or more charges to cast one of the following spells from it without material components: Fly (2 charges), Polymorph (3 charges), or Transport Via Plants (4 charges).\n   " + toUni("Sentience") + ". The sword has an Intelligence of 17, a Wisdom of 12, and a Charisma of 20. It has hearing and truesight out to a range of 120 feet. It communicates telepathically with its attuned wielder and can speak, read, and understand Common, Draconic, Elvish, and Sylvan. In addition, the sword can ascertain the true value of any gemstone brought within 5 feet of it.\n   " + toUni("Personality") + ". Tearulai admires great beauty, music, fine art, and poetry. Vain, the weapon strives to improve its appearance. It craves gemstones and seeks out better ones with which to adorn itself. Most of all, it longs to return to the forests around Myth Drannor, where it was created. If its wielder's goals run counter to its own, Tearulai attempts to take control of its wielder and escape Undermountain, whereupon it can use its Transport Via Plants spell to return whence it came.",
	attunement : true,
	prerequisite : "Requires attunement by a creature of non-evil alignment",
	prereqeval : function(v) { return !(/evil/i).test(What("Alignment")); },
	weight : 3,
	weaponsAdd : ["Tearulai"],
	weaponOptions : {
		baseWeapon : "longsword",
		regExpSearch : /tearulai/i,
		name : "Tearulai",
		source : ["WDMM", 76],
		description : "Versatile (1d10); On 20 to hit: +14 damage \u0026 5% chance to sever limb; Max damage vs. objects"
	},
	usages: 6,
	recovery : "dawn",
	additional : "regain 1d4+2",
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "2 charges",
		spells : ["fly"],
		selection : ["fly"],
		firstCol : 2
	}, {
		name : "3 charges",
		spells : ["polymorph"],
		selection : ["polymorph"],
		firstCol : 3
	}, {
		name : "4 charges",
		spells : ["transport via plants"],
		selection : ["transport via plants"],
		firstCol : 4
	}],
	toNotesPage : [{
		name : "Traits and Personality",
		popupName : "Tearulai Traits and Personality",
		note : desc([
			"Tearulai has an emerald-colored blade and precious gemstones embedded in its hilt and pommel. Evil creatures can't attune to it and take 20 psychic damage if they try to do so. Its emerald blade can't be damaged or dulled, and the sword can't be teleported anywhere without its wielder while the two are attuned to one another.",
			"Objects hit by the sword take maximum damage from it. When I roll a 20 on the attack roll against a creature, that target takes an extra 14 slashing damage. Then roll another d20. If you roll a 20, you lop off one of the target's limbs, with the effect of such loss determined by the DM. If the creature has no limb to sever, you lop off a portion of its body instead.",
			"I can speak the sword's command to cause the blade to shed bright light in a 10-ft radius and dim light for another 10 ft. The light stops when I sheath the sword or speaking the command word again.",
			"The sword has 6 charges and regains 1d4 + 2 expended charges daily at dawn. I can use the charges to cast Fly (2 charges), Polymorph (3 charges), or Transport Via Plants (4 charges).",
			"Tearulai is sentient and has an Intelligence of 17, a Wisdom of 12, and a Charisma of 20. It has hearing and truesight out to a range of 120 ft. It communicates telepathically with its attuned wielder and can speak, read, and understand Common, Draconic, Elvish, and Sylvan. In addition, the sword can ascertain the true value of any gemstone brought within 5 ft of it.",
			"Tearulai admires great beauty, music, fine art, and poetry. Vain, the weapon strives to improve its appearance. It craves gemstones and seeks out better ones with which to adorn itself. Most of all, it longs to return to the forests around Myth Drannor, where it was created. If its wielder's goals run counter to its own, Tearulai attempts to take control of its wielder and uses Transport Via Plants to return whence it came."
		]) + "\n\n" + sentientItemConflictTxt
	}]
}
MagicItemsList["vial of stardust"] = {
	name : "Vial of Stardust",
	source : ["WDotMM", 251],
	type : "potion",
	rarity : "unknown",
	description : "Once as an action, I can sprinkles the stardust contained in this vial over myself. After I do so, I gain the ability to cast Dream once as an action (spell save DC 15), requiring no components.",
	descriptionFull : "Any creature that sprinkles the contents of a Vial of Stardust over itself gains the ability to cast the Dream spell once as an action (spell save DC 15), requiring no components."
}
var iFileName = "pub_20190521_GoS.js";
RequiredSheetVersion(13);
// This file adds all material from the Ghosts of Saltmarsh adventure to MPMB's Character Record Sheet

// Define the source
SourceList["GoS"] = {
	name : "Ghosts of Saltmarsh [backgrounds, beasts, items]",
	abbreviation : "GoS",
	group : "Adventure Books",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/ghosts-saltmarsh",
	date : "2019/05/21"
};

BackgroundList["fisher"] = {
	regExpSearch : /fisher/i,
	name : "Fisher",
	source : [["GoS", 29], ["ALbackground", 0]],
	skills : ["History", "Survival"],
	gold : 10,
	equipleft : [
		["Fishing tackle", "", 4],
		["Net", "", 3]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Fishing lure or oiled leather boots", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [1],
	feature : "Harvest the Water",
	trait : [
		"I am unmoved by the wrath of nature.",
		"My friends are my crew; we sink or float together.",
		"I need long stretches of quiet to clear my head.",
		"Rich folk don't know the satisfaction of hard work.",
		"I laugh heartily, feel deeply, and fear nothing.",
		"I work hard; nature offers no handouts.",
		"I dislike bargaining; state your price and mean it.",
		"Luck favors me, and I take risks others might not."
	],
	ideal : [
		["Camaraderie", "Camaraderie. Good people make even the longest voyage bearable. (Good)"],
		["Luck", "Luck. Our luck depends on respecting its rules\u2014now throw this salt over your shoulder. (Lawful)"],
		["Daring", "Daring. The richest bounty goes to those who risk everything. (Chaotic)"],
		["Plunder", "Plunder. Take all that you can and leave nothing for the scavengers. (Evil)"],
		["Balance", "Balance. Do not fish the same spot twice in a row; suppress your greed, and nature will reward you. (Neutral)"],
		["Hard Work", "Hard Work. No wave can move a soul hard at work. (Any)"]
	],
	bond : [
		"I lost something important in the deep sea, and I intend to find it.",
		"Someone else's greed destroyed my livelihood, and I will be compensated.",
		"I will fish the many famous waters of this land.",
		"The gods saved me during a terrible storm, and I will honor their gift.",
		"My destiny awaits me at the bottom of a particular pond in the Feywild.",
		"I must repay my village's debt."
	],
	flaw : [
		"I am judgmental, especially of those I deem homebodies or otherwise lazy.",
		"I become depressed and anxious if I'm away from the sea too long.",
		"I have lived a hard life and find it difficult to empathize with others.",
		"I am inclined to tell long-winded stories at inopportune times.",
		"I work hard, but I play harder.",
		"I am obsessed with catching an elusive aquatic beast, often to the detriment of other pursuits."
	],
	extra : [
		"Select a Fishing Tale",
		"Lobster wrestling",
		"It dragged the boat",
		"Fins of pure gold",
		"Ghost fish",
		"Nemesis clam",
		"It swallowed the sun",
		"Dive into the abyss",
		"Love story"
	]
};
BackgroundFeatureList["harvest the water"] = {
	description : "I gain advantage on ability checks made using fishing tackle. If I have access to a body of water that sustains marine life, I can maintain a moderate lifestyle while working as a fisher, and I can catch enough food to feed myself and up to ten other people each day.",
	source : [["GoS", 29], ["ALbackground", 0]]
};

BackgroundList["marine"] = {
	regExpSearch : /marine/i,
	name : "Marine",
	source : [["GoS", 31], ["ALbackground", 0]],
	skills : ["Athletics", "Survival"],
	gold : 10,
	equipleft : [
		["Folded flag with company symbol", "", 1]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Dagger", "", 1],
		["Belt pouch (with coins)", "", 1]
	],
	toolProfs : ["Vehicles (water)", "Vehicles (land)"],
	feature : "Steady",
	trait : [
		"I speak rarely but mean every word I say.",
		"I laugh loudly and see the humor in stressful situations.",
		"I prefer to solve problems without violence, but I finish fights decisively.",
		"I enjoy being out in nature; poor weather never sours my mood.",
		"I am dependable.",
		"I am always working on some project or other.",
		"I become cantankerous and quiet in the rain.",
		"When the sea is within my sight, my mood is jovial and optimistic."
	],
	ideal : [
		["Teamwork", "Teamwork. Success depends on cooperation and communication. (Good)"],
		["Code", "Code. The marines' code provides a solution for every problem, and following it is imperative. (Lawful)"],
		["Embracing", "Embracing. Life is messy. Throwing yourself into the worst of it is necessary to get the job done. (Chaotic)"],
		["Might", "Might. The strong train so that they might rule those who are weak. (Evil)"],
		["Bravery", "Bravery. To act when others quake in fear\u2014this is the essence of the warrior. (Any)"],
		["Perseverance", "Perseverance. No injury or obstacle can turn me from my goal. (Any)"]
	],
	bond : [
		"I face danger and evil to offset an unredeemable act in my past.",
		"I. Will. Finish. The. Job.",
		"I must set an example of hope for those who have given up.",
		"I'm searching for a fellow marine captured by an elusive enemy.",
		"Fear leads to tyranny, and both must be eradicated.",
		"My commander betrayed my unit, and I will have revenge."
	],
	flaw : [
		"I grow combative and unpredictable when I drink.",
		"I find civilian life difficult and struggle to say the right thing in social situations.",
		"My intensity can drive others away.",
		"I hold grudges and have difficulty forgiving others.",
		"I become irrational when innocent people are hurt.",
		"I sometimes stay up all night listening to the ghosts of my fallen enemies."
	],
	extra : [
		"Select a Hardship Endured",
		"Nearly drowned",
		"Captured",
		"Sacrifice",
		"Juggernaut",
		"Stowaway",
		"Leave none behind"
	]
};
BackgroundFeatureList["steady"] = {
	description : "I can move twice the normal amount of time (up to 16 hours) each day before being subject to the effect of a forced march and need to make Constitution saves at the end of each extra hour to avoid gaining a level of exhaustion. Additionally, I can automatically find a safe route to land a boat on shore, provided such a route exists.",
	source : [["GoS", 31], ["ALbackground", 0]]
};

BackgroundList["shipwright"] = {
	regExpSearch : /shipwright/i,
	name : "Shipwright",
	source : [["GoS", 33], ["ALbackground", 0]],
	skills : ["History", "Perception"],
	gold : 10,
	equipleft : [
		["Blank book", "", 5],
		["Ink, 1 ounce bottle of", 1, ""],
		["Ink pen (quill)", "", ""],
		["Carpenter's tools", "", 8]
	],
	equipright : [
		["Traveler's clothes", "", 4],
		["Belt pouch (with coins)", "", 1]
	],
	toolProfs : ["Carpenter's tools", "Vehicles (water)"],
	feature : "I'll Patch It!",
	trait : [
		"I love talking and being heard more than I like to listen.",
		"I'm extremely fond of puzzles.",
		"I thrive under pressure.",
		"I love sketching and designing objects, especially boats.",
		"I'm not afraid of hard work\u2014in fact, I prefer it.",
		"A pipe, an ale, and the smell of the sea: paradise.",
		"I have an endless supply of cautionary tales related to the sea.",
		"I don't mind getting my hands dirty."
	],
	ideal : [
		["Crew", "Crew. If everyone on deck pitches in, we'll never sink. (Good)"],
		["Careful Lines", "Careful Lines. A ship must be balanced according to the laws of the universe. (Lawful)"],
		["Invention", "Invention. Make what you need out of whatever is at hand. (Chaotic)"],
		["Perfection", "Perfection. To measure a being and find it lacking is the greatest disappointment. (Evil)"],
		["Reflection", "Reflection. Muddied water always clears in time. (Any)"],
		["Hope", "Hope. The horizon at sea holds the greatest promise. (Any)"]
	],
	bond : [
		"I must visit all the oceans of the world and behold the ships that sail there.",
		"Much of the treasure I claim will be used to enrich my community.",
		"I must find a kind of wood rumored to possess magical qualities.",
		"I repair broken things to redeem what's broken in myself.",
		"I will craft a boat capable of sailing through the most dangerous of storms.",
		"A kraken destroyed my masterpiece; its teeth shall adorn my hearth."
	],
	flaw : [
		"I don't know when to throw something away. You never know when it might be useful again.",
		"I get frustrated to the point of distraction by shoddy craftsmanship.",
		"Though I am an excellent crafter, my work tends to look as though it belongs on a ship.",
		"I am so obsessed with sketching my ideas for elaborate inventions that I sometimes forget little thing like eating and sleeping.",
		"I'm judgmental of those who are not skilled with tools of some kind.",
		"I sometimes take things that don't belong to me, especially if they are very well made."
	],
	extra : [
		"Select a Sea's Influence",
		"Grand designs",
		"Solid and sound",
		"Favored",
		"Master of armaments",
		"Low places",
		"Mysteries of the deep"
	]
};
BackgroundFeatureList["i'll patch it!"] = {
	description : "Provided I have carpenter's tools and wood, I can perform repairs on a water vehicle. When I use this ability, I restore a number of hit points to the hull of a water vehicle equal to 5\xD7 my proficiency modifier. A vehicle cannot be patched by me in this way again until after it has been pulled ashore and fully repaired.",
	source : [["GoS", 33], ["ALbackground", 0]]
};

BackgroundList["smuggler"] = {
	regExpSearch : /smuggler/i,
	name : "Smuggler",
	source : [["GoS", 34], ["ALbackground", 0]],
	skills : ["Athletics", "Deception"],
	gold : 15,
	equipright : [
		["Common clothes", "", 3],
		["Leather boots or vest", "", 1],
		["Belt pouch (with coins)", "", 1]
	],
	toolProfs : ["Vehicles (water)"],
	feature : "Down Low",
	trait : [
		"I love being on the water but hate fishing.",
		"I think of everything in terms of monetary value.",
		"I never stop smiling.",
		"Nothing rattles me; I have a lie for every occasion.",
		"I love gold but won't cheat a friend.",
		"I enjoy doing things others believe to be impossible.",
		"I become wistful when I see the sun rise over the ocean.",
		"I am no common criminal; I am a mastermind."
	],
	ideal : [
		["Wealth", "Wealth. Heaps of coins in a secure vault is all I dream of. (Any)"],
		["Smuggler's Code", "Smuggler's Code. I uphold the unwritten rules of the smugglers, who do not cheat one another or directly harm innocents. (Lawful)"],
		["All for a Coin", "All for a Coin. I'll do nearly anything if it means I turn a profit. (Evil)"],
		["Peace and Prosperity", "Peace and Prosperity. I smuggle only to achieve a greater goal that benefits my community. (Good)"],
		["People", "People. For all my many lies, I place a high value on friendship. (Any)"],
		["Daring", "Daring. I am most happy when risking everything. (Any)"]
	],
	bond : [
		"My vessel was stolen from me, and I burn with the desire to recover it.",
		"I intend to become the leader of the network of smugglers that I belong to.",
		"I owe a debt that cannot be repaid in gold.",
		"After one last job, I will retire from the business.",
		"I was tricked by a fellow smuggler who stole something precious from me. I will find that thief.",
		"I give most of my profits to a charitable cause, and I don't like to brag about it."
	],
	flaw : [
		"Lying is reflexive, and I sometimes engage in it without realizing.",
		"I tend to assess my relationships in terms of profit and loss.",
		"I believe everyone has a price and am cynical toward those who present themselves as virtuous.",
		"I struggle to trust the words of others.",
		"Few people know the real me.",
		"Though I act charming, I feel nothing for others and don't know what friendship is."
	],
	extra : [
		"Select a Claim to Fame",
		"Spirit of the whale",
		"Cart and sword",
		"The recruit",
		"River of shadows",
		"Gold-hearted",
		"Playing both sides"
	]
};
BackgroundFeatureList["down low"] = {
	description : "I am acquainted with a network of smugglers who are willing to help me out of tight spots. While in a particular town, city, or other similarly sized community, my companions and I can stay for free in safe houses. Safe houses provide a poor lifestyle. While staying at a safe house, I can choose to keep my presence (and that of my companions) a secret.",
	source : [["GoS", 34], ["ALbackground", 0]]
};

MagicItemsList["charm of plant command"] = {
	name : "Charm of Plant Command",
	source : ["GoS", 229],
	type : "wondrous item",
	rarity : "rare",
	magicItemTable : "C",
	description : "This fist-sized charm is made from a bundle of dried plant stems wrapped in silver thread. It has 3 charges, regain all at dawn. As an action, I can expend 1 charge to cast Speak With Plants. While that spell lasts, I also have adv. on Charisma checks made to influence the behavior, demeanor, and attitude of plants.",
	descriptionFull : "This fist-sized charm is made from a bundle of dried plant stems wrapped in silver thread. Hung on a leather thong, it is typically worn around the neck or attached to a belt.\n   This charm has 3 charges. While you bear the charm, you can expend 1 charge as an action to cast the Speak With Plants spell. For the duration of the spell, you also have advantage on Charisma checks made to influence the behavior, demeanor, and attitude of plants. The charm regains all expended charges at dawn each day.",
	attunement : true,
	usages : 3,
	recovery : "dawn",
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["speak with plants"],
		selection : ["speak with plants"],
		firstCol : 1
	},
	spellChanges : {
		"speak with plants" : {
			description : "Talk with plants about previous 24h; plants to difficult terrain or vice versa; adv. Cha checks vs. plants",
			changes : "For the duration of the spell, I also have advantage on Charisma checks made to influence the behavior, demeanor, and attitude of plants."
		}
	}
}
MagicItemsList["cursed luckstone"] = {
	name : "Cursed Luckstone",
	source : ["GoS", 229],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "C",
	description : "This flat, gray-and-black river stone is inscribed with an arcane symbol. It is cursed and attuning to it curses me. Once per dawn while it is on my person, I can gain adv. on one ability check of my choice, but disadv. on my next two ability checks. Discarding the stone will cause it to teleport back into my pocket.",
	descriptionFull : "This flat, gray-and-black river stone is inscribed with an unknown arcane symbol and feels cool to the touch. While carrying the stone, you can gain advantage on one ability check of your choice. The stone can't be used this way again until the next dawn.\n   " + toUni("Curse") + "This item is cursed. Attuning to it curses you until you are targeted by a remove curse spell or similar magic. As long as you remain cursed, you cannot discard the stone, which immediately teleports back into your pocket or pack. After you use the stone's magic, your next two ability checks are made with disadvantage.",
	attunement : true,
	usages : 1,
	recovery : "dawn"
}
MagicItemsList["helm of underwater action"] = {
	name : "Helm of Underwater Action",
	source : ["GoS", 229],
	type : "wondrous item",
	rarity : "uncommon",
	magicItemTable : "F",
	description : "While wearing this brass helmet, I can breathe underwater, I gain darkvision with a range of 60 ft, and I gain a swimming speed of 30 ft.",
	descriptionFull : "While wearing this brass helmet, you can breathe underwater, you gain darkvision with a range of 60 feet, and you gain a swimming speed of 30 feet.",
	attunement : true,
	weight : 1,
	vision : [["Darkvision", "fixed 60"]],
	speed : { swim : { spd : 30, enc : 20 } }
}
MagicItemsList["pipe of remembrance"] = {
	name : "Pipe of Remembrance",
	source : ["GoS", 229],
	type : "wondrous item",
	rarity : "common",
	description : "Smoke exhaled from this delicate wooden pipe with a river stone bowl does not dissipate, but lingers around. Once per dawn, I can have that smoke form moving shapes after 10 minutes. The shapes reenact my most impressive and heroic achievements realistically for 5 minutes, after which the smoke dissipates.",
	descriptionFull : "This long, delicate wooden pipe features a bowl made from smooth river stone. When the pipe is lit, smoke exhaled from it does not dissipate, instead lingering around the bearer. After 10 minutes, the smoke forms moving shapes that reenact the bearer's most impressive and heroic achievements for 5 minutes. When this realistic performance is complete, the smoke dissipates. The pipe can't be used this way again until the next dawn.",
	usages : 1,
	recovery : "dawn"
}
MagicItemsList["pressure capsule"] = {
	name : "Pressure Capsule",
	source : ["GoS", 229],
	type : "wondrous item",
	rarity : "common",
	description : "Consuming this capsule of beeswax, sand, and enchanted water plants will prevent the effects of swimming at depths greater than 100 ft for 1 hour. Thus, a creature without a swimming speed does not multiply the time spend swimming at depth for the purpose of determining exhaustion.",
	descriptionFull : "This small capsule is made of beeswax blended with sand and a variety of enchanted water plants. A creature who consumes a pressure capsule ignores the effects of swimming at depths greater than 100 feet for 1 hour (see \"Unusual Environments\" in chapter 5 of the Dungeon Master's Guide)." // addition of 1 hour duration from AL content catalogue v8.08
}
MagicItemsList["sekolahian worshiping statuette"] = {
	name : "Sekolahian Worshiping Statuette",
	source : ["GoS", 229],
	type : "wondrous item",
	rarity : "common",
	description : "Skillfully carved from sandstone, this 1-ft-tall statuette depicts a shark twisting through the water with its mouth open. Once per hour when a Tiny sea-dwelling animal is within 1 inch of the statuette's mouth, the shark flashes to life and deals 1 piercing damage to it.",
	descriptionFull : "Skillfully carved from sandstone, this 1-foot-tall statuette depicts a shark twisting through the water with its mouth open. If any Tiny sea-dwelling animal is within 1 inch of the statuette's mouth, the shark flashes to life and deals 1 piercing damage to it. The shark can deal damage in this way no more than once per hour."
}

CreatureList["fish"] = {
	name : "Fish",
	source : ["GoS", 215],
	size : 5,
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 13,
	hp : 1,
	hd : [1, 4],
	speed : "swim 40 ft",
	scores : [2, 16, 9, 1, 7, 2],
	saves : ["", "", "", "", "", ""],
	senses : "Darkvision 60 ft",
	passivePerception : 8,
	languages : "",
	challengeRating : "0",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [],
	traits : [{
		name : "Water Breathing",
		description : "The fish can breathe only underwater."
	}]
}
CreatureList["giant white moray eel"] = {
	name : "Giant White Moray Eel",
	source : ["GoS", 216],
	size : 1,
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 12,
	hp : 60,
	hd : [8, 12],
	speed : "swim 40 ft",
	scores : [19, 14, 12, 1, 10, 3],
	saves : ["", "", "", "", "", ""],
	skills : {
		"perception" : 2,
		"stealth" : 4
	},
	senses : "Blindsight 10 ft",
	passivePerception : 12,
	languages : "",
	challengeRating : "2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [2, 6, "piercing"],
		range : "Melee (10 ft)",
		description : ""
	}],
	traits : [{
		name : "Water Breathing",
		description : "The eel can breathe only underwater."
	}]
}
CreatureList["giant coral snake"] = {
	name : "Giant Coral Snake",
	source : ["GoS", 236],
	size : 2,
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 13,
	hp : 90,
	hd : [12, 10],
	speed : "30 ft, swim 30 ft",
	scores : [12, 16, 14, 2, 10, 3],
	saves : ["", "", "", "", "", ""],
	skills : {
		"perception" : 2
	},
	senses : "Blindsight 10 ft",
	passivePerception : 12,
	languages : "",
	challengeRating : "4",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 2,
		damage : [2, 4, "piercing"],
		range : "Melee (5 ft)",
		description : "Target DC 12 Con save or stunned until end of its next turn and short-term madness for 10 min"
	}]
}
CreatureList["giant sea eel"] = {
	name : "Giant Sea Eel",
	source : ["GoS", 237],
	size : 2,
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 14,
	hp : 19,
	hd : [3, 10],
	speed : "swim 40 ft",
	scores : [11, 14, 12, 2, 10, 7],
	saves : ["", 4, "", "", "", ""],
	skills : {
		"perception" : 2,
		"stealth" : 4
	},
	senses : "Darkvision 60 ft",
	passivePerception : 12,
	languages : "",
	challengeRating : "1/2",
	proficiencyBonus : 2,
	attacksAction : 1,
	attacks : [{
		name : "Bite",
		ability : 2,
		damage : [2, 10, "piercing"],
		range : "Melee (5 ft)",
		description : ""
	}],
	traits : [{
		name : "Water Breathing",
		description : "The eel can breathe only underwater."
	}]
}
CreatureList["sea lion"] = {
	name : "Sea Lion",
	source : ["GoS", 252],
	size : 2,
	type : "Beast",
	subtype : "",
	alignment : "Unaligned",
	ac : 16,
	hp : 15,
	hd : [2, 10],
	speed : "15 ft, swim 30 ft",
	scores : [17, 10, 14, 5, 10, 12],
	saves : ["", 2, 4, "", "", ""],
	skills : {
		"athletics" : 5,
		"perception" : 2
	},
	senses : "",
	passivePerception : 12,
	languages : "",
	challengeRating : "1/2",
	proficiencyBonus : 2,
	attacksAction : 3,
	attacks : [{
		name : "Bite",
		ability : 1,
		damage : [1, 8, "piercing"],
		range : "Melee (5 ft)",
		description : "One bite and two claw attacks as an Attack action"
	}, {
		name : "Claw",
		ability : 1,
		damage : [1, 4, "slashing"],
		range : "Melee (5 ft)",
		description : "Target pushed up to 5 ft away; 2 claw and 1 bite attack as Attack action"
	}],
	traits : [{
		name : "Hold Breath",
		description : "The sea lion can hold its breath for 15 minutes."
	}, {
		name : "Multiattack",
		description : "The sea lion makes three attacks: one with its bite and two with its claws."
	}]
}
var iFileName = "pub_20190618_AcqInc.js";
RequiredSheetVersion(13);
// This file adds all material from the Acquisitions Incorporated book to MPMB's Character Record Sheet

// Define the source
SourceList["AcqInc"] = {
	name : "Acquisitions Incorporated",
	abbreviation : "AcqInc",
	group : "Primary Sources",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/acqinc",
	date : "2019/06/18"
};

BackgroundList["celebrity adventurer's scion"] = {
	regExpSearch : /^(?=.*celebrity)(?=.*adventurer)(?=.*scion).*$/i,
	name : "Celebrity Adventurer's Scion",
	source : ["AcqInc", 48],
	skills : ["Perception", "Performance"],
	gold : 30,
	equipleft : [
		["Disguise kit", "", 3]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [2],
	toolProfs : ["Disguise kit"],
	feature : "Name Dropping",
	trait : [
		"I will never get out of my famous parent's shadow, and no one else will ever understand this burden.",
		"I've seen enough of the adventuring life to have realistic expectations and empathy for my peers.",
		"Living up to my legacy will be difficult, but I'm going to do it.",
		"I'm used to the very best in life, and that's a hard habit to break.",
		"My parent taught me a sense of duty. I strive to uphold it, even when the odds are against me.",
		"No one can fake a smile, a handshake, or an interested nod like I can.",
		"I've been part of the adventuring life since I was old enough to walk. Let me explain a few things to you.",
		"No risk is too great for the rewards of defeating my enemies... and taking their stuff."
	],
	ideal : [
		["Power", "Power. The only way to get ahead in this world is to attain power and hold onto it with all your might. (Evil)"],
		["Peace", "Peace. Those who can find or make peace in the chaotic world around them have everything. (Lawful)"],
		["Fame", "Fame. I've seen what fame can bring. And I'll do anything to get all that for myself. (Neutral)"],
		["Training", "Training. Hard work, sacrifice, and training lead to success\u2014and eventually to perfection. (Any)"],
		["Anonymity", "Anonymity. I want to be successful. And alone. With lots of guards and wards between me and everyone else in the world. (Any)"],
		["Wisdom", "Wisdom. Material wealth is an illusion. Wisdom is the real treasure. (Good)"]
	],
	bond : [
		"While my parent was out adventuring, a servant raised me, and I care about that person more than anyone.",
		"I consider every member of my parent's former adventuring party to be family.",
		"Despite their absences, my famous parent was kind and generous. I love them and want to make them proud.",
		"My parent once brought a cursed magic item home. It is my obsession.",
		"My childhood home holds all my best memories, and its upkeep is my primary concern.",
		"Growing up, I had an imaginary friend I could always count on. That friend is still with me."
	],
	flaw : [
		"You don't know what I'm going through. You never can.",
		"You. Fetch my cloak. And maybe rub my feet for a while.",
		"My comrades are brave, but I must defeat this threat alone to prove my worth.",
		"Oh, yeah, that spell? Named after my parent's best friend. Let me tell you about them.",
		"My best days are behind me. Ahead lies only toil, pain, and death.",
		"You have to look out for yourself. No one else will."
	]
};
BackgroundFeatureList["name dropping"] = {
	description : "I know and have met any number of powerful people across the land, and some might even remember me. I might be able to wrangle minor assistance from a major figure in the campaign, at the DM's discretion. Additionally, the common folk treat me with deference, and my heritage and the stories I tell might be good for a free meal or a place to sleep.",
	source : ["AcqInc", 48]
};

BackgroundList["failed merchant"] = {
	regExpSearch : /^(?=.*failed)(?=.*merchant).*$/i,
	name : "Failed Merchant",
	source : ["AcqInc", 49],
	skills : ["Investigation", "Persuasion"],
	gold : 10,
	equipleft : [
		["Set of artisan's tools", "", ""],
		["Merchant's scale", "", 3]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [1],
	toolProfs : [["Artisan's tools", 1]],
	feature : "Supply Chain",
	trait : [
		"I didn't have the cutthroat attitude necessary to succeed. I won't make that mistake again.",
		"Even my competitors said I was affable and talented. Those traits should serve me well.",
		"To prosper, you have to be in control.",
		"The customer is always right.",
		"I was cutting corners and breaking deals to maximize profit. That's why I failed.",
		"When I get an idea, I am single-minded in its execution\u2014even if it's a terrible idea.",
		"If I can be everyone's friend, I'll always have support.",
		"My heart wasn't in being a merchant, so I failed. I'm not all that keen on adventuring either, but I need the money."
	],
	ideal : [
		["Survival", "Survival. Where there's life, there's hope. If I remain alive and flexible, I can succeed. (Any)"],
		["Generosity", "Generosity. People helped me when I was down. Now that I'm back on my feet, I'll pay it forward. (Good)"],
		["Excitement", "Excitement. Caution got me nowhere in my previous business. I'm not going to let it hold me back now. (Chaotic)"],
		["Wealth", "Wealth. With enough coin, I can buy comfort, power, knowledge, and even eternal life. Nothing will stand between me and money. (Evil)"],
		["Stability", "Stability. The mercantile trade was too chaotic for me. I need a nice stable profession, like adventuring. (Lawful)"],
		["Redemption", "Redemption. Too many people consider me a failure. So I need to prove them wrong. (Any)"]
	],
	bond : [
		"My family means everything to me. I failed them before, and I must not do so again.",
		"My church provides a connection to my god, so I must ensure that it is protected and funded.",
		"My former business partner fell ill, and then our business failed. Part of my new venture involves earning enough to take care of their family.",
		"If I take care of my possessions, they'll take care of me. People come and go, but a weapon or a wand is something you can always rely on.",
		"Although my business failed, the people of my community were kind to me. I'll do everything in my power to protect them.",
		"I owe a dangerous person a lot of money. As long as they're happy, they let my debt rest unpaid."
	],
	flaw : [
		"Why spend gold here when you can buy the same thing for copper in the next town?",
		"I must have the best of everything. Like, right now.",
		"You haven't heard of me? I'm sure that's because of your ignorance and low breeding.",
		"I failed, but I'm awesome. So when anyone else is successful, it must be because of nepotism, dishonesty, or dumb luck.",
		"I find that most people are trustworthy. Hey, where's my belt pouch?",
		"Nothing gets between me and danger except my fellow adventurers. So I'll be sure to put them there."
	]
};
BackgroundFeatureList["supply chain"] = {
	description : "From my time as a merchant, I retain connections with wholesalers, suppliers, and other merchants and entrepreneurs. I can call upon these connections when looking for items or information.",
	source : ["AcqInc", 49]
};

BackgroundList["gambler"] = {
	regExpSearch : /gambler/i,
	name : "Gambler",
	source : ["AcqInc", 49],
	skills : ["Deception", "Insight"],
	gold : 15,
	equipleft : [
		["Type of gaming set", "", ""]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Lucky charm", "", ""],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [1],
	toolProfs : [["Gaming set", 1]],
	feature : "Never Tell Me the Odds",
	trait : [
		"I plan for every contingency. Leave nothing to chance!",
		"Every copper wants to be a silver. Each bet is an opportunity.",
		"I'm one of Lady Luck's favored. Anything I try is destined to succeed.",
		"I've lost so much to gambling that I refuse to spend money on anything anymore.",
		"Nothing is certain. Planning is a coward's act.",
		"I can't be sure who I've swindled, cheated, or defeated, so I keep a low profile in public.",
		"The perfect bet is out there somewhere. I just have to keep my eyes open.",
		"I have beaten my addiction, but all it takes is one weak moment and I'll be back at the card table."
	],
	ideal : [
		["Knowledge", "Knowledge. Knowledge is power, and knowing which horse to back is the key to success. (Any)"],
		["Fate", "Fate. Whatever happens is fated, regardless of any planning or striving. (Lawful)"],
		["Bravery", "Bravery. If you want to succeed, you have to take risks. (Chaotic)"],
		["Survival", "Survival. You can't win if you're dead. Live to fight another day\u2014when the odds might be more in your favor. (Any)"],
		["Reliability", "Reliability. When I was in need, I was able to rely on others. Now I want to be the one others rely on. (Good)"],
		["Victory", "Victory. Winning is the real measure of a person. In the end, the only thing that matters is the scoreboard. (Evil)"]
	],
	bond : [
		"One person in particular owes me a lot of money, and I need to keep them alive if I want to be repaid.",
		"I'm loyal to the friend or family member who taught me how to gamble.",
		"The person who saved me from my gambling addiction is the only reason I'm alive today.",
		"A patron once fronted me money in exchange for a percentage of my winnings. I owe them a debt of gratitude. And a lot of cash.",
		"A criminal syndicate I once played for isn't happy I left the game, and its enforcers are looking for me.",
		"Urchins once helped me find marks for my games. Now I'm driven to help them escape the streets."
	],
	flaw : [
		"I don't know when to quit. Especially when everyone else is telling me to.",
		"I save my sympathy for my friends, and I have no friends.",
		"You think we're in trouble now? Let me tell you how bad things are likely to get!",
		"You can loan me a little, right? I've got a sure thing. I'll double your money, guaranteed.",
		"I was once a terribly flawed person, like you. Let me tell you how you can save yourself.",
		"I'm a great gambler. I'm just bad at math and logic."
	]
};
BackgroundFeatureList["never tell me the odds"] = {
	description : "Odds and probability are my bread and butter. During downtime activities that involve games of chance or figuring odds on the best plan, I can get a solid sense of which choice is likely the best one and which opportunities seem too good to be true, at the DM's determination.",
	source : ["AcqInc", 50]
};

BackgroundList["plaintiff"] = {
	regExpSearch : /plaintiff/i,
	name : "Plaintiff",
	source : ["AcqInc", 50],
	skills : ["Medicine", "Persuasion"],
	gold : 20,
	equipleft : [
		["Set of artisan's tools", "", ""]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [1],
	toolProfs : [["Artisan's tools", 1]],
	feature : "Legalese",
	trait : [
		"I can't believe I have a chance to join Acquisitions Incorporated! The fun I'm going to have!",
		"I've been wronged my entire life, and the world owes me.",
		"I have always tried to make the best of a bad situation.",
		"The law doesn't protect the honest and the hard working. I'm going to do whatever needs to be done to make things right.",
		"I'm always in the wrong place at the wrong time.",
		"My superiors are smarter and wiser than I am. I do what I'm told.",
		"Never pass up the opportunity to make an easy bit of coin. That's my motto.",
		"I'm beginning to feel like the gods are not on my side."
	],
	ideal : [
		["Justice", "Justice. Those who break the law need to answer for their crimes. (Lawful)"],
		["Freedom", "Freedom. People must have the freedom to do what they want and pursue their dreams. (Chaotic)"],
		["Greed", "Greed. Everyone I see is getting theirs, so I'm surely going to get mine. (Evil)"],
		["Chaos", "Chaos. You're out of order! And you're out of order! This whole realm is out of order! (Chaotic)"],
		["Humility", "Humility. I'm just a small part of a larger whole. So is everyone else. (Neutral)"],
		["Responsibility", "Responsibility. We all have our roles to play. I'll hold up my end of the bargain. (Any)"]
	],
	bond : [
		"Others hurt in the same accident that hurt me are my new family. I'll make sure they're taken care of.",
		"The rulers of this place were kind to me, and they have my lifelong devotion.",
		"My parents worry about me, but I'll make them proud.",
		"The only bond that matters is the one holding my money pouch to my belt.",
		"The other new hires at Acquisitions Incorporated are my allies. We have each other's backs.",
		"My legal counsel is my best friend. I owe all my forthcoming opportunities to their hard work."
	],
	flaw : [
		"The person who gains the most reward for the least effort wins.",
		"Three magic beans for just one cow? What a deal!",
		"I have only one vice, but it controls my life.",
		"Sleep is for the weak. We need to keep training more if we're going to be ready for the challenges ahead.",
		"Until my songs are sung in every tavern in this realm, I won't be satisfied.",
		"If people find me unpleasant, that's their problem."
	]
};
BackgroundFeatureList["legalese"] = {
	description : "My experience with the local legal system has given me a firm knowledge of its ins and outs. Even when the law is not on my side, I can use complex terms like \"ex injuria jus non oritur\" to frighten people into thinking I know what I'm talking about. I might be able to intimidate or deceive folks who don't know any better to get favors or special treatment.",
	source : ["AcqInc", 50]
};

BackgroundList["rival intern"] = {
	regExpSearch : /^(?=.*rival)(?=.*intern).*$/i,
	name : "Rival Intern",
	source : ["AcqInc", 51],
	skills : ["History", "Investigation"],
	gold : 10,
	equipleft : [
		["Set of artisan's tools", "", ""],
		["Ledger from prev. employer", "", 3]
	],
	equipright : [
		["Fine clothes", "", 6],
		["Belt pouch (with coins)", "", 1]
	],
	languageProfs : [1],
	toolProfs : [["Artisan's tools", 1]],
	feature : "Inside Informant",
	trait : [
		"My previous employer didn't respect me, and now I'll do whatever I can to gain respect.",
		"The job is important, but the relationships I forge with my coworkers are even more so.",
		"The job is everything to me. Who needs relaxation, hobbies, and a social life?",
		"I know I'm not the best and brightest, but if I put my best self forward, I can overcome anything.",
		"My former boss was an idiot. So was my boss before that. And before that. I'm sure those were all coincidences.",
		"This company is so much better than my previous one. It will always be the best until they stop paying me.",
		"I know this dagger belongs to the company, but I'm sure they won't miss it. Or this flask. Or this armor.",
		"It's only a matter of time before I'll be upper management. I just have to kiss up to my superiors and kick down those beneath me."
	],
	ideal : [
		["Advancement", "Advancement. Money and power can be gained more easily within an organization. I plan to gain as much as possible. (Evil)"],
		["Structure", "Structure. Life goes much more smoothly when you follow the rules and work within a system. (Lawful)"],
		["Uncertainty", "Uncertainty. The more chaos that swirls around me, the more opportunities I can find to profit. (Chaotic)"],
		["Justice", "Justice. I can't stand people being treated unjustly. I do whatever it takes to stop injustice and those who flout the law. (Lawful)"],
		["Pleasure", "Pleasure. What's the use of working hard and making money if you can't enjoy the finer things in life? (Any)"],
		["Power", "Power. Money is fine, but real power means never having to say you're sorry. (Evil)"]
	],
	bond : [
		"I have a family member in need. I consider them in everything I do.",
		"My peers keep me grounded.",
		"My past mistakes cost someone else dearly. I have to rectify that.",
		"A childhood mentor put me on my current path. If I succeed, I want to repay that mentor in some way.",
		"I value an oath of loyalty I took to a group of friends over everything else in my life.",
		"Although I don't get along well with people, my pet means the world to me."
	],
	flaw : [
		"I know what's best. Trust me.",
		"Flaw? I have no flaws. I'm perfect.",
		"My loyalties are... fluid.",
		"If anything goes wrong, it must be someone else's fault. Let me explain that in detail.",
		"There's right and there's wrong, and there's no gray area in between.",
		"Our superiors might not like what you're doing. I'm going to have to put that in my report."
	]
};
BackgroundFeatureList["inside informant"] = {
	description : "I have connections to my previous employer or other groups I dealt with during my previous employment. I can communicate with my contacts, gaining information at the DM's discretion.",
	source : ["AcqInc", 51]
};

RaceList["verdan"] = {
	regExpSearch : /verdan/i,
	name : "Verdan",
	source : ["AcqInc", 74],
	plural : "Verdan",
	size : 4, // small at 1st level, but medium from level 5+
	speed : {
		walk : { spd : 30, enc : 20 }
	},
	languageProfs : ["Common", "Goblin", 1],
	skills : ["Persuasion"],
	savetxt : { text : ["Adv. on Wis/Cha saves"] },
	age : " reach adulthood at around the age of 24, and it is thought that they might live to nearly 200 years old. However, because no verdan has died of old age since the race's initial creation, their upper age limits remain subject to speculation.",
	height : " are between 3 and a half and 4 feet tall, plus 2 feet from 5th level onwards",
	heightMetric : " are between 100 and 120 cm tall, plus 60 cm from 5th level onwards",
	scores : [0, 0, 1, 0, 0, 2],
	trait : "Verdan (+1 Constitution, +2 Charisma)\nSudden Growth Spurt: At 5th level, I grow 2 ft, increasing my size from Small to Medium.\nBlack Blood Healing: When I roll a 1 or 2 on any HD I spend at the end of short rest, I can reroll the die and must use the new roll.\nLimited Telepathy: I can telepathically communicate simple ideas and straightforward concepts to a creature I can see within 30 ft, if it can understand at least one language.\nTelepathic Insight: I have advantage on Wisdom and Charisma saving throws.",
	features : {
		"sudden growth spurt" : {
			name : "Sudden Growth Spurt",
			minlevel : 5,
			eval : function () { PickDropdown("Size Category", 3); },
			removeeval : function () { PickDropdown("Size Category", 4); }
		}
	},
	advantages : [
		["Wisdom", true],
		["Charisma", true]
	]
}

SpellsList["distort value"] = {
	name : "Distort Value",
	classes : ["bard", "sorcerer", "warlock", "wizard"],
	source : ["AcqInc", 75],
	level : 1,
	school : "Illus",
	time : "1 min",
	range : "Touch",
	components : "V",
	duration : "8 hours",
	description : "1 obj up to 1+1/SL cu ft doubles/halves in perceived value; Investigation vs. spell DC to see true value",
	descriptionFull : "Do you need to squeeze a few more gold pieces out of a merchant as you try to sell that weird octopus statue you liberated from the chaos temple? Do you need to downplay the worth of some magical assets when the tax collector stops by? Distort value has you covered.\n   You cast this spell on an object no more than 1 foot on a side, doubling the object's perceived value by adding illusory flourishes or polish to it, or reducing its perceived value by half with the help of illusory scratches, dents, and other unsightly features. Anyone examining the object can ascertain its true value with a successful Intelligence (Investigation) check against your spell save DC." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the maximum size of the object increases by 1 foot for each slot level above 1st."
};
SpellsList["fast friends"] = {
	name : "Fast Friends",
	classes : ["bard", "cleric", "wizard"],
	source : ["AcqInc", 75],
	level : 3,
	school : "Ench",
	time : "1 a",
	range : "30 ft",
	components : "V",
	duration : "Conc, 1 h",
	save : "Wis",
	description : "1+1/SL humanoid save or charmed and perform tasks I ask it to do; adv. save if me/ally is fighting it",
	descriptionFull : "When you need to make sure something gets done, you can't rely on vague promises, sworn oaths, or binding contracts of employment. When you cast this spell, choose one humanoid within range that can see and hear you, and that can understand you. The creature must succeed on a Wisdom saving throw or become charmed by you for the duration. While the creature is charmed in this way, it undertakes to perform any services or activities you ask of it in a friendly manner, to the best of its ability.\n   You can set the creature new tasks when a previous task is completed, or if you decide to end its current task. If the service or activity might cause harm to the creature, or if it conflicts with the creature's normal activities and desires, the creature can make another Wisdom saving throw to try to end the effect. This save is made with advantage if you or your companions are fighting the creature. If the activity would result in certain death for the creature, the spell ends.\n   When the spell ends, the creature knows it was charmed by you." + AtHigherLevels + "When you cast this spell using a spell slot of 4th level or higher, you can target one additional creature for each slot level above 3rd."
};
SpellsList["gift of gab"] = {
	name : "Gift of Gab",
	classes : ["bard", "wizard"],
	source : ["AcqInc", 76],
	level : 2,
	school : "Ench",
	time : "1 rea", // which you take when you speak to another creature
	range : "Self",
	components : "V,S,R\u2020",
	compMaterial : "2 gp royalty component",
	duration : "Conc, 1 h",
	description : "Cast when talking, any crea within 5 ft think what I said in the last 6 seconds was only to cast a spell",
	descriptionFull : "Jim Darkmagic is said to have invented this spell, originally calling it 'I said what?!'. Have you ever been talking to the local monarch and accidentally mentioned how their son looks like your favorite hog from when you were growing up on the family farm? We've all been there! But rather than being beheaded for an honest slip of the tongue, you can pretend it never happened\u2014by ensuring that no one knows it happened.\n   When you cast this spell, you skillfully reshape the memories of listeners in your immediate area, so that each creature of your choice within 5 feet of you forgets everything you said within the last 6 seconds. Those creatures then remember that you actually said the words you speak as the verbal component of the spell."
};
SpellsList["incite greed"] = {
	name : "Incite Greed",
	classes : ["cleric", "warlock", "wizard"],
	source : ["AcqInc", 76],
	level : 3,
	school : "Ench",
	time : "1 a",
	range : "30 ft",
	components : "V,S,M\u0192",
	compMaterial : "A gem worth at least 50 gp",
	duration : "Conc, 1 min",
	save : "Wis",
	description : "Any crea that see me save or charmed, only move to me, if in 5 ft do nothing; save end of each turn",
	descriptionFull : "When you cast this spell, you present the gem used as the material component and choose any number of creatures within range that can see you. Each target must succeed on a Wisdom saving throw or be charmed by you until the spell ends, or until you or your companions do anything harmful to it. While charmed in this way, a creature can do nothing but use its movement to approach you in a safe manner. While an affected creature is within 5 feet of you, it cannot move, but simply stares greedily at the gem you present.\n   At the end of each of its turns, an affected target can make a Wisdom saving throw. If it succeeds, this effect ends for that target."
};
SpellsList["jim's glowing coin"] = {
	name : "Jim's Glowing Coin",
	classes : ["wizard"],
	source : ["AcqInc", 76],
	level : 2,
	school : "Ench",
	time : "1 a",
	range : "60 ft",
	components : "V,M,R\u2020",
	compMaterial : "A coin, and 2 gp royalty component",
	duration : "1 min",
	save : "Wis",
	description : "30-ft radius any creature I can see save or disadvantage on Perception and Initiative for duration",
	descriptionFull : "Of the many tactics employed by master magician and renowned adventurer Jim Darkmagic, the old glowing coin trick is a time-honored classic. When you cast the spell, you hurl the coin that is the spell's material component to any spot within range. The coin lights up as if under the effect of a light spell. Each creature of your choice that you can see within 30 feet of the coin must succeed on a Wisdom saving throw or be distracted for the duration. While distracted, a creature has disadvantage on Wisdom (Perception) checks and initiative rolls."
};
SpellsList["jim's magic missile"] = {
	name : "Jim's Magic Missile",
	classes : ["wizard"],
	source : ["AcqInc", 76],
	level : 1,
	school : "Evoc",
	time : "1 a",
	range : "120 ft",
	components : "V,S,R\u2020",
	compMaterial : "1 gp royalty component per spell slot level used",
	duration : "Instantaneous",
	description : "3+1/SL darts, each spell atk for 2d4 Force dmg; 5d4 crit; any 1 to hit, all dmg me 1 (1+1/SL gp cons.)",
	descriptionFull : "Any apprentice wizard can cast a boring old magic missile. Sure, it always strikes its target. Yawn. Do away with the drudgery of your grandfather's magic with this improved version of the spell, as used by Jim Darkmagic!\n   You create three twisting, whistling, hypoallergenic, gluten-free darts of magical force. Each dart targets a creature of your choice that you can see within range. Make a ranged spell attack for each missile. On a hit, a missile deals 2d4 force damage to its target.\n   If the attack roll scores a critical hit, the target of that missile takes 5d4 force damage instead of you rolling damage twice for a critical hit. If the attack roll for any missile is a 1, all missiles miss their targets and blow up in your face, dealing 1 force damage per missile to you." + AtHigherLevels + "When you cast this spell using a spell slot of 2nd level or higher, the spell creates one more dart, and the royalty component increases by 1 gp, for each slot level above 1st."
};
SpellsList["motivational speech"] = {
	name : "Motivational Speech",
	classes : ["bard", "cleric"],
	source : ["AcqInc", 77],
	level : 3,
	school : "Ench",
	time : "1 min",
	range : "60 ft",
	components : "V",
	duration : "1 h",
	description : "5 crea that hear me 5+5/SL temp HP, adv. Wis saves, if hit adv. on next atk; stops when temp HP gone",
	descriptionFull : "You address allies, staff, or innocent bystanders to exhort and inspire them to greatness, whether they have anything to get excited about or not. Choose up to five creatures within range that can hear you. For the duration, each affected creature gains 5 temporary hit points and has advantage on Wisdom saving throws. If an affected creature is hit by an attack, it has advantage on the next attack roll it makes. Once an affected creature loses the temporary hit points granted by this spell, the spell ends for that creature." + AtHigherLevels + "At Higher Levels. When you cast this spell using a spell slot of 4th level or higher, the temporary hit points increase by 5 for each slot level above 3rd."
};

// Magic Item from the adventure
MagicItemsList["piercer"] = {
	name : "Piercer",
	source : ["AcqInc", 121],
	type : "weapon (shortsword)",
	rarity : "rare",
	description : "I gain a +1 bonus to attack and damage rolls made with this magical shortsword. I regain the maximum possible number of hit points from expended Hit Dice. However, I must eat twice as much food each day to avoid exhaustion, a minimum of 2 lb.",
	descriptionFull : "You have a +1 bonus to attack and damage rolls made with this magic weapon.\n   A character attuned to the sword regains the maximum possible number of hit points from expended Hit Dice. However, the attuned character must eat twice as much food each day (a minimum of 2 pounds) to avoid exhaustion (see \"The Environment\" in chapter 8 of the Player's Handbook.)",
	attunement : true,
	weight : 3,
	weaponsAdd : ["Piercer"],
	weaponOptions : {
		baseWeapon : "shortsword",
		regExpSearch : /piercer/i,
		name : "Piercer",
		source : ["AcqInc", 121],
		modifiers : [1, 1]
	}
};
var iFileName = "pub_20190903_DnDEK.js";
RequiredSheetVersion(13);
// This file adds the sidekick rules from the Dungeons & Dragons Essentials Kit adventures to MPMB's Character Record Sheet
/* - NOTICE -
	These sidekick classes are available as normal classes because the sheet doesn't support classes for the companion page

	Be aware that the sidekick official way of levelling is not fully compatible with the sheet,
	because it isn't how player classes normally gain abilities and choices.
	For example, the ability score improvements here are left to the player, while the rules say which score increases.

	Also, the sidekicks here gain increases to their proficiency bonus just like normal classes because that is hard-coded into the sheet.
	According to the official rules, the sidekicks only get a proficiency bonus increase at 5th level, and at no other levels.
*/

// Define the source
SourceList["DnDEK"] = {
	name : "Dungeons & Dragons Essentials Kit [sidekick classes]",
	abbreviation : "DnDEK",
	group : "Adventure Books",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/essentials-kit",
	date : "2019/09/03",
	defaultExcluded : true
};

ClassList["sidekick-expert"] = {
	loadSidekickStats : function(AddRemove, scoresA) {
		// (re)set the default ability scores
		initiateCurrentStats();
		var expectedA = AddRemove ? [8,8,8,8,8,8] : scoresA;
		var setA = AddRemove ? scoresA : [8,8,8,8,8,8];
		for (var s = 0; s < scoresA.length; s++) {
			if (CurrentStats.cols[0].scores[s] != expectedA[s]) continue;
			CurrentStats.cols[0].scores[s] = setA[s];
			var thisAbi = AbilityScores.abbreviations[s];
			if (AddRemove && !What(thisAbi)) Value(thisAbi, setA[s])
		}
		// (re)set the race and background
		var expectedV = AddRemove ? ["", ""] : ["Hum\u200Aanoid", "Generic"];
		var setV = AddRemove ? ["Hum\u200Aanoid", "Generic"] : ["", ""];
		if (What("Race") == expectedV[0]) Value("Race", setV[0]);
		if (What("Background") == expectedV[1]) Value("Background", setV[1]);
	},
	fixSidekickLevelDeps : function(aClass, lvlA) {
		// First add an extra HD
		for (var i = 1; i <= 3; i++) {
			var lvlFld = "HD" + i + " Level";
			if (What("HD" + i + " Die") == 8 && What(lvlFld) == lvlA[1]) {
				Value(lvlFld, What(lvlFld) + 1);
				CurrentUpdates.types.push("hp");
				break;
			}
		}
	},
	amendSidekickHP : function (HDobj) {
		// remove 1st level max, and change its average and fixed value
		var matchRegex = /(\d+)d8 \((\d+\.?\d+?)\)/;
		var match = HDobj.dieStr[1].match(matchRegex);
		if (!match) return;
		HDobj.dieStr.shift(); HDobj.average -= 3.5;  HDobj.fixed -= 3;
		HDobj.dieStr[0] = HDobj.dieStr[0].replace(matchRegex, (Number(match[1]) + 1) + "d8 (" + (Number(match[2]) + 4.5) + ")");
		HDobj.dieStr.push("\n extra sidekick HD (included above), but no max 1st level");
	},
	regExpSearch : /^(?=.*expert)(?=.*sidekick).*$/i,
	name : "Expert (sidekick)",
	source : ["DnDEK", 0],
	primaryAbility : "Dexterity",
	prereqs : "Can't multiclass",
	improvements : [0, 0, 0, 1, 1, 1, 1, 2, 2, 3, 3, 4],
	die : 8,
	saves : ["Dex"],
	skills : {
		primary : ["Acrobatics", "Performance", "Persuasion", "Sleight of Hand", "Stealth"]
	},
	toolProfs : {
		primary : [["Thieves' tools", "Dex"], ["Musical instrument", 1]]
	},
	armorProfs : {
		primary : [true, false, false, false]
	},
	weaponProfs : {
		primary : [true, false, ["rapier", "shortsword"]]
	},
	equipment : "Expert starting equipment:" +
		"\n \u2022 A shortsword and a dagger;" +
		"\n \u2022 A shortbow and a quiver of 20 arrows;" +
		"\n \u2022 Studded leather armor;" +
		"\n \u2022 Thieves' tools and a musical instrument of my choice.",
	subclasses : ["", []],
	attacks : [1, 1, 1, 1, 1, 2],
	features : {
		"sidekick" : {
			name : "Sidekick",
			source : ["DnDEK", 0],
			minlevel : 1,
			description : desc([
				"Unlike other classes, a sidekick has preset ability scores and skill proficiencies",
				"A sidekick gains 2 HD at 1st level, but doesn't get max HP for its 1st level",
				"If the DM allows it, a race can be selected and have its racial traits applied",
				"A sidekick does not get the benefits of a background, nor can it multiclass"
			]),
			scorestxt : "Starts with 10 Strength, 15 Dexterity, 12 Constitution, 13 Intelligence, 10 Wisdom, and 14 Charisma",
			weaponsAdd : ["Shortsword", "Dagger", "Shortbow"],
			armorAdd : "Studded Leather",
			languageProfs : ["Common", 1],
			eval : function (lvlA, choiceA) {
				ClassList["sidekick-expert"].loadSidekickStats(true, [10, 15, 12, 13, 10, 14]);
			},
			removeeval : function (lvlA, choiceA) {
				ClassList["sidekick-expert"].loadSidekickStats(false, [10, 15, 12, 13, 10, 14]);
			},
			changeeval : function (lvlA, choiceA) {
				ClassList["sidekick-expert"].fixSidekickLevelDeps("sidekick-expert", lvlA);
			},
			calcChanges : {
				hp : function (totalHD, HDobj) {
					ClassList["sidekick-expert"].amendSidekickHP(HDobj);
				}
			}
		},
		"helpful" : {
			name : "Helpful",
			source : ["DnDEK", 0],
			minlevel : 1,
			description : "\n   I can use a bonus action to take the Help action",
			action : ["bonus action", ""]
		},
		"cunning action" : {
			name : "Cunning Action",
			source : ["DnDEK", 0],
			minlevel : 2,
			description : "\n   I can use a bonus action to take the Dash, Disengage, or Hide action",
			action : ["bonus action", ""]
		},
		"expertise" : {
			name : "Expertise",
			source : ["DnDEK", 0],
			minlevel : 3,
			description : "\n   " + "I gain expertise with two skills I am proficient with",
			skillstxt : "Expertise with any two skill proficiencies",
			extraname : "Expertise",
			extrachoices : ["Acrobatics", "Animal Handling", "Arcana", "Athletics", "Deception", "History", "Insight", "Intimidation", "Investigation", "Medicine", "Nature", "Perception", "Performance", "Persuasion", "Religion", "Sleight of Hand", "Stealth", "Survival"],
			extraTimes : levels.map(function (n) { return n < 3 ? 0 : n < 10 ? 2 : 4; }),
			"acrobatics" : {
				name : "Acrobatics Expertise", description : "",
				source : ["DnDEK", 0],
				prereqeval : function(v) { return v.skillProfs.indexOf("Acrobatics") !== -1; },
				skills : [["Acrobatics", "only"]]
			},
			"animal handling" : {
				name : "Animal Handling Expertise", description : "",
				source : ["DnDEK", 0],
				prereqeval : function(v) { return v.skillProfs.indexOf("Animal Handling") !== -1; },
				skills : [["Animal Handling", "only"]]
			},
			"arcana" : {
				name : "Arcana Expertise", description : "",
				source : ["DnDEK", 0],
				prereqeval : function(v) { return v.skillProfs.indexOf("Arcana") !== -1; },
				skills : [["Arcana", "only"]]
			},
			"athletics" : {
				name : "Athletics Expertise", description : "",
				source : ["DnDEK", 0],
				prereqeval : function(v) { return v.skillProfs.indexOf("Athletics") !== -1; },
				skills : [["Athletics", "only"]]
			},
			"deception" : {
				name : "Deception Expertise", description : "",
				source : ["DnDEK", 0],
				prereqeval : function(v) { return v.skillProfs.indexOf("Deception") !== -1; },
				skills : [["Deception", "only"]]
			},
			"history" : {
				name : "History Expertise", description : "",
				source : ["DnDEK", 0],
				prereqeval : function(v) { return v.skillProfs.indexOf("History") !== -1; },
				skills : [["History", "only"]]
			},
			"insight" : {
				name : "Insight Expertise", description : "",
				source : ["DnDEK", 0],
				prereqeval : function(v) { return v.skillProfs.indexOf("Insight") !== -1; },
				skills : [["Insight", "only"]]
			},
			"intimidation" : {
				name : "Intimidation Expertise", description : "",
				source : ["DnDEK", 0],
				prereqeval : function(v) { return v.skillProfs.indexOf("Intimidation") !== -1; },
				skills : [["Intimidation", "only"]]
			},
			"investigation" : {
				name : "Investigation Expertise", description : "",
				source : ["DnDEK", 0],
				prereqeval : function(v) { return v.skillProfs.indexOf("Investigation") !== -1; },
				skills : [["Investigation", "only"]]
			},
			"medicine" : {
				name : "Medicine Expertise", description : "",
				source : ["DnDEK", 0],
				prereqeval : function(v) { return v.skillProfs.indexOf("Medicine") !== -1; },
				skills : [["Medicine", "only"]]
			},
			"nature" : {
				name : "Nature Expertise", description : "",
				source : ["DnDEK", 0],
				prereqeval : function(v) { return v.skillProfs.indexOf("Nature") !== -1; },
				skills : [["Nature", "only"]]
			},
			"perception" : {
				name : "Perception Expertise", description : "",
				source : ["DnDEK", 0],
				prereqeval : function(v) { return v.skillProfs.indexOf("Perception") !== -1; },
				skills : [["Perception", "only"]]
			},
			"performance" : {
				name : "Performance Expertise", description : "",
				source : ["DnDEK", 0],
				prereqeval : function(v) { return v.skillProfs.indexOf("Performance") !== -1; },
				skills : [["Performance", "only"]]
			},
			"persuasion" : {
				name : "Persuasion Expertise", description : "",
				source : ["DnDEK", 0],
				prereqeval : function(v) { return v.skillProfs.indexOf("Persuasion") !== -1; },
				skills : [["Persuasion", "only"]]
			},
			"religion" : {
				name : "Religion Expertise", description : "",
				source : ["DnDEK", 0],
				prereqeval : function(v) { return v.skillProfs.indexOf("Religion") !== -1; },
				skills : [["Religion", "only"]]
			},
			"sleight of hand" : {
				name : "Sleight of Hand Expertise", description : "",
				source : ["DnDEK", 0],
				prereqeval : function(v) { return v.skillProfs.indexOf("Sleight of Hand") !== -1; },
				skills : [["Sleight of Hand", "only"]]
			},
			"stealth" : {
				name : "Stealth Expertise", description : "",
				source : ["DnDEK", 0],
				prereqeval : function(v) { return v.skillProfs.indexOf("Stealth") !== -1; },
				skills : [["Stealth", "only"]]
			},
			"survival" : {
				name : "Survival Expertise", description : "",
				source : ["DnDEK", 0],
				prereqeval : function(v) { return v.skillProfs.indexOf("Survival") !== -1; },
				skills : [["Survival", "only"]]
			}
		},
		"inspiring help" : {
			name : "Inspiring Help",
			source : ["DnDEK", 0],
			minlevel : 7,
			description : desc([
				"When I use the Help action, the creature that receives the help adds +1d6 to its d20 roll",
				"If it was an attack roll that hits without the +1d6, it can add it to the damage instead"
			])
		},
		"evasion" : {
			name : "Evasion",
			source : ["DnDEK", 0],
			minlevel : 7,
			description : "\n   My Dexterity saves vs. areas of effect negate damage on success and halve it on failure",
			savetxt : { text : ["Dex save vs. area effects: fail \u2015 half dmg, success \u2015 no dmg"] }
		},
		"reliable talent" : {
			name : "Reliable Talent",
			source : ["DnDEK", 0],
			minlevel : 11,
			description : "\n   If I make an ability check where I add my proficiency bonus, rolls of 9 or lower are 10"
		}
	}
}
ClassList["sidekick-warrior"] = {
	regExpSearch : /^(?=.*warrior)(?=.*sidekick).*$/i,
	name : "Warrior (sidekick)",
	source : ["DnDEK", 0],
	primaryAbility : "Strength",
	prereqs : "Can't multiclass",
	improvements : [0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3],
	die : 8,
	saves : ["Con"],
	skills : {
		primary : ["Athletics", "Perception", "Survival"]
	},
	armorProfs : {
		primary : [true, true, true, true]
	},
	weaponProfs : {
		primary : [true, true]
	},
	equipment : "Warrior starting equipment:" +
		"\n \u2022 A longsword;" +
		"\n \u2022 A longbow and a quiver of 20 arrows;" +
		"\n \u2022 Chain shirt and a shield.",
	subclasses : ["", []],
	attacks : [1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 3, 3],
	features : {
		"sidekick" : {
			name : "Sidekick",
			source : ["DnDEK", 0],
			minlevel : 1,
			description : desc([
				"Unlike other classes, a sidekick has preset ability scores and skill proficiencies",
				"A sidekick gains 2 HD at 1st level, but doesn't get max HP for its 1st level",
				"If the DM allows it, a race can be selected and have its racial traits applied",
				"A sidekick does not get the benefits of a background, nor can it take feats or multiclass"
			]),
			scorestxt : "Starts with 15 Strength, 13 Dexterity, 14 Constitution, 10 Intelligence, 12 Wisdom, and 10 Charisma",
			weaponsAdd : ["Longsword", "Longbow"],
			armorAdd : "Chain Shirt",
			shieldAdd : "Shield",
			languageProfs : ["Common", 1],
			eval : function (lvlA, choiceA) {
				ClassList["sidekick-expert"].loadSidekickStats(true, [15, 13, 14, 10, 12, 10]);
			},
			removeeval : function (lvlA, choiceA) {
				ClassList["sidekick-expert"].loadSidekickStats(false, [15, 13, 14, 10, 12, 10]);
			},
			changeeval : function (lvlA, choiceA) {
				ClassList["sidekick-expert"].fixSidekickLevelDeps("sidekick-warrior", lvlA);
			},
			calcChanges : {
				hp : function (totalHD, HDobj) {
					ClassList["sidekick-expert"].amendSidekickHP(HDobj);
				}
			}
		},
		"martial role" : {
			name : "Martial Role",
			source : ["DnDEK", 0],
			minlevel : 1,
			description : '\n   Choose a Martial Role for the warrior using the "Choose Feature" button above',
			choices : ["Attacker", "Defender"],
			"attacker" : {
				name : "Martial Role: Attacker",
				description : "\n  I gain a +2 bonus to my attack rolls",
				calcChanges : {
					atkCalc : [
						function (fields, v, output) {
							if (!v.isDC) output.extraHit += 2;
						},
						"I add a +2 bonus on the To Hit of all my attack rolls."
					]
				}
			},
			"defender" : {
				name : "Martial Role: Defender",
				description : desc([
					"As a reaction, I can give disadv. on an attack made vs. someone within 5 ft of me",
					"I need to be able to see the attacker to do this"
				]),
				action : ["reaction", ""]
			}
		},
		"second wind" : {
			name : "Second Wind",
			source : ["DnDEK", 0],
			minlevel : 2,
			description : "\n   As a bonus action, I regain 1d10 + warrior level HP; I can use this once per short rest",
			additional : levels.map(function (n) {
				return "1d10+" + n;
			}),
			usages : 1,
			recovery : "short rest",
			action : ["bonus action", ""]
		},
		"improved critical" : {
			name : "Improved Critical",
			source : ["DnDEK", 0],
			minlevel : 3,
			description : "\n   I score a critical hit with my weapon attacks on a roll of 19 and 20",
			calcChanges : {
				atkAdd : [
					function (fields, v) {
						if (!v.isSpell && !v.CritChance && classes.known["sidekick-warrior"]) {
							fields.Description += (fields.Description ? '; ' : '') + 'Crit on 19-20';
							v.CritChance = 19;
						};
					},
					"My weapon attacks score a critical on a to hit roll of both 19 and 20."
				]
			}
		},
		"battle readiness" : {
			name : "Battle Readiness",
			source : ["DnDEK", 0],
			minlevel : 7,
			description : "\n   I have advantage on my Initiative rolls",
			advantages : [["Initiative", true]]
		},
		"indomitable" : {
			name : "Indomitable",
			source : ["DnDEK", 0],
			minlevel : 9,
			description : "\n   I can reroll a failed saving throw, but must keep the new result",
			usages : 1,
			recovery : "long rest"
		},
		"improved defense" : {
			name : "Improved Defense",
			source : ["DnDEK", 0],
			minlevel : 10,
			description : "\n   I gain a +1 bonus to AC",
			extraAC : { mod : 1 }
		}
	}
}
ClassList["sidekick-spellcaster"] = {
	setSidekickSpells : function (knownObj, lvlA) {
		var spCast = CurrentSpells["sidekick-spellcaster"];
		if (!spCast.selectCa) spCast.selectCa = [];
		if (!spCast.selectSp) spCast.selectSp = [];
		for (var knownType in knownObj) {
			var knowSel = "select" + knownType;
			for (var cLvl in knownObj[knownType]) {
				if (cLvl > lvlA[0] && cLvl <= lvlA[1]) { // level gained
					spCast[knowSel] = spCast[knowSel].concat(knownObj[knownType][cLvl]);
				} else if (cLvl <= lvlA[0] && cLvl > lvlA[1]) { // level lost
					var removeSp = knownObj[knownType][cLvl];
					for (var i = 0; i < removeSp.length; i++) {
						var indx = spCast[knowSel].indexOf(removeSp[i]);
						if (indx == -1) continue;
						spCast[knowSel].splice(indx, 1);
					}
				}
			}
		}
	},
	regExpSearch : /^(?=.*(spellcaster|mage|healer))(?=.*sidekick).*$/i,
	name : "Spellcaster (sidekick)",
	source : ["DnDEK", 0],
	primaryAbility : "Intelligence or Wisdom",
	prereqs : "Can't multiclass",
	improvements : [0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3],
	die : 8,
	saves : ["Wis"],
	skills : {
		primary : ["Arcana", "Investigation", "Religion"]
	},
	armorProfs : {
		primary : [true, false, false, false]
	},
	weaponProfs : {
		primary : [true, false]
	},
	equipment : "Spellcaster starting equipment:" +
		"\n \u2022 A quarterstaff;" +
		"\n \u2022 Leather armor.",
	subclasses : ["Magical Role", []],
	attacks : [1],
	features : {
		"sidekick" : {
			name : "Sidekick",
			source : ["DnDEK", 0],
			minlevel : 1,
			description : desc([
				"Unlike other classes, a sidekick has preset ability scores and skill proficiencies",
				"A sidekick gains 2 HD at 1st level, but doesn't get max HP for its 1st level",
				"If the DM allows it, a race can be selected and have its racial traits applied",
				"A sidekick does not get the benefits of a background, nor can it take feats or multiclass"
			]),
			scorestxt : "Starts with 10 Strength, 12 Dexterity, 10 Constitution, 15 Intelligence, 14 Wisdom, and 13 Charisma",
			weaponsAdd : ["Quarterstaff"],
			armorAdd : "Leather",
			languageProfs : ["Common", 1],
			eval : function (lvlA, choiceA) {
				ClassList["sidekick-expert"].loadSidekickStats(true, [10, 12, 10, 15, 14, 13]);
			},
			removeeval : function (lvlA, choiceA) {
				ClassList["sidekick-expert"].loadSidekickStats(false, [10, 12, 10, 15, 14, 13]);
			},
			changeeval : function (lvlA, choiceA) {
				ClassList["sidekick-expert"].fixSidekickLevelDeps("sidekick-warrior", lvlA);
			},
			calcChanges : {
				hp : function (totalHD, HDobj) {
					ClassList["sidekick-expert"].amendSidekickHP(HDobj);
				}
			}
		},
		"subclassfeature1" : {
			name : "Magical Role",
			source : ["DnDEK", 0],
			minlevel : 1,
			description : '\n   Choose the magical role of the sidekick, mage or healer, and put it in the "Class" field'
		},
		"potent cantrips" : {
			name : "Potent Cantrips",
			source : ["DnDEK", 0],
			minlevel : 6,
			description : "\n   I add my spellcasting ability modifier to the damage I deal with any cantrip",
			calcChanges : {
				atkCalc : [
					function (fields, v, output) {
						var subclass = classes.known["sidekick-spellcaster"].subclass;
						if (!subclass || !ClassSubList[subclass].abilitySave) return;
						var spAbiMod = Number(What(AbilityScores.abbreviations[ClassSubList[subclass].abilitySave - 1] + ' Mod'));
						if (spAbiMod > 0 && v.thisWeapon[3] && SpellsList[v.thisWeapon[3]].level === 0) {
							output.extraDmg += spAbiMod;
						};
					},
					"My cantrips get my spellcasting ability modifier added to their damage."
				],
				spellAdd : [
					function (spellKey, spellObj, spName) {
						var subclass = classes.known["sidekick-spellcaster"].subclass;
						if (!subclass || !ClassSubList[subclass].abilitySave || spellObj.psionic || spellObj.level !== 0) return;
						var spAbi = AbilityScores.abbreviations[ClassSubList[subclass].abilitySave - 1];
						var spAbiMod = Number(What(spAbi + ' Mod'));
						if (spAbiMod < 1) return;
						if (spellKey == "shillelagh") {
							spellObj.description = spellObj.description.replace("1d8", "1d8+" + spAbiMod);
						} else {
							return genericSpellDmgEdit(spellKey, spellObj, "\\w+\\.?", spAbi, true);
						}
					},
					"My cantrips get my spellcasting ability modifier added to their damage."
				]
			}
		},
		"empowered spells" : {
			name : "Empowered Spells",
			source : ["DnDEK", 0],
			minlevel : 10,
			description : desc([
				'Select one of the eight schools of magic using the "Choose Feature" button above',
				"Whenever I cast a spell from the selected school by expending a spell slot, I empower it",
				"I add my spellcasting ability modifier to the damage or healing I do with that spell"
			]),
			calcChanges : {
				spellAdd : [
					function (spellKey, spellObj, spName) {
						var subclass = classes.known["sidekick-spellcaster"].subclass;
						var spSchool = GetFeatureChoice("classes", "sidekick-spellcaster", "empowered spells", false);
						if (!subclass || !ClassSubList[subclass].abilitySave || !spSchool || spellObj.psionic || !spellObj.level) return;
						for (var aSchl in spellSchoolList) {
							if (spellSchoolList[aSchl] == spSchool) {
								spSchool = aSchl;
								break;
							}
						}
						if (spellObj.school !== spSchool) return;
						var spAbi = AbilityScores.abbreviations[ClassSubList[subclass].abilitySave - 1];
						var spAbiMod = Number(What(spAbi + ' Mod'));
						if (spAbiMod < 1) return;
						var startDescr = spellObj.description;
						switch (spellKey) {
							case "death ward" :
							case "harm" :
							case "virtue-uass" :
								break;
							case "enervation" :
								spellObj.description = spellObj.description.replace("action to repeat", "1 a to repeat").replace("see book", "see B");
							case "life transference" :
							case "vampiric touch" :
								spellObj.description = spellObj.description.replace(/(heals? (half|twice)( the damage dealt| that)?)( in HP)?/, "$1+" + spAbiMod);
								break;
							case "mass heal" :
								spellObj.description = spellObj.description.replace("creatures in range;", "crea in range, each then +" + spAbiMod + " HP;").replace("cured of", "cures").replace("and all diseases", "diseases");
								break;
							case "regenerate" :
								spellObj.description = spellObj.description.replace("1 HP/rnd", (1+spAbiMod) + " HP/rnd");
							default :
								if ((/\bHP o(f|r)\b/).test(spellObj.description)) break;
								var testRegex = /(.*?)([1-9]\d*d?\d*)((\+\d+d?\d*\/\d?SL)?((\+spell(casting)? ability mod(ifier)?|(\+|-)\d+ \(.{3}\))? hp.*))/i;
								var theMatch = spellObj.description.match(testRegex);
								if (!theMatch) break;
								try {
									var repl1 = isNaN(theMatch[2]) ? "$1$2+" + spAbiMod : "$1" + (Number(theMatch[2]) + spAbiMod);
									spellObj.description = spellObj.description.replace(testRegex, repl1 + "$3");
								} catch (err) {
									spellObj.description = startDescr;
								}
						}
						var theReturn = startDescr !== spellObj.description;
						if (genericSpellDmgEdit(spellKey, spellObj, "\\w+\\.?", spAbi, true)) theReturn = true;
						return theReturn;
					},
					"Spells from my selected school get my spellcasting ability modifier added to their damage and healing."
				]
			},
			choices : ["Abjuration", "Conjuration", "Divination", "Enchantment", "Evocation", "Illusion", "Necromancy", "Transmutation"],
			"abjuration" : {
				name : "Empowered Abjurations",
				description : desc([
					"Whenever I cast an abjuration spell by expending a spell slot, I can empower its effect",
					"I then add my spellcasting ability modifier to the damage or healing I do with that spell"
				])
			},
			"conjuration" : {
				name : "Empowered Conjurations",
				description : desc([
					"Whenever I cast a conjuration spell by expending a spell slot, I can empower its effect",
					"I then add my spellcasting ability modifier to the damage or healing I do with that spell"
				])
			},
			"divination" : {
				name : "Empowered Divinations",
				description : desc([
					"Whenever I cast a divination spell by expending a spell slot, I can empower its effect",
					"I then add my spellcasting ability modifier to the damage or healing I do with that spell"
				])
			},
			"enchantment" : {
				name : "Empowered Enchantments",
				description : desc([
					"Whenever I cast a enchantment spell by expending a spell slot, I can empower its effect",
					"I then add my spellcasting ability modifier to the damage or healing I do with that spell"
				])
			},
			"evocation" : {
				name : "Empowered Evocations",
				description : desc([
					"Whenever I cast a evocation spell by expending a spell slot, I can empower its effect",
					"I then add my spellcasting ability modifier to the damage or healing I do with that spell"
				])
			},
			"illusion" : {
				name : "Empowered Illusions",
				description : desc([
					"Whenever I cast an illusion spell by expending a spell slot, I can empower its effect",
					"I then add my spellcasting ability modifier to the damage or healing I do with that spell"
				])
			},
			"necromancy" : {
				name : "Empowered Necromancy",
				description : desc([
					"Whenever I cast a necromancy spell by expending a spell slot, I can empower its effect",
					"I then add my spellcasting ability modifier to the damage or healing I do with that spell"
				])
			},
			"transmutation" : {
				name : "Empowered Transmutations",
				description : desc([
					"Whenever I cast a transmutation spell by expending a spell slot, I can empower its effect",
					"I then add my spellcasting ability modifier to the damage or healing I do with that spell"
				])
			}
		}
	}
}

AddSubClass("sidekick-spellcaster", "mage", {
	regExpSearch : /^(?=.*mage)(?=.*sidekick).*$/i,
	subname : "Mage",
	fullname : "Mage (sidekick)",
	source : ["DnDEK", 0],
	abilitySave : 4,
	spellcastingFactor : 1,
	spellcastingList : {
		"class" : "wizard",
		level : [0, 6]
	},
	spellcastingKnown : {
		cantrips : [2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5],
		spells :   [1, 2, 3, 3, 4, 4, 8, 9,10,11,12,12]
	},
	spellcastingTable : [[0, 0, 0, 0, 0, 0, 0, 0, 0]].concat(levels.slice(0,12).map(function (n) {
		return defaultSpellTable[n < 7 ? Math.ceil(n / 2) : n];
	})),
	features : {
		"subclassfeature1" : {
			name : "Spellcasting",
			source : ["DnDEK", 0],
			minlevel : 1,
			description : "\n   I can cast wizard cantrips/spells I know, using Intelligence as my spellcasting ability",
			weaponsAdd : ["Fire Bolt"],
			changeeval : function (lvlA, choiceA) {
				// set the spells known for the level
				var knownObj = {
					Ca : {
						"1" : ["fire bolt", "light"],
						"4" : ["mage hand"],
						"7" : ["minor illusion"],
						"10" : ["shocking grasp"]
					},
					Sp : {
						"1" : ["sleep"],
						"2" : ["burning hands"],
						"3" : ["shield"],
						"5" : ["invisibility"],
						"7" : ["flaming sphere", "fireball", "fly", "wall of fire"],
						"8" : ["polymorph"],
						"9" : ["cone of cold"],
						"10" : ["hold monster"],
						"11" : ["chain lightning"]
					}
				}
				ClassList["sidekick-spellcaster"].setSidekickSpells(knownObj, lvlA);
			}
		}
	}
});

AddSubClass("sidekick-spellcaster", "healer", {
	regExpSearch : /^(?=.*healer)(?=.*sidekick).*$/i,
	subname : "Healer",
	fullname : "Healer (sidekick)",
	source : ["DnDEK", 0],
	abilitySave : 5,
	spellcastingFactor : 1,
	spellcastingList : {
		"class" : "cleric",
		level : [0, 6]
	},
	spellcastingKnown : {
		cantrips : [2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5],
		spells :   [1, 2, 3, 3, 4, 4, 8, 9,10,11,12,12]
	},
	spellcastingTable : [[0, 0, 0, 0, 0, 0, 0, 0, 0]].concat(levels.slice(0,12).map(function (n) {
		return defaultSpellTable[n < 7 ? Math.ceil(n / 2) : n];
	})),
	features : {
		"subclassfeature1" : {
			name : "Spellcasting",
			source : ["DnDEK", 0],
			minlevel : 1,
			description : "\n   I can cast cleric cantrips/spells I know, using Wisdom as my spellcasting ability",
			weaponsAdd : ["Sacred Flame"],
			changeeval : function (lvlA, choiceA) {
				// set the spells known for the level
				var knownObj = {
					Ca : {
						"1" : ["guidance", "sacred flame"],
						"4" : ["resistance"],
						"7" : ["light"],
						"10" : ["spare they dying"]
					},
					Sp : {
						"1" : ["cure wounds"],
						"2" : ["bless"],
						"3" : ["shield of faith"],
						"5" : ["aid"],
						"7" : ["lesser restoration", "protection from energy", "revivify", "death ward"],
						"8" : ["banishment"],
						"9" : ["greater restoration"],
						"10" : ["mass cure wounds"],
						"11" : ["heal"]
					}
				}
				ClassList["sidekick-spellcaster"].setSidekickSpells(knownObj, lvlA);
			}
		}
	}
});
var iFileName = "pub_20190917_DiA.js";
RequiredSheetVersion(13);
// This file adds all material from the Baldur's Gate: Descent into Avernus adventure to MPMB's Character Record Sheet

// Define the source
SourceList["DiA"] = {
	name : "Baldur's Gate: Descent into Avernus [background, items]",
	abbreviation : "DiA",
	group : "Adventure Books",
	url : "https://dnd.wizards.com/products/tabletop-games/rpg-products/baldursgate_descent",
	date : "2019/09/17"
};

BackgroundList["faceless"] = {
	regExpSearch : /faceless/i,
	name : "Faceless",
	source : ["DiA", 203],
	skills : ["Deception", "Intimidation"],
	gold : 10,
	languageProfs : [1],
	toolProfs : ["Disguise kit"],
	equipleft : [
		["Disguise kit", "", 3]
	],
	equipright : [
		["Costume", "", 4],
		["Belt pouch (with coins)", "", 1]
	],
	feature : "Dual Personalities",
	trait : [
		"I'm earnest and uncommonly direct.",
		"I strive to have no personality\u2014it's easier to forget what's hardly there.",
		"I treasure a memento of the person or instance that set me upon my path.",
		"I sleep just as much as I need to and on an unusual schedule.",
		"I think far ahead, a detachedness often mistaken for daydreaming.",
		"I cultivate a single obscure hobby or study and eagerly discuss it at length.",
		"I am ever learning how to be among others\u2014when to stay quiet, when to laugh.",
		"I behave like an extreme opposite of my persona."
	],
	ideal : [
		["Justice",
			"Justice. Place in society shouldn't determine one's access to what is right. (Good)"
		],
		["Security",
			"Security. Doing what must be done can't bring the innocent to harm. (Lawful)"
		],
		["Confusion",
			"Confusion. Deception is a weapon. Strike from where your foes won't expect. (Chaotic)"
		],
		["Infamy",
			"Infamy. My name will be a malediction, a curse that fulfills my will. (Evil)"
		],
		["Incorruptibility",
			"Incorruptibility. Be a symbol, and leave your flawed being behind. (Any)"
		],
		["Anonymity",
			"Anonymity. It's my deeds that should be remembered, not their instrument. (Any)"
		]
	],
	bond : [
		"I do everything for my family. My first thought is keeping them safe.",
		"What I do, I do for the world. The people don't realize how much they need me.",
		"I've seen too many in need. I must not fail them as everyone else has.",
		"I stand in opposition, lest the wicked go unopposed.",
		"I am exceptional. I do this because no one else can, and no one can stop me.",
		"I do everything for those who were taken from me."
	],
	flaw : [
		"I am callous about death. It comes to us all eventually.",
		"I never make eye contact or hold it unflinchingly.",
		"I have no sense of humor. Laughing is uncomfortable and embarrassing.",
		"I overexert myself, sometimes needing to recuperate for a day or more.",
		"I think far ahead, a detachedness often mistaken for daydreaming.",
		"I see morality entirely in black and white."
	],
	extra : [
		"Select a Faceless Persona",
		"Flamboyant spy or brigand",
		"Incarnation of nation or people",
		"Scoundrel with masked guise",
		"Vengeful spirit",
		"Manifestation of deity or faith",
		"Beauty accented with makeup",
		"Impersonation of another hero",
		"Embodiment of a school of magic",
		"Warrior with distinctive armor",
		"Fear-inspiring monstrous disguise"
	]
};
BackgroundFeatureList["religious community"] = {
	description : "I'm tightly connected with the religious community of the city. I know if a deity has a following in the city, any places that faith openly congregates, and the neighborhoods those faithful typically inhabit. While this isn't remarkable for most of the city's larger faiths, keeping track of the hundreds of religions newcomers bring with them is no mean feat.",
	source : [["DiA", 202], ["ALbackground", 0]]
};
BackgroundFeatureList["long-lost heir"] = {
	description : "I can pose as the long-lost heir to some imaginary or dead lineage. I'm well-versed in the mannerisms and idiosyncrasies of nobility, imitating them smoothly enough to convince anybody of my authenticity. However, any true test is likely to reveal my deception. I can enter places that only nobility can and might be able to bluff other through with me.",
	source : [["DiA", 202], ["ALbackground", 0]]
};
BackgroundFeatureList["criminal connections"] = {
	description : "In a big city, crime is just another business. As a result, I can arrange a meeting with a low-ranking operative of nearly any business, noble family, crew, government institution, or guild. This operative will hear me out and, at their discretion, take my information or request up their chain of command. These meetings almost always occur in shady venues.",
	source : [["DiA", 202], ["ALbackground", 0]]
};
BackgroundFeatureList["backstage pass"] = {
	description : "I know that most of the real business, in entertainment or otherwise, happens behind the scenes. It's easy for me to case what sorts of audiences attend a venue. After a successful performance, I may meet an enthusiastic member of the crowd\u2014someone of an occupation or social class that frequents the venue, who is delighted to talk with me, and to listen.",
	source : [["DiA", 202], ["ALbackground", 0]]
};
BackgroundFeatureList["dual personalities"] = {
	description : "The world knows me as my persona and those who seek to learn more about me find themselves stymied by my disguise. I'm unidentifiable as my true self while disguised and behaving as my persona, allowing me to change appearances between my two personalities as I wish. My deception might lose its effectiveness if someone realize the connection.",
	source : [["DiA", 204], ["ALbackground", 0]]
};
BackgroundFeatureList["social vengeance"] = {
	description : "I've lived my whole life amongst the lower class of the city, seeing the upper class flaunt their wealth while my hardworking neighbors struggled. I know their eagerness to give the wealthy their comeuppance. I can convince 1d6 commoners in a busy area in 2d10 min" + (typePF ? "utes" : "") + " to perform a non-illegal act that inconveniences a guard, noble, or wealthy looking individual.",
	source : [["DiA", 204], ["ALbackground", 0]]
};
BackgroundFeatureList["professional courtesy"] = {
	description : "I conduct my business in one of the city's districts and I'm familiar with its local crews, their territories, and inter-crew politics. When I need information about something in my district, I can learn the local gossip from crew members. Within my district, I can gain entry to nearly any bank, guild hall, place of business, workhouse, or crew meeting place.",
	source : [["DiA", 205], ["ALbackground", 0]]
};
BackgroundFeatureList["the real city"] = {
	description : "I know the city that most of its inhabitants ignore, the dog-eat-dog world of the homeless and unfortunate. I know where to go for anonymity. In these slums and alley camps, I can get a damp bed and a bad meal, but also a degree of privacy and no questions asked. Living here isn't comfortable, but it's unlikely any will find me\u2014and I can stay as long as I want.",
	source : [["DiA", 205], ["ALbackground", 0]]
};
BackgroundFeatureList["patriar"] = {
	description : "As a member of an elite family of the city, I may pass through without paying tolls, enter the better part of town and stay there after dark, mingle among the nobility unquestioned, and impress those looking for wealthy patrons. My word is accepted over others' without question, and any corruption among guards or officials tends to work in my favor.",
	source : [["DiA", 206], ["ALbackground", 0]]
};
BackgroundFeatureList["immigrant experience"] = {
	description : "Even after my short time in the city, I've learned it holds more walls and gates than those the guards patrol. I'm known within the city's immigrant communities. Should I ever need to learn about a foreign land, people, tradition, or history, I know where to find someone with firsthand experience\u2014likely somewhere in the poorer part of town.",
	source : [["DiA", 206], ["ALbackground", 0]]
};
BackgroundFeatureList["rumor monger"] = {
	description : "Via my personal rumor mill and published articles, I can surmise a great deal about the secrets of the city's inhabitants\u2014necromancy, spying, smuggling, dealing in magical wares. Whenever a noteworthy crime or happening occurs in the city, I immediately have a list of 1d4 suspects who, if they aren't involved, have a strong chance of knowing who is.",
	source : [["DiA", 206], ["ALbackground", 0]]
};
BackgroundFeatureList["smuggler's sense"] = {
	description : "I'm familiar with the docks of the city, the movement of inspectors and tax collectors, the way cargo and coin flows, the movements of the harbor guards, and how to operate the port's machinery for moving wares. As a result, it's easy for me to hustle a load of cargo ashore or see such a cargo onto a cooperative ship without attracting suspicion or taxation.",
	source : [["DiA", 207], ["ALbackground", 0]]
};
BackgroundFeatureList["city guard: lower city (the flaming fists)"] = {
	description : "I'm required to take a regular shift patrolling the lower or outer city and I must report for training once every ten days. In return, I have access to the guard's fortresses and a direct line of communication with officers and other soldiers. I can also pass through the city's gates and go to the upper city without question, but can't bring guests to the upper city.",
	source : [["DiA", 207], ["ALbackground", 0]]
};
BackgroundFeatureList["city guard: upper city (the watch)"] = {
	description : "I'm required to take a regular shift patrolling the upper city or its gates and I must report for training once every ten days. In return, I have access to the citadel and a direct line of communication with officers and officials. My word carries considerable weight. I can escort people into the upper city unimpeded, but I'm regarded with suspicion in the lower city.",
	source : [["DiA", 207], ["ALbackground", 0]]
};
BackgroundFeatureList["loyalty test"] = {
	description : "I can spot the behaviors common to corrupt guards and military officers a mile away. While this doesn't equate to evidence, and my sense isn't foolproof, my instinct proves a starting point to determine who might take a bribe, who might turn a blind eye to a crime, who might have criminal connections, or who might fulfill their duties strictly by the book.",
	source : [["DiA", 207], ["ALbackground", 0]]
};
BackgroundFeatureList["gateguide connection"] = {
	description : "I've associated with enough of the Gateguides crew that I know their torch-based code. From the lighting, placement, and type of torch arranged on or near a structure, I can gather information about those who live or do business there\u2014if they deal fairly with strangers, have guild or government connections, or their standing with the Gateguides.",
	source : [["DiA", 207], ["ALbackground", 0]]
};

CreatureList["abyssal chicken"] = {
	name : "Abyssal Chicken",
	source : ["DiA", 97],
	size : 5,
	type : "Fiend",
	subtype : "demon",
	alignment : "Chaotic Evil",
	ac : 13,
	hp : 10,
	hd : [3, 4],
	speed : "30 ft,\nfly 30 ft",
	scores : [6, 14, 13, 4, 9, 5],
	saves : ["", "", "", "", "", ""],
	damage_immunities : "cold, fire, lightning",
	condition_immunities : "blinded, poisoned",
	senses : "Blindsight 30 ft (blind beyond this radius)",
	passivePerception : 9,
	languages : "understands Abyssal but can't speak",
	challengeRating : "1/4",
	proficiencyBonus : 2,
	attacksAction : 2,
	attacks : [{
		name : "Bite",
		ability : 2,
		damage : [1, 4, "piercing"],
		range : "Melee (5 ft)",
		description : "One bite and one claws attack as an Attack action"
	}, {
		name : "Claws",
		ability : 2,
		damage : [1, 6, "piercing"],
		range : "Melee (5 ft)",
		description : "One claws and one bite attack as an Attack action"
	}],
	traits : [{
		name : "Bad Flier",
		description : "The abyssal chicken falls at the end of a turn if it's airborne and the only thing holding it aloft is its flying speed."
	}]
}

MagicItemsList["battle standard of infernal power"] = {
	name : "Battle Standard of Infernal Power",
	source : ["DiA", 223],
	type : "wondrous item",
	rarity : "very rare",
	description : "While holding the banner, my weapon attacks and those of my allies within 300 ft of me count as magical for the purposes of overcoming damage immunities and resistances. The standard has a small unopenable cage with an incapacitated quasit within. It turns to smoke if killed or released and a new one appears.",
	descriptionLong : "While holding the banner, my weapon attacks and those of my allies within 300 ft of me count as magical for the purposes of overcoming damage immunities and resistances.\nThis hell-forged battle standard is made of infernal iron and fitted with a small, unopenable cage containing a quasit. The trapped quasit is incapacitated, and its cage has AC 19, 10 hit points, and immunity to all types of damage except force damage. If killed or somehow released, the quasit disappears in a cloud of smoke, and a new one appears in the cage, provided the cage is intact.",
	descriptionFull : "This hell-forged battle standard is made of infernal iron and fitted with a small, unopenable cage containing a quasit. The trapped quasit is incapacitated, and its cage has AC 19, 10 hit points, and immunity to all types of damage except force damage. If killed or somehow released, the quasit disappears in a cloud of smoke, and a new one appears in the cage, provided the cage is intact.\n   While you hold the banner, your weapon attacks and those of all allied creatures within 300 feet of you count as magical for the purposes of overcoming damage immunities and resistances.",
	attunement : true,
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.isSpell && !v.thisWeapon[1] && !v.theWea.isMagicWeapon && !(/counts as( a)? magical/i).test(fields.Description)) {
					fields.Description += (fields.Description ? '; ' : '') + 'Counts as magical';
				};
			},
			"My weapon attacks count as magical for overcoming resistances and immunities."
		]
	}
}
MagicItemsList["gauntlets of flaming fury"] = {
	name : "Gauntlets of Flaming Fury",
	source : ["DiA", 223],
	type : "wondrous item",
	rarity : "rare",
	description : "While wearing both these steel gauntlets, any weapons I grasp with them count as magical. As a bonus action once per dawn, I can use them to envelop one or two melee weapons in my grasp with magical flames, causing them to deal an extra 1d6 fire damage on a hit. This last until I sheath or let go of a weapon.",
	descriptionFull : "While you wear both of these steel gauntlets, any non- magical weapon you grasp with either gauntlet is treated as a magic weapon. As a bonus action, you can use the gauntlets to cause magical flames to envelop one or two melee weapons in your grasp. Each flaming weapon deals an extra 1d6 fire damage on a hit. The flames last until you sheath or let go of either weapon. Once used, this property can't be used again until the next dawn.",
	attunement : true,
	action : [["bonus action", ""]],
	usages : 1,
	recovery : "dawn",
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.isSpell && !v.isNaturalWeapon && !v.thisWeapon[1] && !v.theWea.isMagicWeapon && !(/dancing|counts as( a)? magical/i).test(fields.Description)) {
					fields.Description += (fields.Description ? '; ' : '') + 'Counts as magical';
				};
			},
			"Any nonmagical weapons that I grasp with my Gauntlets of Flaming Fury count as magical for overcoming resistances and immunities."
		]
	}
}
MagicItemsList["fane-eater"] = {
	name : "Fane-Eater",
	source : ["DiA", 223],
	type : "weapon (battleaxe)",
	rarity : "legendary",
	description : "This battleaxe adds a +3 bonus to attack and damage rolls made with it. When I use it to attack a creature and roll a 20 on the attack roll, the creature takes an extra 2d8 necrotic damage, and I regain a number of hit points equal to the necrotic damage taken.",
	descriptionFull : "Fane-Eater is a battleaxe belonging to Arkhan the Cruel.\n   You gain a +3 bonus to attack and damage rolls with Fane-Eater. If you attack a creature with this weapon and roll a 20 on the attack roll, the creature takes an extra 2d8 necrotic damage, and you regain a number of hit points equal to the necrotic damage taken.",
	attunement : true,
	prerequisite : "Requires attunement by an evil cleric or paladin",
	prereqeval : function(v) { return (classes.known.paladin || classes.known.cleric) && (/evil/i).test(What("Alignment")); },
	weight : 4,
	weaponsAdd : ["Fane-Eater"],
	weaponOptions : {
		baseWeapon : "battleaxe",
		regExpSearch : /fane-eater/i,
		name : "Fane-Eater",
		source : ["DiA", 223],
		description : "Versatile (1d10); On 20 to hit: +2d8 necrotic damage and I heal same amount"
	}
}
MagicItemsList["hellfire weapon"] = {
	name : "Hellfire Weapon",
	nameTest : "Hellfire",
	source : ["DiA", 223],
	type : "weapon (any)",
	rarity : "uncommon",
	description : "This weapon is fashioned from infernal iron and traced with veins of hellfire that shed dim light in a 5-ft radius. Any humanoid killed by an attack made with this weapon has its soul funneled into the River Styx, where it's reborn instantly as a lemure devil.",
	descriptionFull : "This weapon is fashioned from infernal iron and traced with veins of hellfire that shed dim light in a 5-foot-radius.\n   Any humanoid killed by an attack made with this weapon has its soul funneled into the River Styx, where it's reborn instantly as a lemure devil.",
	chooseGear : {
		type : "weapon",
		prefixOrSuffix : "suffix",
		descriptionChange : ["replace", "weapon"]
	},
	calcChanges : {
		atkAdd : [
			function (fields, v) {
				if (!v.theWea.isMagicWeapon && (/hellfire/i).test(v.WeaponText)) {
					v.theWea.isMagicWeapon = true;
					fields.Description = fields.Description.replace(/(, |; )?Counts as magical/i, '');
					fields.Description += (fields.Description ? '; ' : '') + 'Humanoids killed lose their soul';
				}
			},
			'If I include the word "Hellfire" in a the name of a weapon, it will be treated as the magic weapon Hellfire Weapon. Any humanoid killed by the weapon has its soul funneled into the River Styx, and are instantly reborn as a lemure devil.'
		]
	}
}
MagicItemsList["helm of devil command"] = {
	name : "Helm of Devil Command",
	source : ["DiA", 223],
	type : "wondrous item",
	rarity : "very rare",
	description : "This helm has 3 charges, regaining all 24 h after using the last. I can use 1 charge to cast Dominate Monster on a devil, but it knows I tried to charm it. It allows me to know the exact location of all devils within 1000 ft and I can telepathically communicate with one of them at a time, or broadcast my thoughts to all.",
	descriptionLong : "This bulky, eyeless helmet resizes to fit my head and allows me to see out of it as if I was not wearing it. It has 3 charges, regaining all 24 hours after using the last charge. I can use 1 charge to cast Dominate Monster on a devil, but if it can see me do so, the devil knows I tried to charm it. The helm also allows me to know the exact location of all devils within 1000 ft and I can telepathically communicate with one of them at a time, or broadcast my thoughts to all within range, but they have no special means of replying. If I use its dominating power while I'm on the Nine Hells, there is a chance it attracts a narzugon.",
	descriptionFull : "This bulky, eyeless helmet is made for a pit fiend but magically resizes to fit the heads of other wearers.\n   While wearing the helm, you can see out of it as though you weren't wearing it. In addition, you know the exact location and type of all devils within 1,000 feet of you. You can telepathically communicate with a devil within range, or you can broadcast your thoughts to all devils within range. The devils receiving your broadcasted thoughts have no special means of replying to them.\n   The helm has 3 charges. As an action, you can expend 1 charge to cast dominate monster (save DC 21), which affects devils only. (The spell fails and the charge is wasted if you target any creature that's not a devil.) If a devil can see you when you cast this spell on it, the devil knows you tried to charm it. The helm regains all its charges 24 hours after its last charge is expended.\n   If you are not a devil, using the helm's dominate monster property in the Nine Hells has a 20 percent chance of attracting a narzugon, which arrives on the back of a nightmare mount in 1d4 hours. The narzugon tries to recover the helm, killing you if necessary to obtain it. If it gets the helm, the narzugon tries to deliver it to its infernal master.",
	attunement : true,
	prerequisite : "Requires attunement by a creature that can speak infernal",
	prereqeval : function(v) { return (/infernal/i).test(v.languageProfs); },
	usages : 3,
	recovery : "Special",
	fixedDC : 21,
	spellFirstColTitle : "Ch",
	spellcastingBonus : {
		name : "1 charge",
		spells : ["dominate monster"],
		selection : ["dominate monster"],
		firstCol : 1
	},
	spellChanges : {
		"dominate monster" : {
			description : "Devil save or charmed, follows telepathic commands, 1 a for complete control; save on dmg",
			changes : "Can only affect a devil."
		}
	}
}
MagicItemsList["infernal puzzle box"] = {
	name : "Infernal Puzzle Box",
	source : ["DiA", 224],
	type : "wondrous item",
	rarity : "uncommon",
	description : "This cube-shaped container is around 15 cm on a side and is composed of airtight, interlocking parts. It can't be magically opened and is immune to all damage. I can figure out how to open it in 1 hour with a DC 30 Investigation check. If failed by 5 or more, I take 12d6 psychic damage, Wis DC 18 halves.",
	descriptionLong : "This cube-shaped container is around 15 cm on a side and is composed of airtight, interlocking parts made from materials found in the Nine Hells. It can't be magically opened and is immune to all damage while shut. Every infernal puzzle box has an unique mundane way of opening it. I can figure out how to open this box in 1 hour with a DC 30 Investigation check, but if I fail this check by 5 or more, I take 12d6 psychic damage, Wisdom save DC 18 halves. Once I figure out the trick or sequence of steps needed to open this box, I can open it as an action, allowing access to the box's contents.",
	descriptionFull : "An infernal puzzle box is a cube-shaped container 5 to 6 inches on a side, composed of airtight, interlocking parts made from materials found in the Nine Hells. Most of these boxes are made of infernal iron, though some are carved from bone or horn. Infernal puzzle boxes are used to safeguard diabolical contracts signed between devils and mortals, even after the terms of these contracts are fulfilled. An empty infernal puzzle box weighs 3 pounds regardless of the materials used to fashion it.\n   When an object small enough to fit inside an infernal puzzle box is placed in it, the container magically seals shut around the object, and no magic can force the box open. The sealed box becomes immune to all damage as well. Every infernal puzzle box is constructed with a unique means of opening it. The trick to solving the puzzle is always mundane, never magical. Once a creature figures out the trick or sequence of steps needed to open a particular infernal puzzle box, that creature can open the box as an action, allowing access to the box's contents.\n   A creature that spends 1 hour holding an infernal puzzle box while trying to open it can make a DC 30 Intelligence (Investigation) check. If the check succeeds, the creature figures out the trick or sequence of steps needed to open the box. If the check fails by 5 or more, the creature must make a DC 18 Wisdom saving throw, taking 42 (12d6) psychic damage on a failed save, or half as much damage on a successful one.",
	weight : 3
}
if (!SourceList.MToF) {
	MagicItemsList["infernal tack"] = {
		name : "Infernal Tack",
		source : [["MToF", 167], ["DiA", 224]],
		type : "wondrous item",
		rarity : "legendary",
		description : "While wearing the spurs of this set, the nightmare equipped with the bridle, bit, reins, saddle, and stirrups is under my command. As an action, I can have it appear in 20 ft at the start of my next turn. It acts on as my ally on my initiative, remains for 1 day, until I or it dies, or I dismiss it as an action. If it dies, it reforms in 24 h.",
		descriptionLong : "This tack consists of a bridle, bit, reins, saddle, stirrups, and spurs. A nightmare equipped with the tack serves whoever wears the spurs until the wearer dies or the tack is removed. As an action, I can clash the spurs together or scrape them through blood, causing the nightmare to appear within 20 ft at the start of my next turn. It acts as my ally on my initiative count, remains for 1 day, until I or it dies, or until I dismiss it as an action. If it dies, it reforms within 24 hours, after which I can summon it again. The tack doesn't create a nightmare from thin air; one must first be subdued so the tack can be placed on it.",
		descriptionFull : "A narzugon binds a nightmare to its service with infernal tack, which consists of a bridle, bit, reins, saddle, stirrups, and spurs. A nightmare equipped with infernal tack must serve whoever wears the spurs until the wearer dies or the tack is removed.\n   You can use an action to call a nightmare equipped with infernal tack by clashing the spurs together or scraping them through blood. The nightmare appears at the start of your next turn, within 20 feet of you. It acts as your ally and takes its turn on your initiative count. It remains for 1 day, until you or it dies, or until you dismiss it as an action. If the nightmare dies, it reforms in the Nine Hells within 24 hours, after which you can summon it again.\n   The tack doesn't conjure a nightmare from thin air; one must first be subdued so the tack can be placed on it. No nightmare accepts this forced servitude willingly, but some eventually form strong loyalties to their masters and become true partners in evil.",
		attunement : true,
		weight : 26, // riding saddle (25) + bit and bridle (1)
		prerequisite : "Requires attunement by a creature of evil alignment",
		prereqeval : function(v) { return (/evil/i).test(What("Alignment")); },
		action : [["action", ""]]
	}
}
MagicItemsList["matalotok"] = {
	name : "Matalotok",
	source : ["DiA", 224],
	type : "weapon (warhammer)",
	rarity : "legendary",
	description : "This ancient warhammer, the Frost Father, was fashioned by Thrym. It is frigid to the touch and wreathed in mist. I'm immune to cold damage while holding it. Whenever I deal damage to a creature with it, it radiates a burst of intense cold in a 30-ft radius sphere, dealing 3d6 cold damage to all creatures within.",
	descriptionFull : "Matalotok, the Frost Father, is an ancient hammer fashioned by Thrym, the god of frost giants. The favored weapon of the demon lord Kostchtchie, Matalotok is frigid to the touch and wreathed in mist.\n   You are immune to cold damage while holding Matalotok. Whenever it deals damage to a creature, the hammer radiates a burst of intense cold in a 30-foot-radius sphere. Each creature in that area takes 10 (3d6) cold damage.",
	attunement : true,
	weight : 2,
	weaponsAdd : ["Matalotok"],
	weaponOptions : {
		baseWeapon : "warhammer",
		regExpSearch : /matalotok/i,
		name : "Matalotok",
		source : ["DiA", 224],
		description : "Versatile (1d10); On hit: all in 30-ft radius take 3d6 cold damage"
	},
	savetxt : { immune : ["cold"] }
}
MagicItemsList["obsidian flint dragon plate"] = {
	name : "Obsidian Flint Dragon Plate",
	source : ["DiA", 224],
	type : "armor (plate)",
	rarity : "legendary",
	description : "I gain a +2 bonus to AC and resistance to poison damage while I wear this plate armor. In addition, I gain advantage on ability checks and saving throws made to avoid or end the grappled condition on myself.",
	descriptionFull : "You gain a +2 bonus to AC and resistance to poison damage while you wear this armor. In addition, you gain advantage on ability checks and saving throws made to avoid or end the grappled condition on yourself.",
	armorAdd : "Obsidian Flint Dragon Plate",
	armorOptions : {
		regExpSearch : /^(?=.*obsidian)(?=.*flint)(?=.*dragon)(?=.*plate).*$/i,
		name : "Obsidian Flint Dragon Plate",
		source : ["DiA", 224],
		type : "heavy",
		ac : 20,
		stealthdis : true,
		weight : 65,
		strReq : 15
	},
	dmgres : ["Poison"],
	savetxt : { adv_vs : ["grappled"] }
}
var shieldOfTheHiddenLordFullDescription = [
	"The Shield of the Hidden Lord is of celestial origin and serves as a prison for the pit fiend Gargauth, whose mortal followers revere it as a god. Over time, Gargauth's evil has warped the shield's appearance, so that its celestial motif and designs have become twisted into a fiendish face that subtly moves in disturbing ways.",
	"While holding this shield, you gain a +2 bonus to AC and resistance to fire damage.",
	">>Sentience<<. The Shield of the Hidden Lord is sentient as long as it imprisons Gargauth. While sentient, the shield has the following properties:",
	"\u2022 The shield has an Intelligence of 22, a Wisdom of 18, and a Charisma of 24, as well as hearing and truesight out to a range of 120 feet.",
	"\u2022 The shield can speak, read, and understand Common and Infernal, and it can communicate telepathically with any creature it can sense within 120 feet of it. Its voice is a deep, hollow whisper.",
	"\u2022 The shield has 3 charges. You can use an action to expend 1 charge to cast Fireball or 2 charges to cast Wall of Fire from the shield (save DC 21 for each). The Wall of Fire spell lasts for 1 minute (no concentration required). The shield regains all expended charges daily at dawn.",
	"\u2022 Anytime during your turn, the shield can choose to radiate an aura of dread for 1 minute. (This is not a power of the shield that you control.) Any creature hostile to you that starts its turn within 20 feet of the shield must make a DC 18 Wisdom saving throw. On a failed save, the creature is frightened until the start of its next turn. On a successful save, the creature is immune to this power of the shield for the next 24 hours. Once the shield uses this power, it can't use it again until the next dawn.\n",
	">>Gargauth's Personality<<. Gargauth desperately seeks freedom but can't escape on its own. The pit fiend won't reveal its true nature, referring to itself only as the Hidden Lord. It drops hints and subtle suggestions that it is an angel trapped in an unholy prison. If released from the shield, the pit fiend honors the terms of whatever bargain it struck to facilitate its escape.",
	"While trapped in the shield, Gargauth carefully steers the shield's current owner toward committing acts of cruelty and domination, hoping to condemn the individual's soul to the Nine Hells. Conflict occurs if the shield's owner does anything that would make it more difficult for Gargauth to escape its prison, such as leaving the shield in a place where others are unlikely to find it.",
	"Gargauth doesn't know how to escape from the shield. The pit fiend believes (incorrectly) that it can break free of the shield if it's brought to the Nine Hells, for it's convinced that the shield's powers are weaker there.",
	">>Freeing Gargauth<<. Casting dispel evil and good on the shield has a 1 percent chance of freeing the pit fiend, or automatically succeeds if the spell is cast by a solar, a planetar, or an archdevil. A god can release the pit fiend by touching the shield and speaking Gargauth's name. When released, Gargauth appears in a random, unoccupied space as close to the shield as possible."
];
MagicItemsList["shield of the hidden lord"] = {
	name : "Shield of the Hidden Lord",
	source : ["DiA", 225],
	type : "shield",
	rarity : "legendary",
	description : "This shield grants me +2 bonus to AC and resistance to fire damage. It has 3 charges, regaining all at dawn. I can expend 1 charge to cast Fireball or 2 charges to cast Wall of Fire from it at DC 21. The shield is sentient and can communicate telepathically with any creature within 120 ft of it. See \"Notes\" page for more.",
	descriptionFull : shieldOfTheHiddenLordFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	attunement : true,
	toNotesPage : [{
		name : "Features",
		popupName : "Features of the Shield of the Hidden Lord",
		note : desc(shieldOfTheHiddenLordFullDescription).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/you are /ig, "I am ").replace(/(to) you/ig, "$1 me").replace(/you /ig, "I ") + "\n\n" + sentientItemConflictTxt
	}],
	weight : 6,
	shieldAdd : ["Shield of the Hidden Lord", 4, 6],
	usages : 3,
	recovery : "Dawn",
	fixedDC : 21,
	spellFirstColTitle : "Ch",
	spellcastingBonus : [{
		name : "1 charge",
		spells : ["fireball"],
		selection : ["fireball"],
		firstCol : 1
	}, {
		name : "2 charges",
		spells : ["wall of fire"],
		selection : ["wall of fire"],
		firstCol : 2
	}],
	spellChanges : {
		"wall of fire" : {
			duration : "1 min",
			changes : "The Wall of Fire lasts for 1 minute and does not require concentration."
		}
	}
}
var soulCoinFullDescription = [
	"Soul coins are about 5 inches across and about 1 inch thick, minted from infernal iron. Each coin weighs one-third of a pound, and is inscribed with Infernal writing and a spell that magically binds a single soul to the coin. Because each soul coin has a unique soul trapped within it, each has a story. A creature might have been imprisoned as a result of defaulting on a deal, while another might be the victim of a night hag's curse.",
	">>Carrying Soul Coins<<. To hold a soul coin is to feel the soul bound within it\u2014overcome with rage or fraught with despair.",
	"An evil creature can carry as many soul coins as it wishes (up to its maximum weight allowance). A non-evil creature can carry a number of soul coins equal to or less than its Constitution modifier without penalty. A non-evil creature carrying a number of soul coins greater than its Constitution modifier has disadvantage on its attack rolls, ability checks, and saving throws.",
	">>Using a Soul Coin<<. A soul coin has 3 charges. A creature carrying the coin can use its action to expend 1 charge from a soul coin and use it to do one of the following:",
	"\u2022 >>Drain Life<<. You siphon away some of the soul's essence and gain 1d10 temporary hit points.",
	"\u2022 >>Query<<. You telepathically ask the soul a question and receive a brief telepathic response, which you can understand. The soul knows only what it knew in life, but it must answer you truthfully and to the best of its ability. The answer is no more than a sentence or two and might be cryptic.\n",
	">>Freeing a Soul<<. Casting a spell that removes a curse on a soul coin frees the soul trapped within it, as does expending all of the coin's charges. The coin itself rusts from within and is destroyed once the soul is released. A freed soul travels to the realm of the god it served or the outer plane most closely tied to its alignment (DM's choice). The souls of lawful evil creatures released from soul coins typically emerge from the River Styx as lemure devils.",
	"A soul can also be freed by destroying the coin that contains it. A soul coin has AC 19, 1 hit point for each charge it has remaining, and immunity to all damage except that which is dealt by a hellfire weapon or an infernal war machine's furnace.",
	"Freeing a soul from a soul coin is considered a good act, even if the soul belongs to an evil creature.",
	">>Hellish Currency<<. Soul coins are a currency of the Nine Hells and are highly valued by devils. The coins are used among the infernal hierarchy to barter for favors, bribe the unwilling, and reward the faithful for services rendered.",
	"Soul coins are created by Mammon and his greater devils on Minauros, the third layer of the Nine Hells, in a vast chamber where the captured souls of evil mortals are bound into the coins. These coins are then distributed throughout the Nine Hells to be used for goods and services, infernal deals, dark bargains, and bribes."
];
MagicItemsList["soul coin"] = {
	name : "Soul Coin",
	source : ["DiA", 225],
	type : "wondrous item",
	rarity : "uncommon",
	description : "Each coin traps a unique soul, whose rage or despair is felt by me while I hold it. A coin has 3 charges. As an action, I can expend 1 charge to either siphon the soul's essence to grant me 1d10 temporary HP or telepathically ask the soul a question which it must answer truthfully. See \"Notes\" page for more.",
	descriptionFull : soulCoinFullDescription.join("\n   ").replace(/>>(.*?)<</g, function(a, match) { return toUni(match); }),
	toNotesPage : [{
		name : "Features",
		popupName : "Features of Soul Coins",
		note : desc(soulCoinFullDescription).replace(/>>(.*?)<</g, function(a, match) { return match.toUpperCase(); }).replace(/your/g, "my").replace(/you are /ig, "I am ").replace(/(answer) you/ig, "$1 me").replace(/you /ig, "I ")
	}],
	weight : 0.3,
	usages : 3,
	recovery : "Never",
	action : [["action", ""]]
}
var iFileName = "pub_20190917_DiA.js";
RequiredSheetVersion(13);
// This file adds the winged aasimar/tiefling from the Adventurers League Player's Guide v9.1: Inglorious Redemption to MPMB's Character Record Sheet

// Define the source
SourceList["ALPGs9"] = {
	name : "AL Player's Guide v9.1: Inglorious Redemption",
	abbreviation : "ALPGs9",
	group : "Adventurers League",
	url : "https://www.dmsguild.com/product/208178",
	date : "2019/09/17"
};

/*
	Add this source to the Aasimar from VGtM and the Winged Tiefling variant from SCAG
	Also, add a winged variant to the three Aasimar subraces from VGtM
*/
[
	["fallen aasimar", false],
	["protector aasimar", false],
	["scourge aasimar", false],
	["tiefling-winged", true],
	["feral tiefling-winged", true]
].forEach(function (rac) {
	var rObj = rac[1] ? RaceSubList[rac[0]] : RaceList[rac[0]];
	if (!rObj) return;
	rObj.source = (isArray(rObj.source[0]) ? rObj.source : [rObj.source]).concat([["ALPGs9", 6], ["ALbackground", 0]]);
	if (rac[0].indexOf("aasimar") !== -1) {
		AddRacialVariant(rac[0], "winged", {
			regExpSearch : /wing/i,
			name : "Winged " + rObj.name,
			source : [["ALPGs9", 6], ["ALbackground", 0]],
			plural : "Winged " + rObj.plural,
			speed : {
				walk : { spd : 30, enc : 20 },
				fly : { spd : 30, enc : 0 }
			},
			trait : "Winged " + rObj.trait.replace(/\)(\r|\n|.)+/, ")\n\nHealing Hands:\n   As an action, once per long rest, I can touch to heal for my level in HP.\nWings:\n   Once I'm 5th level, I sprout feathered wings from my shoulder blades that give me a flying speed of 30 feet when I'm not wearing heavy armor."),
			features : {
				"healing hands" : {
					name : "Healing Hands",
					usages : 1,
					minlevel : 1,
					recovery : "long rest",
					additional : levels.map(function (n) { return n + " HP"; }),
					action : ["action", ""]
				}
			},
			abilitySave : "",
			spellcastingAbility : "",
			spellcastingBonus : ""
		});
	}
});
